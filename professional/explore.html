<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Explore Elite Talent</title>
    <link rel="stylesheet" href="../css/classified-navbar.css">
    <link rel="icon" type="image/png" href="../assets/logo.jpg">

    <link href="https://fonts.googleapis.com/css2?family=Google+Sans:wght@400;500;600;700&family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        :root {
            --primary-color: #1a73e8;
            --primary-dark: #1557b0;
            --primary-light: #e8f0fe;
            --secondary-color: #34a853;
            --accent-color: #fbbc04;
            --text-primary: #202124;
            --text-secondary: #5f6368;
            --text-muted: #9aa0a6;
            --background-primary: #ffffff;
            --background-secondary: #f8f9fa;
            --border-color: #dadce0;
            --border-light: #e8eaed;
            --shadow-sm: 0 1px 2px 0 rgba(60, 64, 67, 0.3), 0 1px 3px 1px rgba(60, 64, 67, 0.15);
            --shadow-md: 0 4px 8px 3px rgba(60, 64, 67, 0.15);
            --shadow-lg: 0 8px 16px 6px rgba(60, 64, 67, 0.15);
            --radius-sm: 8px;
            --radius-md: 12px;
            --radius-lg: 16px;
            --spacing-xs: 0.5rem;
            --spacing-sm: 1rem;
            --spacing-md: 1.5rem;
            --spacing-lg: 2rem;
            --spacing-xl: 3rem;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Google Sans', 'Roboto', 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: var(--background-primary);
            color: var(--text-primary);
            line-height: 1.6;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }

        
        /* Main Content */
        .dashboard-content {
            padding: calc(80px + var(--spacing-lg)) var(--spacing-lg) var(--spacing-xl);
            max-width: 1400px;
            margin: 0 auto;
        }

        .dashboard-section {
            text-align: center;
        }

        .dashboard-section h1 {
            font-size: clamp(2rem, 5vw, 3rem);
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            letter-spacing: -0.02em;
            line-height: 1.2;
        }

        .dashboard-section p { 
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-xl);
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.6;
        }

        /* AI Search Container */
        .ai-search-container {
            margin: var(--spacing-xs) 0;
            display: flex;
            justify-content: center;
        }

        .ai-search-box {
            display: flex;
            align-items: center;
            background: var(--background-primary);
            border: 2px solid var(--border-color);
            border-radius: var(--radius-lg);
            padding: var(--spacing-sm) var(--spacing-md);
            width: 100%;
            max-width: 600px;
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .ai-search-box:focus-within {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 4px var(--primary-light);
        }

        .ai-search-icon {
            color: var(--text-muted);
            font-size: 1.25rem;
            margin-right: var(--spacing-sm);
        }

        .ai-search-box input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 1.25rem;
            color: var(--text-primary);
            padding: var(--spacing-sm) 0;
            font-family: inherit;
        }

        .ai-search-box input::placeholder {
            color: var(--text-muted);
            font-size: 1.25rem;
        }

        .ai-search-box button {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm) var(--spacing-md);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .ai-search-box button:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        /* Hiring Ad Section */
        .hiring-ad-section {
            background: linear-gradient(135deg, var(--primary-light) 0%, #f0f4ff 100%);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            margin: var(--spacing-sm) 0;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .hiring-ad-section::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><defs><pattern id="grain" width="100" height="100" patternUnits="userSpaceOnUse"><circle cx="25" cy="25" r="1" fill="%23ffffff" opacity="0.1"/><circle cx="75" cy="75" r="1" fill="%23ffffff" opacity="0.1"/><circle cx="50" cy="10" r="0.5" fill="%23ffffff" opacity="0.1"/></pattern></defs><rect width="100" height="100" fill="url(%23grain)"/></svg>');
            pointer-events: none;
        }

        .hiring-ad-text {
            position: relative;
            z-index: 1;
        }

        .hiring-ad-text h3 {
            font-size: 2rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            letter-spacing: -0.01em;
        }

        .hiring-ad-text p {
            font-size: 1.125rem;
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            max-width: 500px;
            margin-left: auto;
            margin-right: auto;
        }

        .hiring-ad-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: 1rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            gap: var(--spacing-xs);
        }

        .hiring-ad-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        /* Search Results */
        .search-results-header {
            margin: var(--spacing-md) 0 var(--spacing-md);
            text-align: center;
        }
        
        .search-results-header h2 {
            font-size: 1.5rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-sm);
        }

        /* Student Cards - Redesigned */
        .students-list {
            display: flex;
            flex-direction: column;
            gap: var(--spacing-md);
            margin-top: var(--spacing-sm);
        }
        
        .student-card {
            background: var(--background-primary);
            border: 1px solid var(--border-light);
            border-radius: var(--radius-lg);
            padding: var(--spacing-lg);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
            position: relative;
            overflow: hidden;
        }

        .student-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .student-card .card-content {
            display: flex;
            align-items: flex-start;
            gap: var(--spacing-lg);
            width: 100%;
        }

        .student-card .profile-section {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: var(--spacing-sm);
            width: 120px;
        }

        .student-card .profile-pic {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: cover;
            border: 3px solid var(--border-light);
            transition: all 0.3s ease;
            box-shadow: var(--shadow-sm);
        }

        .student-card:hover .profile-pic {
            transform: scale(1.05);
        }

        .student-card .info-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            min-width: 0;
            text-align: left;
        }

        .student-card .name-section {
            display: flex;
            align-items: center;
            gap: var(--spacing-sm);
        }

        .student-card .name-section h3 {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .student-card .college-section h4 {
            font-size: 1.25rem;
            color: var(--text-primary);
            margin: 0;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            font-weight: 500;
        }

        .student-card .skills-section {
            margin-top: var(--spacing-xs);
        }

        .student-card .skills-section p {
            font-size: 1.1rem;
            color: var(--text-primary);
            margin: 0;
            line-height: 1.5;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            white-space: normal;
        }

        .student-card .skills-section p strong {
            color: var(--text-primary);
            font-weight: 600;
        }

        .student-card .about-section {
            margin-top: var(--spacing-xs);
        }

        .student-card .about-section p {
            font-size: 1rem;
            color: var(--text-primary);
            margin: 0;
            line-height: 1.5;
            overflow: hidden;
            text-overflow: ellipsis;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            white-space: normal;
        }

        .student-card .actions-section {
            flex-shrink: 0;
            display: flex;
            flex-direction: column;
            gap: var(--spacing-sm);
            align-items: center;
            justify-content: center;
            width: 140px;
        }

        .ai-intro-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: 0.75rem 1.5rem;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            white-space: nowrap;
            width: auto;
            text-align: center;
            font-family: 'Google Sans', 'Roboto', sans-serif;
        }

        .ai-intro-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
            box-shadow: var(--shadow-sm);
        }

        .ai-intro-btn.connected {
            background: var(--secondary-color);
            cursor: not-allowed;
        }

        .ai-intro-btn.connected:hover {
            background: var(--secondary-color);
            transform: none;
            box-shadow: none;
        }

        .toggle-details {
            color: var(--primary-color);
            background: none;
            border: none;
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            text-decoration: underline;
            transition: color 0.2s ease;
            white-space: nowrap;
            width: auto;
            text-align: center;
            font-family: 'Google Sans', 'Roboto', sans-serif;
        }

        .toggle-details:hover {
            color: var(--primary-dark);
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.95);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1001;
            backdrop-filter: blur(4px);
        }

        .loading-content {
            text-align: center;
            max-width: 400px;
            padding: var(--spacing-lg);
        }

        .loading-text {
            font-size: 1.25rem;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: var(--spacing-lg);
            min-height: 2rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .progress-bar-container {
            width: 100%;
            height: 8px;
            background: var(--border-light);
            border-radius: var(--radius-sm);
            overflow: hidden;
            margin-bottom: var(--spacing-md);
        }

        .progress-bar {
            height: 100%;
            background: linear-gradient(90deg, var(--primary-color), var(--secondary-color));
            border-radius: var(--radius-sm);
            width: 0%;
            transition: width 0.5s ease;
            animation: progress-animation 3s ease-in-out infinite;
        }

        @keyframes progress-animation {
            0% { width: 0%; }
            25% { width: 25%; }
            50% { width: 60%; }
            75% { width: 85%; }
            100% { width: 100%; }
        }

        /* Popups */
        .overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: transparent;
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .overlay.active {
            display: block;
        }
       
        .message-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--background-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            max-width: 500px;
            width: 90%;
            border: 1px solid var(--border-light);
        }

        .message-popup.active {
            display: block;
        }

        .message-popup h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
            padding: var(--spacing-lg) var(--spacing-lg) 0 var(--spacing-lg);
        }

        .message-popup textarea {
            width: 100%;
            height: 120px;
            padding: var(--spacing-sm);
            border: 1px solid var(--border-color);
            border-radius: var(--radius-sm);
            margin: 0 var(--spacing-lg) var(--spacing-md) var(--spacing-lg);
            resize: vertical;
            font-family: inherit;
            font-size: 0.875rem;
            color: var(--text-primary);
            background: var(--background-primary);
            transition: border-color 0.2s ease;
        }

        .message-popup textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px var(--primary-light);
        }

        .message-popup .send-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            margin: 0 var(--spacing-lg) var(--spacing-lg) var(--spacing-lg);
            display: block;
            width: calc(100% - 2 * var(--spacing-lg));
        }

        .message-popup .send-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-1px);
        }

        .close-btn {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            color: var(--text-secondary);
            font-size: 1.2rem;
        }

        .close-btn:hover {
            background: var(--border-light);
            color: var(--text-primary);
        }

        .connection-request-popup,
        .student-details-popup {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: var(--background-primary);
            border-radius: var(--radius-lg);
            box-shadow: var(--shadow-lg);
            z-index: 1001;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
        }

        .connection-request-popup.active,
        .student-details-popup.active {
            display: block;
        }

        .macos-close {
            position: absolute;
            top: var(--spacing-md);
            right: var(--spacing-md);
            width: 32px;
            height: 32px;
            background: var(--background-secondary);
            border: 1px solid var(--border-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
            z-index: 10;
        }

        .macos-close:hover {
            background: var(--border-light);
        }

        .macos-close i {
            color: var(--text-secondary);
            font-size: 1rem;
        }

        .connection-request-content,
        .student-details-content {
            padding: var(--spacing-xl);
        }

        .connection-request-content h2,
        .student-details-content h2 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: var(--spacing-md);
        }

        .connection-request-content p {
            color: var(--text-secondary);
            margin-bottom: var(--spacing-lg);
            line-height: 1.6;
        }

        .ok-btn {
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: var(--radius-sm);
            padding: var(--spacing-sm) var(--spacing-lg);
            font-size: 0.875rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .ok-btn:hover {
            background: var(--primary-dark);
        }

        .manage-connections {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .manage-connections:hover {
            text-decoration: underline;
        }

        /* macOS Style Student Details Popup */
        .student-details-popup {
            background: rgba(255,255,255,0.92);
            backdrop-filter: blur(18px) saturate(1.1);
            -webkit-backdrop-filter: blur(18px) saturate(1.1);
            border-radius: 16px;
            width: 90vw;
            max-width: 1200px;
            height: 85vh;
            max-height: 85vh;
            overflow: hidden;
            z-index: 2001;
            border: 1.5px solid rgba(180,180,180,0.22);
            box-shadow: 0 8px 32px 0 rgba(30,34,90,0.13);
            font-family: -apple-system, BlinkMacSystemFont, 'Inter', 'Segoe UI', Roboto, Arial, sans-serif;
            padding: 0;
            transition: box-shadow 0.18s, background 0.18s;
        }

        .student-details-popup .macos-close {
            position: absolute;
            top: 18px;
            right: 18px;
            left: auto;
            width: 36px;
            height: 36px;
            background: #ededed;
            border-radius: 50%;
            border: 1.5px solid #e0e0e0;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: background 0.18s, box-shadow 0.18s;
            z-index: 10;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
            font-size: 1.3rem;
            color: #ff5f57;
            outline: none;
        }

        .student-details-popup .macos-close:focus {
            box-shadow: 0 0 0 2px #007aff44;
        }

        .student-details-popup .macos-close:hover {
            background: #fff;
            box-shadow: 0 2px 8px rgba(0,0,0,0.10);
        }

        .student-details-popup .macos-close i {
            color: #ff5f57;
            font-size: 1.3rem;
            font-weight: bold;
            pointer-events: none;
        }

        .student-details-content {
            padding: 2.2rem 2.2rem 1.2rem 2.2rem;
            font-size: 0.98rem;
            color: #222;
            display: flex;
            flex-direction: column;
            gap: 1.1rem;
        }

        .popup-header-row {
            display: flex;
            align-items: center;
            gap: 1.2rem;
            margin-bottom: 1.1rem;
        }

        .popup-avatar {
            width: 72px;
            height: 72px;
            border-radius: 16px;
            object-fit: cover;
            background: #f3f3f3;
            border: 1.5px solid #e0e0e0;
            box-shadow: 0 1px 4px rgba(0,0,0,0.04);
        }

        .popup-header-info {
            flex: 1;
            min-width: 0;
            display: flex;
            flex-direction: column;
            gap: 0.2rem;
        }

        .popup-name {
            font-size: 1.18rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 0.1rem;
            letter-spacing: -0.01em;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .popup-title {
            font-size: 0.98rem;
            color: #86868b;
            font-weight: 400;
            margin-bottom: 0.2rem;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .popup-section {
            margin-bottom: 0.2rem;
            padding-bottom: 0.7rem;
            border-bottom: 1px solid #ececec;
        }

        .popup-section:last-child {
            border-bottom: none;
        }

        .popup-section h5 {
            font-size: 1.01rem;
            font-weight: 600;
            color: #1d1d1f;
            margin-bottom: 0.3rem;
            letter-spacing: -0.01em;
        }

        .popup-section p, .popup-section ul {
            margin: 0.1rem 0 0.2rem 0;
            color: #444;
            font-size: 0.97rem;
            line-height: 1.5;
        }

        .popup-section ul {
            padding-left: 1.1em;
            margin-bottom: 0.2rem;
        }

        .popup-section li {
            margin-bottom: 0.1rem;
        }

        .popup-section a {
            color: #007aff;
            text-decoration: none;
            transition: color 0.18s;
        }

        .popup-section a:hover {
            color: #0056cc;
            text-decoration: underline;
        }

        #studentDetailsOverlay {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100vw; height: 100vh;
            background: rgba(0,0,0,0.18);
            z-index: 2000;
        }

        #studentDetailsOverlay.active {
            display: block;
        }

        /* Footer */
        footer {
            background: var(--background-secondary);
            padding: var(--spacing-lg);
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.875rem;
            border-top: 1px solid var(--border-light);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .student-card .card-content {
                flex-direction: column;
                gap: var(--spacing-md);
                text-align: center;
            }

            .student-card .profile-section {
                order: 1;
                width: auto;
            }

            .student-card .info-section {
                order: 2;
                width: 100%;
                text-align: center;
            }

            .student-card .actions-section {
                order: 3;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                width: 100%;
                gap: var(--spacing-sm);
            }
        }

        @media (max-width: 768px) {
            .navbar_classified {
                flex-direction: column;
                align-items: flex-start;
                padding: 0.5rem 0.5rem;
                min-height: 48px;
            }

            .navbar_classified .nav-menu {
                flex-direction: column;
                width: 100%;
                background: #ffffff;
                box-shadow: 0 2px 8px rgba(0,0,0,0.08);
                position: absolute;
                top: 56px;
                left: 0;
                display: none;
                border-top: 1px solid #e9ecef;
                z-index: 1001;
            }

            .navbar_classified .nav-menu.active {
            display: flex;
            }

            .navbar_classified .nav-menu li a {
                padding: 1rem 2rem;
                border-radius: 0;
            border: none;
            font-size: 1.1rem;
            }

            .navbar_classified .hamburger {
                display: block;
                position: absolute;
                right: 1rem;
                top: 0.7rem;
            }

            .dashboard-content {
                padding: calc(80px + var(--spacing-md)) var(--spacing-md) var(--spacing-lg);
            }

            .ai-search-box {
                flex-direction: row;
                gap: var(--spacing-xs);
                padding: var(--spacing-sm);
                max-width: 95%;
                border-radius: var(--radius-md);
            }

            .ai-search-box button {
                width: auto;
            justify-content: center;
                white-space: nowrap;
            flex-shrink: 0;
            }

            .ai-search-container {
                margin: var(--spacing-xs) 0;
            }

            .ai-search-box input {
                font-size: 1.1rem;
                padding: var(--spacing-xs) 0;
                min-width: 0;
            }

            .ai-search-box input::placeholder {
                font-size: 1.1rem;
            }

            .ai-search-box button {
                font-size: 0.95rem;
                padding: var(--spacing-xs) var(--spacing-sm);
            }

            .student-card {
                padding: var(--spacing-md);
            }

            .student-card .card-content {
                gap: var(--spacing-sm);
                flex-direction: column;
                align-items: center;
                text-align: center;
            }

            .student-card .profile-section {
                width: auto;
                align-items: center;
            }

            .student-card .info-section {
                width: 100%;
                text-align: center;
                align-items: center;
            }

            .student-card .name-section,
            .student-card .college-section,
            .student-card .skills-section,
            .student-card .about-section {
                text-align: center;
                align-items: center;
            }

            .student-card .profile-pic {
                width: 60px;
                height: 60px;
            }

            .student-card .name-section h3 {
                font-size: 1.125rem;
            }

            .student-card .college-section h4 {
                font-size: 0.95rem;
            }

            .student-card .skills-section p,
            .student-card .about-section p {
                font-size: 0.85rem;
            }

            .hiring-ad-section {
                padding: var(--spacing-lg);
            }

            .hiring-ad-text h3 {
                font-size: 1.5rem;
            }

            .connection-request-content,
            .student-details-content {
                padding: var(--spacing-lg);
            }

            .message-popup {
                max-width: 95%;
                width: 95%;
            }

            .message-popup h2 {
                font-size: 1.1rem;
                padding: var(--spacing-md) var(--spacing-md) 0 var(--spacing-md);
            }

            .message-popup textarea {
                margin: 0 var(--spacing-md) var(--spacing-md) var(--spacing-md);
                font-size: 0.9rem;
            }

            .message-popup .send-btn {
                margin: 0 var(--spacing-md) var(--spacing-md) var(--spacing-md);
                width: calc(100% - 2 * var(--spacing-md));
                font-size: 0.9rem;
            }
            .student-card .actions-section {
                width: 100%;
                flex-direction: column;
                justify-content: center;
                align-items: center;
                gap: var(--spacing-sm);
            }
        }

        @media (max-width: 480px) {
            .dashboard-section h1 {
                font-size: 1.75rem;
            }

            .dashboard-section p {
                font-size: 1rem;
            }

            .ai-search-box {
                border-radius: var(--radius-sm);
                max-width: 98%;
                padding: var(--spacing-xs) var(--spacing-sm);
                flex-direction: row;
                gap: var(--spacing-xs);
            }

            .ai-search-box input {
                font-size: 1rem;
                min-width: 0;
            }

            .ai-search-box input::placeholder {
                font-size: 1rem;
            }

            .ai-search-box button {
                font-size: 0.9rem;
                padding: var(--spacing-xs) var(--spacing-sm);
                width: auto;
                flex-shrink: 0;
                white-space: nowrap;
            }

            .ai-search-icon {
                font-size: 1.1rem;
                margin-right: var(--spacing-xs);
            }

            .student-card {
                padding: var(--spacing-md);
            }

            .hiring-ad-section {
                padding: var(--spacing-md);
            }
            .connection-request-popup {
                width: 90vw !important;
                max-width: 90vw !important;
                left: 50% !important;
                transform: translate(-50%, -50%) !important;
            }
        }
    </style>
</head>
<body>
    
    <nav class="navbar_classified">
        <a href="../index.html">
            <div class="logo"><img src="../assets/logo.png" alt="Taska Logo" style="height:48px;vertical-align:middle;"></div>
        </a>
        <ul class="nav-menu">
            <li><a href="explore.html" class="active">Explore</a></li>
            <li><a href="tasks.html" >Workplace</a></li>
            
            <li><a href="profile.html" >Account</a></li>
        </ul>
        <div class="hamburger">☰</div>
    </nav>
    <main class="dashboard-content">
        <section class="dashboard-section">
            <br><br>
            <h1>Explore Talents to match your needs</h1>
            <p>Find and connect with skilled students using AI powered search.</p>
            <!-- Modern Responsive Search Box -->
            <div class="ai-search-container">
                <form class="ai-search-box" onsubmit="event.preventDefault(); performSearch();">
                    <span class="ai-search-icon"><i class="fas fa-search"></i></span>
                    <input type="text" id="ai-search-input" placeholder="Explain your project needs...">
                    <button type="submit"><i class="fas fa-arrow-right"></i></button>
                </form>
            </div>
            <!-- End AI Search Box -->
            <br>
            <br>
            
            <!-- Hiring Ad Section -->
            <div class="hiring-ad-section">
                <div class="hiring-ad-text">
                    <h3>Want to post a hiring ad?</h3>
                    <p>Reach over <strong>Thousands of skilled students</strong> in our community and get curated candidates for your needs. We help you shortlist and conduct the selection process.</p>
                    <div class="hiring-ad-actions">
                        <button class="hiring-ad-btn primary" onclick="openWhatsAppHiring()">
                            Post Hiring Ad
                        </button>
                    </div>
                    </div>
                    </div>
            
            <div class="search-info" id="searchInfo">
                
                    </div>
            
            <div class="loading-overlay" id="loadingOverlay">
                <div class="loading-content">
                    <div class="loading-text" id="loadingText">Analysing your prompt...</div>
                    <div class="progress-bar-container">
                        <div class="progress-bar"></div>
                    </div>
                </div>
            </div>
            <div class="students-list" id="students-list"></div>
            <div class="pagination" id="pagination"></div>
        </section>
    </main>
    <footer>
        <p>© 2025 Taska Elite. All rights reserved.</p>
    </footer>
    <div class="overlay" id="overlay"></div>
    <div class="message-popup" id="messagePopup">
        <button class="close-btn" onclick="closeMessagePopup()">×</button>
        <h2>Connect</h2>
        <textarea id="introMessage" placeholder="Generating message..."></textarea>
        <button class="send-btn" onclick="sendMessage()">Send via WhatsApp</button>
    </div>
    <div class="connection-request-popup" id="connectionRequestPopup">
        <div class="macos-close" onclick="closeConnectionRequestPopup()"><i class="fas fa-times"></i></div>
        <div class="connection-request-content">
            <h2>Connection Request Sent</h2>
            <p id="connectionRequestMessage"></p>
            <button class="ok-btn" onclick="closeConnectionRequestPopup()">OK</button>
        </div>
    </div>
    <div class="student-details-popup" id="studentDetailsPopup">
        <div class="macos-close" onclick="closeStudentDetailsPopup()"><i class="fas fa-times"></i></div>
        <iframe id="studentProfileFrame" src="" frameborder="0" style="width: 100%; height: 100%; border: none; border-radius: 16px; overflow: hidden;"></iframe>
    </div>
    <div class="overlay" id="studentDetailsOverlay"></div>
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-storage.js"></script>
    <script>
        // Initialize Firebase
const firebaseConfig = {
    apiKey: "AIzaSyDZIDlEtaNRxODoFhRw0xF2yYFBqqBexqo",
    authDomain: "taska-45011.firebaseapp.com",
    databaseURL: "https://taska-45011-default-rtdb.asia-southeast1.firebasedatabase.app",
    projectId: "taska-45011",
    storageBucket: "taska-45011.appspot.com",
    messagingSenderId: "205487498813",
    appId: "1:205487498813:web:0de2c9eab567482781ec54",
    measurementId: "G-G0G1F6GQ9B"
};
firebase.initializeApp(firebaseConfig);
const database = firebase.database();

// Hamburger menu toggle
document.addEventListener('DOMContentLoaded', () => {
    document.querySelector('.hamburger').addEventListener('click', () => {
        document.querySelector('.nav-menu').classList.toggle('active');
    });
    // Search on Enter key
    document.getElementById('ai-search-input').addEventListener('keypress', (e) => {
        if (e.key === 'Enter') {
            performSearch();
        }
    });
});

let studentsData = [];
let currentStudentId = null;
let connectedStudents = new Set();
const studentsList = document.getElementById('students-list');
const profilePopup = document.getElementById('profilePopup');
const profileContent = document.getElementById('profileContent');
const overlay = document.getElementById('overlay');
const loadingOverlay = document.getElementById('loadingOverlay');
const messagePopup = document.getElementById('messagePopup');
const introMessage = document.getElementById('introMessage');
const searchInfo = document.getElementById('searchInfo');

// Loading text messages for search process
const loadingMessages = [
    "Analysing your prompt...",
    "Searching database...",
    "Picking best talent with AI...",
    "Finalising results..."
];

let currentMessageIndex = 0;
let loadingInterval;

function updateLoadingText() {
    const loadingText = document.getElementById('loadingText');
    if (loadingText) {
        loadingText.textContent = loadingMessages[currentMessageIndex];
        
        // Stop the cycle when we reach the final message
        if (currentMessageIndex === loadingMessages.length - 1) {
            stopLoadingAnimation();
            return;
        }
        
        currentMessageIndex = (currentMessageIndex + 1) % loadingMessages.length;
    }
}

function startLoadingAnimation() {
    currentMessageIndex = 0;
    updateLoadingText();
    loadingInterval = setInterval(updateLoadingText, 1500); // Change message every 1.5 seconds
}

function stopLoadingAnimation() {
    if (loadingInterval) {
        clearInterval(loadingInterval);
        loadingInterval = null;
    }
}

// Fetch student data and connected students
document.addEventListener('DOMContentLoaded', async () => {
    try {
        // Fetch student data from Firebase
        const snapshot = await database.ref('studentslist').once('value');
        const data = snapshot.val() || {};
        studentsData = Object.keys(data).map(id => ({
            id,
            ...data[id],
            personal: data[id].personal || {},
            education: data[id].education || {},
            skills: data[id].skills || '',
            profiles: data[id].profiles || {},
            portfolio: data[id].portfolio || []
        }));

        // Fetch connected students
        const connections = await getConnectedStudents();
        connectedStudents = new Set(connections);
    } catch (error) {
        console.error('Error loading data:', error);
        studentsList.innerHTML = '<p>Error loading student data.</p>';
    }
});

// Fetch connected students from Firebase
async function getConnectedStudents() {
    const user = firebase.auth().currentUser;
    if (!user) return [];
    try {
        const snapshot = await database.ref(`users/${user.uid}/connections`).once('value');
        const connections = snapshot.val() || {};
        return Object.keys(connections).filter(id => ['pending', 'connected'].includes(connections[id].status));
    } catch (error) {
        console.error('Error fetching connections:', error);
        return [];
    }
}

// Map education year to label
function getYearLabel(year) {
    if (!year || year === 'Not set') return 'Student';
    return year; // Return the actual year (1st, 2nd, 3rd, 4th, 5th)
}

async function aiSearch(query = '') {
    if (!query) {
        studentsList.innerHTML = '<p>Please enter a search query</p>';
        searchInfo.style.display = 'block'; // Show help cards when no search
        return;
    }
    loadingOverlay.style.display = 'flex';
    startLoadingAnimation();
    searchInfo.style.display = 'none'; // Hide help cards when searching

    const csvText = [
        ['id', 'personal.name', 'education.college', 'education.degree', 'education.branch', 'education.year', 'skills', 'personal.about'].join(','),
        ...studentsData.map(student => [
            student.id,
            student.personal?.name || 'Unnamed',
            student.education?.college || 'Not set',
            student.education?.degree || 'Not set',
            student.education?.branch || 'Not set',
            student.education?.year || 'Not set',
            student.skills || 'Not set',
            student.personal?.about || 'Not set'
        ].join(','))
    ].join('\n');

    const prompt = `
        You are an expert at analyzing student data for talent matching. Given the following CSV data of students:
        ${csvText}
        The user has provided this requirement: "${query}"
        Prioritize the word based matching search first, then the keyword based matching search.
        Your task is to:
        1. Carefully analyze each student's data (name, college, degree, branch, year, skills, about).
        2. Match students to the requirement based on relevance (e.g., specific college, skills, branch, or about section mentioned in the query).
        3. Rank the students by how well they match the requirement.
        4. Return EXACTLY 10 student IDs in order of relevance as a JSON array of strings.
        5. If fewer than 10 students match exactly, fill the remaining slots with the most relevant students based on partial matches.
        6. Do not simply return the first 10 students unless they genuinely match the query.
        Examples:
        - Query: "IIT Delhi B.Tech Applied Mechanics student with Python skill"
          - Prioritize students from IIT Delhi, with B.Tech in Applied Mechanics, and Python in skills.
        - Query: "IIT Bombay student with machine learning experience"
          - Prioritize IIT Bombay students with "machine learning" in skills or about section.
        Return the result STRICTLY as a JSON array of 10 student IDs,        Prioritize the word based matching search first
 e.g.:
        ["student_1", "student_2", "student_3", "student_4", "student_5", "student_6", "student_7", "student_8", "student_9", "student_10"]
    `;

    try {
        const response = await fetch('/api/ai-search', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ prompt }),
        });
        const data = await response.json();
        if (!response.ok) throw new Error(data.error?.message || 'API request failed');

        let shortlistedIds;
        try {
            shortlistedIds = JSON.parse(data.choices[0].message.content);
            if (!Array.isArray(shortlistedIds) || shortlistedIds.length !== 10 || !shortlistedIds.every(id => typeof id === 'string')) {
                throw new Error('Invalid response format: Expected an array of 10 student IDs');
            }
            const validIds = shortlistedIds.filter(id => studentsData.some(student => student.id === id));
            if (validIds.length < 10) {
                console.warn('AI returned fewer valid IDs than expected:', validIds);
                const remainingCount = 10 - validIds.length;
                const additionalIds = studentsData
                    .filter(student => !validIds.includes(student.id) && !connectedStudents.has(student.id))
                    .slice(0, remainingCount)
                    .map(student => student.id);
                shortlistedIds = [...validIds, ...additionalIds];
            }
        } catch (parseError) {
            console.error('JSON Parse Error:', parseError, 'Response:', data.choices[0].message.content);
            shortlistedIds = basicKeywordMatch(query);
        }

        const filteredStudents = studentsData
            .filter(student => shortlistedIds.includes(student.id) && !connectedStudents.has(student.id))
            .sort((a, b) => shortlistedIds.indexOf(a.id) - shortlistedIds.indexOf(b.id));

        studentsList.innerHTML = filteredStudents.length > 0
            ? `<div class="search-results-header">
                <h2>Here are the Top 10 matching students for your requirement</h2>
               </div>` + filteredStudents.map(student => {
                const personal = student.personal || {};
                const education = student.education || {};
                const profiles = student.profiles || {};
                const availability = student.availability || {};
                const softSkills = student.softSkills || {};
                const preferences = student.preferences || {};
                const yearLabel = getYearLabel(education?.year);
                const isConnected = connectedStudents.has(student.id);
                const hasLinkedIn = !!personal.linkedin;
                
                return `
                    <div class="student-card">
                        <div class="card-content">
                            <div class="profile-section">
                                <img data-student-id="${student.id}" src="../assets/avatar/1.png" alt="" class="profile-pic">
                            </div>
                            <div class="info-section">
                                <div class="name-section">
                                    <h3>${personal.name || 'Unnamed'}</h3>
                                </div>
                                <div class="college-section">
                                    <h4>${education.college || 'Not set'}</h4>
                                </div>
                                <div class="skills-section">
                                    <p><strong>Skills:</strong> ${student.skills || 'Not specified'}</p>
                                </div>
                                <div class="about-section">
                                    ${personal.about ? `<p>${personal.about.substring(0, 120)}${personal.about.length > 120 ? '...' : ''}</p>` : '<p>No description available</p>'}
                                </div>
                            </div>
                            <div class="actions-section">
                                <span class="ai-intro-btn${isConnected ? ' connected' : ''}" 
                                      onclick="${isConnected ? '' : `connectStudent('${student.id}')`}" 
                                      ${isConnected ? 'style="cursor: not-allowed;"' : ''}>
                                    ${isConnected ? 'Connected' : 'Connect'}
                                </span>
                                <span class="toggle-details" onclick="showStudentDetailsPopup('${student.id}')">View Profile</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('')
            : '<p>No matching students found.</p>';
    } catch (error) {
        console.error('AI Search Error:', error);
        studentsList.innerHTML = `<p>Error performing search: ${error.message}</p>`;
    }
    loadingOverlay.style.display = 'none';
    stopLoadingAnimation();
    // Load profile images using Firebase Storage SDK
    setTimeout(loadProfileImages, 0);
}

function loadProfileImages() {
    const storage = firebase.storage();
    document.querySelectorAll('.profile-pic[data-student-id]').forEach(img => {
        const studentId = img.getAttribute('data-student-id');
        const tryExtensions = ['webp', 'jpg', 'png'];
        let found = false;
        (function tryNext(i) {
            if (i >= tryExtensions.length) return; // All failed, keep default
            const ext = tryExtensions[i];
            const ref = storage.ref(`profile/${studentId}.${ext}`);
            ref.getDownloadURL()
                .then(url => {
                    img.src = url;
                    found = true;
                })
                .catch(() => {
                    if (!found) tryNext(i + 1);
                });
        })(0);
    });
}

function basicKeywordMatch(query) {
    const keywords = query.toLowerCase().split(' ');
    const scoredStudents = studentsData
        .filter(student => !connectedStudents.has(student.id))
        .map(student => {
            let score = 0;
            const studentText = `${student.personal?.name || ''} ${student.education?.college || ''} ${student.education?.degree || ''} ${student.education?.branch || ''} ${student.skills || ''} ${student.personal?.about || ''}`.toLowerCase();
            keywords.forEach(keyword => {
                if (studentText.includes(keyword)) score += 1;
            });
            return { id: student.id, score };
        });
    return scoredStudents
        .sort((a, b) => b.score - a.score)
        .slice(0, 10)
        .map(student => student.id);
}

window.performSearch = () => {
    const query = document.getElementById('ai-search-input').value.trim();
    
    // Hide the hiring ad section when search is performed
    const hiringAdSection = document.querySelector('.hiring-ad-section');
    if (hiringAdSection) {
        hiringAdSection.style.display = 'none';
    }
    
    aiSearch(query);
};

window.toggleReadMore = (element) => {
    const description = element.previousElementSibling;
    description.classList.toggle('expanded');
    element.textContent = description.classList.contains('expanded') ? 'Read Less' : 'Read More';
};

window.toggleStudentDetails = (element) => {
    const card = element.closest('.student-card');
    const details = card.querySelector('.student-details');
    details.classList.toggle('expanded');
    element.textContent = details.classList.contains('expanded') ? 'Hide Details' : 'View Details';
};

window.generateAIIntro = async (studentId) => {
    currentStudentId = studentId;
    loadingOverlay.style.display = 'flex';
    startLoadingAnimation();
    const student = studentsData.find(s => s.id === studentId);
    const user = firebase.auth().currentUser;
    if (!user || !student) {
        loadingOverlay.style.display = 'none';
        stopLoadingAnimation();
        alert('Error: User not authenticated or student not found.');
        return;
    }
    try {
        // Store connection request in Firebase
        await storeConnectionRequest(studentId);
        // Send notifications
        await sendConnectionNotifications(studentId, student.personal?.name || 'Unnamed', student.personal?.email, student.personal?.whatsapp, user.email);
        // Show popup
        showConnectionRequestPopup(student.personal?.name || 'Unnamed');
        // Update connected students set
        connectedStudents.add(studentId);
        // Refresh the student list to update button states
        performSearch();
    } catch (error) {
        console.error('Error sending connection request:', error);
        alert('Failed to send connection request.');
    }
    stopLoadingAnimation();
    loadingOverlay.style.display = 'none';
};

async function storeConnectionRequest(studentId) {
    const user = firebase.auth().currentUser;
    const userId = user.uid;
    const timestamp = new Date().toISOString();
    // Store for professional
    await database.ref(`users/${userId}/connections/${studentId}`).set({
        timestamp: timestamp,
        status: "pending"
    });
    // Store for student
    await database.ref(`users/${studentId}/connections/${userId}`).set({
        timestamp: timestamp,
        status: "pending"
    });
}

async function sendConnectionNotifications(studentId, studentName, studentEmail, studentWhatsApp, professionalEmail) {
    const user = firebase.auth().currentUser;
    const professionalName = user.displayName || 'Professional';
    // Send email notifications
    try {
        const response = await fetch('https://your-server.com/send-connection-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                studentEmail,
                studentName,
                professionalEmail,
                professionalName
            })
        });
        if (!response.ok) throw new Error('Failed to send email notifications');
    } catch (error) {
        console.error('Error sending email notifications:', error);
    }
    // Send WhatsApp notification
    await sendWhatsAppNotification(studentWhatsApp, studentName, professionalName);
}

async function sendWhatsAppNotification(studentWhatsApp, studentName, professionalName) {
    if (!studentWhatsApp) return;
    try {
        const response = await fetch('https://your-server.com/send-whatsapp', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                to: studentWhatsApp,
                studentName,
                professionalName
            })
        });
        if (!response.ok) throw new Error('Failed to send WhatsApp notification');
    } catch (error) {
        console.error('Error sending WhatsApp notification:', error);
    }
}

function showConnectionRequestPopup(studentName) {
    const popup = document.getElementById('connectionRequestPopup');
    const message = document.getElementById('connectionRequestMessage');
    message.innerHTML = `
        We have sent a connection request to <strong>${studentName}</strong>. 
        
        You can <a href="tasks.html" class="manage-connections" target="_blank">manage your connections</a> here.
    `;
    popup.classList.add('active');
    overlay.classList.add('active');
}

window.closeConnectionRequestPopup = () => {
    const popup = document.getElementById('connectionRequestPopup');
    popup.classList.remove('active');
    overlay.classList.remove('active');
    // Only hide the popup, do not reset currentStudentId or perform any other actions
};

window.showProfile = (targetUserId) => {
    // This function is no longer needed since details are shown in cards
    console.log('Profile details are now shown directly in the student cards');
};

window.closeProfilePopup = () => {
    // This function is no longer needed since profile popup is removed
    console.log('Profile popup is no longer used');
};

window.closeMessagePopup = () => {
    messagePopup.classList.remove('active');
    overlay.classList.remove('active');
    currentStudentId = null;
};

window.sendMessage = () => {
    if (!currentStudentId) return;
    const student = studentsData.find(s => s.id === currentStudentId);
    const message = introMessage.value.trim();
    if (!message) return;
    const phone = student.personal?.whatsapp || '';
    if (phone) {
        storeConnection(currentStudentId);
        const whatsappUrl = `https://wa.me/${phone}?text=${encodeURIComponent(message)}`;
        window.open(whatsappUrl, '_blank');
    }
    closeMessagePopup();
};

async function storeConnection(studentId) {
    const user = firebase.auth().currentUser;
    if (user) {
        const userId = user.uid;
        const timestamp = new Date().toISOString();
        database.ref(`users/${userId}/connections/${studentId}`).set({
            timestamp: timestamp,
            status: "pending"
        }).then(() => {
            console.log("Connection stored successfully");
            connectedStudents.add(studentId);
        }).catch((error) => {
            console.error("Error storing connection:", error);
        });
        database.ref(`users/${studentId}/connections/${userId}`).set({
            timestamp: timestamp,
            status: "pending"
        }).catch((error) => {
            console.error("Error storing connection:", error);
        });
    } else {
        console.log("User not authenticated, connection not stored");
    }
}

overlay.addEventListener('click', () => {
    closeMessagePopup();
    closeConnectionRequestPopup();
});

window.showStudentDetailsPopup = (studentId) => {
    const student = studentsData.find(s => s.id === studentId);
    if (!student) return;
    
    // Load the workplace/view-profile page in the iframe
    const iframe = document.getElementById('studentProfileFrame');
    iframe.src = `../workplace/view-profile.html?studentId=${studentId}`;
    
    document.getElementById('studentDetailsPopup').classList.add('active');
    document.getElementById('studentDetailsOverlay').classList.add('active');
    
    // Focus close button for accessibility
    const closeBtn = document.querySelector('.student-details-popup .macos-close');
    if (closeBtn) closeBtn.focus();
};

window.closeStudentDetailsPopup = () => {
    document.getElementById('studentDetailsPopup').classList.remove('active');
    document.getElementById('studentDetailsOverlay').classList.remove('active');
};

document.getElementById('studentDetailsOverlay').onclick = closeStudentDetailsPopup;

// Keyboard accessibility for close button and Escape
const closeBtn = document.querySelector('.student-details-popup .macos-close');
if (closeBtn) {
    closeBtn.setAttribute('tabindex', '0');
    closeBtn.setAttribute('role', 'button');
    closeBtn.addEventListener('keydown', function(e) {
        if (e.key === 'Enter' || e.key === ' ' || e.key === 'Spacebar') {
            closeStudentDetailsPopup();
        }
    });
}

document.addEventListener('keydown', function(e) {
    if (document.getElementById('studentDetailsPopup').classList.contains('active') && e.key === 'Escape') {
        closeStudentDetailsPopup();
    }
});

// Tooltip for truncated card content
let cardTooltip;
function showCardTooltip(e, text) {
    if (!cardTooltip) {
        cardTooltip = document.createElement('div');
        cardTooltip.className = 'card-tooltip';
        document.body.appendChild(cardTooltip);
    }
    cardTooltip.textContent = text;
    cardTooltip.classList.add('active');
    // Position tooltip near mouse, but not off screen
    const padding = 12;
    let x = e.clientX + padding;
    let y = e.clientY + padding;
    // Adjust if tooltip would go off right/bottom edge
    setTimeout(() => {
        const rect = cardTooltip.getBoundingClientRect();
        if (x + rect.width > window.innerWidth - 8) x = window.innerWidth - rect.width - 8;
        if (y + rect.height > window.innerHeight - 8) y = window.innerHeight - rect.height - 8;
        cardTooltip.style.left = x + 'px';
        cardTooltip.style.top = y + 'px';
    }, 0);
}

function hideCardTooltip() {
    if (cardTooltip) cardTooltip.classList.remove('active');
}

function isTruncated(el) {
    return el.scrollWidth > el.clientWidth;
}

function addTooltipListenersToCardCells() {
    // Select all card content cells that may overflow
    const selectors = [
        '.student-card .name-section h3',
        '.student-card .college-section h4',
        '.student-card .skills-section p',
        '.student-card .about-section p'
    ];
    document.querySelectorAll(selectors.join(',')).forEach(cell => {
        cell.onmouseenter = function(e) {
            if (isTruncated(this)) {
                showCardTooltip(e, this.textContent);
            }
        };
        cell.onmousemove = function(e) {
            if (cardTooltip && cardTooltip.classList.contains('active')) {
                showCardTooltip(e, this.textContent);
            }
        };
        cell.onmouseleave = function() {
            hideCardTooltip();
        };
    });
}

// Re-apply listeners after cards are rendered
const origPerformSearch = window.performSearch;
window.performSearch = function() {
    origPerformSearch.apply(this, arguments);
    setTimeout(addTooltipListenersToCardCells, 0);
};

window.addEventListener('DOMContentLoaded', addTooltipListenersToCardCells);

// WhatsApp integration for hiring ads
function openWhatsAppHiring() {
    const phoneNumber = '+919266124039';
    const message = encodeURIComponent(`Hi! I want to post a hiring ad in your community`);
    const whatsappUrl = `https://wa.me/${phoneNumber}?text=${message}`;
    window.open(whatsappUrl, '_blank');
}

window.connectStudent = async (studentId) => {
    currentStudentId = studentId;
    const student = studentsData.find(s => s.id === studentId);
    const user = firebase.auth().currentUser;
    if (!user || !student) {
        alert('Error: User not authenticated or student not found.');
        return;
    }
    // Immediately disable the button
    const card = document.querySelector(`.student-card .ai-intro-btn[onclick*="connectStudent('${studentId}')"]`);
    if (card) {
        card.textContent = 'Connection Sent';
        card.classList.add('connected');
        card.onclick = null;
        card.style.cursor = 'not-allowed';
    }
    try {
        await storeConnectionRequest(studentId);
        await sendEmployerConnectionEmail(student, user);
        showConnectionRequestPopup(student.personal?.name || 'Unnamed');
        connectedStudents.add(studentId);
    } catch (error) {
        console.error('Error sending connection request:', error);
        alert('Failed to send connection request.');
    }
};

async function sendEmployerConnectionEmail(student, employerUser) {
    if (!student.personal?.email) return;
    const studentName = student.personal?.name || 'Student';
    const employerEmail = employerUser.email;
    const subject = 'An employer wants to connect with you on Taska';
    const html = `
        <div style="font-family:Arial,sans-serif;max-width:480px;margin:0 auto;background:#fff;border-radius:8px;box-shadow:0 2px 10px rgba(0,0,0,0.07);padding:32px 24px;">
            <h2 style="color:#1a73e8;font-size:1.3rem;margin-bottom:18px;">Connection Request on Taska</h2>
            <p style="font-size:1.08rem;color:#222;">Hi ${studentName},</p>
            <p style="font-size:1.08rem;color:#222;">An employer wants to connect with you on <b>Taska</b>! You can view and manage your connections by clicking the button below.</p>
            <div style="margin:32px 0;text-align:center;">
                <a href="https://jointaska.com/workplace/tasks.html" style="display:inline-block;padding:12px 28px;background:#1a73e8;color:#fff;border-radius:6px;font-weight:600;text-decoration:none;font-size:1.08rem;">View Connections</a>
            </div>
            <p style="font-size:0.98rem;color:#666;">If you did not expect this, you can safely ignore this email.</p>
            <p style="font-size:0.95rem;color:#aaa;margin-top:32px;">&copy; 2025 Taska</p>
        </div>
    `;
    try {
        await fetch('/api/send-email', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                to: student.personal.email,
                subject,
                html
            })
        });
    } catch (error) {
        console.error('Error sending connection email:', error);
    }
}
</script>
</body>
</html>