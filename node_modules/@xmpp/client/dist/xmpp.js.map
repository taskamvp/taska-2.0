{"version":3,"file":"xmpp.js","sources":["../../../node_modules/rollup-plugin-node-polyfills/polyfills/events.js","../../events/lib/TimeoutError.js","../../events/lib/timeout.js","../../events/lib/delay.js","../../events/lib/onoff.js","../../events/lib/promise.js","../../events/lib/Deferred.js","../../events/lib/procedure.js","../../events/lib/listeners.js","../../jid/lib/escaping.js","../../jid/lib/JID.js","../../jid/lib/parse.js","../../jid/index.js","../../../node_modules/ltx/lib/escape.js","../../../node_modules/ltx/lib/Element.js","../../../node_modules/ltx/lib/createElement.js","../../../node_modules/ltx/lib/parsers/ltx.js","../../xml/lib/XMLError.js","../../xml/lib/Parser.js","../../xml/index.js","../../error/index.js","../../connection/lib/StreamError.js","../../connection/lib/util.js","../../connection/index.js","../../client-core/lib/Client.js","../lib/createOnAuthenticate.js","../../reconnect/index.js","../../websocket/lib/Socket.js","../../websocket/lib/Connection.js","../../websocket/lib/FramedParser.js","../../../node_modules/koa-compose/index.js","../../middleware/lib/Context.js","../../middleware/lib/IncomingContext.js","../../middleware/lib/OutgoingContext.js","../../middleware/index.js","../../middleware/lib/StanzaError.js","../../iq/caller.js","../../id/index.js","../../iq/callee.js","../../resolve/lib/alt-connections.js","../../resolve/lib/http.js","../../xml/lib/parse.js","../../resolve/index.js","../../resolve/resolve.js","../../base64/index.js","../../sasl/lib/SASLError.js","../../sasl/index.js","../../sasl2/index.js","../../resource-binding/index.js","../../time/index.js","../../stream-management/stream-feature.js","../../stream-management/index.js","../../stream-management/bind2.js","../../stream-management/sasl2.js","../../client-core/src/bind2/bind2.js","../../../node_modules/saslmechanisms/main.js","../../../node_modules/saslmechanisms/lib/factory.js","../../client-core/src/fast/fast.js","../../../node_modules/sasl-plain/main.js","../../../node_modules/sasl-plain/lib/mechanism.js","../../sasl-plain/index.js","../../../node_modules/sasl-anonymous/main.js","../../../node_modules/sasl-anonymous/lib/mechanism.js","../../sasl-anonymous/index.js","../../sasl-ht-sha-256-none/index.js","../index.js","../lib/getDomain.js","../../websocket/index.js","../../stream-features/index.js"],"sourcesContent":["'use strict';\n\nvar domain;\n\n// This constructor is used to store event handlers. Instantiating this is\n// faster than explicitly calling `Object.create(null)` to get a \"clean\" empty\n// object (tested with v8 v4.9).\nfunction EventHandlers() {}\nEventHandlers.prototype = Object.create(null);\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nexport default EventEmitter;\nexport {EventEmitter};\n\n// nodejs oddity\n// require('events') === require('events').EventEmitter\nEventEmitter.EventEmitter = EventEmitter\n\nEventEmitter.usingDomains = false;\n\nEventEmitter.prototype.domain = undefined;\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\nEventEmitter.init = function() {\n  this.domain = null;\n  if (EventEmitter.usingDomains) {\n    // if there is an active domain, then attach to it.\n    if (domain.active && !(this instanceof domain.Domain)) {\n      this.domain = domain.active;\n    }\n  }\n\n  if (!this._events || this._events === Object.getPrototypeOf(this)._events) {\n    this._events = new EventHandlers();\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || isNaN(n))\n    throw new TypeError('\"n\" argument must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\n// These standalone emit* functions are used to optimize calling of event\n// handlers for fast cases because emit() itself often has a variable number of\n// arguments and can be deoptimized because of that. These functions always have\n// the same number of arguments and thus do not get deoptimized, so the code\n// inside them can execute faster.\nfunction emitNone(handler, isFn, self) {\n  if (isFn)\n    handler.call(self);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self);\n  }\n}\nfunction emitOne(handler, isFn, self, arg1) {\n  if (isFn)\n    handler.call(self, arg1);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1);\n  }\n}\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\n  if (isFn)\n    handler.call(self, arg1, arg2);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2);\n  }\n}\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\n  if (isFn)\n    handler.call(self, arg1, arg2, arg3);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2, arg3);\n  }\n}\n\nfunction emitMany(handler, isFn, self, args) {\n  if (isFn)\n    handler.apply(self, args);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].apply(self, args);\n  }\n}\n\nEventEmitter.prototype.emit = function emit(type) {\n  var er, handler, len, args, i, events, domain;\n  var needDomainExit = false;\n  var doError = (type === 'error');\n\n  events = this._events;\n  if (events)\n    doError = (doError && events.error == null);\n  else if (!doError)\n    return false;\n\n  domain = this.domain;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    er = arguments[1];\n    if (domain) {\n      if (!er)\n        er = new Error('Uncaught, unspecified \"error\" event');\n      er.domainEmitter = this;\n      er.domain = domain;\n      er.domainThrown = false;\n      domain.emit('error', er);\n    } else if (er instanceof Error) {\n      throw er; // Unhandled 'error' event\n    } else {\n      // At least give some kind of context to the user\n      var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n      err.context = er;\n      throw err;\n    }\n    return false;\n  }\n\n  handler = events[type];\n\n  if (!handler)\n    return false;\n\n  var isFn = typeof handler === 'function';\n  len = arguments.length;\n  switch (len) {\n    // fast cases\n    case 1:\n      emitNone(handler, isFn, this);\n      break;\n    case 2:\n      emitOne(handler, isFn, this, arguments[1]);\n      break;\n    case 3:\n      emitTwo(handler, isFn, this, arguments[1], arguments[2]);\n      break;\n    case 4:\n      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\n      break;\n    // slower\n    default:\n      args = new Array(len - 1);\n      for (i = 1; i < len; i++)\n        args[i - 1] = arguments[i];\n      emitMany(handler, isFn, this, args);\n  }\n\n  if (needDomainExit)\n    domain.exit();\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n\n  events = target._events;\n  if (!events) {\n    events = target._events = new EventHandlers();\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (!existing) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] = prepend ? [listener, existing] :\n                                          [existing, listener];\n    } else {\n      // If we've already got an array, just append.\n      if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n    }\n\n    // Check for listener leak\n    if (!existing.warned) {\n      m = $getMaxListeners(target);\n      if (m && m > 0 && existing.length > m) {\n        existing.warned = true;\n        var w = new Error('Possible EventEmitter memory leak detected. ' +\n                            existing.length + ' ' + type + ' listeners added. ' +\n                            'Use emitter.setMaxListeners() to increase limit');\n        w.name = 'MaxListenersExceededWarning';\n        w.emitter = target;\n        w.type = type;\n        w.count = existing.length;\n        emitWarning(w);\n      }\n    }\n  }\n\n  return target;\n}\nfunction emitWarning(e) {\n  typeof console.warn === 'function' ? console.warn(e) : console.log(e);\n}\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction _onceWrap(target, type, listener) {\n  var fired = false;\n  function g() {\n    target.removeListener(type, g);\n    if (!fired) {\n      fired = true;\n      listener.apply(target, arguments);\n    }\n  }\n  g.listener = listener;\n  return g;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      list = events[type];\n      if (!list)\n        return this;\n\n      if (list === listener || (list.listener && list.listener === listener)) {\n        if (--this._eventsCount === 0)\n          this._events = new EventHandlers();\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length; i-- > 0;) {\n          if (list[i] === listener ||\n              (list[i].listener && list[i].listener === listener)) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (list.length === 1) {\n          list[0] = undefined;\n          if (--this._eventsCount === 0) {\n            this._events = new EventHandlers();\n            return this;\n          } else {\n            delete events[type];\n          }\n        } else {\n          spliceOne(list, position);\n        }\n\n        if (events.removeListener)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events;\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (!events.removeListener) {\n        if (arguments.length === 0) {\n          this._events = new EventHandlers();\n          this._eventsCount = 0;\n        } else if (events[type]) {\n          if (--this._eventsCount === 0)\n            this._events = new EventHandlers();\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        for (var i = 0, key; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = new EventHandlers();\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners) {\n        // LIFO order\n        do {\n          this.removeListener(type, listeners[listeners.length - 1]);\n        } while (listeners[0]);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  var evlistener;\n  var ret;\n  var events = this._events;\n\n  if (!events)\n    ret = [];\n  else {\n    evlistener = events[type];\n    if (!evlistener)\n      ret = [];\n    else if (typeof evlistener === 'function')\n      ret = [evlistener.listener || evlistener];\n    else\n      ret = unwrapListeners(evlistener);\n  }\n\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];\n};\n\n// About 1.5x faster than the two-arg version of Array#splice().\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)\n    list[i] = list[k];\n  list.pop();\n}\n\nfunction arrayClone(arr, i) {\n  var copy = new Array(i);\n  while (i--)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","export default class TimeoutError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = \"TimeoutError\";\n    // Error.captureStackTrace?.(this, this.constructor);\n  }\n}\n","import TimeoutError from \"./TimeoutError.js\";\nimport delay from \"./delay.js\";\n\nexport default function timeout(promise, ms) {\n  const promiseDelay = delay(ms);\n\n  function cancelDelay() {\n    clearTimeout(promiseDelay.timeout);\n  }\n\n  const error = new TimeoutError();\n  return Promise.race([\n    promise.finally(cancelDelay),\n    promiseDelay.then(() => {\n      throw error;\n    }),\n  ]);\n}\n","export default function delay(ms) {\n  let timeout;\n  const promise = new Promise((resolve) => {\n    timeout = setTimeout(resolve, ms);\n  });\n  promise.timeout = timeout;\n  return promise;\n}\n","const map = new WeakMap();\n\nexport default function onoff(target) {\n  let m = map.get(target);\n\n  if (!m) {\n    const on = (target.addEventListener ?? target.addListener).bind(target);\n    const off = (target.removeEventListener ?? target.removeListener).bind(\n      target,\n    );\n    const once = (\n      target.once ??\n      ((event, handler) =>\n        target.addEventListener(event, handler, { once: true }))\n    ).bind(target);\n    m = { on, off, once };\n    map.set(target, m);\n  }\n\n  return m;\n}\n","import onoff from \"./onoff.js\";\n\nimport TimeoutError from \"./TimeoutError.js\";\n\nexport default function promise(target, event, rejectEvent = \"error\", timeout) {\n  return new Promise((resolve, reject) => {\n    let timeoutId;\n\n    const { off, once } = onoff(target);\n\n    const cleanup = () => {\n      clearTimeout(timeoutId);\n      off(event, onEvent);\n      off(rejectEvent, onError);\n    };\n\n    function onError(reason) {\n      reject(reason);\n      cleanup();\n    }\n\n    function onEvent(value) {\n      resolve(value);\n      cleanup();\n    }\n\n    once(event, onEvent);\n    if (rejectEvent) {\n      once(rejectEvent, onError);\n    }\n\n    if (timeout) {\n      const error = new TimeoutError();\n      timeoutId = setTimeout(() => {\n        cleanup();\n        reject(error);\n      }, timeout);\n    }\n  });\n}\n","export default function Deferred() {\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n}\n","export default function procedure(entity, stanza = null, handler) {\n  return new Promise((resolve, reject) => {\n    function onError(err) {\n      entity.removeListener(\"nonza\", listener);\n      reject(err);\n    }\n\n    function done(...args) {\n      entity.removeListener(\"nonza\", listener);\n      resolve(...args);\n    }\n\n    async function listener(element) {\n      try {\n        await handler(element, done);\n      } catch (err) {\n        onError(err);\n      }\n    }\n\n    stanza && entity.send(stanza).catch(onError);\n    entity.on(\"nonza\", listener);\n  });\n}\n","import onoff from \"./onoff.js\";\n\nexport default function listeners(events) {\n  return {\n    subscribe(target) {\n      const { on } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        on(event, handler);\n      }\n    },\n    unsubscribe(target) {\n      const { off } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        off(event, handler);\n      }\n    },\n  };\n}\n","export function detect(local) {\n  if (!local) {\n    return false;\n  }\n\n  // Remove all escaped sequences\n  const tmp = local\n    .replaceAll(String.raw`\\20`, \"\")\n    .replaceAll(String.raw`\\22`, \"\")\n    .replaceAll(String.raw`\\26`, \"\")\n    .replaceAll(String.raw`\\27`, \"\")\n    .replaceAll(String.raw`\\2f`, \"\")\n    .replaceAll(String.raw`\\3a`, \"\")\n    .replaceAll(String.raw`\\3c`, \"\")\n    .replaceAll(String.raw`\\3e`, \"\")\n    .replaceAll(String.raw`\\40`, \"\")\n    .replaceAll(String.raw`\\5c`, \"\");\n\n  // Detect if we have unescaped sequences\n  const search = tmp.search(/[ \"&'/:<>@\\\\]/g);\n  if (search === -1) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Escape the local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return An escaped local part\n */\nexport function escape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(/^\\s+|\\s+$/g, \"\")\n    .replaceAll(\"\\\\\", String.raw`\\5c`)\n    .replaceAll(\" \", String.raw`\\20`)\n    .replaceAll('\"', String.raw`\\22`)\n    .replaceAll(\"&\", String.raw`\\26`)\n    .replaceAll(\"'\", String.raw`\\27`)\n    .replaceAll(\"/\", String.raw`\\2f`)\n    .replaceAll(\":\", String.raw`\\3a`)\n    .replaceAll(\"<\", String.raw`\\3c`)\n    .replaceAll(\">\", String.raw`\\3e`)\n    .replaceAll(\"@\", String.raw`\\40`);\n}\n\n/**\n * Unescape a local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return unescaped local part\n */\nexport function unescape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(String.raw`\\20`, \" \")\n    .replaceAll(String.raw`\\22`, '\"')\n    .replaceAll(String.raw`\\26`, \"&\")\n    .replaceAll(String.raw`\\27`, \"'\")\n    .replaceAll(String.raw`\\2f`, \"/\")\n    .replaceAll(String.raw`\\3a`, \":\")\n    .replaceAll(String.raw`\\3c`, \"<\")\n    .replaceAll(String.raw`\\3e`, \">\")\n    .replaceAll(String.raw`\\40`, \"@\")\n    .replaceAll(String.raw`\\5c`, \"\\\\\");\n}\n","import * as escaping from \"./escaping.js\";\n\n/**\n * JID implements\n * - XMPP addresses according to RFC6122\n * - XEP-0106: JID Escaping\n *\n * @see http://tools.ietf.org/html/rfc6122#section-2\n * @see http://xmpp.org/extensions/xep-0106.html\n */\nclass JID {\n  constructor(local, domain, resource) {\n    if (typeof domain !== \"string\" || !domain) {\n      throw new TypeError(`Invalid domain.`);\n    }\n\n    this.setDomain(domain);\n    this.setLocal(typeof local === \"string\" ? local : \"\");\n    this.setResource(typeof resource === \"string\" ? resource : \"\");\n  }\n\n  [Symbol.toPrimitive](hint) {\n    if (hint === \"number\") {\n      return Number.NaN;\n    }\n\n    return this.toString();\n  }\n\n  toString(unescape) {\n    let s = this._domain;\n    if (this._local) {\n      s = this.getLocal(unescape) + \"@\" + s;\n    }\n\n    if (this._resource) {\n      s = s + \"/\" + this._resource;\n    }\n\n    return s;\n  }\n\n  /**\n   * Convenience method to distinguish users\n   * */\n  bare() {\n    if (this._resource) {\n      return new JID(this._local, this._domain, null);\n    }\n\n    return this;\n  }\n\n  /**\n   * Comparison function\n   * */\n  equals(other) {\n    return (\n      this._local === other._local &&\n      this._domain === other._domain &&\n      this._resource === other._resource\n    );\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-localpart\n   * */\n  setLocal(local, escape) {\n    escape = escape || escaping.detect(local);\n\n    if (escape) {\n      local = escaping.escape(local);\n    }\n\n    this._local = local && local.toLowerCase();\n    return this;\n  }\n\n  getLocal(unescape = false) {\n    let local = null;\n\n    local = unescape ? escaping.unescape(this._local) : this._local;\n\n    return local;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-domain\n   */\n  setDomain(domain) {\n    this._domain = domain.toLowerCase();\n    return this;\n  }\n\n  getDomain() {\n    return this._domain;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-resourcepart\n   */\n  setResource(resource) {\n    this._resource = resource;\n    return this;\n  }\n\n  getResource() {\n    return this._resource;\n  }\n}\n\nObject.defineProperty(JID.prototype, \"local\", {\n  get: JID.prototype.getLocal,\n  set: JID.prototype.setLocal,\n});\n\nObject.defineProperty(JID.prototype, \"domain\", {\n  get: JID.prototype.getDomain,\n  set: JID.prototype.setDomain,\n});\n\nObject.defineProperty(JID.prototype, \"resource\", {\n  get: JID.prototype.getResource,\n  set: JID.prototype.setResource,\n});\n\nexport default JID;\n","import JID from \"./JID.js\";\n\nexport default function parse(s) {\n  let local;\n  let resource;\n\n  const resourceStart = s.indexOf(\"/\");\n  if (resourceStart !== -1) {\n    resource = s.slice(resourceStart + 1);\n    s = s.slice(0, resourceStart);\n  }\n\n  const atStart = s.indexOf(\"@\");\n  if (atStart !== -1) {\n    local = s.slice(0, atStart);\n    s = s.slice(atStart + 1);\n  }\n\n  return new JID(local, s, resource);\n}\n","import JID from \"./lib/JID.js\";\nimport { detect, escape, unescape } from \"./lib/escaping.js\";\nimport parse from \"./lib/parse.js\";\n\nexport function equal(a, b) {\n  return a.equals(b);\n}\n\nfunction jid(...args) {\n  if (!args[1] && !args[2]) {\n    return parse(...args);\n  }\n\n  return new JID(...args);\n}\n\nconst j = jid.bind();\nj.jid = jid;\nj.JID = JID;\nj.parse = parse;\nj.equal = equal;\nj.detectEscape = detect;\nj.escapeLocal = escape;\nj.unescapeLocal = unescape;\n\nexport default j;\n\nexport { jid, JID, parse };\n\nexport {\n  detect as detectEscape,\n  escape as escapeLocal,\n  unescape as unescapeLocal,\n};\n","'use strict';\n\nconst escapeXMLTable = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&apos;\",\n};\n\nfunction escapeXMLReplace(match) {\n  return escapeXMLTable[match];\n}\n\nconst unescapeXMLTable = {\n  \"&amp;\": \"&\",\n  \"&lt;\": \"<\",\n  \"&gt;\": \">\",\n  \"&quot;\": '\"',\n  \"&apos;\": \"'\",\n};\n\nfunction unescapeXMLReplace(match) {\n  if (match[1] === \"#\") {\n    const num =\n      match[2] === \"x\"\n        ? parseInt(match.slice(3), 16)\n        : parseInt(match.slice(2), 10);\n    // https://www.w3.org/TR/xml/#NT-Char defines legal XML characters:\n    // #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]\n    if (\n      num === 0x9 ||\n      num === 0xa ||\n      num === 0xd ||\n      (num >= 0x20 && num <= 0xd7ff) ||\n      (num >= 0xe000 && num <= 0xfffd) ||\n      (num >= 0x10000 && num <= 0x10ffff)\n    ) {\n      return String.fromCodePoint(num);\n    }\n    throw new Error(\"Illegal XML character 0x\" + num.toString(16));\n  }\n  if (unescapeXMLTable[match]) {\n    return unescapeXMLTable[match] || match;\n  }\n  throw new Error(\"Illegal XML entity \" + match);\n}\n\nfunction escapeXML(s) {\n  return s.replace(/[\"&'<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXML(s) {\n  let result = \"\";\n  let start = -1;\n  let end = -1;\n  let previous = 0;\n  while (\n    (start = s.indexOf(\"&\", previous)) !== -1 &&\n    (end = s.indexOf(\";\", start + 1)) !== -1\n  ) {\n    result =\n      result +\n      s.slice(previous, start) +\n      unescapeXMLReplace(s.slice(start, end + 1));\n    previous = end + 1;\n  }\n\n  // shortcut if loop never entered:\n  // return the original string without creating new objects\n  if (previous === 0) return s;\n\n  // push the remaining characters\n  result = result + s.substring(previous);\n\n  return result;\n}\n\nfunction escapeXMLText(s) {\n  return s.replace(/[&<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXMLText(s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62);/g, unescapeXMLReplace);\n}\n\nexports.escapeXML = escapeXML;\nexports.escapeXMLText = escapeXMLText;\nexports.unescapeXML = unescapeXML;\nexports.unescapeXMLText = unescapeXMLText;\n","'use strict';\n\nvar escape = require('./escape.js');\n\n/**\n * Element\n *\n * Attributes are in the element.attrs object. Children is a list of\n * either other Elements or Strings for text content.\n **/\nclass Element {\n  constructor(name, attrs) {\n    this.name = name;\n    this.parent = null;\n    this.children = [];\n    this.attrs = {};\n    this.setAttrs(attrs);\n  }\n\n  /* Accessors */\n\n  /**\n   * if (element.is('message', 'jabber:client')) ...\n   **/\n  is(name, xmlns) {\n    return this.getName() === name && (!xmlns || this.getNS() === xmlns);\n  }\n\n  /* without prefix */\n  getName() {\n    const idx = this.name.indexOf(\":\");\n    return idx >= 0 ? this.name.slice(idx + 1) : this.name;\n  }\n\n  /**\n   * retrieves the namespace of the current element, upwards recursively\n   **/\n  getNS() {\n    const idx = this.name.indexOf(\":\");\n    if (idx >= 0) {\n      const prefix = this.name.slice(0, idx);\n      return this.findNS(prefix);\n    }\n    return this.findNS();\n  }\n\n  /**\n   * find the namespace to the given prefix, upwards recursively\n   **/\n  findNS(prefix) {\n    if (!prefix) {\n      /* default namespace */\n      if (this.attrs.xmlns) {\n        return this.attrs.xmlns;\n      } else if (this.parent) {\n        return this.parent.findNS();\n      }\n    } else {\n      /* prefixed namespace */\n      const attr = \"xmlns:\" + prefix;\n      if (this.attrs[attr]) {\n        return this.attrs[attr];\n      } else if (this.parent) {\n        return this.parent.findNS(prefix);\n      }\n    }\n  }\n\n  /**\n   * Recursiverly gets all xmlns defined, in the form of {url:prefix}\n   **/\n  getXmlns() {\n    let namespaces = {};\n\n    if (this.parent) {\n      namespaces = this.parent.getXmlns();\n    }\n\n    for (const attr in this.attrs) {\n      const m = attr.match(\"xmlns:?(.*)\");\n      // eslint-disable-next-line  no-prototype-builtins\n      if (this.attrs.hasOwnProperty(attr) && m) {\n        namespaces[this.attrs[attr]] = m[1];\n      }\n    }\n    return namespaces;\n  }\n\n  setAttrs(attrs) {\n    if (typeof attrs === \"string\") {\n      this.attrs.xmlns = attrs;\n    } else if (attrs) {\n      Object.assign(this.attrs, attrs);\n    }\n  }\n\n  /**\n   * xmlns can be null, returns the matching attribute.\n   **/\n  getAttr(name, xmlns) {\n    if (!xmlns) {\n      return this.attrs[name];\n    }\n\n    const namespaces = this.getXmlns();\n\n    if (!namespaces[xmlns]) {\n      return null;\n    }\n\n    return this.attrs[[namespaces[xmlns], name].join(\":\")];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChild(name, xmlns) {\n    return this.getChildren(name, xmlns)[0];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChildren(name, xmlns) {\n    const result = [];\n    for (const child of this.children) {\n      if (\n        child.getName &&\n        child.getName() === name &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildByAttr(attr, val, xmlns, recursive) {\n    return this.getChildrenByAttr(attr, val, xmlns, recursive)[0];\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildrenByAttr(attr, val, xmlns, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (\n        child.attrs &&\n        child.attrs[attr] === val &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByAttr) {\n        result.push(child.getChildrenByAttr(attr, val, xmlns, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getChildrenByFilter(filter, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (filter(child)) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByFilter) {\n        result.push(child.getChildrenByFilter(filter, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getText() {\n    let text = \"\";\n    for (const child of this.children) {\n      if (typeof child === \"string\" || typeof child === \"number\") {\n        text += child;\n      }\n    }\n    return text;\n  }\n\n  getChildText(name, xmlns) {\n    const child = this.getChild(name, xmlns);\n    return child ? child.getText() : null;\n  }\n\n  /**\n   * Return all direct descendents that are Elements.\n   * This differs from `getChildren` in that it will exclude text nodes,\n   * processing instructions, etc.\n   */\n  getChildElements() {\n    return this.getChildrenByFilter((child) => {\n      return child instanceof Element;\n    });\n  }\n\n  /* Builder */\n\n  /** returns uppermost parent */\n  root() {\n    if (this.parent) {\n      return this.parent.root();\n    }\n    return this;\n  }\n\n  /** just parent or itself */\n  up() {\n    if (this.parent) {\n      return this.parent;\n    }\n    return this;\n  }\n\n  /** create child node and return it */\n  c(name, attrs) {\n    return this.cnode(new Element(name, attrs));\n  }\n\n  cnode(child) {\n    this.children.push(child);\n    if (typeof child === \"object\") {\n      child.parent = this;\n    }\n    return child;\n  }\n\n  append(...nodes) {\n    for (const node of nodes) {\n      this.children.push(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  prepend(...nodes) {\n    for (const node of nodes) {\n      this.children.unshift(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  /** add text node and return element */\n  t(text) {\n    this.children.push(text);\n    return this;\n  }\n\n  /* Manipulation */\n\n  /**\n   * Either:\n   *   el.remove(childEl)\n   *   el.remove('author', 'urn:...')\n   */\n  remove(el, xmlns) {\n    const filter =\n      typeof el === \"string\"\n        ? (child) => {\n            /* 1st parameter is tag name */\n            return !(child.is && child.is(el, xmlns));\n          }\n        : (child) => {\n            /* 1st parameter is element */\n            return child !== el;\n          };\n\n    this.children = this.children.filter(filter);\n\n    return this;\n  }\n\n  text(val) {\n    if (val && this.children.length === 1) {\n      this.children[0] = val;\n      return this;\n    }\n    return this.getText();\n  }\n\n  attr(attr, val) {\n    if (typeof val !== \"undefined\" || val === null) {\n      if (!this.attrs) {\n        this.attrs = {};\n      }\n      this.attrs[attr] = val;\n      return this;\n    }\n    return this.attrs[attr];\n  }\n\n  /* Serialization */\n\n  toString() {\n    let s = \"\";\n    this.write((c) => {\n      s += c;\n    });\n    return s;\n  }\n\n  _addChildren(writer) {\n    writer(\">\");\n    for (const child of this.children) {\n      /* Skip null/undefined */\n      if (child != null) {\n        if (child.write) {\n          child.write(writer);\n        } else if (typeof child === \"string\") {\n          writer(escape.escapeXMLText(child));\n        } else if (child.toString) {\n          writer(escape.escapeXMLText(child.toString(10)));\n        }\n      }\n    }\n    writer(\"</\");\n    writer(this.name);\n    writer(\">\");\n  }\n\n  write(writer) {\n    writer(\"<\");\n    writer(this.name);\n    for (const k in this.attrs) {\n      const v = this.attrs[k];\n      // === null || undefined\n      if (v != null) {\n        writer(\" \");\n        writer(k);\n        writer('=\"');\n        writer(escape.escapeXML(typeof v === \"string\" ? v : v.toString(10)));\n        writer('\"');\n      }\n    }\n    if (this.children.length === 0) {\n      writer(\"/>\");\n    } else {\n      this._addChildren(writer);\n    }\n  }\n}\n\nElement.prototype.tree = Element.prototype.root;\n\nmodule.exports = Element;\n","'use strict';\n\nvar Element = require('./Element.js');\n\nfunction append(el, child) {\n  if (Array.isArray(child)) {\n    for (const c of child) append(el, c);\n    return;\n  }\n\n  if (child === \"\" || child == null || child === true || child === false) {\n    return;\n  }\n\n  el.cnode(child);\n}\n\n/**\n * JSX compatible API, use this function as pragma\n * https://facebook.github.io/jsx/\n *\n * @param  {string} name  name of the element\n * @param  {object} attrs object of attribute key/value pairs\n * @return {Element}      Element\n */\nfunction createElement(name, attrs, ...children) {\n  if (typeof attrs === \"object\" && attrs !== null) {\n    // __self and __source are added by babel in development\n    // https://github.com/facebook/react/pull/4596\n    // https://babeljs.io/docs/en/babel-preset-react#development\n    // https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source\n    delete attrs.__source;\n    delete attrs.__self;\n\n    for (const [key, value] of Object.entries(attrs)) {\n      if (value == null) delete attrs[key];\n      else attrs[key] = value.toString(10);\n    }\n  }\n\n  const el = new Element(name, attrs);\n\n  for (const child of children) {\n    append(el, child);\n  }\n\n  return el;\n}\n\nmodule.exports = createElement;\n","'use strict';\n\nvar events = require('events');\nvar escape = require('../escape.js');\n\nconst STATE_TEXT = 0;\nconst STATE_IGNORE_COMMENT = 1;\nconst STATE_IGNORE_INSTRUCTION = 2;\nconst STATE_TAG_NAME = 3;\nconst STATE_TAG = 4;\nconst STATE_ATTR_NAME = 5;\nconst STATE_ATTR_EQ = 6;\nconst STATE_ATTR_QUOT = 7;\nconst STATE_ATTR_VALUE = 8;\nconst STATE_CDATA = 9;\nconst STATE_IGNORE_CDATA = 10;\n\nclass SaxLtx extends events.EventEmitter {\n  constructor() {\n    super();\n    let state = STATE_TEXT;\n    let remainder;\n    let parseRemainder;\n    let tagName;\n    let attrs;\n    let endTag;\n    let selfClosing;\n    let attrQuote;\n    let attrQuoteChar;\n    let recordStart = 0;\n    let attrName;\n\n    this._handleTagOpening = function _handleTagOpening(\n      endTag,\n      tagName,\n      attrs\n    ) {\n      if (!endTag) {\n        this.emit(\"startElement\", tagName, attrs);\n        if (selfClosing) {\n          this.emit(\"endElement\", tagName, true);\n        }\n      } else {\n        this.emit(\"endElement\", tagName, false);\n      }\n    };\n\n    this.write = function write(data) {\n      if (typeof data !== \"string\") {\n        data = data.toString();\n      }\n      let pos = 0;\n\n      /* Anything from previous write()? */\n      if (remainder) {\n        data = remainder + data;\n        pos += !parseRemainder ? remainder.length : 0;\n        parseRemainder = false;\n        remainder = null;\n      }\n\n      function endRecording() {\n        if (typeof recordStart === \"number\") {\n          const recorded = data.slice(recordStart, pos);\n          recordStart = undefined;\n          return recorded;\n        }\n      }\n\n      for (; pos < data.length; pos++) {\n        switch (state) {\n          case STATE_TEXT: {\n            // if we're looping through text, fast-forward using indexOf to\n            // the next '<' character\n            const lt = data.indexOf(\"<\", pos);\n            if (lt !== -1 && pos !== lt) {\n              pos = lt;\n            }\n\n            break;\n          }\n          case STATE_ATTR_VALUE: {\n            // if we're looping through an attribute, fast-forward using\n            // indexOf to the next end quote character\n            const quot = data.indexOf(attrQuoteChar, pos);\n            if (quot !== -1) {\n              pos = quot;\n            }\n\n            break;\n          }\n          case STATE_IGNORE_COMMENT: {\n            // if we're looping through a comment, fast-forward using\n            // indexOf to the first end-comment character\n            const endcomment = data.indexOf(\"-->\", pos);\n            if (endcomment !== -1) {\n              pos = endcomment + 2; // target the '>' character\n            }\n\n            break;\n          }\n          case STATE_IGNORE_CDATA: {\n            // if we're looping through a CDATA, fast-forward using\n            // indexOf to the first end-CDATA character ]]>\n            const endCDATA = data.indexOf(\"]]>\", pos);\n            if (endCDATA !== -1) {\n              pos = endCDATA + 2; // target the '>' character\n            }\n\n            break;\n          }\n          // No default\n        }\n\n        const c = data.charCodeAt(pos);\n        switch (state) {\n          case STATE_TEXT:\n            if (c === 60 /* < */) {\n              const text = endRecording();\n              if (text) {\n                this.emit(\"text\", escape.unescapeXML(text));\n              }\n              state = STATE_TAG_NAME;\n              recordStart = pos + 1;\n              attrs = {};\n            }\n            break;\n          case STATE_CDATA:\n            if (c === 93 /* ] */) {\n              if (data.substr(pos + 1, 2) === \"]>\") {\n                const cData = endRecording();\n                if (cData) {\n                  this.emit(\"text\", cData);\n                }\n                state = STATE_TEXT;\n              } else if (data.length < pos + 2) {\n                parseRemainder = true;\n                pos = data.length;\n              }\n            }\n            break;\n          case STATE_TAG_NAME:\n            if (c === 47 /* / */ && recordStart === pos) {\n              recordStart = pos + 1;\n              endTag = true;\n            } else if (c === 33 /* ! */) {\n              if (data.substr(pos + 1, 7) === \"[CDATA[\") {\n                recordStart = pos + 8;\n                state = STATE_CDATA;\n              } else if (\n                data.length < pos + 8 &&\n                \"[CDATA[\".startsWith(data.slice(pos + 1))\n              ) {\n                // We potentially have CDATA, but the chunk is ending; stop here and let the next write() decide\n                parseRemainder = true;\n                pos = data.length;\n              } else {\n                recordStart = undefined;\n                state = STATE_IGNORE_COMMENT;\n              }\n            } else if (c === 63 /* ? */) {\n              recordStart = undefined;\n              state = STATE_IGNORE_INSTRUCTION;\n            } else if (c <= 32 || c === 47 /* / */ || c === 62 /* > */) {\n              tagName = endRecording();\n              pos--;\n              state = STATE_TAG;\n            }\n            break;\n          case STATE_IGNORE_COMMENT:\n            if (c === 62 /* > */) {\n              const prevFirst = data.charCodeAt(pos - 1);\n              const prevSecond = data.charCodeAt(pos - 2);\n              if (\n                (prevFirst === 45 /* - */ && prevSecond === 45) /* - */ ||\n                (prevFirst === 93 /* ] */ && prevSecond === 93) /* ] */\n              ) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_IGNORE_INSTRUCTION:\n            if (c === 62 /* > */) {\n              const prev = data.charCodeAt(pos - 1);\n              if (prev === 63 /* ? */) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_TAG:\n            if (c === 62 /* > */) {\n              this._handleTagOpening(endTag, tagName, attrs);\n              tagName = undefined;\n              attrs = undefined;\n              endTag = undefined;\n              selfClosing = undefined;\n              state = STATE_TEXT;\n              recordStart = pos + 1;\n            } else if (c === 47 /* / */) {\n              selfClosing = true;\n            } else if (c > 32) {\n              recordStart = pos;\n              state = STATE_ATTR_NAME;\n            }\n            break;\n          case STATE_ATTR_NAME:\n            if (c <= 32 || c === 61 /* = */) {\n              attrName = endRecording();\n              pos--;\n              state = STATE_ATTR_EQ;\n            }\n            break;\n          case STATE_ATTR_EQ:\n            if (c === 61 /* = */) {\n              state = STATE_ATTR_QUOT;\n            }\n            break;\n          case STATE_ATTR_QUOT:\n            if (c === 34 /* \" */ || c === 39 /* ' */) {\n              attrQuote = c;\n              attrQuoteChar = c === 34 ? '\"' : \"'\";\n              state = STATE_ATTR_VALUE;\n              recordStart = pos + 1;\n            }\n            break;\n          case STATE_ATTR_VALUE:\n            if (c === attrQuote) {\n              const value = escape.unescapeXML(endRecording());\n              attrs[attrName] = value;\n              attrName = undefined;\n              state = STATE_TAG;\n            }\n            break;\n        }\n      }\n\n      if (typeof recordStart === \"number\" && recordStart <= data.length) {\n        remainder = data.slice(recordStart);\n        recordStart = 0;\n      }\n    };\n  }\n\n  end(data) {\n    if (data) {\n      this.write(data);\n    }\n\n    /* Uh, yeah */\n    this.write = function write() {};\n  }\n}\n\nmodule.exports = SaxLtx;\n","export default class XMLError extends Error {\n  constructor(...args) {\n    super(...args);\n    this.name = \"XMLError\";\n  }\n}\n","import LtxParser from \"ltx/lib/parsers/ltx.js\";\nimport Element from \"ltx/lib/Element.js\";\nimport { EventEmitter } from \"@xmpp/events\";\nimport XMLError from \"./XMLError.js\";\n\nclass Parser extends EventEmitter {\n  constructor() {\n    super();\n    const parser = new LtxParser();\n    this.root = null;\n    this.cursor = null;\n\n    parser.on(\"startElement\", this.onStartElement.bind(this));\n    parser.on(\"endElement\", this.onEndElement.bind(this));\n    parser.on(\"text\", this.onText.bind(this));\n\n    this.parser = parser;\n  }\n\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { root, cursor } = this;\n\n    if (!root) {\n      this.root = element;\n      this.emit(\"start\", element);\n    } else if (cursor !== root) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { root, cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor === root) {\n      this.emit(\"end\", root);\n      return;\n    }\n\n    if (!cursor.parent) {\n      cursor.parent = root;\n      this.emit(\"element\", cursor);\n      this.cursor = root;\n      return;\n    }\n\n    this.cursor = cursor.parent;\n  }\n\n  onText(str) {\n    const { cursor } = this;\n    if (!cursor) {\n      this.emit(\"error\", new XMLError(`${str} must be a child.`));\n      return;\n    }\n\n    cursor.t(str);\n  }\n\n  write(data) {\n    this.parser.write(data);\n  }\n\n  end(data) {\n    if (data) {\n      this.parser.write(data);\n    }\n  }\n}\n\nParser.XMLError = XMLError;\n\nexport default Parser;\n","import Element from \"ltx/lib/Element.js\";\nimport createElement from \"ltx/lib/createElement.js\";\nimport Parser from \"./lib/Parser.js\";\nimport {\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n} from \"ltx/lib/escape.js\";\nimport XMLError from \"./lib/XMLError.js\";\n\nexport default function xml(...args) {\n  return createElement(...args);\n}\n\nObject.assign(xml, {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n});\n\nexport {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n};\n","// https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.9.2\n\nclass XMPPError extends Error {\n  constructor(condition, text, application) {\n    super(condition + (text ? ` - ${text}` : \"\"));\n    this.name = \"XMPPError\";\n    this.condition = condition;\n    this.text = text;\n    this.application = application;\n  }\n\n  static fromElement(element) {\n    const [condition, second, third] = element.getChildElements();\n    let text;\n    let application;\n\n    if (second) {\n      if (second.is(\"text\")) {\n        text = second;\n      } else if (second) {\n        application = second;\n      }\n\n      if (third) application = third;\n    }\n\n    const error = new this(\n      condition.name,\n      text ? text.text() : \"\",\n      application,\n    );\n    error.element = element;\n    return error;\n  }\n}\n\nexport default XMPPError;\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#streams-error\n\nclass StreamError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"StreamError\";\n  }\n}\n\nexport default StreamError;\n","function parseURI(URI) {\n  let { port, hostname, protocol } = new URL(URI);\n  // https://github.com/nodejs/node/issues/12410#issuecomment-294138912\n  if (hostname === \"[::1]\") {\n    hostname = \"::1\";\n  }\n\n  return { port, hostname, protocol };\n}\n\nfunction parseHost(host) {\n  const { port, hostname } = parseURI(`http://${host}`);\n  return { port, hostname };\n}\n\nfunction parseService(service) {\n  return service.includes(\"://\") ? parseURI(service) : parseHost(service);\n}\n\nexport { parseURI, parseHost, parseService };\n","import { EventEmitter, promise, listeners } from \"@xmpp/events\";\nimport jid from \"@xmpp/jid\";\nimport xml from \"@xmpp/xml\";\nimport StreamError from \"./lib/StreamError.js\";\nimport { parseHost, parseService } from \"./lib/util.js\";\n\nconst NS_STREAM = \"urn:ietf:params:xml:ns:xmpp-streams\";\nconst NS_JABBER_STREAM = \"http://etherx.jabber.org/streams\";\n\nclass Connection extends EventEmitter {\n  #socketListeners = null;\n  #parserListeners = null;\n\n  constructor(options = {}) {\n    super();\n\n    if (typeof options === \"string\") {\n      options = { domain: options };\n    }\n\n    this.jid = null;\n    this.timeout = options.timeout || 2000;\n    this.options = options;\n    this.status = \"offline\";\n    this.socket = null;\n    this.parser = null;\n    this.root = null;\n  }\n\n  isSecure() {\n    return this.socket?.secure === true;\n  }\n\n  async _streamError(condition, children) {\n    try {\n      await this.send(\n        // prettier-ignore\n        xml('stream:error', {}, [\n          xml(condition, {xmlns: NS_STREAM}, children),\n        ]),\n      );\n    } catch {}\n\n    return this.disconnect();\n  }\n\n  _onData(data) {\n    const str = data.toString(\"utf8\");\n    this.parser.write(str);\n  }\n\n  #onParserError(error) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-bad-format\n    // \"This error can be used instead of the more specific XML-related errors,\n    // such as <bad-namespace-prefix/>, <invalid-xml/>, <not-well-formed/>, <restricted-xml/>,\n    // and <unsupported-encoding/>. However, the more specific errors are RECOMMENDED.\"\n    this._streamError(\"bad-format\");\n    this._detachParser();\n    this.emit(\"error\", error);\n  }\n\n  #onSocketClosed(dirty, reason) {\n    this._detachSocket();\n    this._status(\"disconnect\", { clean: !dirty, reason });\n  }\n\n  #onStreamClosed(dirty, reason) {\n    this._detachParser();\n    this._status(\"close\", { clean: !dirty, reason });\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#socketListeners ??= listeners({\n      data: this._onData.bind(this),\n      close: this.#onSocketClosed.bind(this),\n      connect: () => this._status(\"connect\"),\n      error: (error) => this.emit(\"error\", error),\n    });\n    this.#socketListeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.socket && this.#socketListeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  _onElement(element) {\n    const isStreamError = element.is(\"error\", NS_JABBER_STREAM);\n\n    if (isStreamError) {\n      this._onStreamError(element);\n    }\n\n    this.emit(\"element\", element);\n    this.emit(this.isStanza(element) ? \"stanza\" : \"nonza\", element);\n\n    if (isStreamError) {\n      // \"Stream Errors Are Unrecoverable\"\n      // \"The entity that receives the stream error then SHALL close the stream\"\n      this.disconnect();\n    }\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error\n  _onStreamError(element) {\n    const error = StreamError.fromElement(element);\n\n    if (error.condition === \"see-other-host\") {\n      return this._onSeeOtherHost(error);\n    }\n\n    this.emit(\"error\", error);\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-see-other-host\n  async _onSeeOtherHost(error) {\n    const { protocol } = parseService(this.options.service);\n\n    const host = error.element.getChildText(\"see-other-host\");\n    const { port } = parseHost(host);\n\n    let service;\n    service = port\n      ? `${protocol || \"xmpp:\"}//${host}`\n      : (protocol ? `${protocol}//` : \"\") + host;\n\n    try {\n      await promise(this, \"disconnect\");\n      const { domain, lang } = this.options;\n      await this.connect(service);\n      await this.open({ domain, lang });\n    } catch (err) {\n      this.emit(\"error\", err);\n    }\n  }\n\n  _attachParser(parser) {\n    this.parser = parser;\n    this.#parserListeners ??= listeners({\n      element: this._onElement.bind(this),\n      error: this.#onParserError.bind(this),\n      end: this.#onStreamClosed.bind(this),\n      start: (element) => this._status(\"open\", element),\n    });\n    this.#parserListeners.subscribe(this.parser);\n  }\n\n  _detachParser() {\n    this.parser && this.#parserListeners?.unsubscribe(this.parser);\n    this.parser = null;\n    this.root = null;\n  }\n\n  _jid(id) {\n    this.jid = jid(id);\n    return this.jid;\n  }\n\n  /*\n  [\n    \"offline\",\n    // \"disconnect\",\n    \"connecting\",\n    \"connected\",\n    \"opening\",\n    \"open\",\n    \"online\",\n    \"closing\",\n    \"close\",\n    \"disconnecting\",\n    \"disconnect\",\n    \"offline\",\n  ];\n  */\n  _status(status, ...args) {\n    if (this.status === status) return;\n    this.status = status;\n    this.emit(\"status\", status, ...args);\n    this.emit(status, ...args);\n  }\n\n  _ready(resumed = false) {\n    if (resumed) {\n      this.status = \"online\";\n    } else {\n      this._status(\"online\", this.jid);\n    }\n  }\n\n  async disconnect() {\n    let el;\n\n    try {\n      el = await this._closeStream();\n    } catch (err) {\n      this.#onStreamClosed(err);\n    }\n\n    try {\n      await this._closeSocket();\n    } catch (err) {\n      this.#onSocketClosed(true, err);\n    }\n\n    return el;\n  }\n\n  /**\n   * Opens the socket then opens the stream\n   */\n  async start() {\n    if (this.status !== \"offline\") {\n      throw new Error(\"Connection is not offline\");\n    }\n\n    const { service, domain, lang } = this.options;\n\n    await this.connect(service);\n\n    const promiseOnline = promise(this, \"online\");\n\n    await this.open({ domain, lang });\n\n    return promiseOnline;\n  }\n\n  /**\n   * Connects the socket\n   */\n  async connect(service) {\n    this._status(\"connecting\", service);\n    const socket = new this.Socket();\n    this._attachSocket(socket);\n    // The 'connect' status is set by the socket 'connect' listener\n    socket.connect(this.socketParameters(service));\n    return promise(socket, \"connect\");\n  }\n\n  /**\n   * Disconnects the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeSocket(timeout = this.timeout) {\n    this._status(\"disconnecting\");\n    this.socket.end();\n\n    // The 'disconnect' status is set by the socket 'close' listener\n    await promise(this.socket, \"close\", \"error\", timeout);\n  }\n\n  /**\n   * Opens the stream\n   */\n  async open(options) {\n    this._status(\"opening\");\n\n    const { domain, lang } = options;\n\n    const headerElement = this.headerElement();\n    headerElement.attrs.to = domain;\n    headerElement.attrs[\"xml:lang\"] = lang;\n    this.root = headerElement;\n\n    this._attachParser(new this.Parser());\n\n    await this.write(this.header(headerElement));\n    return promise(this, \"open\", \"error\", this.timeout);\n  }\n\n  /**\n   * Closes the stream then closes the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async stop() {\n    const el = await this.disconnect();\n    this._status(\"offline\", el);\n    return el;\n  }\n\n  /**\n   * Closes the stream and wait for the server to close it\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeStream(timeout = this.timeout) {\n    await this.#runHooks(\"close\");\n\n    const fragment = this.footer(this.footerElement());\n\n    await this.write(fragment);\n    this._status(\"closing\");\n    return promise(this.parser, \"end\", \"error\", timeout);\n    // The 'close' status is set by the parser 'end' listener\n  }\n\n  /**\n   * Restart the stream\n   * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation-restart\n   */\n  async restart() {\n    this._detachParser();\n    const { domain, lang } = this.options;\n    return this.open({ domain, lang });\n  }\n\n  async send(element) {\n    element.parent = this.root;\n    await this.write(element.toString());\n    this.emit(\"send\", element);\n  }\n\n  sendReceive(element, timeout = this.timeout) {\n    return Promise.all([\n      this.send(element),\n      promise(this, \"element\", \"error\", timeout),\n    ]).then(([, el]) => el);\n  }\n\n  async write(string) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-close\n    // \"Refrain from sending any further data over its outbound stream to the other entity\"\n    if (this.status === \"closing\") {\n      throw new Error(\"Connection is closing\");\n    }\n\n    return new Promise((resolve, reject) => {\n      this.socket.write(string, (err) => (err ? reject(err) : resolve()));\n    });\n  }\n\n  isStanza(element) {\n    const { name } = element;\n    return name === \"iq\" || name === \"message\" || name === \"presence\";\n  }\n\n  isNonza(element) {\n    return !this.isStanza(element);\n  }\n\n  // Override\n  header(el) {\n    return el.toString();\n  }\n\n  // Override\n  headerElement() {\n    return new xml.Element(\"\", {\n      version: \"1.0\",\n      xmlns: this.NS,\n    });\n  }\n\n  // Override\n  footer(el) {\n    return el.toString();\n  }\n\n  // Override\n  footerElement() {}\n\n  // Override\n  socketParameters() {}\n\n  /* Experimental hooks */\n  #hooks = new Map();\n  #hook_events = new Set([\"close\"]);\n  hook(event, handler /*priority = 0 TODO */) {\n    this.#assertHookEventName(event);\n\n    if (!this.#hooks.has(event)) {\n      this.#hooks.set(event, new Set());\n    }\n\n    this.#hooks.get(event).add([handler]);\n  }\n  #assertHookEventName(event) {\n    if (!this.#hook_events.has(event)) {\n      throw new Error(`Hook event name \"${event}\" is unknown.`);\n    }\n  }\n  unhook(event, handler) {\n    this.#assertHookEventName(event);\n    const handlers = this.#hooks.get(\"event\");\n    const item = [...handlers].find((item) => item.handler === handler);\n    handlers.remove(item);\n  }\n  async #runHooks(event, ...args) {\n    this.#assertHookEventName(event);\n\n    const hooks = this.#hooks.get(event);\n    if (!hooks) return;\n\n    // TODO run hooks by priority\n    // run hooks with the same priority in parallel\n\n    await Promise.all(\n      [...hooks].map(async ([handler]) => {\n        try {\n          await handler(...args);\n        } catch (err) {\n          this.emit(\"error\", err);\n        }\n      }),\n    );\n  }\n}\n\n// Override\nConnection.prototype.NS = \"\";\nConnection.prototype.Socket = null;\nConnection.prototype.Parser = null;\n\nexport default Connection;\n","import Connection from \"@xmpp/connection\";\n\nclass Client extends Connection {\n  constructor(options) {\n    super(options);\n    this.transports = [];\n  }\n\n  send(element, ...args) {\n    return this.Transport.prototype.send.call(this, element, ...args);\n  }\n\n  sendMany(...args) {\n    return this.Transport.prototype.sendMany.call(this, ...args);\n  }\n\n  _findTransport(service) {\n    return this.transports.find((Transport) => {\n      try {\n        return Transport.prototype.socketParameters(service) !== undefined;\n      } catch {\n        return false;\n      }\n    });\n  }\n\n  connect(service) {\n    const Transport = this._findTransport(service);\n\n    if (!Transport) {\n      throw new Error(\"No compatible connection method found.\");\n    }\n\n    this.Transport = Transport;\n    this.Socket = Transport.prototype.Socket;\n    this.Parser = Transport.prototype.Parser;\n\n    return super.connect(service);\n  }\n\n  socketParameters(...args) {\n    return this.Transport.prototype.socketParameters(...args);\n  }\n\n  header(headerElement, ...args) {\n    // if the client knows the XMPP identity then it SHOULD include the 'from' attribute\n    // after the confidentiality and integrity of the stream are protected via TLS\n    // or an equivalent security layer.\n    // https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.7.1\n    const from = this.isSecure() && this.jid?.bare().toString();\n    if (from) headerElement.attrs.from = from;\n    return this.Transport.prototype.header(headerElement, ...args);\n  }\n\n  headerElement(...args) {\n    return this.Transport.prototype.headerElement(...args);\n  }\n\n  footer(...args) {\n    return this.Transport.prototype.footer(...args);\n  }\n\n  footerElement(...args) {\n    return this.Transport.prototype.footerElement(...args);\n  }\n}\n\nClient.prototype.NS = \"jabber:client\";\n\nexport default Client;\n","const ANONYMOUS = \"ANONYMOUS\";\nconst PLAIN = \"PLAIN\";\n\nexport default function createOnAuthenticate(credentials, userAgent) {\n  return async function onAuthenticate(...args) {\n    if (typeof credentials === \"function\") {\n      await credentials(...args);\n      return;\n    }\n\n    const [authenticate, mechanisms, fast, entity] = args;\n\n    credentials.token ??= await fast?.fetch();\n\n    const mechanism = getMechanism({ mechanisms, entity, credentials });\n    await authenticate(credentials, mechanism, userAgent);\n  };\n}\n\nexport function getMechanism({ mechanisms, entity, credentials }) {\n  if (\n    !credentials?.username &&\n    !credentials?.password &&\n    !credentials?.token &&\n    mechanisms.includes(ANONYMOUS)\n  ) {\n    return ANONYMOUS;\n  }\n\n  if (entity.isSecure()) return mechanisms[0];\n\n  return mechanisms.find((mechanism) => mechanism !== PLAIN);\n}\n","import { EventEmitter } from \"@xmpp/events\";\n\nclass Reconnect extends EventEmitter {\n  constructor(entity) {\n    super();\n\n    this.delay = 1000;\n    this.entity = entity;\n    this._timeout = null;\n  }\n\n  #onDisconnect = () => {\n    this.scheduleReconnect();\n  };\n\n  scheduleReconnect() {\n    const { entity, delay, _timeout } = this;\n    clearTimeout(_timeout);\n    this._timeout = setTimeout(async () => {\n      if (entity.status !== \"disconnect\") {\n        return;\n      }\n\n      try {\n        await this.reconnect();\n      } catch {\n        // Ignoring the rejection is safe because the error is emitted on entity by #start\n      }\n    }, delay);\n  }\n\n  async reconnect() {\n    const { entity } = this;\n    this.emit(\"reconnecting\");\n\n    const { service, domain, lang } = entity.options;\n    await entity.connect(service);\n    await entity.open({ domain, lang });\n\n    this.emit(\"reconnected\");\n  }\n\n  start() {\n    const { entity } = this;\n    entity.on(\"disconnect\", this.#onDisconnect);\n  }\n\n  stop() {\n    const { entity, _timeout } = this;\n    entity.removeListener(\"disconnect\", this.#onDisconnect);\n    clearTimeout(_timeout);\n  }\n}\n\nexport default function reconnect({ entity }) {\n  const r = new Reconnect(entity);\n  r.start();\n  return r;\n}\n","import { EventEmitter, listeners } from \"@xmpp/events\";\nimport { parseURI } from \"@xmpp/connection/lib/util.js\";\n\nconst CODE = \"ECONNERROR\";\n\nexport function isSecure(url) {\n  const uri = parseURI(url);\n  if (uri.protocol === \"wss:\") return true;\n  if ([\"localhost\", \"127.0.0.1\", \"::1\"].includes(uri.hostname)) return true;\n  return false;\n}\n\nexport default class Socket extends EventEmitter {\n  #listeners = null;\n  socket = null;\n  url = null;\n  secure = false;\n\n  connect(url) {\n    this.url = url;\n    this.secure = isSecure(url);\n    // eslint-disable-next-line n/no-unsupported-features/node-builtins\n    this._attachSocket(new WebSocket(url, [\"xmpp\"]));\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#listeners ??= listeners({\n      open: () => this.emit(\"connect\"),\n      message: ({ data }) => this.emit(\"data\", data),\n      error: (event) => {\n        const { url } = this;\n        // WS\n        let { error } = event;\n        // DOM\n        if (!error) {\n          error = new Error(event.message || `WebSocket ${CODE} ${url}`);\n          error.errno = CODE;\n          error.code = CODE;\n        }\n\n        error.event = event;\n        error.url = url;\n        this.emit(\"error\", error);\n      },\n      close: (event) => {\n        this._detachSocket();\n        this.emit(\"close\", !event.wasClean, event);\n      },\n    });\n    this.#listeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.url = null;\n    this.secure = false;\n    this.socket && this.#listeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  end() {\n    this.socket.close();\n  }\n\n  write(data, fn) {\n    function done(err) {\n      if (!fn) return;\n      // eslint-disable-next-line promise/catch-or-return, promise/no-promise-in-callback\n      Promise.resolve().then(() => fn(err));\n    }\n\n    try {\n      this.socket.send(data);\n    } catch (err) {\n      done(err);\n      return;\n    }\n    done();\n  }\n}\n","import Socket from \"./Socket.js\";\nimport Connection from \"@xmpp/connection\";\nimport xml from \"@xmpp/xml\";\nimport FramedParser from \"./FramedParser.js\";\n\nconst NS_FRAMING = \"urn:ietf:params:xml:ns:xmpp-framing\";\n\n/* References\n * WebSocket protocol https://tools.ietf.org/html/rfc6455\n * WebSocket Web API https://html.spec.whatwg.org/multipage/comms.html#network\n * XMPP over WebSocket https://tools.ietf.org/html/rfc7395\n */\n\nclass ConnectionWebSocket extends Connection {\n  send(element, ...args) {\n    element.attrs.xmlns ??= this.NS;\n    return super.send(element, ...args);\n  }\n\n  async sendMany(elements) {\n    for (const element of elements) {\n      element.attrs.xmlns ??= this.NS;\n      element.parent = this.root;\n      this.socket.write(element.toString());\n      this.emit(\"send\", element);\n    }\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.6\n  footerElement() {\n    return new xml.Element(\"close\", {\n      xmlns: NS_FRAMING,\n    });\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.4\n  headerElement() {\n    const el = super.headerElement();\n    el.name = \"open\";\n    el.attrs.xmlns = NS_FRAMING;\n    return el;\n  }\n\n  socketParameters(service) {\n    return /^wss?:\\/\\//.test(service) ? service : undefined;\n  }\n}\n\nConnectionWebSocket.prototype.Socket = Socket;\nConnectionWebSocket.prototype.NS = \"jabber:client\";\nConnectionWebSocket.prototype.Parser = FramedParser;\n\nexport default ConnectionWebSocket;\n","import { Parser, Element, XMLError } from \"@xmpp/xml\";\n\nexport default class FramedParser extends Parser {\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { cursor } = this;\n\n    if (cursor) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor.parent) {\n      this.cursor = cursor.parent;\n      return;\n    }\n\n    if (cursor.is(\"open\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"start\", cursor);\n    } else if (cursor.is(\"close\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"end\", cursor);\n    } else {\n      this.emit(\"element\", cursor);\n    }\n\n    this.cursor = null;\n  }\n}\n","'use strict'\n\n/**\n * Expose compositor.\n */\n\nmodule.exports = compose\n\n/**\n * Compose `middleware` returning\n * a fully valid middleware comprised\n * of all those which are passed.\n *\n * @param {Array} middleware\n * @return {Function}\n * @api public\n */\n\nfunction compose (middleware) {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  /**\n   * @param {Object} context\n   * @return {Promise}\n   * @api public\n   */\n\n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n","export default class Context {\n  constructor(entity, stanza) {\n    this.stanza = stanza;\n    this.entity = entity;\n\n    const { name, attrs } = stanza;\n    const { type, id } = attrs;\n\n    this.name = name;\n    this.id = id || \"\";\n\n    if (name === \"message\") {\n      this.type = type || \"normal\";\n    } else if (name === \"presence\") {\n      this.type = type || \"available\";\n    } else {\n      this.type = type || \"\";\n    }\n\n    this.from = null;\n    this.to = null;\n    this.local = \"\";\n    this.domain = \"\";\n    this.resource = \"\";\n  }\n}\n","import Context from \"./Context.js\";\nimport JID from \"@xmpp/jid\";\n\nexport default class IncomingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const to = stanza.attrs.to || jid?.toString();\n    const from = stanza.attrs.from || domain;\n\n    if (to) this.to = new JID(to);\n\n    if (from) {\n      this.from = new JID(from);\n      this.local = this.from.local;\n      this.domain = this.from.domain;\n      this.resource = this.from.resource;\n    }\n  }\n}\n","import Context from \"./Context.js\";\nimport JID from \"@xmpp/jid\";\n\nexport default class OutgoingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const from = stanza.attrs.from || jid?.toString();\n    const to = stanza.attrs.to || domain;\n\n    if (from) this.from = new JID(from);\n\n    if (to) {\n      this.to = new JID(to);\n      this.local = this.to.local;\n      this.domain = this.to.domain;\n      this.resource = this.to.resource;\n    }\n  }\n}\n","import compose from \"koa-compose\";\n\nimport IncomingContext from \"./lib/IncomingContext.js\";\nimport OutgoingContext from \"./lib/OutgoingContext.js\";\n\nfunction listener(entity, middleware, Context) {\n  return (stanza) => {\n    const ctx = new Context(entity, stanza);\n    return compose(middleware)(ctx);\n  };\n}\n\nfunction errorHandler(entity) {\n  return (ctx, next) => {\n    next()\n      .then((reply) => reply && entity.send(reply))\n      .catch((err) => entity.emit(\"error\", err));\n  };\n}\n\nexport default function middleware({ entity }) {\n  const incoming = [errorHandler(entity)];\n  const outgoing = [];\n\n  const incomingListener = listener(entity, incoming, IncomingContext);\n  const outgoingListener = listener(entity, outgoing, OutgoingContext);\n\n  entity.on(\"element\", incomingListener);\n  entity.on(\"send\", outgoingListener);\n\n  return {\n    use(fn) {\n      incoming.push(fn);\n      return fn;\n    },\n    filter(fn) {\n      outgoing.push(fn);\n      return fn;\n    },\n  };\n}\n","import XMPPError from \"@xmpp/error\";\n\n/* https://xmpp.org/rfcs/rfc6120.html#stanzas-error */\n\nclass StanzaError extends XMPPError {\n  constructor(condition, text, application, type) {\n    super(condition, text, application);\n    this.type = type;\n    this.name = \"StanzaError\";\n  }\n\n  static fromElement(element) {\n    const error = super.fromElement(element);\n    error.type = element.attrs.type;\n    return error;\n  }\n}\n\nexport default StanzaError;\n","import xid from \"@xmpp/id\";\nimport StanzaError from \"@xmpp/middleware/lib/StanzaError.js\";\nimport { Deferred, timeout as timeoutPromise } from \"@xmpp/events\";\nimport xml from \"@xmpp/xml\";\n\nfunction isReply({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type !== \"error\" && type !== \"result\") return false;\n  return true;\n}\n\nclass IQCaller {\n  constructor({ entity, middleware }) {\n    this.handlers = new Map();\n    this.entity = entity;\n    this.middleware = middleware;\n  }\n\n  start() {\n    this.middleware.use(this._route.bind(this));\n  }\n\n  _route({ type, name, id, stanza }, next) {\n    if (!isReply({ name, type })) return next();\n\n    const deferred = this.handlers.get(id);\n\n    if (!deferred) {\n      return next();\n    }\n\n    if (type === \"error\") {\n      deferred.reject(StanzaError.fromElement(stanza.getChild(\"error\")));\n    } else {\n      deferred.resolve(stanza);\n    }\n\n    this.handlers.delete(id);\n  }\n\n  async request(stanza, timeout = 30 * 1000) {\n    if (!stanza.attrs.id) {\n      stanza.attrs.id = xid();\n    }\n\n    const deferred = new Deferred();\n    this.handlers.set(stanza.attrs.id, deferred);\n\n    try {\n      await this.entity.send(stanza);\n      await timeoutPromise(deferred.promise, timeout);\n    } catch (err) {\n      this.handlers.delete(stanza.attrs.id);\n      throw err;\n    }\n\n    return deferred.promise;\n  }\n\n  _childRequest(type, element, to, ...args) {\n    const {\n      name,\n      attrs: { xmlns },\n    } = element;\n    return this.request(xml(\"iq\", { type, to }, element), ...args).then(\n      (stanza) => stanza.getChild(name, xmlns),\n    );\n  }\n\n  async get(...args) {\n    return this._childRequest(\"get\", ...args);\n  }\n\n  async set(...args) {\n    return this._childRequest(\"set\", ...args);\n  }\n}\n\nexport default function iqCaller(...args) {\n  const iqCaller = new IQCaller(...args);\n  iqCaller.start();\n  return iqCaller;\n}\n","export default function id() {\n  let i;\n  while (!i) {\n    i = Math.random().toString(36).slice(2, 12);\n  }\n\n  return i;\n}\n","import xml from \"@xmpp/xml\";\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-semantics-iq\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-error\n */\n\nconst NS_STANZA = \"urn:ietf:params:xml:ns:xmpp-stanzas\";\n\nfunction isQuery({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type === \"error\" || type === \"result\") return false;\n  return true;\n}\n\nfunction isValidQuery({ type }, children, child) {\n  if (type !== \"get\" && type !== \"set\") return false;\n  if (children.length !== 1) return false;\n  if (!child) return false;\n  return true;\n}\n\nfunction buildReply({ stanza }) {\n  return xml(\"iq\", {\n    to: stanza.attrs.from,\n    from: stanza.attrs.to,\n    id: stanza.attrs.id,\n  });\n}\n\nfunction buildReplyResult(ctx, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"result\";\n  if (child) {\n    reply.append(child);\n  }\n\n  return reply;\n}\n\nfunction buildReplyError(ctx, error, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"error\";\n  if (child) {\n    reply.append(child);\n  }\n\n  reply.append(error);\n  return reply;\n}\n\nfunction buildError(type, condition) {\n  return xml(\"error\", { type }, xml(condition, NS_STANZA));\n}\n\nfunction iqHandler(entity) {\n  return async function iqHandler(ctx, next) {\n    if (!isQuery(ctx)) return next();\n\n    const { stanza } = ctx;\n    const children = stanza.getChildElements();\n    const [child] = children;\n\n    if (!isValidQuery(ctx, children, child)) {\n      return buildReplyError(ctx, buildError(\"modify\", \"bad-request\"), child);\n    }\n\n    ctx.element = child;\n\n    let reply;\n    try {\n      reply = await next();\n    } catch (err) {\n      entity.emit(\"error\", err);\n      reply = buildError(\"cancel\", \"internal-server-error\");\n    }\n\n    if (!reply) {\n      reply = buildError(\"cancel\", \"service-unavailable\");\n    }\n\n    if (reply instanceof xml.Element && reply.is(\"error\")) {\n      return buildReplyError(ctx, reply, child);\n    }\n\n    return buildReplyResult(\n      ctx,\n      reply instanceof xml.Element ? reply : undefined,\n    );\n  };\n}\n\nfunction route(type, ns, name, handler) {\n  return (ctx, next) => {\n    if ((ctx.type !== type) | !ctx.element || !ctx.element.is(name, ns))\n      return next();\n    return handler(ctx, next);\n  };\n}\n\nexport default function iqCallee({ middleware, entity }) {\n  middleware.use(iqHandler(entity));\n\n  return {\n    get(ns, name, handler) {\n      middleware.use(route(\"get\", ns, name, handler));\n    },\n    set(ns, name, handler) {\n      middleware.use(route(\"set\", ns, name, handler));\n    },\n  };\n}\n","function isSecure(uri) {\n  return uri.startsWith(\"https\") || uri.startsWith(\"wss\");\n}\n\nexport function compare(a, b) {\n  let secure;\n  if (isSecure(a.uri) && !isSecure(b.uri)) {\n    secure = -1;\n  } else if (!isSecure(a.uri) && isSecure(b.uri)) {\n    secure = 1;\n  } else {\n    secure = 0;\n  }\n\n  if (secure !== 0) {\n    return secure;\n  }\n\n  let method;\n  if (a.method === b.method) {\n    method = 0;\n  } else if (a.method === \"websocket\") {\n    method = -1;\n  } else if (b.method === \"websocket\") {\n    method = 1;\n  } else if (a.method === \"xbosh\") {\n    method = -1;\n  } else if (b.method === \"xbosh\") {\n    method = 1;\n  } else if (a.method === \"httppoll\") {\n    method = -1;\n  } else if (b.method === \"httppoll\") {\n    method = 1;\n  } else {\n    method = 0;\n  }\n\n  if (method !== 0) {\n    return method;\n  }\n\n  return 0;\n}\n","import parse from \"@xmpp/xml/lib/parse.js\";\nimport { compare as compareAltConnections } from \"./alt-connections.js\";\n\nexport function resolve(domain) {\n  // eslint-disable-next-line n/no-unsupported-features/node-builtins\n  return fetch(`https://${domain}/.well-known/host-meta`)\n    .then((res) => res.text())\n    .then((res) => {\n      return parse(res)\n        .getChildren(\"Link\")\n        .filter((link) =>\n          [\n            \"urn:xmpp:alt-connections:websocket\",\n            \"urn:xmpp:alt-connections:httppoll\",\n            \"urn:xmpp:alt-connections:xbosh\",\n          ].includes(link.attrs.rel),\n        )\n        .map(({ attrs }) => ({\n          rel: attrs.rel,\n          href: attrs.href,\n          method: attrs.rel.split(\":\").pop(),\n          uri: attrs.href,\n        }))\n        .sort(compareAltConnections);\n    })\n    .catch(() => {\n      return [];\n    });\n}\n","import Parser from \"./Parser.js\";\n\nexport default function parse(data) {\n  const p = new Parser();\n\n  let result = null;\n  let error = null;\n\n  p.on(\"start\", (el) => {\n    result = el;\n  });\n  p.on(\"element\", (el) => {\n    result.append(el);\n  });\n  p.on(\"error\", (err) => {\n    error = err;\n  });\n\n  p.write(data);\n  p.end();\n\n  if (error) {\n    throw error;\n  } else {\n    return result;\n  }\n}\n","import _resolve from \"./resolve.js\";\nimport { promise } from \"@xmpp/events\";\n\nasync function fetchURIs(domain) {\n  const result = await _resolve(domain, {\n    srv: [\n      {\n        service: \"xmpps-client\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"xmpp-client\",\n        protocol: \"tcp\",\n      },\n    ],\n  });\n\n  return [\n    // Remove duplicates\n    ...new Set(result.map((record) => record.uri)),\n  ];\n}\n\nfunction filterSupportedURIs(entity, uris) {\n  return uris.filter((uri) => entity._findTransport(uri));\n}\n\nasync function fallbackConnect(entity, uris) {\n  if (uris.length === 0) {\n    throw new Error(\"Couldn't connect\");\n  }\n\n  const uri = uris.shift();\n  const Transport = entity._findTransport(uri);\n\n  if (!Transport) {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._status(\"connecting\", uri);\n  const params = Transport.prototype.socketParameters(uri);\n  const socket = new Transport.prototype.Socket();\n\n  try {\n    socket.connect(params);\n    await promise(socket, \"connect\");\n  } catch {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._attachSocket(socket);\n  socket.emit(\"connect\");\n  entity.Transport = Transport;\n  entity.Socket = Transport.prototype.Socket;\n  entity.Parser = Transport.prototype.Parser;\n}\n\nexport default function resolve({ entity }) {\n  const _connect = entity.connect;\n  entity.connect = async function connect(service) {\n    if (!service || /:\\/\\//.test(service)) {\n      return _connect.call(this, service);\n    }\n\n    const uris = filterSupportedURIs(entity, await fetchURIs(service));\n\n    if (uris.length === 0) {\n      throw new Error(\"No compatible transport found.\");\n    }\n\n    try {\n      await fallbackConnect(entity, uris);\n    } catch (err) {\n      await entity.disconnect();\n      entity._status(\"disconnect\");\n      throw err;\n    }\n  };\n}\n\nexport { _resolve as resolve };\n","import * as dns from \"./lib/dns.js\";\nimport * as http from \"./lib/http.js\";\n\nexport default function resolve(...args) {\n  return Promise.all([\n    dns.resolve ? dns.resolve(...args) : Promise.resolve([]),\n    http.resolve(...args),\n  ]).then(([records, endpoints]) => [...records, ...endpoints]);\n}\n\nexport { dns, http };\n","export function encode(string) {\n  return globalThis.btoa(string);\n}\n\nexport function decode(string) {\n  return globalThis.atob(string);\n}\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl-errors\n\nclass SASLError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"SASLError\";\n  }\n}\n\nexport default SASLError;\n","import { encode, decode } from \"@xmpp/base64\";\nimport SASLError from \"./lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-sasl\";\n\nexport function getAvailableMechanisms(element, NS, saslFactory) {\n  const offered = new Set(\n    element.getChildren(\"mechanism\", NS).map((m) => m.text()),\n  );\n  const supported = saslFactory._mechs.map(({ name }) => name);\n  return supported.filter((mech) => offered.has(mech));\n}\n\nasync function authenticate({ saslFactory, entity, mechanism, credentials }) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    mech.clientFirst &&\n      xml(\n        \"auth\",\n        { xmlns: NS, mechanism: mech.name },\n        encode(await mech.response(creds)),\n      ),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"success\") {\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl({ streamFeatures, saslFactory }, onAuthenticate) {\n  streamFeatures.use(\"mechanisms\", NS, async ({ entity }, _next, element) => {\n    const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n    if (mechanisms.length === 0) {\n      throw new SASLError(\"SASL: No compatible mechanism available.\");\n    }\n\n    async function done(credentials, mechanism) {\n      await authenticate({\n        saslFactory,\n        entity,\n        mechanism,\n        credentials,\n      });\n    }\n\n    await onAuthenticate(done, mechanisms, null, entity);\n\n    await entity.restart();\n  });\n}\n","import { encode, decode } from \"@xmpp/base64\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\n\n// https://xmpp.org/extensions/xep-0388.html\n\nconst NS = \"urn:xmpp:sasl:2\";\n\nasync function authenticate({\n  saslFactory,\n  entity,\n  mechanism,\n  credentials,\n  userAgent,\n  streamFeatures,\n  features,\n}) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    xml(\"authenticate\", { xmlns: NS, mechanism: mech.name }, [\n      mech.clientFirst &&\n        xml(\"initial-response\", {}, encode(await mech.response(creds))),\n      userAgent,\n      ...streamFeatures,\n    ]),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"continue\") {\n        throw new Error(\"SASL continue is not supported yet\");\n      }\n\n      if (element.name === \"success\") {\n        const additionalData = element.getChild(\"additional-data\")?.text();\n        if (additionalData && mech.final) {\n          await mech.final(decode(additionalData));\n        }\n\n        // https://xmpp.org/extensions/xep-0388.html#success\n        // this is a bare JID, unless resource binding or stream resumption has occurred, in which case it is a full JID.\n        const aid = element.getChildText(\"authorization-identifier\");\n        if (aid) {\n          entity._jid(aid);\n        }\n\n        for (const child of element.getChildElements()) {\n          const feature = features.get(child.getNS());\n          feature?.[1]?.(child);\n        }\n\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl2({ streamFeatures, saslFactory }, onAuthenticate) {\n  const features = new Map();\n  let fast;\n\n  streamFeatures.use(\n    \"authentication\",\n    NS,\n    async ({ entity }, _next, element) => {\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const streamFeatures = await getStreamFeatures({ element, features });\n      const fast_available = !!fast?.mechanism;\n\n      if (mechanisms.length === 0 && !fast_available) {\n        throw new SASLError(\"SASL: No compatible mechanism available.\");\n      }\n\n      await onAuthenticate(\n        done,\n        mechanisms,\n        fast_available ? fast : null,\n        entity,\n      );\n\n      async function done(credentials, mechanism, userAgent) {\n        // Try fast\n        const success = await fast.auth({\n          authenticate,\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          credentials,\n        });\n        if (success) return;\n\n        // fast.auth may mutate streamFeatures to request a token\n\n        // If fast authentication fails, continue and try without\n        await authenticate({\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          saslFactory,\n          mechanism,\n          credentials,\n        });\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n    setup({ fast: _fast }) {\n      fast = _fast;\n    },\n  };\n}\n\nasync function getStreamFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.getNS();\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","import xml from \"@xmpp/xml\";\n\n/*\n * References\n * https://xmpp.org/rfcs/rfc6120.html#bind\n */\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-bind\";\n\nfunction makeBindElement(resource) {\n  return xml(\"bind\", { xmlns: NS }, resource && xml(\"resource\", {}, resource));\n}\n\nasync function bind(entity, iqCaller, resource) {\n  const result = await iqCaller.set(makeBindElement(resource));\n  const jid = result.getChildText(\"jid\");\n  entity._jid(jid);\n  entity._ready(false);\n  return jid;\n}\n\nfunction route({ iqCaller }, resource) {\n  return async ({ entity }, next) => {\n    resource = typeof resource === \"function\" ? await resource() : resource;\n    await bind(entity, iqCaller, resource);\n    next();\n  };\n}\n\nexport default function resourceBinding(\n  { streamFeatures, iqCaller },\n  resource,\n) {\n  streamFeatures.use(\"bind\", NS, route({ iqCaller }, resource));\n}\n","function date(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return datetime(d).split(\"T\")[0];\n}\n\nfunction time(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return datetime(d).split(\"T\")[1];\n}\n\nfunction datetime(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return new Date(d).toISOString().split(\".\")[0] + \"Z\";\n}\n\nfunction pad(value) {\n  return value < 10 ? \"0\" + value : value;\n}\n\nfunction formatOffset(n) {\n  const sign = n > 0 ? \"-\" : \"+\";\n  const offset = Math.abs(n);\n  return sign + pad(Math.floor(offset / 60)) + \":\" + pad(offset % 60);\n}\n\nfunction offset(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return formatOffset(d.getTimezoneOffset());\n}\n\nexport { date, time, datetime, offset };\n","import XMPPError from \"@xmpp/error\";\nimport { procedure } from \"@xmpp/events\";\n\nimport { NS, makeEnableElement, makeResumeElement } from \"./index.js\";\n\nexport function setupStreamFeature({\n  streamFeatures,\n  sm,\n  entity,\n  resumed,\n  failed,\n  enabled,\n}) {\n  // https://xmpp.org/extensions/xep-0198.html#enable\n  // For client-to-server connections, the client MUST NOT attempt to enable stream management until after it has completed Resource Binding unless it is resuming a previous session\n  streamFeatures.use(\"sm\", NS, async (context, next) => {\n    // Resuming\n    if (sm.id) {\n      try {\n        const element = await resume(entity, sm);\n        await resumed(element);\n        return;\n        // If resumption fails, continue with session establishment\n      } catch {\n        failed();\n      }\n    }\n\n    // Enabling\n\n    // Resource binding first\n    await next();\n\n    const promiseEnable = enable(entity, sm);\n\n    if (sm.outbound_q.length > 0) {\n      throw new Error(\n        \"Stream Management assertion failure, queue should be empty after enable\",\n      );\n    }\n\n    // > The counter for an entity's own sent stanzas is set to zero and started after sending either <enable/> or <enabled/>.\n    // https://xmpp.org/extensions/xep-0198.html#example-7\n    sm.outbound = 0;\n\n    try {\n      const response = await promiseEnable;\n      enabled(response.attrs);\n    } catch {\n      sm.enabled = false;\n      sm.enableSent = false;\n    }\n  });\n}\n\nexport function enable(entity, sm) {\n  return procedure(entity, makeEnableElement({ sm }), (element, done) => {\n    if (element.is(\"enabled\", NS)) {\n      return done(element);\n    } else if (element.is(\"failed\", NS)) {\n      throw XMPPError.fromElement(element);\n    }\n  });\n}\n\nexport async function resume(entity, sm) {\n  return procedure(entity, makeResumeElement({ sm }), (element, done) => {\n    if (element.is(\"resumed\", NS)) {\n      return done(element);\n    } else if (element.is(\"failed\", NS)) {\n      throw XMPPError.fromElement(element);\n    }\n  });\n}\n","import { EventEmitter } from \"@xmpp/events\";\nimport xml from \"@xmpp/xml\";\nimport { datetime } from \"@xmpp/time\";\nimport { setupBind2 } from \"./bind2.js\";\nimport { setupSasl2 } from \"./sasl2.js\";\nimport { setupStreamFeature } from \"./stream-feature.js\";\n\n// https://xmpp.org/extensions/xep-0198.html\n\nexport const NS = \"urn:xmpp:sm:3\";\n\nexport function makeEnableElement({ sm }) {\n  return xml(\"enable\", {\n    xmlns: NS,\n    max: sm.preferredMaximum,\n    resume: \"true\",\n  });\n}\n\nexport function makeResumeElement({ sm }) {\n  return xml(\"resume\", { xmlns: NS, h: sm.inbound, previd: sm.id });\n}\n\nexport default function streamManagement({\n  streamFeatures,\n  entity,\n  middleware,\n  bind2,\n  sasl2,\n}) {\n  let timeoutTimeout = null;\n  let requestAckTimeout = null;\n  let requestAckDebounce = null;\n\n  const sm = new EventEmitter();\n  Object.assign(sm, {\n    preferredMaximum: null,\n    enabled: false,\n    enableSent: false,\n    id: \"\",\n    outbound_q: [],\n    outbound: 0,\n    inbound: 0,\n    max: null,\n    timeout: 60_000,\n    requestAckInterval: 30_000,\n    requestAckDebounce: 250,\n  });\n\n  async function sendAck() {\n    try {\n      await entity.send(xml(\"a\", { xmlns: NS, h: sm.inbound }));\n    } catch {}\n  }\n\n  entity.on(\"disconnect\", () => {\n    clearTimeout(timeoutTimeout);\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n    sm.enabled = false;\n    sm.enableSent = false;\n  });\n\n  // It is RECOMMENDED that initiating entities (usually clients) send an element right before they gracefully close the stream, in order to inform the peer about received stanzas\n  entity.hook(\"close\", async () => {\n    if (!sm.enabled) return;\n    await sendAck();\n  });\n\n  async function resumed(resumed) {\n    sm.enabled = true;\n    ackQueue(+resumed.attrs.h);\n    let q = sm.outbound_q;\n    sm.outbound_q = [];\n    // This will trigger the middleware and re-add to the queue\n    await entity.sendMany(q.map((item) => queueToStanza({ entity, item })));\n    sm.emit(\"resumed\");\n    entity._ready(true);\n    scheduleRequestAck();\n  }\n\n  function failed() {\n    sm.enabled = false;\n    sm.enableSent = false;\n    sm.id = \"\";\n    failQueue();\n  }\n\n  function ackQueue(n) {\n    const oldOutbound = sm.outbound;\n    for (let i = 0; i < +n - oldOutbound; i++) {\n      const item = sm.outbound_q.shift();\n      sm.outbound++;\n      sm.emit(\"ack\", item.stanza);\n    }\n  }\n\n  function failQueue() {\n    let item;\n    while ((item = sm.outbound_q.shift())) {\n      sm.emit(\"fail\", item.stanza);\n    }\n    sm.outbound = 0;\n  }\n\n  function enabled({ id, max }) {\n    sm.enabled = true;\n    sm.id = id;\n    sm.max = max;\n    // > The counter for the received stanzas ('h') is set to zero and started after receiving either <enable/> or <enabled/>.\n    // https://xmpp.org/extensions/xep-0198.html#example-7\n    sm.inbound = 0;\n    scheduleRequestAck();\n  }\n\n  entity.on(\"offline\", () => {\n    failQueue();\n    sm.inbound = 0;\n    sm.enabled = false;\n    sm.enableSent = false;\n    sm.id = \"\";\n  });\n\n  middleware.use(async (context, next) => {\n    const { stanza } = context;\n    clearTimeout(timeoutTimeout);\n    if ([\"presence\", \"message\", \"iq\"].includes(stanza.name)) {\n      sm.inbound += 1;\n    } else if (stanza.is(\"r\", NS)) {\n      // > When an <r/> element (\"request\") is received, the recipient MUST acknowledge it by sending an <a/> element to the sender containing a value of 'h' that is equal to the number of stanzas handled by the recipient of the <r/> element.\n      await sendAck();\n    } else if (stanza.is(\"a\", NS)) {\n      // > When a party receives an <a/> element, it SHOULD keep a record of the 'h' value returned as the sequence number of the last handled outbound stanza for the current stream (and discard the previous value).\n      ackQueue(+stanza.attrs.h);\n    }\n\n    scheduleRequestAck();\n\n    return next();\n  });\n\n  if (bind2) {\n    setupBind2({ bind2, sm, failed, enabled });\n  }\n  if (sasl2) {\n    setupSasl2({ sasl2, sm, failed, resumed });\n  }\n\n  // Periodically send r to check the connection\n  // If a stanza goes out it will cancel this and set a sooner timer\n  function scheduleRequestAck(timeout = sm.requestAckInterval) {\n    clearTimeout(requestAckTimeout);\n\n    if (!sm.enabled) return;\n    if (!timeout) return;\n\n    requestAckTimeout = setTimeout(requestAck, timeout);\n  }\n\n  function requestAck() {\n    clearTimeout(timeoutTimeout);\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n\n    if (!sm.enabled) return;\n\n    if (sm.timeout) {\n      timeoutTimeout = setTimeout(\n        () => entity.disconnect().catch(() => {}),\n        sm.timeout,\n      );\n    }\n    entity.send(xml(\"r\", { xmlns: NS })).catch(() => {});\n\n    scheduleRequestAck();\n  }\n\n  middleware.filter((context, next) => {\n    const { stanza } = context;\n    if (stanza.is(\"enable\", NS)) {\n      sm.enableSent = true;\n    }\n    if (!sm.enabled && !sm.enableSent) return next();\n    if (![\"presence\", \"message\", \"iq\"].includes(stanza.name)) return next();\n\n    sm.outbound_q.push({ stanza, stamp: datetime() });\n    // Debounce requests so we send only one after a big run of stanza together\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n    requestAckDebounce = setTimeout(requestAck, sm.requestAckDebounce);\n\n    return next();\n  });\n\n  if (streamFeatures) {\n    setupStreamFeature({\n      streamFeatures,\n      sm,\n      entity,\n      resumed,\n      failed,\n      enabled,\n    });\n  }\n\n  return sm;\n}\n\nfunction queueToStanza({ entity, item }) {\n  const { stanza, stamp } = item;\n  if (\n    stanza.name === \"message\" &&\n    !stanza.getChild(\"delay\", \"urn:xmpp:delay\")\n  ) {\n    stanza.append(\n      xml(\"delay\", {\n        xmlns: \"urn:xmpp:delay\",\n        from: entity.jid.toString(),\n        stamp,\n      }),\n    );\n  }\n  return stanza;\n}\n","import { NS, makeEnableElement } from \"./index.js\";\n\nexport function setupBind2({ bind2, sm, failed, enabled }) {\n  bind2.use(\n    NS,\n    // https://xmpp.org/extensions/xep-0198.html#inline-examples\n    (_element) => {\n      return makeEnableElement({ sm });\n    },\n    async (element) => {\n      if (element.is(\"enabled\")) {\n        enabled(element.attrs);\n      } else if (element.is(\"failed\")) {\n        // const error = StreamError.fromElement(element)\n        failed();\n      }\n    },\n  );\n}\n","import { NS, makeResumeElement } from \"./index.js\";\n\nexport function setupSasl2({ sasl2, sm, failed, resumed }) {\n  sasl2.use(\n    NS,\n    (element) => {\n      if (!element.is(\"sm\")) return;\n      if (sm.id) return makeResumeElement({ sm });\n    },\n    (element) => {\n      if (element.is(\"resumed\")) {\n        resumed(element);\n      } else if (element.is(\"failed\")) {\n        // const error = StreamError.fromElement(element)\n        failed();\n      }\n    },\n  );\n}\n","import xml from \"@xmpp/xml\";\n\nconst NS = \"urn:xmpp:bind:0\";\n\nexport default function bind2({ sasl2, entity }, tag) {\n  const features = new Map();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"bind\", NS)) return;\n\n      tag = typeof tag === \"function\" ? await tag() : tag;\n\n      const sessionFeatures = await getSessionFeatures({ element, features });\n\n      return xml(\n        \"bind\",\n        { xmlns: \"urn:xmpp:bind:0\" },\n        tag && xml(\"tag\", null, tag),\n        ...sessionFeatures,\n      );\n    },\n    (element) => {\n      if (!element.is(\"bound\")) return;\n      entity._ready(false);\n      for (const child of element.getChildElements()) {\n        const feature = features.get(child.getNS());\n        feature?.[1]?.(child);\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n  };\n}\n\nfunction getSessionFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.attrs.var;\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/factory'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/factory'], factory);\n  }\n}(this, function(exports, module, Factory) {\n  \n  exports = module.exports = Factory;\n  exports.Factory = Factory;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n  \n  /**\n   * `Factory` constructor.\n   *\n   * @api public\n   */\n  function Factory() {\n    this._mechs = [];\n  }\n  \n  /**\n   * Utilize the given `mech` with optional `name`, overridding the mechanism's\n   * default name.\n   *\n   * Examples:\n   *\n   *     factory.use(FooMechanism);\n   *\n   *     factory.use('XFOO', FooMechanism);\n   *\n   * @param {String|Mechanism} name\n   * @param {Mechanism} mech\n   * @return {Factory} for chaining\n   * @api public\n   */\n  Factory.prototype.use = function(name, mech) {\n    if (!mech) {\n      mech = name;\n      name = mech.prototype.name;\n    }\n    this._mechs.push({ name: name, mech: mech });\n    return this;\n  };\n  \n  /**\n   * Create a new mechanism from supported list of `mechs`.\n   *\n   * If no mechanisms are supported, returns `null`.\n   *\n   * Examples:\n   *\n   *     var mech = factory.create(['FOO', 'BAR']);\n   *\n   * @param {Array} mechs\n   * @return {Mechanism}\n   * @api public\n   */\n  Factory.prototype.create = function(mechs) {\n    for (var i = 0, len = this._mechs.length; i < len; i++) {\n      for (var j = 0, jlen = mechs.length; j < jlen; j++) {\n        var entry = this._mechs[i];\n        if (entry.name == mechs[j]) {\n          return new entry.mech();\n        }\n      }\n    }\n    return null;\n  };\n\n  exports = module.exports = Factory;\n  \n}));\n","import { EventEmitter } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport SASLFactory from \"saslmechanisms\";\n\nconst NS = \"urn:xmpp:fast:0\";\n\nexport default function fast({ sasl2, entity }) {\n  const saslFactory = new SASLFactory();\n\n  let token;\n\n  const fast = new EventEmitter();\n  Object.assign(fast, {\n    mechanism: null,\n    mechanisms: [],\n    async saveToken(t) {\n      token = t;\n    },\n    async fetchToken() {\n      return token;\n    },\n    async deleteToken() {\n      token = null;\n    },\n    async save(token) {\n      try {\n        await this.saveToken(token);\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async fetch() {\n      try {\n        return this.fetchToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async delete() {\n      try {\n        await this.deleteToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    saslFactory,\n    async auth({\n      authenticate,\n      entity,\n      userAgent,\n      credentials,\n      streamFeatures,\n      features,\n    }) {\n      // Unavailable\n      if (!fast.mechanism) {\n        return false;\n      }\n\n      const { token } = credentials;\n      if (!isTokenValid(token, fast.mechanisms)) {\n        return onInvalidToken();\n      }\n\n      try {\n        await authenticate({\n          saslFactory: fast.saslFactory,\n          mechanism: token.mechanism,\n          credentials: {\n            ...credentials,\n            password: token.token,\n          },\n          streamFeatures: [\n            ...streamFeatures,\n            xml(\"fast\", {\n              xmlns: NS,\n            }),\n          ],\n          entity,\n          userAgent,\n          features,\n        });\n        return true;\n      } catch (err) {\n        if (\n          err instanceof SASLError &&\n          [\"not-authorized\", \"credentials-expired\"].includes(err.condition)\n        ) {\n          return onInvalidToken();\n        }\n        entity.emit(\"error\", err);\n        return false;\n      }\n\n      async function onInvalidToken() {\n        await fast.delete();\n        requestToken(streamFeatures);\n        return false;\n      }\n    },\n  });\n\n  function requestToken(streamFeatures) {\n    streamFeatures.push(\n      xml(\"request-token\", {\n        xmlns: NS,\n        mechanism: fast.mechanism,\n      }),\n    );\n  }\n\n  function reset() {\n    fast.mechanism = null;\n    fast.mechanisms = [];\n  }\n  reset();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"fast\", NS)) return reset();\n\n      fast.available = true;\n\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const mechanism = mechanisms[0];\n\n      if (!mechanism) return reset();\n      fast.mechanisms = mechanisms;\n      fast.mechanism = mechanism;\n\n      // The rest is handled by @xmpp/sasl2\n    },\n    async (element) => {\n      if (element.is(\"token\", NS)) {\n        await fast.save({\n          // The token is bound by the mechanism\n          // > Servers MUST bind tokens to the mechanism selected by the client in its original request, and reject attempts to use them with other mechanisms.\n          mechanism: fast.mechanism,\n          token: element.attrs.token,\n          expiry: element.attrs.expiry,\n        });\n      }\n    },\n  );\n\n  return fast;\n}\n\nexport function isTokenValid(token, mechanisms) {\n  if (!token) return false;\n\n  // Avoid an error round trip if the server does not support the token mechanism anymore\n  if (!mechanisms.includes(token.mechanism)) {\n    return false;\n  }\n\n  // Avoid an error round trip if the token is already expired\n  if (new Date(token.expiry) <= new Date()) {\n    return false;\n  }\n\n  return true;\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * PLAIN `Mechanism` constructor.\n   *\n   * This class implements the PLAIN SASL mechanism.\n   *\n   * The PLAIN SASL mechanism provides support for exchanging a clear-text\n   * username and password.  This mechanism should not be used without adequate\n   * security provided by an underlying transport layer. \n   *\n   * References:\n   *  - [RFC 4616](http://tools.ietf.org/html/rfc4616)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'PLAIN';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using given credential.\n   *\n   * Options:\n   *  - `username`\n   *  - `password`\n   *  - `authzid`   authorization identity (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    var str = '';\n    str += cred.authzid || '';\n    str += '\\0';\n    str += cred.username;\n    str += '\\0';\n    str += cred.password;\n    return str;\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @return {Mechanism} for chaining\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n    return this;\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-plain\";\n\nexport default function saslPlain(sasl) {\n  sasl.use(mech);\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * ANONYMOUS `Mechanism` constructor.\n   *\n   * This class implements the ANONYMOUS SASL mechanism.\n   *\n   * The ANONYMOUS SASL mechanism provides support for permitting anonymous\n   * access to various services\n   *\n   * References:\n   *  - [RFC 4505](http://tools.ietf.org/html/rfc4505)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'ANONYMOUS';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using optional trace information.\n   *\n   * Options:\n   *  - `trace`  trace information (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    return cred.trace || '';\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-anonymous\";\n\n/**\n * [XEP-0175: Best Practices for Use of SASL ANONYMOUS](https://xmpp.org/extensions/xep-0175.html)\n * [RFC-4504: Anonymous Simple Authentication and Security Layer (SASL) Mechanism](https://tools.ietf.org/html/rfc4505)\n */\n\nexport default function saslAnonymous(sasl) {\n  sasl.use(mech);\n}\n","/* eslint-disable n/no-unsupported-features/node-builtins */\n\n// https://datatracker.ietf.org/doc/draft-schmaus-kitten-sasl-ht/\n// https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API\n\nexport function Mechanism() {}\n\nMechanism.prototype.Mechanism = Mechanism;\nMechanism.prototype.name = \"HT-SHA-256-NONE\";\nMechanism.prototype.clientFirst = true;\n\nMechanism.prototype.response = async function response({ username, password }) {\n  this.key = await crypto.subtle.importKey(\n    \"raw\",\n    new TextEncoder().encode(password),\n    // https://developer.mozilla.org/en-US/docs/Web/API/HmacImportParams\n    { name: \"HMAC\", hash: \"SHA-256\" },\n    false, // extractable\n    [\"sign\", \"verify\"],\n  );\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    this.key,\n    new TextEncoder().encode(\"Initiator\"),\n  );\n  return `${username}\\0${String.fromCodePoint(...new Uint8Array(signature))}`;\n};\n\nMechanism.prototype.final = async function final(data) {\n  const signature = Uint8Array.from(data, (c) => c.codePointAt(0));\n  // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/verify\n  const result = await crypto.subtle.verify(\n    \"HMAC\",\n    this.key,\n    signature,\n    new TextEncoder().encode(\"Responder\"),\n  );\n  if (result !== true) {\n    throw new Error(\"Responder message from server was wrong\");\n  }\n};\n\nexport default function saslHashedToken(sasl) {\n  sasl.use(Mechanism);\n}\n","import { xml, jid, Client } from \"@xmpp/client-core\";\nimport getDomain from \"./lib/getDomain.js\";\nimport createOnAuthenticate from \"./lib/createOnAuthenticate.js\";\n\nimport _reconnect from \"@xmpp/reconnect\";\nimport _websocket from \"@xmpp/websocket\";\nimport _tcp from \"@xmpp/tcp\";\nimport _tls from \"@xmpp/tls\";\nimport _middleware from \"@xmpp/middleware\";\nimport _streamFeatures from \"@xmpp/stream-features\";\nimport _iqCaller from \"@xmpp/iq/caller.js\";\nimport _iqCallee from \"@xmpp/iq/callee.js\";\nimport _resolve from \"@xmpp/resolve\";\nimport _starttls from \"@xmpp/starttls\";\nimport _sasl2 from \"@xmpp/sasl2\";\nimport _sasl from \"@xmpp/sasl\";\nimport _resourceBinding from \"@xmpp/resource-binding\";\nimport _streamManagement from \"@xmpp/stream-management\";\nimport _bind2 from \"@xmpp/client-core/src/bind2/bind2.js\";\nimport _fast from \"@xmpp/client-core/src/fast/fast.js\";\n\nimport SASLFactory from \"saslmechanisms\";\nimport scramsha1 from \"@xmpp/sasl-scram-sha-1\";\nimport plain from \"@xmpp/sasl-plain\";\nimport anonymous from \"@xmpp/sasl-anonymous\";\nimport htsha256none from \"@xmpp/sasl-ht-sha-256-none\";\n\nfunction client(options = {}) {\n  let { resource, credentials, username, password, userAgent, ...params } =\n    options;\n\n  const { domain, service } = params;\n  if (!domain && service) {\n    params.domain = getDomain(service);\n  }\n\n  const entity = new Client(params);\n  if (username && params.domain) {\n    entity.jid = jid(username, params.domain);\n  }\n\n  const reconnect = _reconnect({ entity });\n  const websocket = _websocket({ entity });\n  const tcp = setupIfAvailable(_tcp, { entity });\n  const tls = setupIfAvailable(_tls, { entity });\n\n  const middleware = _middleware({ entity });\n  const streamFeatures = _streamFeatures({ middleware });\n  const iqCaller = _iqCaller({ middleware, entity });\n  const iqCallee = _iqCallee({ middleware, entity });\n  const resolve = _resolve({ entity });\n\n  // SASL mechanisms - order matters and define priority\n  const saslFactory = new SASLFactory();\n  const mechanisms = Object.entries({\n    ...(typeof scramsha1 === \"function\" && { scramsha1 }),\n    plain,\n    anonymous,\n  }).map(([k, v]) => ({ [k]: v(saslFactory) }));\n\n  // eslint-disable-next-line n/no-unsupported-features/node-builtins\n  userAgent ??= xml(\"user-agent\", { id: globalThis.crypto.randomUUID() });\n\n  // Stream features - order matters and define priority\n  const starttls = setupIfAvailable(_starttls, { streamFeatures });\n  const sasl2 = _sasl2(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent),\n  );\n\n  const fast = _fast({\n    sasl2,\n    entity,\n  });\n  sasl2.setup({ fast });\n\n  // SASL2 inline features\n  const bind2 = _bind2({ sasl2, entity }, resource);\n\n  // FAST mechanisms - order matters and define priority\n  htsha256none(fast.saslFactory);\n\n  // Stream features - order matters and define priority\n  const sasl = _sasl(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent),\n  );\n  const streamManagement = _streamManagement({\n    streamFeatures,\n    entity,\n    middleware,\n    bind2,\n    sasl2,\n  });\n  const resourceBinding = _resourceBinding(\n    { iqCaller, streamFeatures },\n    resource,\n  );\n\n  iqCallee?.get(\"urn:xmpp:ping\", \"ping\", () => {\n    return {};\n  });\n\n  return Object.assign(entity, {\n    entity,\n    reconnect,\n    tcp,\n    websocket,\n    tls,\n    middleware,\n    streamFeatures,\n    iqCaller,\n    iqCallee,\n    resolve,\n    starttls,\n    saslFactory,\n    sasl2,\n    sasl,\n    resourceBinding,\n    streamManagement,\n    mechanisms,\n    bind2,\n    fast,\n  });\n}\n\n// In browsers and react-native some packages are excluded\n// see package.json and https://metrobundler.dev/docs/configuration/#resolvermainfields\n// in which case the default import returns an empty object\nfunction setupIfAvailable(module, ...args) {\n  if (typeof module !== \"function\") {\n    return undefined;\n  }\n\n  return module(...args);\n}\n\nexport { xml, jid, client };\n","export default function getDomain(service) {\n  const domain = service.split(\"://\")[1] || service;\n  return domain.split(\":\")[0].split(\"/\")[0];\n}\n","import ConnectionWebSocket from \"./lib/Connection.js\";\n\nexport default function websocket({ entity }) {\n  entity.transports.push(ConnectionWebSocket);\n}\n","/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation Stream Negotiation\n * https://xmpp.org/extensions/xep-0170.html XEP-0170: Recommended Order of Stream Feature Negotiation\n * https://xmpp.org/registrar/stream-features.html XML Stream Features\n */\n\nexport default function streamFeatures({ middleware }) {\n  function use(name, xmlns, handler) {\n    return middleware.use((ctx, next) => {\n      const { stanza } = ctx;\n      if (!stanza.is(\"features\", \"http://etherx.jabber.org/streams\"))\n        return next();\n      const feature = stanza.getChild(name, xmlns);\n      if (!feature) return next();\n      return handler(ctx, next, feature);\n    });\n  }\n\n  return {\n    use,\n  };\n}\n"],"names":["domain","EventHandlers","EventEmitter","init","call","this","$getMaxListeners","that","undefined","_maxListeners","defaultMaxListeners","_addListener","target","type","listener","prepend","m","events","existing","e","TypeError","_events","newListener","emit","_eventsCount","unshift","push","warned","length","w","Error","name","emitter","count","console","warn","log","_onceWrap","fired","g","removeListener","apply","arguments","listenerCount","evlistener","arrayClone","arr","i","copy","Array","prototype","Object","create","usingDomains","active","Domain","getPrototypeOf","setMaxListeners","n","isNaN","getMaxListeners","er","handler","len","args","doError","error","err","context","domainEmitter","domainThrown","isFn","self","listeners","emitNone","arg1","emitOne","arg2","emitTwo","arg3","emitThree","emitMany","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","index","k","pop","spliceOne","removeAllListeners","key","keys","ret","unwrapListeners","eventNames","Reflect","ownKeys","TimeoutError","constructor","message","super","timeout","promise","ms","promiseDelay","Promise","resolve","setTimeout","delay","race","finally","clearTimeout","then","map","WeakMap","onoff","get","addEventListener","bind","off","removeEventListener","event","set","rejectEvent","reject","timeoutId","cleanup","onEvent","onError","reason","value","Deferred","procedure","entity","stanza","done","async","element","send","catch","subscribe","entries","unsubscribe","detect","local","replaceAll","String","raw","search","escape","unescape","JID","resource","setDomain","setLocal","setResource","Symbol","toPrimitive","hint","Number","NaN","toString","s","_domain","_local","getLocal","_resource","bare","equals","other","escaping","toLowerCase","getDomain","getResource","parse","resourceStart","indexOf","slice","atStart","jid","defineProperty","j","equal","a","b","detectEscape","escapeLocal","unescapeLocal","escapeXMLTable","escapeXMLReplace","match","unescapeXMLTable","unescapeXMLReplace","num","parseInt","fromCodePoint","exports","replace","result","start","end","previous","substring","require","Element","attrs","parent","children","setAttrs","is","xmlns","getName","getNS","idx","prefix","findNS","attr","getXmlns","namespaces","hasOwnProperty","assign","getAttr","join","getChild","getChildren","child","getChildByAttr","val","recursive","getChildrenByAttr","flat","getChildrenByFilter","filter","getText","text","getChildText","getChildElements","root","up","c","cnode","append","nodes","node","t","remove","el","write","_addChildren","writer","escapeXMLText","v","escapeXML","tree","module","isArray","__source","__self","SaxLtx","remainder","parseRemainder","tagName","endTag","selfClosing","attrQuote","attrQuoteChar","attrName","state","recordStart","_handleTagOpening","data","pos","endRecording","recorded","lt","quot","endcomment","endCDATA","charCodeAt","unescapeXML","substr","cData","startsWith","prevFirst","prevSecond","XMLError","Parser","parser","LtxParser","cursor","onStartElement","onEndElement","onText","str","xml","createElement","unescapeXMLText","XMPPError","condition","application","fromElement","second","third","StreamError","parseURI","URI","port","hostname","protocol","URL","parseHost","host","Connection","socketListeners","parserListeners","options","status","socket","isSecure","secure","_streamError","disconnect","_onData","onParserError","_detachParser","onSocketClosed","dirty","_detachSocket","_status","clean","onStreamClosed","_attachSocket","close","connect","_onElement","isStreamError","_onStreamError","isStanza","_onSeeOtherHost","service","includes","parseService","lang","open","_attachParser","_jid","id","_ready","resumed","_closeStream","_closeSocket","promiseOnline","Socket","socketParameters","headerElement","to","header","stop","runHooks","fragment","footer","footerElement","restart","sendReceive","all","string","isNonza","version","NS","hooks","Map","hook_events","Set","hook","assertHookEventName","has","add","unhook","handlers","item","find","Client","transports","Transport","sendMany","_findTransport","from","ANONYMOUS","PLAIN","createOnAuthenticate","credentials","userAgent","authenticate","mechanisms","fast","token","fetch","mechanism","username","password","getMechanism","Reconnect","_timeout","onDisconnect","#onDisconnect","scheduleReconnect","reconnect","CODE","NS_FRAMING","ConnectionWebSocket","elements","test","url","uri","WebSocket","errno","code","wasClean","fn","middleware","next","dispatch","Context","IncomingContext","OutgoingContext","ctx","compose","errorHandler","reply","StanzaError","IQCaller","use","_route","isReply","deferred","delete","request","Math","random","xid","timeoutPromise","_childRequest","buildReply","buildReplyError","buildError","iqHandler","isQuery","isValidQuery","buildReplyResult","route","ns","compare","method","res","p","link","rel","href","split","sort","compareAltConnections","fetchURIs","http","records","endpoints","_resolve","srv","record","fallbackConnect","uris","shift","params","_connect","filterSupportedURIs","encode","globalThis","btoa","decode","atob","SASLError","getAvailableMechanisms","saslFactory","offered","_mechs","mech","sasl","streamFeatures","onAuthenticate","_next","creds","server","realm","serviceType","serviceName","clientFirst","response","challenge","resp","features","additionalData","final","aid","feature","sasl2","promises","inline","getStreamFeatures","fast_available","auth","req","setup","_fast","iqCaller","makeBindElement","resourceBinding","datetime","d","Date","toISOString","setupStreamFeature","sm","failed","enabled","makeResumeElement","resume","promiseEnable","makeEnableElement","enable","outbound_q","outbound","enableSent","max","preferredMaximum","h","inbound","previd","streamManagement","bind2","timeoutTimeout","requestAckTimeout","requestAckDebounce","sendAck","ackQueue","q","stamp","queueToStanza","scheduleRequestAck","failQueue","oldOutbound","requestAckInterval","requestAck","_element","setupBind2","setupSasl2","tag","sessionFeatures","var","getSessionFeatures","Factory","mechs","jlen","entry","factory","SASLFactory","reset","saveToken","fetchToken","deleteToken","save","expiry","isTokenValid","onInvalidToken","requestToken","available","Mechanism","cred","authzid","chal","saslPlain","trace","saslAnonymous","setupIfAvailable","crypto","subtle","importKey","TextEncoder","hash","signature","sign","Uint8Array","codePointAt","verify","r","_reconnect","websocket","_websocket","tcp","_tcp","tls","_tls","incoming","outgoing","incomingListener","outgoingListener","_middleware","_streamFeatures","_iqCaller","iqCallee","_iqCallee","plain","anonymous","randomUUID","starttls","_starttls","_sasl2","_bind2","htsha256none","_sasl","_streamManagement","_resourceBinding"],"mappings":"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","x_google_ignoreList":[0,13,14,15,16,30,55,56,58,59,61,62]}