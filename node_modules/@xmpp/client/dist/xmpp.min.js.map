{"version":3,"file":"xmpp.min.js","sources":["../../../node_modules/rollup-plugin-node-polyfills/polyfills/events.js","../../events/lib/TimeoutError.js","../../events/lib/timeout.js","../../events/lib/delay.js","../../events/lib/onoff.js","../../events/lib/promise.js","../../events/lib/Deferred.js","../../events/lib/procedure.js","../../events/lib/listeners.js","../../jid/lib/escaping.js","../../jid/lib/JID.js","../../jid/lib/parse.js","../../jid/index.js","../../../node_modules/ltx/lib/escape.js","../../../node_modules/ltx/lib/Element.js","../../../node_modules/ltx/lib/createElement.js","../../../node_modules/ltx/lib/parsers/ltx.js","../../xml/lib/XMLError.js","../../xml/lib/Parser.js","../../xml/index.js","../../error/index.js","../../connection/lib/StreamError.js","../../connection/lib/util.js","../../connection/index.js","../../client-core/lib/Client.js","../lib/createOnAuthenticate.js","../../reconnect/index.js","../../websocket/lib/Socket.js","../../websocket/lib/Connection.js","../../websocket/lib/FramedParser.js","../../websocket/index.js","../../../node_modules/koa-compose/index.js","../../middleware/lib/Context.js","../../middleware/lib/IncomingContext.js","../../middleware/lib/OutgoingContext.js","../../middleware/index.js","../../middleware/lib/StanzaError.js","../../iq/caller.js","../../id/index.js","../../iq/callee.js","../../resolve/lib/alt-connections.js","../../resolve/lib/http.js","../../xml/lib/parse.js","../../resolve/index.js","../../resolve/resolve.js","../../base64/index.js","../../sasl/lib/SASLError.js","../../sasl/index.js","../../sasl2/index.js","../../resource-binding/index.js","../../time/index.js","../../stream-management/stream-feature.js","../../stream-management/index.js","../../stream-management/bind2.js","../../stream-management/sasl2.js","../../client-core/src/bind2/bind2.js","../../../node_modules/saslmechanisms/main.js","../../../node_modules/saslmechanisms/lib/factory.js","../../client-core/src/fast/fast.js","../../../node_modules/sasl-plain/main.js","../../../node_modules/sasl-plain/lib/mechanism.js","../../sasl-plain/index.js","../../../node_modules/sasl-anonymous/main.js","../../../node_modules/sasl-anonymous/lib/mechanism.js","../../sasl-anonymous/index.js","../../sasl-ht-sha-256-none/index.js","../index.js","../lib/getDomain.js","../../stream-features/index.js"],"sourcesContent":["'use strict';\n\nvar domain;\n\n// This constructor is used to store event handlers. Instantiating this is\n// faster than explicitly calling `Object.create(null)` to get a \"clean\" empty\n// object (tested with v8 v4.9).\nfunction EventHandlers() {}\nEventHandlers.prototype = Object.create(null);\n\nfunction EventEmitter() {\n  EventEmitter.init.call(this);\n}\nexport default EventEmitter;\nexport {EventEmitter};\n\n// nodejs oddity\n// require('events') === require('events').EventEmitter\nEventEmitter.EventEmitter = EventEmitter\n\nEventEmitter.usingDomains = false;\n\nEventEmitter.prototype.domain = undefined;\nEventEmitter.prototype._events = undefined;\nEventEmitter.prototype._maxListeners = undefined;\n\n// By default EventEmitters will print a warning if more than 10 listeners are\n// added to it. This is a useful default which helps finding memory leaks.\nEventEmitter.defaultMaxListeners = 10;\n\nEventEmitter.init = function() {\n  this.domain = null;\n  if (EventEmitter.usingDomains) {\n    // if there is an active domain, then attach to it.\n    if (domain.active && !(this instanceof domain.Domain)) {\n      this.domain = domain.active;\n    }\n  }\n\n  if (!this._events || this._events === Object.getPrototypeOf(this)._events) {\n    this._events = new EventHandlers();\n    this._eventsCount = 0;\n  }\n\n  this._maxListeners = this._maxListeners || undefined;\n};\n\n// Obviously not all Emitters should be limited to 10. This function allows\n// that to be increased. Set to zero for unlimited.\nEventEmitter.prototype.setMaxListeners = function setMaxListeners(n) {\n  if (typeof n !== 'number' || n < 0 || isNaN(n))\n    throw new TypeError('\"n\" argument must be a positive number');\n  this._maxListeners = n;\n  return this;\n};\n\nfunction $getMaxListeners(that) {\n  if (that._maxListeners === undefined)\n    return EventEmitter.defaultMaxListeners;\n  return that._maxListeners;\n}\n\nEventEmitter.prototype.getMaxListeners = function getMaxListeners() {\n  return $getMaxListeners(this);\n};\n\n// These standalone emit* functions are used to optimize calling of event\n// handlers for fast cases because emit() itself often has a variable number of\n// arguments and can be deoptimized because of that. These functions always have\n// the same number of arguments and thus do not get deoptimized, so the code\n// inside them can execute faster.\nfunction emitNone(handler, isFn, self) {\n  if (isFn)\n    handler.call(self);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self);\n  }\n}\nfunction emitOne(handler, isFn, self, arg1) {\n  if (isFn)\n    handler.call(self, arg1);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1);\n  }\n}\nfunction emitTwo(handler, isFn, self, arg1, arg2) {\n  if (isFn)\n    handler.call(self, arg1, arg2);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2);\n  }\n}\nfunction emitThree(handler, isFn, self, arg1, arg2, arg3) {\n  if (isFn)\n    handler.call(self, arg1, arg2, arg3);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].call(self, arg1, arg2, arg3);\n  }\n}\n\nfunction emitMany(handler, isFn, self, args) {\n  if (isFn)\n    handler.apply(self, args);\n  else {\n    var len = handler.length;\n    var listeners = arrayClone(handler, len);\n    for (var i = 0; i < len; ++i)\n      listeners[i].apply(self, args);\n  }\n}\n\nEventEmitter.prototype.emit = function emit(type) {\n  var er, handler, len, args, i, events, domain;\n  var needDomainExit = false;\n  var doError = (type === 'error');\n\n  events = this._events;\n  if (events)\n    doError = (doError && events.error == null);\n  else if (!doError)\n    return false;\n\n  domain = this.domain;\n\n  // If there is no 'error' event listener then throw.\n  if (doError) {\n    er = arguments[1];\n    if (domain) {\n      if (!er)\n        er = new Error('Uncaught, unspecified \"error\" event');\n      er.domainEmitter = this;\n      er.domain = domain;\n      er.domainThrown = false;\n      domain.emit('error', er);\n    } else if (er instanceof Error) {\n      throw er; // Unhandled 'error' event\n    } else {\n      // At least give some kind of context to the user\n      var err = new Error('Uncaught, unspecified \"error\" event. (' + er + ')');\n      err.context = er;\n      throw err;\n    }\n    return false;\n  }\n\n  handler = events[type];\n\n  if (!handler)\n    return false;\n\n  var isFn = typeof handler === 'function';\n  len = arguments.length;\n  switch (len) {\n    // fast cases\n    case 1:\n      emitNone(handler, isFn, this);\n      break;\n    case 2:\n      emitOne(handler, isFn, this, arguments[1]);\n      break;\n    case 3:\n      emitTwo(handler, isFn, this, arguments[1], arguments[2]);\n      break;\n    case 4:\n      emitThree(handler, isFn, this, arguments[1], arguments[2], arguments[3]);\n      break;\n    // slower\n    default:\n      args = new Array(len - 1);\n      for (i = 1; i < len; i++)\n        args[i - 1] = arguments[i];\n      emitMany(handler, isFn, this, args);\n  }\n\n  if (needDomainExit)\n    domain.exit();\n\n  return true;\n};\n\nfunction _addListener(target, type, listener, prepend) {\n  var m;\n  var events;\n  var existing;\n\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n\n  events = target._events;\n  if (!events) {\n    events = target._events = new EventHandlers();\n    target._eventsCount = 0;\n  } else {\n    // To avoid recursion in the case that type === \"newListener\"! Before\n    // adding it to the listeners, first emit \"newListener\".\n    if (events.newListener) {\n      target.emit('newListener', type,\n                  listener.listener ? listener.listener : listener);\n\n      // Re-assign `events` because a newListener handler could have caused the\n      // this._events to be assigned to a new object\n      events = target._events;\n    }\n    existing = events[type];\n  }\n\n  if (!existing) {\n    // Optimize the case of one listener. Don't need the extra array object.\n    existing = events[type] = listener;\n    ++target._eventsCount;\n  } else {\n    if (typeof existing === 'function') {\n      // Adding the second element, need to change to array.\n      existing = events[type] = prepend ? [listener, existing] :\n                                          [existing, listener];\n    } else {\n      // If we've already got an array, just append.\n      if (prepend) {\n        existing.unshift(listener);\n      } else {\n        existing.push(listener);\n      }\n    }\n\n    // Check for listener leak\n    if (!existing.warned) {\n      m = $getMaxListeners(target);\n      if (m && m > 0 && existing.length > m) {\n        existing.warned = true;\n        var w = new Error('Possible EventEmitter memory leak detected. ' +\n                            existing.length + ' ' + type + ' listeners added. ' +\n                            'Use emitter.setMaxListeners() to increase limit');\n        w.name = 'MaxListenersExceededWarning';\n        w.emitter = target;\n        w.type = type;\n        w.count = existing.length;\n        emitWarning(w);\n      }\n    }\n  }\n\n  return target;\n}\nfunction emitWarning(e) {\n  typeof console.warn === 'function' ? console.warn(e) : console.log(e);\n}\nEventEmitter.prototype.addListener = function addListener(type, listener) {\n  return _addListener(this, type, listener, false);\n};\n\nEventEmitter.prototype.on = EventEmitter.prototype.addListener;\n\nEventEmitter.prototype.prependListener =\n    function prependListener(type, listener) {\n      return _addListener(this, type, listener, true);\n    };\n\nfunction _onceWrap(target, type, listener) {\n  var fired = false;\n  function g() {\n    target.removeListener(type, g);\n    if (!fired) {\n      fired = true;\n      listener.apply(target, arguments);\n    }\n  }\n  g.listener = listener;\n  return g;\n}\n\nEventEmitter.prototype.once = function once(type, listener) {\n  if (typeof listener !== 'function')\n    throw new TypeError('\"listener\" argument must be a function');\n  this.on(type, _onceWrap(this, type, listener));\n  return this;\n};\n\nEventEmitter.prototype.prependOnceListener =\n    function prependOnceListener(type, listener) {\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n      this.prependListener(type, _onceWrap(this, type, listener));\n      return this;\n    };\n\n// emits a 'removeListener' event iff the listener was removed\nEventEmitter.prototype.removeListener =\n    function removeListener(type, listener) {\n      var list, events, position, i, originalListener;\n\n      if (typeof listener !== 'function')\n        throw new TypeError('\"listener\" argument must be a function');\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      list = events[type];\n      if (!list)\n        return this;\n\n      if (list === listener || (list.listener && list.listener === listener)) {\n        if (--this._eventsCount === 0)\n          this._events = new EventHandlers();\n        else {\n          delete events[type];\n          if (events.removeListener)\n            this.emit('removeListener', type, list.listener || listener);\n        }\n      } else if (typeof list !== 'function') {\n        position = -1;\n\n        for (i = list.length; i-- > 0;) {\n          if (list[i] === listener ||\n              (list[i].listener && list[i].listener === listener)) {\n            originalListener = list[i].listener;\n            position = i;\n            break;\n          }\n        }\n\n        if (position < 0)\n          return this;\n\n        if (list.length === 1) {\n          list[0] = undefined;\n          if (--this._eventsCount === 0) {\n            this._events = new EventHandlers();\n            return this;\n          } else {\n            delete events[type];\n          }\n        } else {\n          spliceOne(list, position);\n        }\n\n        if (events.removeListener)\n          this.emit('removeListener', type, originalListener || listener);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.removeAllListeners =\n    function removeAllListeners(type) {\n      var listeners, events;\n\n      events = this._events;\n      if (!events)\n        return this;\n\n      // not listening for removeListener, no need to emit\n      if (!events.removeListener) {\n        if (arguments.length === 0) {\n          this._events = new EventHandlers();\n          this._eventsCount = 0;\n        } else if (events[type]) {\n          if (--this._eventsCount === 0)\n            this._events = new EventHandlers();\n          else\n            delete events[type];\n        }\n        return this;\n      }\n\n      // emit removeListener for all listeners on all events\n      if (arguments.length === 0) {\n        var keys = Object.keys(events);\n        for (var i = 0, key; i < keys.length; ++i) {\n          key = keys[i];\n          if (key === 'removeListener') continue;\n          this.removeAllListeners(key);\n        }\n        this.removeAllListeners('removeListener');\n        this._events = new EventHandlers();\n        this._eventsCount = 0;\n        return this;\n      }\n\n      listeners = events[type];\n\n      if (typeof listeners === 'function') {\n        this.removeListener(type, listeners);\n      } else if (listeners) {\n        // LIFO order\n        do {\n          this.removeListener(type, listeners[listeners.length - 1]);\n        } while (listeners[0]);\n      }\n\n      return this;\n    };\n\nEventEmitter.prototype.listeners = function listeners(type) {\n  var evlistener;\n  var ret;\n  var events = this._events;\n\n  if (!events)\n    ret = [];\n  else {\n    evlistener = events[type];\n    if (!evlistener)\n      ret = [];\n    else if (typeof evlistener === 'function')\n      ret = [evlistener.listener || evlistener];\n    else\n      ret = unwrapListeners(evlistener);\n  }\n\n  return ret;\n};\n\nEventEmitter.listenerCount = function(emitter, type) {\n  if (typeof emitter.listenerCount === 'function') {\n    return emitter.listenerCount(type);\n  } else {\n    return listenerCount.call(emitter, type);\n  }\n};\n\nEventEmitter.prototype.listenerCount = listenerCount;\nfunction listenerCount(type) {\n  var events = this._events;\n\n  if (events) {\n    var evlistener = events[type];\n\n    if (typeof evlistener === 'function') {\n      return 1;\n    } else if (evlistener) {\n      return evlistener.length;\n    }\n  }\n\n  return 0;\n}\n\nEventEmitter.prototype.eventNames = function eventNames() {\n  return this._eventsCount > 0 ? Reflect.ownKeys(this._events) : [];\n};\n\n// About 1.5x faster than the two-arg version of Array#splice().\nfunction spliceOne(list, index) {\n  for (var i = index, k = i + 1, n = list.length; k < n; i += 1, k += 1)\n    list[i] = list[k];\n  list.pop();\n}\n\nfunction arrayClone(arr, i) {\n  var copy = new Array(i);\n  while (i--)\n    copy[i] = arr[i];\n  return copy;\n}\n\nfunction unwrapListeners(arr) {\n  var ret = new Array(arr.length);\n  for (var i = 0; i < ret.length; ++i) {\n    ret[i] = arr[i].listener || arr[i];\n  }\n  return ret;\n}\n","export default class TimeoutError extends Error {\n  constructor(message) {\n    super(message);\n    this.name = \"TimeoutError\";\n    // Error.captureStackTrace?.(this, this.constructor);\n  }\n}\n","import TimeoutError from \"./TimeoutError.js\";\nimport delay from \"./delay.js\";\n\nexport default function timeout(promise, ms) {\n  const promiseDelay = delay(ms);\n\n  function cancelDelay() {\n    clearTimeout(promiseDelay.timeout);\n  }\n\n  const error = new TimeoutError();\n  return Promise.race([\n    promise.finally(cancelDelay),\n    promiseDelay.then(() => {\n      throw error;\n    }),\n  ]);\n}\n","export default function delay(ms) {\n  let timeout;\n  const promise = new Promise((resolve) => {\n    timeout = setTimeout(resolve, ms);\n  });\n  promise.timeout = timeout;\n  return promise;\n}\n","const map = new WeakMap();\n\nexport default function onoff(target) {\n  let m = map.get(target);\n\n  if (!m) {\n    const on = (target.addEventListener ?? target.addListener).bind(target);\n    const off = (target.removeEventListener ?? target.removeListener).bind(\n      target,\n    );\n    const once = (\n      target.once ??\n      ((event, handler) =>\n        target.addEventListener(event, handler, { once: true }))\n    ).bind(target);\n    m = { on, off, once };\n    map.set(target, m);\n  }\n\n  return m;\n}\n","import onoff from \"./onoff.js\";\n\nimport TimeoutError from \"./TimeoutError.js\";\n\nexport default function promise(target, event, rejectEvent = \"error\", timeout) {\n  return new Promise((resolve, reject) => {\n    let timeoutId;\n\n    const { off, once } = onoff(target);\n\n    const cleanup = () => {\n      clearTimeout(timeoutId);\n      off(event, onEvent);\n      off(rejectEvent, onError);\n    };\n\n    function onError(reason) {\n      reject(reason);\n      cleanup();\n    }\n\n    function onEvent(value) {\n      resolve(value);\n      cleanup();\n    }\n\n    once(event, onEvent);\n    if (rejectEvent) {\n      once(rejectEvent, onError);\n    }\n\n    if (timeout) {\n      const error = new TimeoutError();\n      timeoutId = setTimeout(() => {\n        cleanup();\n        reject(error);\n      }, timeout);\n    }\n  });\n}\n","export default function Deferred() {\n  this.promise = new Promise((resolve, reject) => {\n    this.resolve = resolve;\n    this.reject = reject;\n  });\n}\n","export default function procedure(entity, stanza = null, handler) {\n  return new Promise((resolve, reject) => {\n    function onError(err) {\n      entity.removeListener(\"nonza\", listener);\n      reject(err);\n    }\n\n    function done(...args) {\n      entity.removeListener(\"nonza\", listener);\n      resolve(...args);\n    }\n\n    async function listener(element) {\n      try {\n        await handler(element, done);\n      } catch (err) {\n        onError(err);\n      }\n    }\n\n    stanza && entity.send(stanza).catch(onError);\n    entity.on(\"nonza\", listener);\n  });\n}\n","import onoff from \"./onoff.js\";\n\nexport default function listeners(events) {\n  return {\n    subscribe(target) {\n      const { on } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        on(event, handler);\n      }\n    },\n    unsubscribe(target) {\n      const { off } = onoff(target);\n      for (const [event, handler] of Object.entries(events)) {\n        off(event, handler);\n      }\n    },\n  };\n}\n","export function detect(local) {\n  if (!local) {\n    return false;\n  }\n\n  // Remove all escaped sequences\n  const tmp = local\n    .replaceAll(String.raw`\\20`, \"\")\n    .replaceAll(String.raw`\\22`, \"\")\n    .replaceAll(String.raw`\\26`, \"\")\n    .replaceAll(String.raw`\\27`, \"\")\n    .replaceAll(String.raw`\\2f`, \"\")\n    .replaceAll(String.raw`\\3a`, \"\")\n    .replaceAll(String.raw`\\3c`, \"\")\n    .replaceAll(String.raw`\\3e`, \"\")\n    .replaceAll(String.raw`\\40`, \"\")\n    .replaceAll(String.raw`\\5c`, \"\");\n\n  // Detect if we have unescaped sequences\n  const search = tmp.search(/[ \"&'/:<>@\\\\]/g);\n  if (search === -1) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Escape the local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return An escaped local part\n */\nexport function escape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(/^\\s+|\\s+$/g, \"\")\n    .replaceAll(\"\\\\\", String.raw`\\5c`)\n    .replaceAll(\" \", String.raw`\\20`)\n    .replaceAll('\"', String.raw`\\22`)\n    .replaceAll(\"&\", String.raw`\\26`)\n    .replaceAll(\"'\", String.raw`\\27`)\n    .replaceAll(\"/\", String.raw`\\2f`)\n    .replaceAll(\":\", String.raw`\\3a`)\n    .replaceAll(\"<\", String.raw`\\3c`)\n    .replaceAll(\">\", String.raw`\\3e`)\n    .replaceAll(\"@\", String.raw`\\40`);\n}\n\n/**\n * Unescape a local part of a JID.\n *\n * @see http://xmpp.org/extensions/xep-0106.html\n * @param String local local part of a jid\n * @return unescaped local part\n */\nexport function unescape(local) {\n  if (local === null) {\n    return null;\n  }\n\n  return local\n    .replaceAll(String.raw`\\20`, \" \")\n    .replaceAll(String.raw`\\22`, '\"')\n    .replaceAll(String.raw`\\26`, \"&\")\n    .replaceAll(String.raw`\\27`, \"'\")\n    .replaceAll(String.raw`\\2f`, \"/\")\n    .replaceAll(String.raw`\\3a`, \":\")\n    .replaceAll(String.raw`\\3c`, \"<\")\n    .replaceAll(String.raw`\\3e`, \">\")\n    .replaceAll(String.raw`\\40`, \"@\")\n    .replaceAll(String.raw`\\5c`, \"\\\\\");\n}\n","import * as escaping from \"./escaping.js\";\n\n/**\n * JID implements\n * - XMPP addresses according to RFC6122\n * - XEP-0106: JID Escaping\n *\n * @see http://tools.ietf.org/html/rfc6122#section-2\n * @see http://xmpp.org/extensions/xep-0106.html\n */\nclass JID {\n  constructor(local, domain, resource) {\n    if (typeof domain !== \"string\" || !domain) {\n      throw new TypeError(`Invalid domain.`);\n    }\n\n    this.setDomain(domain);\n    this.setLocal(typeof local === \"string\" ? local : \"\");\n    this.setResource(typeof resource === \"string\" ? resource : \"\");\n  }\n\n  [Symbol.toPrimitive](hint) {\n    if (hint === \"number\") {\n      return Number.NaN;\n    }\n\n    return this.toString();\n  }\n\n  toString(unescape) {\n    let s = this._domain;\n    if (this._local) {\n      s = this.getLocal(unescape) + \"@\" + s;\n    }\n\n    if (this._resource) {\n      s = s + \"/\" + this._resource;\n    }\n\n    return s;\n  }\n\n  /**\n   * Convenience method to distinguish users\n   * */\n  bare() {\n    if (this._resource) {\n      return new JID(this._local, this._domain, null);\n    }\n\n    return this;\n  }\n\n  /**\n   * Comparison function\n   * */\n  equals(other) {\n    return (\n      this._local === other._local &&\n      this._domain === other._domain &&\n      this._resource === other._resource\n    );\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-localpart\n   * */\n  setLocal(local, escape) {\n    escape = escape || escaping.detect(local);\n\n    if (escape) {\n      local = escaping.escape(local);\n    }\n\n    this._local = local && local.toLowerCase();\n    return this;\n  }\n\n  getLocal(unescape = false) {\n    let local = null;\n\n    local = unescape ? escaping.unescape(this._local) : this._local;\n\n    return local;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-domain\n   */\n  setDomain(domain) {\n    this._domain = domain.toLowerCase();\n    return this;\n  }\n\n  getDomain() {\n    return this._domain;\n  }\n\n  /**\n   * http://xmpp.org/rfcs/rfc6122.html#addressing-resourcepart\n   */\n  setResource(resource) {\n    this._resource = resource;\n    return this;\n  }\n\n  getResource() {\n    return this._resource;\n  }\n}\n\nObject.defineProperty(JID.prototype, \"local\", {\n  get: JID.prototype.getLocal,\n  set: JID.prototype.setLocal,\n});\n\nObject.defineProperty(JID.prototype, \"domain\", {\n  get: JID.prototype.getDomain,\n  set: JID.prototype.setDomain,\n});\n\nObject.defineProperty(JID.prototype, \"resource\", {\n  get: JID.prototype.getResource,\n  set: JID.prototype.setResource,\n});\n\nexport default JID;\n","import JID from \"./JID.js\";\n\nexport default function parse(s) {\n  let local;\n  let resource;\n\n  const resourceStart = s.indexOf(\"/\");\n  if (resourceStart !== -1) {\n    resource = s.slice(resourceStart + 1);\n    s = s.slice(0, resourceStart);\n  }\n\n  const atStart = s.indexOf(\"@\");\n  if (atStart !== -1) {\n    local = s.slice(0, atStart);\n    s = s.slice(atStart + 1);\n  }\n\n  return new JID(local, s, resource);\n}\n","import JID from \"./lib/JID.js\";\nimport { detect, escape, unescape } from \"./lib/escaping.js\";\nimport parse from \"./lib/parse.js\";\n\nexport function equal(a, b) {\n  return a.equals(b);\n}\n\nfunction jid(...args) {\n  if (!args[1] && !args[2]) {\n    return parse(...args);\n  }\n\n  return new JID(...args);\n}\n\nconst j = jid.bind();\nj.jid = jid;\nj.JID = JID;\nj.parse = parse;\nj.equal = equal;\nj.detectEscape = detect;\nj.escapeLocal = escape;\nj.unescapeLocal = unescape;\n\nexport default j;\n\nexport { jid, JID, parse };\n\nexport {\n  detect as detectEscape,\n  escape as escapeLocal,\n  unescape as unescapeLocal,\n};\n","'use strict';\n\nconst escapeXMLTable = {\n  \"&\": \"&amp;\",\n  \"<\": \"&lt;\",\n  \">\": \"&gt;\",\n  '\"': \"&quot;\",\n  \"'\": \"&apos;\",\n};\n\nfunction escapeXMLReplace(match) {\n  return escapeXMLTable[match];\n}\n\nconst unescapeXMLTable = {\n  \"&amp;\": \"&\",\n  \"&lt;\": \"<\",\n  \"&gt;\": \">\",\n  \"&quot;\": '\"',\n  \"&apos;\": \"'\",\n};\n\nfunction unescapeXMLReplace(match) {\n  if (match[1] === \"#\") {\n    const num =\n      match[2] === \"x\"\n        ? parseInt(match.slice(3), 16)\n        : parseInt(match.slice(2), 10);\n    // https://www.w3.org/TR/xml/#NT-Char defines legal XML characters:\n    // #x9 | #xA | #xD | [#x20-#xD7FF] | [#xE000-#xFFFD] | [#x10000-#x10FFFF]\n    if (\n      num === 0x9 ||\n      num === 0xa ||\n      num === 0xd ||\n      (num >= 0x20 && num <= 0xd7ff) ||\n      (num >= 0xe000 && num <= 0xfffd) ||\n      (num >= 0x10000 && num <= 0x10ffff)\n    ) {\n      return String.fromCodePoint(num);\n    }\n    throw new Error(\"Illegal XML character 0x\" + num.toString(16));\n  }\n  if (unescapeXMLTable[match]) {\n    return unescapeXMLTable[match] || match;\n  }\n  throw new Error(\"Illegal XML entity \" + match);\n}\n\nfunction escapeXML(s) {\n  return s.replace(/[\"&'<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXML(s) {\n  let result = \"\";\n  let start = -1;\n  let end = -1;\n  let previous = 0;\n  while (\n    (start = s.indexOf(\"&\", previous)) !== -1 &&\n    (end = s.indexOf(\";\", start + 1)) !== -1\n  ) {\n    result =\n      result +\n      s.slice(previous, start) +\n      unescapeXMLReplace(s.slice(start, end + 1));\n    previous = end + 1;\n  }\n\n  // shortcut if loop never entered:\n  // return the original string without creating new objects\n  if (previous === 0) return s;\n\n  // push the remaining characters\n  result = result + s.substring(previous);\n\n  return result;\n}\n\nfunction escapeXMLText(s) {\n  return s.replace(/[&<>]/g, escapeXMLReplace);\n}\n\nfunction unescapeXMLText(s) {\n  return s.replace(/&(amp|#38|lt|#60|gt|#62);/g, unescapeXMLReplace);\n}\n\nexports.escapeXML = escapeXML;\nexports.escapeXMLText = escapeXMLText;\nexports.unescapeXML = unescapeXML;\nexports.unescapeXMLText = unescapeXMLText;\n","'use strict';\n\nvar escape = require('./escape.js');\n\n/**\n * Element\n *\n * Attributes are in the element.attrs object. Children is a list of\n * either other Elements or Strings for text content.\n **/\nclass Element {\n  constructor(name, attrs) {\n    this.name = name;\n    this.parent = null;\n    this.children = [];\n    this.attrs = {};\n    this.setAttrs(attrs);\n  }\n\n  /* Accessors */\n\n  /**\n   * if (element.is('message', 'jabber:client')) ...\n   **/\n  is(name, xmlns) {\n    return this.getName() === name && (!xmlns || this.getNS() === xmlns);\n  }\n\n  /* without prefix */\n  getName() {\n    const idx = this.name.indexOf(\":\");\n    return idx >= 0 ? this.name.slice(idx + 1) : this.name;\n  }\n\n  /**\n   * retrieves the namespace of the current element, upwards recursively\n   **/\n  getNS() {\n    const idx = this.name.indexOf(\":\");\n    if (idx >= 0) {\n      const prefix = this.name.slice(0, idx);\n      return this.findNS(prefix);\n    }\n    return this.findNS();\n  }\n\n  /**\n   * find the namespace to the given prefix, upwards recursively\n   **/\n  findNS(prefix) {\n    if (!prefix) {\n      /* default namespace */\n      if (this.attrs.xmlns) {\n        return this.attrs.xmlns;\n      } else if (this.parent) {\n        return this.parent.findNS();\n      }\n    } else {\n      /* prefixed namespace */\n      const attr = \"xmlns:\" + prefix;\n      if (this.attrs[attr]) {\n        return this.attrs[attr];\n      } else if (this.parent) {\n        return this.parent.findNS(prefix);\n      }\n    }\n  }\n\n  /**\n   * Recursiverly gets all xmlns defined, in the form of {url:prefix}\n   **/\n  getXmlns() {\n    let namespaces = {};\n\n    if (this.parent) {\n      namespaces = this.parent.getXmlns();\n    }\n\n    for (const attr in this.attrs) {\n      const m = attr.match(\"xmlns:?(.*)\");\n      // eslint-disable-next-line  no-prototype-builtins\n      if (this.attrs.hasOwnProperty(attr) && m) {\n        namespaces[this.attrs[attr]] = m[1];\n      }\n    }\n    return namespaces;\n  }\n\n  setAttrs(attrs) {\n    if (typeof attrs === \"string\") {\n      this.attrs.xmlns = attrs;\n    } else if (attrs) {\n      Object.assign(this.attrs, attrs);\n    }\n  }\n\n  /**\n   * xmlns can be null, returns the matching attribute.\n   **/\n  getAttr(name, xmlns) {\n    if (!xmlns) {\n      return this.attrs[name];\n    }\n\n    const namespaces = this.getXmlns();\n\n    if (!namespaces[xmlns]) {\n      return null;\n    }\n\n    return this.attrs[[namespaces[xmlns], name].join(\":\")];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChild(name, xmlns) {\n    return this.getChildren(name, xmlns)[0];\n  }\n\n  /**\n   * xmlns can be null\n   **/\n  getChildren(name, xmlns) {\n    const result = [];\n    for (const child of this.children) {\n      if (\n        child.getName &&\n        child.getName() === name &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n    }\n    return result;\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildByAttr(attr, val, xmlns, recursive) {\n    return this.getChildrenByAttr(attr, val, xmlns, recursive)[0];\n  }\n\n  /**\n   * xmlns and recursive can be null\n   **/\n  getChildrenByAttr(attr, val, xmlns, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (\n        child.attrs &&\n        child.attrs[attr] === val &&\n        (!xmlns || child.getNS() === xmlns)\n      ) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByAttr) {\n        result.push(child.getChildrenByAttr(attr, val, xmlns, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getChildrenByFilter(filter, recursive) {\n    let result = [];\n    for (const child of this.children) {\n      if (filter(child)) {\n        result.push(child);\n      }\n      if (recursive && child.getChildrenByFilter) {\n        result.push(child.getChildrenByFilter(filter, true));\n      }\n    }\n    if (recursive) {\n      result = result.flat();\n    }\n    return result;\n  }\n\n  getText() {\n    let text = \"\";\n    for (const child of this.children) {\n      if (typeof child === \"string\" || typeof child === \"number\") {\n        text += child;\n      }\n    }\n    return text;\n  }\n\n  getChildText(name, xmlns) {\n    const child = this.getChild(name, xmlns);\n    return child ? child.getText() : null;\n  }\n\n  /**\n   * Return all direct descendents that are Elements.\n   * This differs from `getChildren` in that it will exclude text nodes,\n   * processing instructions, etc.\n   */\n  getChildElements() {\n    return this.getChildrenByFilter((child) => {\n      return child instanceof Element;\n    });\n  }\n\n  /* Builder */\n\n  /** returns uppermost parent */\n  root() {\n    if (this.parent) {\n      return this.parent.root();\n    }\n    return this;\n  }\n\n  /** just parent or itself */\n  up() {\n    if (this.parent) {\n      return this.parent;\n    }\n    return this;\n  }\n\n  /** create child node and return it */\n  c(name, attrs) {\n    return this.cnode(new Element(name, attrs));\n  }\n\n  cnode(child) {\n    this.children.push(child);\n    if (typeof child === \"object\") {\n      child.parent = this;\n    }\n    return child;\n  }\n\n  append(...nodes) {\n    for (const node of nodes) {\n      this.children.push(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  prepend(...nodes) {\n    for (const node of nodes) {\n      this.children.unshift(node);\n      if (typeof node === \"object\") {\n        node.parent = this;\n      }\n    }\n  }\n\n  /** add text node and return element */\n  t(text) {\n    this.children.push(text);\n    return this;\n  }\n\n  /* Manipulation */\n\n  /**\n   * Either:\n   *   el.remove(childEl)\n   *   el.remove('author', 'urn:...')\n   */\n  remove(el, xmlns) {\n    const filter =\n      typeof el === \"string\"\n        ? (child) => {\n            /* 1st parameter is tag name */\n            return !(child.is && child.is(el, xmlns));\n          }\n        : (child) => {\n            /* 1st parameter is element */\n            return child !== el;\n          };\n\n    this.children = this.children.filter(filter);\n\n    return this;\n  }\n\n  text(val) {\n    if (val && this.children.length === 1) {\n      this.children[0] = val;\n      return this;\n    }\n    return this.getText();\n  }\n\n  attr(attr, val) {\n    if (typeof val !== \"undefined\" || val === null) {\n      if (!this.attrs) {\n        this.attrs = {};\n      }\n      this.attrs[attr] = val;\n      return this;\n    }\n    return this.attrs[attr];\n  }\n\n  /* Serialization */\n\n  toString() {\n    let s = \"\";\n    this.write((c) => {\n      s += c;\n    });\n    return s;\n  }\n\n  _addChildren(writer) {\n    writer(\">\");\n    for (const child of this.children) {\n      /* Skip null/undefined */\n      if (child != null) {\n        if (child.write) {\n          child.write(writer);\n        } else if (typeof child === \"string\") {\n          writer(escape.escapeXMLText(child));\n        } else if (child.toString) {\n          writer(escape.escapeXMLText(child.toString(10)));\n        }\n      }\n    }\n    writer(\"</\");\n    writer(this.name);\n    writer(\">\");\n  }\n\n  write(writer) {\n    writer(\"<\");\n    writer(this.name);\n    for (const k in this.attrs) {\n      const v = this.attrs[k];\n      // === null || undefined\n      if (v != null) {\n        writer(\" \");\n        writer(k);\n        writer('=\"');\n        writer(escape.escapeXML(typeof v === \"string\" ? v : v.toString(10)));\n        writer('\"');\n      }\n    }\n    if (this.children.length === 0) {\n      writer(\"/>\");\n    } else {\n      this._addChildren(writer);\n    }\n  }\n}\n\nElement.prototype.tree = Element.prototype.root;\n\nmodule.exports = Element;\n","'use strict';\n\nvar Element = require('./Element.js');\n\nfunction append(el, child) {\n  if (Array.isArray(child)) {\n    for (const c of child) append(el, c);\n    return;\n  }\n\n  if (child === \"\" || child == null || child === true || child === false) {\n    return;\n  }\n\n  el.cnode(child);\n}\n\n/**\n * JSX compatible API, use this function as pragma\n * https://facebook.github.io/jsx/\n *\n * @param  {string} name  name of the element\n * @param  {object} attrs object of attribute key/value pairs\n * @return {Element}      Element\n */\nfunction createElement(name, attrs, ...children) {\n  if (typeof attrs === \"object\" && attrs !== null) {\n    // __self and __source are added by babel in development\n    // https://github.com/facebook/react/pull/4596\n    // https://babeljs.io/docs/en/babel-preset-react#development\n    // https://babeljs.io/docs/en/babel-plugin-transform-react-jsx-source\n    delete attrs.__source;\n    delete attrs.__self;\n\n    for (const [key, value] of Object.entries(attrs)) {\n      if (value == null) delete attrs[key];\n      else attrs[key] = value.toString(10);\n    }\n  }\n\n  const el = new Element(name, attrs);\n\n  for (const child of children) {\n    append(el, child);\n  }\n\n  return el;\n}\n\nmodule.exports = createElement;\n","'use strict';\n\nvar events = require('events');\nvar escape = require('../escape.js');\n\nconst STATE_TEXT = 0;\nconst STATE_IGNORE_COMMENT = 1;\nconst STATE_IGNORE_INSTRUCTION = 2;\nconst STATE_TAG_NAME = 3;\nconst STATE_TAG = 4;\nconst STATE_ATTR_NAME = 5;\nconst STATE_ATTR_EQ = 6;\nconst STATE_ATTR_QUOT = 7;\nconst STATE_ATTR_VALUE = 8;\nconst STATE_CDATA = 9;\nconst STATE_IGNORE_CDATA = 10;\n\nclass SaxLtx extends events.EventEmitter {\n  constructor() {\n    super();\n    let state = STATE_TEXT;\n    let remainder;\n    let parseRemainder;\n    let tagName;\n    let attrs;\n    let endTag;\n    let selfClosing;\n    let attrQuote;\n    let attrQuoteChar;\n    let recordStart = 0;\n    let attrName;\n\n    this._handleTagOpening = function _handleTagOpening(\n      endTag,\n      tagName,\n      attrs\n    ) {\n      if (!endTag) {\n        this.emit(\"startElement\", tagName, attrs);\n        if (selfClosing) {\n          this.emit(\"endElement\", tagName, true);\n        }\n      } else {\n        this.emit(\"endElement\", tagName, false);\n      }\n    };\n\n    this.write = function write(data) {\n      if (typeof data !== \"string\") {\n        data = data.toString();\n      }\n      let pos = 0;\n\n      /* Anything from previous write()? */\n      if (remainder) {\n        data = remainder + data;\n        pos += !parseRemainder ? remainder.length : 0;\n        parseRemainder = false;\n        remainder = null;\n      }\n\n      function endRecording() {\n        if (typeof recordStart === \"number\") {\n          const recorded = data.slice(recordStart, pos);\n          recordStart = undefined;\n          return recorded;\n        }\n      }\n\n      for (; pos < data.length; pos++) {\n        switch (state) {\n          case STATE_TEXT: {\n            // if we're looping through text, fast-forward using indexOf to\n            // the next '<' character\n            const lt = data.indexOf(\"<\", pos);\n            if (lt !== -1 && pos !== lt) {\n              pos = lt;\n            }\n\n            break;\n          }\n          case STATE_ATTR_VALUE: {\n            // if we're looping through an attribute, fast-forward using\n            // indexOf to the next end quote character\n            const quot = data.indexOf(attrQuoteChar, pos);\n            if (quot !== -1) {\n              pos = quot;\n            }\n\n            break;\n          }\n          case STATE_IGNORE_COMMENT: {\n            // if we're looping through a comment, fast-forward using\n            // indexOf to the first end-comment character\n            const endcomment = data.indexOf(\"-->\", pos);\n            if (endcomment !== -1) {\n              pos = endcomment + 2; // target the '>' character\n            }\n\n            break;\n          }\n          case STATE_IGNORE_CDATA: {\n            // if we're looping through a CDATA, fast-forward using\n            // indexOf to the first end-CDATA character ]]>\n            const endCDATA = data.indexOf(\"]]>\", pos);\n            if (endCDATA !== -1) {\n              pos = endCDATA + 2; // target the '>' character\n            }\n\n            break;\n          }\n          // No default\n        }\n\n        const c = data.charCodeAt(pos);\n        switch (state) {\n          case STATE_TEXT:\n            if (c === 60 /* < */) {\n              const text = endRecording();\n              if (text) {\n                this.emit(\"text\", escape.unescapeXML(text));\n              }\n              state = STATE_TAG_NAME;\n              recordStart = pos + 1;\n              attrs = {};\n            }\n            break;\n          case STATE_CDATA:\n            if (c === 93 /* ] */) {\n              if (data.substr(pos + 1, 2) === \"]>\") {\n                const cData = endRecording();\n                if (cData) {\n                  this.emit(\"text\", cData);\n                }\n                state = STATE_TEXT;\n              } else if (data.length < pos + 2) {\n                parseRemainder = true;\n                pos = data.length;\n              }\n            }\n            break;\n          case STATE_TAG_NAME:\n            if (c === 47 /* / */ && recordStart === pos) {\n              recordStart = pos + 1;\n              endTag = true;\n            } else if (c === 33 /* ! */) {\n              if (data.substr(pos + 1, 7) === \"[CDATA[\") {\n                recordStart = pos + 8;\n                state = STATE_CDATA;\n              } else if (\n                data.length < pos + 8 &&\n                \"[CDATA[\".startsWith(data.slice(pos + 1))\n              ) {\n                // We potentially have CDATA, but the chunk is ending; stop here and let the next write() decide\n                parseRemainder = true;\n                pos = data.length;\n              } else {\n                recordStart = undefined;\n                state = STATE_IGNORE_COMMENT;\n              }\n            } else if (c === 63 /* ? */) {\n              recordStart = undefined;\n              state = STATE_IGNORE_INSTRUCTION;\n            } else if (c <= 32 || c === 47 /* / */ || c === 62 /* > */) {\n              tagName = endRecording();\n              pos--;\n              state = STATE_TAG;\n            }\n            break;\n          case STATE_IGNORE_COMMENT:\n            if (c === 62 /* > */) {\n              const prevFirst = data.charCodeAt(pos - 1);\n              const prevSecond = data.charCodeAt(pos - 2);\n              if (\n                (prevFirst === 45 /* - */ && prevSecond === 45) /* - */ ||\n                (prevFirst === 93 /* ] */ && prevSecond === 93) /* ] */\n              ) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_IGNORE_INSTRUCTION:\n            if (c === 62 /* > */) {\n              const prev = data.charCodeAt(pos - 1);\n              if (prev === 63 /* ? */) {\n                state = STATE_TEXT;\n              }\n            }\n            break;\n          case STATE_TAG:\n            if (c === 62 /* > */) {\n              this._handleTagOpening(endTag, tagName, attrs);\n              tagName = undefined;\n              attrs = undefined;\n              endTag = undefined;\n              selfClosing = undefined;\n              state = STATE_TEXT;\n              recordStart = pos + 1;\n            } else if (c === 47 /* / */) {\n              selfClosing = true;\n            } else if (c > 32) {\n              recordStart = pos;\n              state = STATE_ATTR_NAME;\n            }\n            break;\n          case STATE_ATTR_NAME:\n            if (c <= 32 || c === 61 /* = */) {\n              attrName = endRecording();\n              pos--;\n              state = STATE_ATTR_EQ;\n            }\n            break;\n          case STATE_ATTR_EQ:\n            if (c === 61 /* = */) {\n              state = STATE_ATTR_QUOT;\n            }\n            break;\n          case STATE_ATTR_QUOT:\n            if (c === 34 /* \" */ || c === 39 /* ' */) {\n              attrQuote = c;\n              attrQuoteChar = c === 34 ? '\"' : \"'\";\n              state = STATE_ATTR_VALUE;\n              recordStart = pos + 1;\n            }\n            break;\n          case STATE_ATTR_VALUE:\n            if (c === attrQuote) {\n              const value = escape.unescapeXML(endRecording());\n              attrs[attrName] = value;\n              attrName = undefined;\n              state = STATE_TAG;\n            }\n            break;\n        }\n      }\n\n      if (typeof recordStart === \"number\" && recordStart <= data.length) {\n        remainder = data.slice(recordStart);\n        recordStart = 0;\n      }\n    };\n  }\n\n  end(data) {\n    if (data) {\n      this.write(data);\n    }\n\n    /* Uh, yeah */\n    this.write = function write() {};\n  }\n}\n\nmodule.exports = SaxLtx;\n","export default class XMLError extends Error {\n  constructor(...args) {\n    super(...args);\n    this.name = \"XMLError\";\n  }\n}\n","import LtxParser from \"ltx/lib/parsers/ltx.js\";\nimport Element from \"ltx/lib/Element.js\";\nimport { EventEmitter } from \"@xmpp/events\";\nimport XMLError from \"./XMLError.js\";\n\nclass Parser extends EventEmitter {\n  constructor() {\n    super();\n    const parser = new LtxParser();\n    this.root = null;\n    this.cursor = null;\n\n    parser.on(\"startElement\", this.onStartElement.bind(this));\n    parser.on(\"endElement\", this.onEndElement.bind(this));\n    parser.on(\"text\", this.onText.bind(this));\n\n    this.parser = parser;\n  }\n\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { root, cursor } = this;\n\n    if (!root) {\n      this.root = element;\n      this.emit(\"start\", element);\n    } else if (cursor !== root) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { root, cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor === root) {\n      this.emit(\"end\", root);\n      return;\n    }\n\n    if (!cursor.parent) {\n      cursor.parent = root;\n      this.emit(\"element\", cursor);\n      this.cursor = root;\n      return;\n    }\n\n    this.cursor = cursor.parent;\n  }\n\n  onText(str) {\n    const { cursor } = this;\n    if (!cursor) {\n      this.emit(\"error\", new XMLError(`${str} must be a child.`));\n      return;\n    }\n\n    cursor.t(str);\n  }\n\n  write(data) {\n    this.parser.write(data);\n  }\n\n  end(data) {\n    if (data) {\n      this.parser.write(data);\n    }\n  }\n}\n\nParser.XMLError = XMLError;\n\nexport default Parser;\n","import Element from \"ltx/lib/Element.js\";\nimport createElement from \"ltx/lib/createElement.js\";\nimport Parser from \"./lib/Parser.js\";\nimport {\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n} from \"ltx/lib/escape.js\";\nimport XMLError from \"./lib/XMLError.js\";\n\nexport default function xml(...args) {\n  return createElement(...args);\n}\n\nObject.assign(xml, {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n});\n\nexport {\n  Element,\n  createElement,\n  Parser,\n  escapeXML,\n  unescapeXML,\n  escapeXMLText,\n  unescapeXMLText,\n  XMLError,\n  xml,\n};\n","// https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.9.2\n\nclass XMPPError extends Error {\n  constructor(condition, text, application) {\n    super(condition + (text ? ` - ${text}` : \"\"));\n    this.name = \"XMPPError\";\n    this.condition = condition;\n    this.text = text;\n    this.application = application;\n  }\n\n  static fromElement(element) {\n    const [condition, second, third] = element.getChildElements();\n    let text;\n    let application;\n\n    if (second) {\n      if (second.is(\"text\")) {\n        text = second;\n      } else if (second) {\n        application = second;\n      }\n\n      if (third) application = third;\n    }\n\n    const error = new this(\n      condition.name,\n      text ? text.text() : \"\",\n      application,\n    );\n    error.element = element;\n    return error;\n  }\n}\n\nexport default XMPPError;\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#streams-error\n\nclass StreamError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"StreamError\";\n  }\n}\n\nexport default StreamError;\n","function parseURI(URI) {\n  let { port, hostname, protocol } = new URL(URI);\n  // https://github.com/nodejs/node/issues/12410#issuecomment-294138912\n  if (hostname === \"[::1]\") {\n    hostname = \"::1\";\n  }\n\n  return { port, hostname, protocol };\n}\n\nfunction parseHost(host) {\n  const { port, hostname } = parseURI(`http://${host}`);\n  return { port, hostname };\n}\n\nfunction parseService(service) {\n  return service.includes(\"://\") ? parseURI(service) : parseHost(service);\n}\n\nexport { parseURI, parseHost, parseService };\n","import { EventEmitter, promise, listeners } from \"@xmpp/events\";\nimport jid from \"@xmpp/jid\";\nimport xml from \"@xmpp/xml\";\nimport StreamError from \"./lib/StreamError.js\";\nimport { parseHost, parseService } from \"./lib/util.js\";\n\nconst NS_STREAM = \"urn:ietf:params:xml:ns:xmpp-streams\";\nconst NS_JABBER_STREAM = \"http://etherx.jabber.org/streams\";\n\nclass Connection extends EventEmitter {\n  #socketListeners = null;\n  #parserListeners = null;\n\n  constructor(options = {}) {\n    super();\n\n    if (typeof options === \"string\") {\n      options = { domain: options };\n    }\n\n    this.jid = null;\n    this.timeout = options.timeout || 2000;\n    this.options = options;\n    this.status = \"offline\";\n    this.socket = null;\n    this.parser = null;\n    this.root = null;\n  }\n\n  isSecure() {\n    return this.socket?.secure === true;\n  }\n\n  async _streamError(condition, children) {\n    try {\n      await this.send(\n        // prettier-ignore\n        xml('stream:error', {}, [\n          xml(condition, {xmlns: NS_STREAM}, children),\n        ]),\n      );\n    } catch {}\n\n    return this.disconnect();\n  }\n\n  _onData(data) {\n    const str = data.toString(\"utf8\");\n    this.parser.write(str);\n  }\n\n  #onParserError(error) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-bad-format\n    // \"This error can be used instead of the more specific XML-related errors,\n    // such as <bad-namespace-prefix/>, <invalid-xml/>, <not-well-formed/>, <restricted-xml/>,\n    // and <unsupported-encoding/>. However, the more specific errors are RECOMMENDED.\"\n    this._streamError(\"bad-format\");\n    this._detachParser();\n    this.emit(\"error\", error);\n  }\n\n  #onSocketClosed(dirty, reason) {\n    this._detachSocket();\n    this._status(\"disconnect\", { clean: !dirty, reason });\n  }\n\n  #onStreamClosed(dirty, reason) {\n    this._detachParser();\n    this._status(\"close\", { clean: !dirty, reason });\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#socketListeners ??= listeners({\n      data: this._onData.bind(this),\n      close: this.#onSocketClosed.bind(this),\n      connect: () => this._status(\"connect\"),\n      error: (error) => this.emit(\"error\", error),\n    });\n    this.#socketListeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.socket && this.#socketListeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  _onElement(element) {\n    const isStreamError = element.is(\"error\", NS_JABBER_STREAM);\n\n    if (isStreamError) {\n      this._onStreamError(element);\n    }\n\n    this.emit(\"element\", element);\n    this.emit(this.isStanza(element) ? \"stanza\" : \"nonza\", element);\n\n    if (isStreamError) {\n      // \"Stream Errors Are Unrecoverable\"\n      // \"The entity that receives the stream error then SHALL close the stream\"\n      this.disconnect();\n    }\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error\n  _onStreamError(element) {\n    const error = StreamError.fromElement(element);\n\n    if (error.condition === \"see-other-host\") {\n      return this._onSeeOtherHost(error);\n    }\n\n    this.emit(\"error\", error);\n  }\n\n  // https://xmpp.org/rfcs/rfc6120.html#streams-error-conditions-see-other-host\n  async _onSeeOtherHost(error) {\n    const { protocol } = parseService(this.options.service);\n\n    const host = error.element.getChildText(\"see-other-host\");\n    const { port } = parseHost(host);\n\n    let service;\n    service = port\n      ? `${protocol || \"xmpp:\"}//${host}`\n      : (protocol ? `${protocol}//` : \"\") + host;\n\n    try {\n      await promise(this, \"disconnect\");\n      const { domain, lang } = this.options;\n      await this.connect(service);\n      await this.open({ domain, lang });\n    } catch (err) {\n      this.emit(\"error\", err);\n    }\n  }\n\n  _attachParser(parser) {\n    this.parser = parser;\n    this.#parserListeners ??= listeners({\n      element: this._onElement.bind(this),\n      error: this.#onParserError.bind(this),\n      end: this.#onStreamClosed.bind(this),\n      start: (element) => this._status(\"open\", element),\n    });\n    this.#parserListeners.subscribe(this.parser);\n  }\n\n  _detachParser() {\n    this.parser && this.#parserListeners?.unsubscribe(this.parser);\n    this.parser = null;\n    this.root = null;\n  }\n\n  _jid(id) {\n    this.jid = jid(id);\n    return this.jid;\n  }\n\n  /*\n  [\n    \"offline\",\n    // \"disconnect\",\n    \"connecting\",\n    \"connected\",\n    \"opening\",\n    \"open\",\n    \"online\",\n    \"closing\",\n    \"close\",\n    \"disconnecting\",\n    \"disconnect\",\n    \"offline\",\n  ];\n  */\n  _status(status, ...args) {\n    if (this.status === status) return;\n    this.status = status;\n    this.emit(\"status\", status, ...args);\n    this.emit(status, ...args);\n  }\n\n  _ready(resumed = false) {\n    if (resumed) {\n      this.status = \"online\";\n    } else {\n      this._status(\"online\", this.jid);\n    }\n  }\n\n  async disconnect() {\n    let el;\n\n    try {\n      el = await this._closeStream();\n    } catch (err) {\n      this.#onStreamClosed(err);\n    }\n\n    try {\n      await this._closeSocket();\n    } catch (err) {\n      this.#onSocketClosed(true, err);\n    }\n\n    return el;\n  }\n\n  /**\n   * Opens the socket then opens the stream\n   */\n  async start() {\n    if (this.status !== \"offline\") {\n      throw new Error(\"Connection is not offline\");\n    }\n\n    const { service, domain, lang } = this.options;\n\n    await this.connect(service);\n\n    const promiseOnline = promise(this, \"online\");\n\n    await this.open({ domain, lang });\n\n    return promiseOnline;\n  }\n\n  /**\n   * Connects the socket\n   */\n  async connect(service) {\n    this._status(\"connecting\", service);\n    const socket = new this.Socket();\n    this._attachSocket(socket);\n    // The 'connect' status is set by the socket 'connect' listener\n    socket.connect(this.socketParameters(service));\n    return promise(socket, \"connect\");\n  }\n\n  /**\n   * Disconnects the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeSocket(timeout = this.timeout) {\n    this._status(\"disconnecting\");\n    this.socket.end();\n\n    // The 'disconnect' status is set by the socket 'close' listener\n    await promise(this.socket, \"close\", \"error\", timeout);\n  }\n\n  /**\n   * Opens the stream\n   */\n  async open(options) {\n    this._status(\"opening\");\n\n    const { domain, lang } = options;\n\n    const headerElement = this.headerElement();\n    headerElement.attrs.to = domain;\n    headerElement.attrs[\"xml:lang\"] = lang;\n    this.root = headerElement;\n\n    this._attachParser(new this.Parser());\n\n    await this.write(this.header(headerElement));\n    return promise(this, \"open\", \"error\", this.timeout);\n  }\n\n  /**\n   * Closes the stream then closes the socket\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async stop() {\n    const el = await this.disconnect();\n    this._status(\"offline\", el);\n    return el;\n  }\n\n  /**\n   * Closes the stream and wait for the server to close it\n   * https://xmpp.org/rfcs/rfc6120.html#streams-close\n   * https://tools.ietf.org/html/rfc7395#section-3.6\n   */\n  async _closeStream(timeout = this.timeout) {\n    await this.#runHooks(\"close\");\n\n    const fragment = this.footer(this.footerElement());\n\n    await this.write(fragment);\n    this._status(\"closing\");\n    return promise(this.parser, \"end\", \"error\", timeout);\n    // The 'close' status is set by the parser 'end' listener\n  }\n\n  /**\n   * Restart the stream\n   * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation-restart\n   */\n  async restart() {\n    this._detachParser();\n    const { domain, lang } = this.options;\n    return this.open({ domain, lang });\n  }\n\n  async send(element) {\n    element.parent = this.root;\n    await this.write(element.toString());\n    this.emit(\"send\", element);\n  }\n\n  sendReceive(element, timeout = this.timeout) {\n    return Promise.all([\n      this.send(element),\n      promise(this, \"element\", \"error\", timeout),\n    ]).then(([, el]) => el);\n  }\n\n  async write(string) {\n    // https://xmpp.org/rfcs/rfc6120.html#streams-close\n    // \"Refrain from sending any further data over its outbound stream to the other entity\"\n    if (this.status === \"closing\") {\n      throw new Error(\"Connection is closing\");\n    }\n\n    return new Promise((resolve, reject) => {\n      this.socket.write(string, (err) => (err ? reject(err) : resolve()));\n    });\n  }\n\n  isStanza(element) {\n    const { name } = element;\n    return name === \"iq\" || name === \"message\" || name === \"presence\";\n  }\n\n  isNonza(element) {\n    return !this.isStanza(element);\n  }\n\n  // Override\n  header(el) {\n    return el.toString();\n  }\n\n  // Override\n  headerElement() {\n    return new xml.Element(\"\", {\n      version: \"1.0\",\n      xmlns: this.NS,\n    });\n  }\n\n  // Override\n  footer(el) {\n    return el.toString();\n  }\n\n  // Override\n  footerElement() {}\n\n  // Override\n  socketParameters() {}\n\n  /* Experimental hooks */\n  #hooks = new Map();\n  #hook_events = new Set([\"close\"]);\n  hook(event, handler /*priority = 0 TODO */) {\n    this.#assertHookEventName(event);\n\n    if (!this.#hooks.has(event)) {\n      this.#hooks.set(event, new Set());\n    }\n\n    this.#hooks.get(event).add([handler]);\n  }\n  #assertHookEventName(event) {\n    if (!this.#hook_events.has(event)) {\n      throw new Error(`Hook event name \"${event}\" is unknown.`);\n    }\n  }\n  unhook(event, handler) {\n    this.#assertHookEventName(event);\n    const handlers = this.#hooks.get(\"event\");\n    const item = [...handlers].find((item) => item.handler === handler);\n    handlers.remove(item);\n  }\n  async #runHooks(event, ...args) {\n    this.#assertHookEventName(event);\n\n    const hooks = this.#hooks.get(event);\n    if (!hooks) return;\n\n    // TODO run hooks by priority\n    // run hooks with the same priority in parallel\n\n    await Promise.all(\n      [...hooks].map(async ([handler]) => {\n        try {\n          await handler(...args);\n        } catch (err) {\n          this.emit(\"error\", err);\n        }\n      }),\n    );\n  }\n}\n\n// Override\nConnection.prototype.NS = \"\";\nConnection.prototype.Socket = null;\nConnection.prototype.Parser = null;\n\nexport default Connection;\n","import Connection from \"@xmpp/connection\";\n\nclass Client extends Connection {\n  constructor(options) {\n    super(options);\n    this.transports = [];\n  }\n\n  send(element, ...args) {\n    return this.Transport.prototype.send.call(this, element, ...args);\n  }\n\n  sendMany(...args) {\n    return this.Transport.prototype.sendMany.call(this, ...args);\n  }\n\n  _findTransport(service) {\n    return this.transports.find((Transport) => {\n      try {\n        return Transport.prototype.socketParameters(service) !== undefined;\n      } catch {\n        return false;\n      }\n    });\n  }\n\n  connect(service) {\n    const Transport = this._findTransport(service);\n\n    if (!Transport) {\n      throw new Error(\"No compatible connection method found.\");\n    }\n\n    this.Transport = Transport;\n    this.Socket = Transport.prototype.Socket;\n    this.Parser = Transport.prototype.Parser;\n\n    return super.connect(service);\n  }\n\n  socketParameters(...args) {\n    return this.Transport.prototype.socketParameters(...args);\n  }\n\n  header(headerElement, ...args) {\n    // if the client knows the XMPP identity then it SHOULD include the 'from' attribute\n    // after the confidentiality and integrity of the stream are protected via TLS\n    // or an equivalent security layer.\n    // https://xmpp.org/rfcs/rfc6120.html#rfc.section.4.7.1\n    const from = this.isSecure() && this.jid?.bare().toString();\n    if (from) headerElement.attrs.from = from;\n    return this.Transport.prototype.header(headerElement, ...args);\n  }\n\n  headerElement(...args) {\n    return this.Transport.prototype.headerElement(...args);\n  }\n\n  footer(...args) {\n    return this.Transport.prototype.footer(...args);\n  }\n\n  footerElement(...args) {\n    return this.Transport.prototype.footerElement(...args);\n  }\n}\n\nClient.prototype.NS = \"jabber:client\";\n\nexport default Client;\n","const ANONYMOUS = \"ANONYMOUS\";\nconst PLAIN = \"PLAIN\";\n\nexport default function createOnAuthenticate(credentials, userAgent) {\n  return async function onAuthenticate(...args) {\n    if (typeof credentials === \"function\") {\n      await credentials(...args);\n      return;\n    }\n\n    const [authenticate, mechanisms, fast, entity] = args;\n\n    credentials.token ??= await fast?.fetch();\n\n    const mechanism = getMechanism({ mechanisms, entity, credentials });\n    await authenticate(credentials, mechanism, userAgent);\n  };\n}\n\nexport function getMechanism({ mechanisms, entity, credentials }) {\n  if (\n    !credentials?.username &&\n    !credentials?.password &&\n    !credentials?.token &&\n    mechanisms.includes(ANONYMOUS)\n  ) {\n    return ANONYMOUS;\n  }\n\n  if (entity.isSecure()) return mechanisms[0];\n\n  return mechanisms.find((mechanism) => mechanism !== PLAIN);\n}\n","import { EventEmitter } from \"@xmpp/events\";\n\nclass Reconnect extends EventEmitter {\n  constructor(entity) {\n    super();\n\n    this.delay = 1000;\n    this.entity = entity;\n    this._timeout = null;\n  }\n\n  #onDisconnect = () => {\n    this.scheduleReconnect();\n  };\n\n  scheduleReconnect() {\n    const { entity, delay, _timeout } = this;\n    clearTimeout(_timeout);\n    this._timeout = setTimeout(async () => {\n      if (entity.status !== \"disconnect\") {\n        return;\n      }\n\n      try {\n        await this.reconnect();\n      } catch {\n        // Ignoring the rejection is safe because the error is emitted on entity by #start\n      }\n    }, delay);\n  }\n\n  async reconnect() {\n    const { entity } = this;\n    this.emit(\"reconnecting\");\n\n    const { service, domain, lang } = entity.options;\n    await entity.connect(service);\n    await entity.open({ domain, lang });\n\n    this.emit(\"reconnected\");\n  }\n\n  start() {\n    const { entity } = this;\n    entity.on(\"disconnect\", this.#onDisconnect);\n  }\n\n  stop() {\n    const { entity, _timeout } = this;\n    entity.removeListener(\"disconnect\", this.#onDisconnect);\n    clearTimeout(_timeout);\n  }\n}\n\nexport default function reconnect({ entity }) {\n  const r = new Reconnect(entity);\n  r.start();\n  return r;\n}\n","import { EventEmitter, listeners } from \"@xmpp/events\";\nimport { parseURI } from \"@xmpp/connection/lib/util.js\";\n\nconst CODE = \"ECONNERROR\";\n\nexport function isSecure(url) {\n  const uri = parseURI(url);\n  if (uri.protocol === \"wss:\") return true;\n  if ([\"localhost\", \"127.0.0.1\", \"::1\"].includes(uri.hostname)) return true;\n  return false;\n}\n\nexport default class Socket extends EventEmitter {\n  #listeners = null;\n  socket = null;\n  url = null;\n  secure = false;\n\n  connect(url) {\n    this.url = url;\n    this.secure = isSecure(url);\n    // eslint-disable-next-line n/no-unsupported-features/node-builtins\n    this._attachSocket(new WebSocket(url, [\"xmpp\"]));\n  }\n\n  _attachSocket(socket) {\n    this.socket = socket;\n    this.#listeners ??= listeners({\n      open: () => this.emit(\"connect\"),\n      message: ({ data }) => this.emit(\"data\", data),\n      error: (event) => {\n        const { url } = this;\n        // WS\n        let { error } = event;\n        // DOM\n        if (!error) {\n          error = new Error(event.message || `WebSocket ${CODE} ${url}`);\n          error.errno = CODE;\n          error.code = CODE;\n        }\n\n        error.event = event;\n        error.url = url;\n        this.emit(\"error\", error);\n      },\n      close: (event) => {\n        this._detachSocket();\n        this.emit(\"close\", !event.wasClean, event);\n      },\n    });\n    this.#listeners.subscribe(this.socket);\n  }\n\n  _detachSocket() {\n    this.url = null;\n    this.secure = false;\n    this.socket && this.#listeners?.unsubscribe(this.socket);\n    this.socket = null;\n  }\n\n  end() {\n    this.socket.close();\n  }\n\n  write(data, fn) {\n    function done(err) {\n      if (!fn) return;\n      // eslint-disable-next-line promise/catch-or-return, promise/no-promise-in-callback\n      Promise.resolve().then(() => fn(err));\n    }\n\n    try {\n      this.socket.send(data);\n    } catch (err) {\n      done(err);\n      return;\n    }\n    done();\n  }\n}\n","import Socket from \"./Socket.js\";\nimport Connection from \"@xmpp/connection\";\nimport xml from \"@xmpp/xml\";\nimport FramedParser from \"./FramedParser.js\";\n\nconst NS_FRAMING = \"urn:ietf:params:xml:ns:xmpp-framing\";\n\n/* References\n * WebSocket protocol https://tools.ietf.org/html/rfc6455\n * WebSocket Web API https://html.spec.whatwg.org/multipage/comms.html#network\n * XMPP over WebSocket https://tools.ietf.org/html/rfc7395\n */\n\nclass ConnectionWebSocket extends Connection {\n  send(element, ...args) {\n    element.attrs.xmlns ??= this.NS;\n    return super.send(element, ...args);\n  }\n\n  async sendMany(elements) {\n    for (const element of elements) {\n      element.attrs.xmlns ??= this.NS;\n      element.parent = this.root;\n      this.socket.write(element.toString());\n      this.emit(\"send\", element);\n    }\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.6\n  footerElement() {\n    return new xml.Element(\"close\", {\n      xmlns: NS_FRAMING,\n    });\n  }\n\n  // https://tools.ietf.org/html/rfc7395#section-3.4\n  headerElement() {\n    const el = super.headerElement();\n    el.name = \"open\";\n    el.attrs.xmlns = NS_FRAMING;\n    return el;\n  }\n\n  socketParameters(service) {\n    return /^wss?:\\/\\//.test(service) ? service : undefined;\n  }\n}\n\nConnectionWebSocket.prototype.Socket = Socket;\nConnectionWebSocket.prototype.NS = \"jabber:client\";\nConnectionWebSocket.prototype.Parser = FramedParser;\n\nexport default ConnectionWebSocket;\n","import { Parser, Element, XMLError } from \"@xmpp/xml\";\n\nexport default class FramedParser extends Parser {\n  onStartElement(name, attrs) {\n    const element = new Element(name, attrs);\n\n    const { cursor } = this;\n\n    if (cursor) {\n      cursor.append(element);\n    }\n\n    this.cursor = element;\n  }\n\n  onEndElement(name) {\n    const { cursor } = this;\n    if (name !== cursor.name) {\n      // <foo></bar>\n      this.emit(\"error\", new XMLError(`${cursor.name} must be closed.`));\n      return;\n    }\n\n    if (cursor.parent) {\n      this.cursor = cursor.parent;\n      return;\n    }\n\n    if (cursor.is(\"open\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"start\", cursor);\n    } else if (cursor.is(\"close\", \"urn:ietf:params:xml:ns:xmpp-framing\")) {\n      this.emit(\"end\", cursor);\n    } else {\n      this.emit(\"element\", cursor);\n    }\n\n    this.cursor = null;\n  }\n}\n","import ConnectionWebSocket from \"./lib/Connection.js\";\n\nexport default function websocket({ entity }) {\n  entity.transports.push(ConnectionWebSocket);\n}\n","'use strict'\n\n/**\n * Expose compositor.\n */\n\nmodule.exports = compose\n\n/**\n * Compose `middleware` returning\n * a fully valid middleware comprised\n * of all those which are passed.\n *\n * @param {Array} middleware\n * @return {Function}\n * @api public\n */\n\nfunction compose (middleware) {\n  if (!Array.isArray(middleware)) throw new TypeError('Middleware stack must be an array!')\n  for (const fn of middleware) {\n    if (typeof fn !== 'function') throw new TypeError('Middleware must be composed of functions!')\n  }\n\n  /**\n   * @param {Object} context\n   * @return {Promise}\n   * @api public\n   */\n\n  return function (context, next) {\n    // last called middleware #\n    let index = -1\n    return dispatch(0)\n    function dispatch (i) {\n      if (i <= index) return Promise.reject(new Error('next() called multiple times'))\n      index = i\n      let fn = middleware[i]\n      if (i === middleware.length) fn = next\n      if (!fn) return Promise.resolve()\n      try {\n        return Promise.resolve(fn(context, dispatch.bind(null, i + 1)));\n      } catch (err) {\n        return Promise.reject(err)\n      }\n    }\n  }\n}\n","export default class Context {\n  constructor(entity, stanza) {\n    this.stanza = stanza;\n    this.entity = entity;\n\n    const { name, attrs } = stanza;\n    const { type, id } = attrs;\n\n    this.name = name;\n    this.id = id || \"\";\n\n    if (name === \"message\") {\n      this.type = type || \"normal\";\n    } else if (name === \"presence\") {\n      this.type = type || \"available\";\n    } else {\n      this.type = type || \"\";\n    }\n\n    this.from = null;\n    this.to = null;\n    this.local = \"\";\n    this.domain = \"\";\n    this.resource = \"\";\n  }\n}\n","import Context from \"./Context.js\";\nimport JID from \"@xmpp/jid\";\n\nexport default class IncomingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const to = stanza.attrs.to || jid?.toString();\n    const from = stanza.attrs.from || domain;\n\n    if (to) this.to = new JID(to);\n\n    if (from) {\n      this.from = new JID(from);\n      this.local = this.from.local;\n      this.domain = this.from.domain;\n      this.resource = this.from.resource;\n    }\n  }\n}\n","import Context from \"./Context.js\";\nimport JID from \"@xmpp/jid\";\n\nexport default class OutgoingContext extends Context {\n  constructor(entity, stanza) {\n    super(entity, stanza);\n\n    const { jid } = entity;\n    const { domain } = entity.options ?? {};\n\n    const from = stanza.attrs.from || jid?.toString();\n    const to = stanza.attrs.to || domain;\n\n    if (from) this.from = new JID(from);\n\n    if (to) {\n      this.to = new JID(to);\n      this.local = this.to.local;\n      this.domain = this.to.domain;\n      this.resource = this.to.resource;\n    }\n  }\n}\n","import compose from \"koa-compose\";\n\nimport IncomingContext from \"./lib/IncomingContext.js\";\nimport OutgoingContext from \"./lib/OutgoingContext.js\";\n\nfunction listener(entity, middleware, Context) {\n  return (stanza) => {\n    const ctx = new Context(entity, stanza);\n    return compose(middleware)(ctx);\n  };\n}\n\nfunction errorHandler(entity) {\n  return (ctx, next) => {\n    next()\n      .then((reply) => reply && entity.send(reply))\n      .catch((err) => entity.emit(\"error\", err));\n  };\n}\n\nexport default function middleware({ entity }) {\n  const incoming = [errorHandler(entity)];\n  const outgoing = [];\n\n  const incomingListener = listener(entity, incoming, IncomingContext);\n  const outgoingListener = listener(entity, outgoing, OutgoingContext);\n\n  entity.on(\"element\", incomingListener);\n  entity.on(\"send\", outgoingListener);\n\n  return {\n    use(fn) {\n      incoming.push(fn);\n      return fn;\n    },\n    filter(fn) {\n      outgoing.push(fn);\n      return fn;\n    },\n  };\n}\n","import XMPPError from \"@xmpp/error\";\n\n/* https://xmpp.org/rfcs/rfc6120.html#stanzas-error */\n\nclass StanzaError extends XMPPError {\n  constructor(condition, text, application, type) {\n    super(condition, text, application);\n    this.type = type;\n    this.name = \"StanzaError\";\n  }\n\n  static fromElement(element) {\n    const error = super.fromElement(element);\n    error.type = element.attrs.type;\n    return error;\n  }\n}\n\nexport default StanzaError;\n","import xid from \"@xmpp/id\";\nimport StanzaError from \"@xmpp/middleware/lib/StanzaError.js\";\nimport { Deferred, timeout as timeoutPromise } from \"@xmpp/events\";\nimport xml from \"@xmpp/xml\";\n\nfunction isReply({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type !== \"error\" && type !== \"result\") return false;\n  return true;\n}\n\nclass IQCaller {\n  constructor({ entity, middleware }) {\n    this.handlers = new Map();\n    this.entity = entity;\n    this.middleware = middleware;\n  }\n\n  start() {\n    this.middleware.use(this._route.bind(this));\n  }\n\n  _route({ type, name, id, stanza }, next) {\n    if (!isReply({ name, type })) return next();\n\n    const deferred = this.handlers.get(id);\n\n    if (!deferred) {\n      return next();\n    }\n\n    if (type === \"error\") {\n      deferred.reject(StanzaError.fromElement(stanza.getChild(\"error\")));\n    } else {\n      deferred.resolve(stanza);\n    }\n\n    this.handlers.delete(id);\n  }\n\n  async request(stanza, timeout = 30 * 1000) {\n    if (!stanza.attrs.id) {\n      stanza.attrs.id = xid();\n    }\n\n    const deferred = new Deferred();\n    this.handlers.set(stanza.attrs.id, deferred);\n\n    try {\n      await this.entity.send(stanza);\n      await timeoutPromise(deferred.promise, timeout);\n    } catch (err) {\n      this.handlers.delete(stanza.attrs.id);\n      throw err;\n    }\n\n    return deferred.promise;\n  }\n\n  _childRequest(type, element, to, ...args) {\n    const {\n      name,\n      attrs: { xmlns },\n    } = element;\n    return this.request(xml(\"iq\", { type, to }, element), ...args).then(\n      (stanza) => stanza.getChild(name, xmlns),\n    );\n  }\n\n  async get(...args) {\n    return this._childRequest(\"get\", ...args);\n  }\n\n  async set(...args) {\n    return this._childRequest(\"set\", ...args);\n  }\n}\n\nexport default function iqCaller(...args) {\n  const iqCaller = new IQCaller(...args);\n  iqCaller.start();\n  return iqCaller;\n}\n","export default function id() {\n  let i;\n  while (!i) {\n    i = Math.random().toString(36).slice(2, 12);\n  }\n\n  return i;\n}\n","import xml from \"@xmpp/xml\";\n\n/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-semantics-iq\n * https://xmpp.org/rfcs/rfc6120.html#stanzas-error\n */\n\nconst NS_STANZA = \"urn:ietf:params:xml:ns:xmpp-stanzas\";\n\nfunction isQuery({ name, type }) {\n  if (name !== \"iq\") return false;\n  if (type === \"error\" || type === \"result\") return false;\n  return true;\n}\n\nfunction isValidQuery({ type }, children, child) {\n  if (type !== \"get\" && type !== \"set\") return false;\n  if (children.length !== 1) return false;\n  if (!child) return false;\n  return true;\n}\n\nfunction buildReply({ stanza }) {\n  return xml(\"iq\", {\n    to: stanza.attrs.from,\n    from: stanza.attrs.to,\n    id: stanza.attrs.id,\n  });\n}\n\nfunction buildReplyResult(ctx, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"result\";\n  if (child) {\n    reply.append(child);\n  }\n\n  return reply;\n}\n\nfunction buildReplyError(ctx, error, child) {\n  const reply = buildReply(ctx);\n  reply.attrs.type = \"error\";\n  if (child) {\n    reply.append(child);\n  }\n\n  reply.append(error);\n  return reply;\n}\n\nfunction buildError(type, condition) {\n  return xml(\"error\", { type }, xml(condition, NS_STANZA));\n}\n\nfunction iqHandler(entity) {\n  return async function iqHandler(ctx, next) {\n    if (!isQuery(ctx)) return next();\n\n    const { stanza } = ctx;\n    const children = stanza.getChildElements();\n    const [child] = children;\n\n    if (!isValidQuery(ctx, children, child)) {\n      return buildReplyError(ctx, buildError(\"modify\", \"bad-request\"), child);\n    }\n\n    ctx.element = child;\n\n    let reply;\n    try {\n      reply = await next();\n    } catch (err) {\n      entity.emit(\"error\", err);\n      reply = buildError(\"cancel\", \"internal-server-error\");\n    }\n\n    if (!reply) {\n      reply = buildError(\"cancel\", \"service-unavailable\");\n    }\n\n    if (reply instanceof xml.Element && reply.is(\"error\")) {\n      return buildReplyError(ctx, reply, child);\n    }\n\n    return buildReplyResult(\n      ctx,\n      reply instanceof xml.Element ? reply : undefined,\n    );\n  };\n}\n\nfunction route(type, ns, name, handler) {\n  return (ctx, next) => {\n    if ((ctx.type !== type) | !ctx.element || !ctx.element.is(name, ns))\n      return next();\n    return handler(ctx, next);\n  };\n}\n\nexport default function iqCallee({ middleware, entity }) {\n  middleware.use(iqHandler(entity));\n\n  return {\n    get(ns, name, handler) {\n      middleware.use(route(\"get\", ns, name, handler));\n    },\n    set(ns, name, handler) {\n      middleware.use(route(\"set\", ns, name, handler));\n    },\n  };\n}\n","function isSecure(uri) {\n  return uri.startsWith(\"https\") || uri.startsWith(\"wss\");\n}\n\nexport function compare(a, b) {\n  let secure;\n  if (isSecure(a.uri) && !isSecure(b.uri)) {\n    secure = -1;\n  } else if (!isSecure(a.uri) && isSecure(b.uri)) {\n    secure = 1;\n  } else {\n    secure = 0;\n  }\n\n  if (secure !== 0) {\n    return secure;\n  }\n\n  let method;\n  if (a.method === b.method) {\n    method = 0;\n  } else if (a.method === \"websocket\") {\n    method = -1;\n  } else if (b.method === \"websocket\") {\n    method = 1;\n  } else if (a.method === \"xbosh\") {\n    method = -1;\n  } else if (b.method === \"xbosh\") {\n    method = 1;\n  } else if (a.method === \"httppoll\") {\n    method = -1;\n  } else if (b.method === \"httppoll\") {\n    method = 1;\n  } else {\n    method = 0;\n  }\n\n  if (method !== 0) {\n    return method;\n  }\n\n  return 0;\n}\n","import parse from \"@xmpp/xml/lib/parse.js\";\nimport { compare as compareAltConnections } from \"./alt-connections.js\";\n\nexport function resolve(domain) {\n  // eslint-disable-next-line n/no-unsupported-features/node-builtins\n  return fetch(`https://${domain}/.well-known/host-meta`)\n    .then((res) => res.text())\n    .then((res) => {\n      return parse(res)\n        .getChildren(\"Link\")\n        .filter((link) =>\n          [\n            \"urn:xmpp:alt-connections:websocket\",\n            \"urn:xmpp:alt-connections:httppoll\",\n            \"urn:xmpp:alt-connections:xbosh\",\n          ].includes(link.attrs.rel),\n        )\n        .map(({ attrs }) => ({\n          rel: attrs.rel,\n          href: attrs.href,\n          method: attrs.rel.split(\":\").pop(),\n          uri: attrs.href,\n        }))\n        .sort(compareAltConnections);\n    })\n    .catch(() => {\n      return [];\n    });\n}\n","import Parser from \"./Parser.js\";\n\nexport default function parse(data) {\n  const p = new Parser();\n\n  let result = null;\n  let error = null;\n\n  p.on(\"start\", (el) => {\n    result = el;\n  });\n  p.on(\"element\", (el) => {\n    result.append(el);\n  });\n  p.on(\"error\", (err) => {\n    error = err;\n  });\n\n  p.write(data);\n  p.end();\n\n  if (error) {\n    throw error;\n  } else {\n    return result;\n  }\n}\n","import _resolve from \"./resolve.js\";\nimport { promise } from \"@xmpp/events\";\n\nasync function fetchURIs(domain) {\n  const result = await _resolve(domain, {\n    srv: [\n      {\n        service: \"xmpps-client\",\n        protocol: \"tcp\",\n      },\n      {\n        service: \"xmpp-client\",\n        protocol: \"tcp\",\n      },\n    ],\n  });\n\n  return [\n    // Remove duplicates\n    ...new Set(result.map((record) => record.uri)),\n  ];\n}\n\nfunction filterSupportedURIs(entity, uris) {\n  return uris.filter((uri) => entity._findTransport(uri));\n}\n\nasync function fallbackConnect(entity, uris) {\n  if (uris.length === 0) {\n    throw new Error(\"Couldn't connect\");\n  }\n\n  const uri = uris.shift();\n  const Transport = entity._findTransport(uri);\n\n  if (!Transport) {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._status(\"connecting\", uri);\n  const params = Transport.prototype.socketParameters(uri);\n  const socket = new Transport.prototype.Socket();\n\n  try {\n    socket.connect(params);\n    await promise(socket, \"connect\");\n  } catch {\n    return fallbackConnect(entity, uris);\n  }\n\n  entity._attachSocket(socket);\n  socket.emit(\"connect\");\n  entity.Transport = Transport;\n  entity.Socket = Transport.prototype.Socket;\n  entity.Parser = Transport.prototype.Parser;\n}\n\nexport default function resolve({ entity }) {\n  const _connect = entity.connect;\n  entity.connect = async function connect(service) {\n    if (!service || /:\\/\\//.test(service)) {\n      return _connect.call(this, service);\n    }\n\n    const uris = filterSupportedURIs(entity, await fetchURIs(service));\n\n    if (uris.length === 0) {\n      throw new Error(\"No compatible transport found.\");\n    }\n\n    try {\n      await fallbackConnect(entity, uris);\n    } catch (err) {\n      await entity.disconnect();\n      entity._status(\"disconnect\");\n      throw err;\n    }\n  };\n}\n\nexport { _resolve as resolve };\n","import * as dns from \"./lib/dns.js\";\nimport * as http from \"./lib/http.js\";\n\nexport default function resolve(...args) {\n  return Promise.all([\n    dns.resolve ? dns.resolve(...args) : Promise.resolve([]),\n    http.resolve(...args),\n  ]).then(([records, endpoints]) => [...records, ...endpoints]);\n}\n\nexport { dns, http };\n","export function encode(string) {\n  return globalThis.btoa(string);\n}\n\nexport function decode(string) {\n  return globalThis.atob(string);\n}\n","import XMPPError from \"@xmpp/error\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl-errors\n\nclass SASLError extends XMPPError {\n  constructor(...args) {\n    super(...args);\n    this.name = \"SASLError\";\n  }\n}\n\nexport default SASLError;\n","import { encode, decode } from \"@xmpp/base64\";\nimport SASLError from \"./lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\n\n// https://xmpp.org/rfcs/rfc6120.html#sasl\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-sasl\";\n\nexport function getAvailableMechanisms(element, NS, saslFactory) {\n  const offered = new Set(\n    element.getChildren(\"mechanism\", NS).map((m) => m.text()),\n  );\n  const supported = saslFactory._mechs.map(({ name }) => name);\n  return supported.filter((mech) => offered.has(mech));\n}\n\nasync function authenticate({ saslFactory, entity, mechanism, credentials }) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    mech.clientFirst &&\n      xml(\n        \"auth\",\n        { xmlns: NS, mechanism: mech.name },\n        encode(await mech.response(creds)),\n      ),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"success\") {\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl({ streamFeatures, saslFactory }, onAuthenticate) {\n  streamFeatures.use(\"mechanisms\", NS, async ({ entity }, _next, element) => {\n    const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n    if (mechanisms.length === 0) {\n      throw new SASLError(\"SASL: No compatible mechanism available.\");\n    }\n\n    async function done(credentials, mechanism) {\n      await authenticate({\n        saslFactory,\n        entity,\n        mechanism,\n        credentials,\n      });\n    }\n\n    await onAuthenticate(done, mechanisms, null, entity);\n\n    await entity.restart();\n  });\n}\n","import { encode, decode } from \"@xmpp/base64\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport { procedure } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\n\n// https://xmpp.org/extensions/xep-0388.html\n\nconst NS = \"urn:xmpp:sasl:2\";\n\nasync function authenticate({\n  saslFactory,\n  entity,\n  mechanism,\n  credentials,\n  userAgent,\n  streamFeatures,\n  features,\n}) {\n  const mech = saslFactory.create([mechanism]);\n  if (!mech) {\n    throw new Error(`SASL: Mechanism ${mechanism} not found.`);\n  }\n\n  const { domain } = entity.options;\n  const creds = {\n    username: null,\n    password: null,\n    server: domain,\n    host: domain,\n    realm: domain,\n    serviceType: \"xmpp\",\n    serviceName: domain,\n    ...credentials,\n  };\n\n  await procedure(\n    entity,\n    xml(\"authenticate\", { xmlns: NS, mechanism: mech.name }, [\n      mech.clientFirst &&\n        xml(\"initial-response\", {}, encode(await mech.response(creds))),\n      userAgent,\n      ...streamFeatures,\n    ]),\n    async (element, done) => {\n      if (element.getNS() !== NS) return;\n\n      if (element.name === \"challenge\") {\n        await mech.challenge(decode(element.text()));\n        const resp = await mech.response(creds);\n        await entity.send(\n          xml(\n            \"response\",\n            { xmlns: NS, mechanism: mech.name },\n            typeof resp === \"string\" ? encode(resp) : \"\",\n          ),\n        );\n        return;\n      }\n\n      if (element.name === \"failure\") {\n        throw SASLError.fromElement(element);\n      }\n\n      if (element.name === \"continue\") {\n        throw new Error(\"SASL continue is not supported yet\");\n      }\n\n      if (element.name === \"success\") {\n        const additionalData = element.getChild(\"additional-data\")?.text();\n        if (additionalData && mech.final) {\n          await mech.final(decode(additionalData));\n        }\n\n        // https://xmpp.org/extensions/xep-0388.html#success\n        // this is a bare JID, unless resource binding or stream resumption has occurred, in which case it is a full JID.\n        const aid = element.getChildText(\"authorization-identifier\");\n        if (aid) {\n          entity._jid(aid);\n        }\n\n        for (const child of element.getChildElements()) {\n          const feature = features.get(child.getNS());\n          feature?.[1]?.(child);\n        }\n\n        return done();\n      }\n    },\n  );\n}\n\nexport default function sasl2({ streamFeatures, saslFactory }, onAuthenticate) {\n  const features = new Map();\n  let fast;\n\n  streamFeatures.use(\n    \"authentication\",\n    NS,\n    async ({ entity }, _next, element) => {\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const streamFeatures = await getStreamFeatures({ element, features });\n      const fast_available = !!fast?.mechanism;\n\n      if (mechanisms.length === 0 && !fast_available) {\n        throw new SASLError(\"SASL: No compatible mechanism available.\");\n      }\n\n      await onAuthenticate(\n        done,\n        mechanisms,\n        fast_available ? fast : null,\n        entity,\n      );\n\n      async function done(credentials, mechanism, userAgent) {\n        // Try fast\n        const success = await fast.auth({\n          authenticate,\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          credentials,\n        });\n        if (success) return;\n\n        // fast.auth may mutate streamFeatures to request a token\n\n        // If fast authentication fails, continue and try without\n        await authenticate({\n          entity,\n          userAgent,\n          streamFeatures,\n          features,\n          saslFactory,\n          mechanism,\n          credentials,\n        });\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n    setup({ fast: _fast }) {\n      fast = _fast;\n    },\n  };\n}\n\nasync function getStreamFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.getNS();\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","import xml from \"@xmpp/xml\";\n\n/*\n * References\n * https://xmpp.org/rfcs/rfc6120.html#bind\n */\n\nconst NS = \"urn:ietf:params:xml:ns:xmpp-bind\";\n\nfunction makeBindElement(resource) {\n  return xml(\"bind\", { xmlns: NS }, resource && xml(\"resource\", {}, resource));\n}\n\nasync function bind(entity, iqCaller, resource) {\n  const result = await iqCaller.set(makeBindElement(resource));\n  const jid = result.getChildText(\"jid\");\n  entity._jid(jid);\n  entity._ready(false);\n  return jid;\n}\n\nfunction route({ iqCaller }, resource) {\n  return async ({ entity }, next) => {\n    resource = typeof resource === \"function\" ? await resource() : resource;\n    await bind(entity, iqCaller, resource);\n    next();\n  };\n}\n\nexport default function resourceBinding(\n  { streamFeatures, iqCaller },\n  resource,\n) {\n  streamFeatures.use(\"bind\", NS, route({ iqCaller }, resource));\n}\n","function date(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return datetime(d).split(\"T\")[0];\n}\n\nfunction time(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return datetime(d).split(\"T\")[1];\n}\n\nfunction datetime(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return new Date(d).toISOString().split(\".\")[0] + \"Z\";\n}\n\nfunction pad(value) {\n  return value < 10 ? \"0\" + value : value;\n}\n\nfunction formatOffset(n) {\n  const sign = n > 0 ? \"-\" : \"+\";\n  const offset = Math.abs(n);\n  return sign + pad(Math.floor(offset / 60)) + \":\" + pad(offset % 60);\n}\n\nfunction offset(d = new Date()) {\n  if (typeof d === \"string\") {\n    d = new Date(d);\n  }\n\n  return formatOffset(d.getTimezoneOffset());\n}\n\nexport { date, time, datetime, offset };\n","import XMPPError from \"@xmpp/error\";\nimport { procedure } from \"@xmpp/events\";\n\nimport { NS, makeEnableElement, makeResumeElement } from \"./index.js\";\n\nexport function setupStreamFeature({\n  streamFeatures,\n  sm,\n  entity,\n  resumed,\n  failed,\n  enabled,\n}) {\n  // https://xmpp.org/extensions/xep-0198.html#enable\n  // For client-to-server connections, the client MUST NOT attempt to enable stream management until after it has completed Resource Binding unless it is resuming a previous session\n  streamFeatures.use(\"sm\", NS, async (context, next) => {\n    // Resuming\n    if (sm.id) {\n      try {\n        const element = await resume(entity, sm);\n        await resumed(element);\n        return;\n        // If resumption fails, continue with session establishment\n      } catch {\n        failed();\n      }\n    }\n\n    // Enabling\n\n    // Resource binding first\n    await next();\n\n    const promiseEnable = enable(entity, sm);\n\n    if (sm.outbound_q.length > 0) {\n      throw new Error(\n        \"Stream Management assertion failure, queue should be empty after enable\",\n      );\n    }\n\n    // > The counter for an entity's own sent stanzas is set to zero and started after sending either <enable/> or <enabled/>.\n    // https://xmpp.org/extensions/xep-0198.html#example-7\n    sm.outbound = 0;\n\n    try {\n      const response = await promiseEnable;\n      enabled(response.attrs);\n    } catch {\n      sm.enabled = false;\n      sm.enableSent = false;\n    }\n  });\n}\n\nexport function enable(entity, sm) {\n  return procedure(entity, makeEnableElement({ sm }), (element, done) => {\n    if (element.is(\"enabled\", NS)) {\n      return done(element);\n    } else if (element.is(\"failed\", NS)) {\n      throw XMPPError.fromElement(element);\n    }\n  });\n}\n\nexport async function resume(entity, sm) {\n  return procedure(entity, makeResumeElement({ sm }), (element, done) => {\n    if (element.is(\"resumed\", NS)) {\n      return done(element);\n    } else if (element.is(\"failed\", NS)) {\n      throw XMPPError.fromElement(element);\n    }\n  });\n}\n","import { EventEmitter } from \"@xmpp/events\";\nimport xml from \"@xmpp/xml\";\nimport { datetime } from \"@xmpp/time\";\nimport { setupBind2 } from \"./bind2.js\";\nimport { setupSasl2 } from \"./sasl2.js\";\nimport { setupStreamFeature } from \"./stream-feature.js\";\n\n// https://xmpp.org/extensions/xep-0198.html\n\nexport const NS = \"urn:xmpp:sm:3\";\n\nexport function makeEnableElement({ sm }) {\n  return xml(\"enable\", {\n    xmlns: NS,\n    max: sm.preferredMaximum,\n    resume: \"true\",\n  });\n}\n\nexport function makeResumeElement({ sm }) {\n  return xml(\"resume\", { xmlns: NS, h: sm.inbound, previd: sm.id });\n}\n\nexport default function streamManagement({\n  streamFeatures,\n  entity,\n  middleware,\n  bind2,\n  sasl2,\n}) {\n  let timeoutTimeout = null;\n  let requestAckTimeout = null;\n  let requestAckDebounce = null;\n\n  const sm = new EventEmitter();\n  Object.assign(sm, {\n    preferredMaximum: null,\n    enabled: false,\n    enableSent: false,\n    id: \"\",\n    outbound_q: [],\n    outbound: 0,\n    inbound: 0,\n    max: null,\n    timeout: 60_000,\n    requestAckInterval: 30_000,\n    requestAckDebounce: 250,\n  });\n\n  async function sendAck() {\n    try {\n      await entity.send(xml(\"a\", { xmlns: NS, h: sm.inbound }));\n    } catch {}\n  }\n\n  entity.on(\"disconnect\", () => {\n    clearTimeout(timeoutTimeout);\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n    sm.enabled = false;\n    sm.enableSent = false;\n  });\n\n  // It is RECOMMENDED that initiating entities (usually clients) send an element right before they gracefully close the stream, in order to inform the peer about received stanzas\n  entity.hook(\"close\", async () => {\n    if (!sm.enabled) return;\n    await sendAck();\n  });\n\n  async function resumed(resumed) {\n    sm.enabled = true;\n    ackQueue(+resumed.attrs.h);\n    let q = sm.outbound_q;\n    sm.outbound_q = [];\n    // This will trigger the middleware and re-add to the queue\n    await entity.sendMany(q.map((item) => queueToStanza({ entity, item })));\n    sm.emit(\"resumed\");\n    entity._ready(true);\n    scheduleRequestAck();\n  }\n\n  function failed() {\n    sm.enabled = false;\n    sm.enableSent = false;\n    sm.id = \"\";\n    failQueue();\n  }\n\n  function ackQueue(n) {\n    const oldOutbound = sm.outbound;\n    for (let i = 0; i < +n - oldOutbound; i++) {\n      const item = sm.outbound_q.shift();\n      sm.outbound++;\n      sm.emit(\"ack\", item.stanza);\n    }\n  }\n\n  function failQueue() {\n    let item;\n    while ((item = sm.outbound_q.shift())) {\n      sm.emit(\"fail\", item.stanza);\n    }\n    sm.outbound = 0;\n  }\n\n  function enabled({ id, max }) {\n    sm.enabled = true;\n    sm.id = id;\n    sm.max = max;\n    // > The counter for the received stanzas ('h') is set to zero and started after receiving either <enable/> or <enabled/>.\n    // https://xmpp.org/extensions/xep-0198.html#example-7\n    sm.inbound = 0;\n    scheduleRequestAck();\n  }\n\n  entity.on(\"offline\", () => {\n    failQueue();\n    sm.inbound = 0;\n    sm.enabled = false;\n    sm.enableSent = false;\n    sm.id = \"\";\n  });\n\n  middleware.use(async (context, next) => {\n    const { stanza } = context;\n    clearTimeout(timeoutTimeout);\n    if ([\"presence\", \"message\", \"iq\"].includes(stanza.name)) {\n      sm.inbound += 1;\n    } else if (stanza.is(\"r\", NS)) {\n      // > When an <r/> element (\"request\") is received, the recipient MUST acknowledge it by sending an <a/> element to the sender containing a value of 'h' that is equal to the number of stanzas handled by the recipient of the <r/> element.\n      await sendAck();\n    } else if (stanza.is(\"a\", NS)) {\n      // > When a party receives an <a/> element, it SHOULD keep a record of the 'h' value returned as the sequence number of the last handled outbound stanza for the current stream (and discard the previous value).\n      ackQueue(+stanza.attrs.h);\n    }\n\n    scheduleRequestAck();\n\n    return next();\n  });\n\n  if (bind2) {\n    setupBind2({ bind2, sm, failed, enabled });\n  }\n  if (sasl2) {\n    setupSasl2({ sasl2, sm, failed, resumed });\n  }\n\n  // Periodically send r to check the connection\n  // If a stanza goes out it will cancel this and set a sooner timer\n  function scheduleRequestAck(timeout = sm.requestAckInterval) {\n    clearTimeout(requestAckTimeout);\n\n    if (!sm.enabled) return;\n    if (!timeout) return;\n\n    requestAckTimeout = setTimeout(requestAck, timeout);\n  }\n\n  function requestAck() {\n    clearTimeout(timeoutTimeout);\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n\n    if (!sm.enabled) return;\n\n    if (sm.timeout) {\n      timeoutTimeout = setTimeout(\n        () => entity.disconnect().catch(() => {}),\n        sm.timeout,\n      );\n    }\n    entity.send(xml(\"r\", { xmlns: NS })).catch(() => {});\n\n    scheduleRequestAck();\n  }\n\n  middleware.filter((context, next) => {\n    const { stanza } = context;\n    if (stanza.is(\"enable\", NS)) {\n      sm.enableSent = true;\n    }\n    if (!sm.enabled && !sm.enableSent) return next();\n    if (![\"presence\", \"message\", \"iq\"].includes(stanza.name)) return next();\n\n    sm.outbound_q.push({ stanza, stamp: datetime() });\n    // Debounce requests so we send only one after a big run of stanza together\n    clearTimeout(requestAckTimeout);\n    clearTimeout(requestAckDebounce);\n    requestAckDebounce = setTimeout(requestAck, sm.requestAckDebounce);\n\n    return next();\n  });\n\n  if (streamFeatures) {\n    setupStreamFeature({\n      streamFeatures,\n      sm,\n      entity,\n      resumed,\n      failed,\n      enabled,\n    });\n  }\n\n  return sm;\n}\n\nfunction queueToStanza({ entity, item }) {\n  const { stanza, stamp } = item;\n  if (\n    stanza.name === \"message\" &&\n    !stanza.getChild(\"delay\", \"urn:xmpp:delay\")\n  ) {\n    stanza.append(\n      xml(\"delay\", {\n        xmlns: \"urn:xmpp:delay\",\n        from: entity.jid.toString(),\n        stamp,\n      }),\n    );\n  }\n  return stanza;\n}\n","import { NS, makeEnableElement } from \"./index.js\";\n\nexport function setupBind2({ bind2, sm, failed, enabled }) {\n  bind2.use(\n    NS,\n    // https://xmpp.org/extensions/xep-0198.html#inline-examples\n    (_element) => {\n      return makeEnableElement({ sm });\n    },\n    async (element) => {\n      if (element.is(\"enabled\")) {\n        enabled(element.attrs);\n      } else if (element.is(\"failed\")) {\n        // const error = StreamError.fromElement(element)\n        failed();\n      }\n    },\n  );\n}\n","import { NS, makeResumeElement } from \"./index.js\";\n\nexport function setupSasl2({ sasl2, sm, failed, resumed }) {\n  sasl2.use(\n    NS,\n    (element) => {\n      if (!element.is(\"sm\")) return;\n      if (sm.id) return makeResumeElement({ sm });\n    },\n    (element) => {\n      if (element.is(\"resumed\")) {\n        resumed(element);\n      } else if (element.is(\"failed\")) {\n        // const error = StreamError.fromElement(element)\n        failed();\n      }\n    },\n  );\n}\n","import xml from \"@xmpp/xml\";\n\nconst NS = \"urn:xmpp:bind:0\";\n\nexport default function bind2({ sasl2, entity }, tag) {\n  const features = new Map();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"bind\", NS)) return;\n\n      tag = typeof tag === \"function\" ? await tag() : tag;\n\n      const sessionFeatures = await getSessionFeatures({ element, features });\n\n      return xml(\n        \"bind\",\n        { xmlns: \"urn:xmpp:bind:0\" },\n        tag && xml(\"tag\", null, tag),\n        ...sessionFeatures,\n      );\n    },\n    (element) => {\n      if (!element.is(\"bound\")) return;\n      entity._ready(false);\n      for (const child of element.getChildElements()) {\n        const feature = features.get(child.getNS());\n        feature?.[1]?.(child);\n      }\n    },\n  );\n\n  return {\n    use(ns, req, res) {\n      features.set(ns, [req, res]);\n    },\n  };\n}\n\nfunction getSessionFeatures({ element, features }) {\n  const promises = [];\n\n  const inline = element.getChild(\"inline\");\n  if (!inline) return promises;\n\n  for (const element of inline.getChildElements()) {\n    const xmlns = element.attrs.var;\n    const feature = features.get(xmlns);\n    if (!feature) continue;\n    promises.push(feature[0](element));\n  }\n\n  return Promise.all(promises);\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/factory'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/factory'], factory);\n  }\n}(this, function(exports, module, Factory) {\n  \n  exports = module.exports = Factory;\n  exports.Factory = Factory;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n  \n  /**\n   * `Factory` constructor.\n   *\n   * @api public\n   */\n  function Factory() {\n    this._mechs = [];\n  }\n  \n  /**\n   * Utilize the given `mech` with optional `name`, overridding the mechanism's\n   * default name.\n   *\n   * Examples:\n   *\n   *     factory.use(FooMechanism);\n   *\n   *     factory.use('XFOO', FooMechanism);\n   *\n   * @param {String|Mechanism} name\n   * @param {Mechanism} mech\n   * @return {Factory} for chaining\n   * @api public\n   */\n  Factory.prototype.use = function(name, mech) {\n    if (!mech) {\n      mech = name;\n      name = mech.prototype.name;\n    }\n    this._mechs.push({ name: name, mech: mech });\n    return this;\n  };\n  \n  /**\n   * Create a new mechanism from supported list of `mechs`.\n   *\n   * If no mechanisms are supported, returns `null`.\n   *\n   * Examples:\n   *\n   *     var mech = factory.create(['FOO', 'BAR']);\n   *\n   * @param {Array} mechs\n   * @return {Mechanism}\n   * @api public\n   */\n  Factory.prototype.create = function(mechs) {\n    for (var i = 0, len = this._mechs.length; i < len; i++) {\n      for (var j = 0, jlen = mechs.length; j < jlen; j++) {\n        var entry = this._mechs[i];\n        if (entry.name == mechs[j]) {\n          return new entry.mech();\n        }\n      }\n    }\n    return null;\n  };\n\n  exports = module.exports = Factory;\n  \n}));\n","import { EventEmitter } from \"@xmpp/events\";\nimport { getAvailableMechanisms } from \"@xmpp/sasl\";\nimport SASLError from \"@xmpp/sasl/lib/SASLError.js\";\nimport xml from \"@xmpp/xml\";\nimport SASLFactory from \"saslmechanisms\";\n\nconst NS = \"urn:xmpp:fast:0\";\n\nexport default function fast({ sasl2, entity }) {\n  const saslFactory = new SASLFactory();\n\n  let token;\n\n  const fast = new EventEmitter();\n  Object.assign(fast, {\n    mechanism: null,\n    mechanisms: [],\n    async saveToken(t) {\n      token = t;\n    },\n    async fetchToken() {\n      return token;\n    },\n    async deleteToken() {\n      token = null;\n    },\n    async save(token) {\n      try {\n        await this.saveToken(token);\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async fetch() {\n      try {\n        return this.fetchToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    async delete() {\n      try {\n        await this.deleteToken();\n      } catch (err) {\n        entity.emit(\"error\", err);\n      }\n    },\n    saslFactory,\n    async auth({\n      authenticate,\n      entity,\n      userAgent,\n      credentials,\n      streamFeatures,\n      features,\n    }) {\n      // Unavailable\n      if (!fast.mechanism) {\n        return false;\n      }\n\n      const { token } = credentials;\n      if (!isTokenValid(token, fast.mechanisms)) {\n        return onInvalidToken();\n      }\n\n      try {\n        await authenticate({\n          saslFactory: fast.saslFactory,\n          mechanism: token.mechanism,\n          credentials: {\n            ...credentials,\n            password: token.token,\n          },\n          streamFeatures: [\n            ...streamFeatures,\n            xml(\"fast\", {\n              xmlns: NS,\n            }),\n          ],\n          entity,\n          userAgent,\n          features,\n        });\n        return true;\n      } catch (err) {\n        if (\n          err instanceof SASLError &&\n          [\"not-authorized\", \"credentials-expired\"].includes(err.condition)\n        ) {\n          return onInvalidToken();\n        }\n        entity.emit(\"error\", err);\n        return false;\n      }\n\n      async function onInvalidToken() {\n        await fast.delete();\n        requestToken(streamFeatures);\n        return false;\n      }\n    },\n  });\n\n  function requestToken(streamFeatures) {\n    streamFeatures.push(\n      xml(\"request-token\", {\n        xmlns: NS,\n        mechanism: fast.mechanism,\n      }),\n    );\n  }\n\n  function reset() {\n    fast.mechanism = null;\n    fast.mechanisms = [];\n  }\n  reset();\n\n  sasl2.use(\n    NS,\n    async (element) => {\n      if (!element.is(\"fast\", NS)) return reset();\n\n      fast.available = true;\n\n      const mechanisms = getAvailableMechanisms(element, NS, saslFactory);\n      const mechanism = mechanisms[0];\n\n      if (!mechanism) return reset();\n      fast.mechanisms = mechanisms;\n      fast.mechanism = mechanism;\n\n      // The rest is handled by @xmpp/sasl2\n    },\n    async (element) => {\n      if (element.is(\"token\", NS)) {\n        await fast.save({\n          // The token is bound by the mechanism\n          // > Servers MUST bind tokens to the mechanism selected by the client in its original request, and reject attempts to use them with other mechanisms.\n          mechanism: fast.mechanism,\n          token: element.attrs.token,\n          expiry: element.attrs.expiry,\n        });\n      }\n    },\n  );\n\n  return fast;\n}\n\nexport function isTokenValid(token, mechanisms) {\n  if (!token) return false;\n\n  // Avoid an error round trip if the server does not support the token mechanism anymore\n  if (!mechanisms.includes(token.mechanism)) {\n    return false;\n  }\n\n  // Avoid an error round trip if the token is already expired\n  if (new Date(token.expiry) <= new Date()) {\n    return false;\n  }\n\n  return true;\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * PLAIN `Mechanism` constructor.\n   *\n   * This class implements the PLAIN SASL mechanism.\n   *\n   * The PLAIN SASL mechanism provides support for exchanging a clear-text\n   * username and password.  This mechanism should not be used without adequate\n   * security provided by an underlying transport layer. \n   *\n   * References:\n   *  - [RFC 4616](http://tools.ietf.org/html/rfc4616)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'PLAIN';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using given credential.\n   *\n   * Options:\n   *  - `username`\n   *  - `password`\n   *  - `authzid`   authorization identity (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    var str = '';\n    str += cred.authzid || '';\n    str += '\\0';\n    str += cred.username;\n    str += '\\0';\n    str += cred.password;\n    return str;\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @return {Mechanism} for chaining\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n    return this;\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-plain\";\n\nexport default function saslPlain(sasl) {\n  sasl.use(mech);\n}\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports,\n            module,\n            require('./lib/mechanism'));\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports',\n            'module',\n            './lib/mechanism'], factory);\n  }\n}(this, function(exports, module, Mechanism) {\n\n  exports = module.exports = Mechanism;\n  exports.Mechanism = Mechanism;\n  \n}));\n","(function(root, factory) {\n  if (typeof exports === 'object') {\n    // CommonJS\n    factory(exports, module);\n  } else if (typeof define === 'function' && define.amd) {\n    // AMD\n    define(['exports', 'module'], factory);\n  }\n}(this, function(exports, module) {\n\n  /**\n   * ANONYMOUS `Mechanism` constructor.\n   *\n   * This class implements the ANONYMOUS SASL mechanism.\n   *\n   * The ANONYMOUS SASL mechanism provides support for permitting anonymous\n   * access to various services\n   *\n   * References:\n   *  - [RFC 4505](http://tools.ietf.org/html/rfc4505)\n   *\n   * @api public\n   */\n  function Mechanism() {\n  }\n  \n  Mechanism.prototype.name = 'ANONYMOUS';\n  Mechanism.prototype.clientFirst = true;\n  \n  /**\n   * Encode a response using optional trace information.\n   *\n   * Options:\n   *  - `trace`  trace information (optional)\n   *\n   * @param {Object} cred\n   * @api public\n   */\n  Mechanism.prototype.response = function(cred) {\n    return cred.trace || '';\n  };\n  \n  /**\n   * Decode a challenge issued by the server.\n   *\n   * @param {String} chal\n   * @api public\n   */\n  Mechanism.prototype.challenge = function(chal) {\n  };\n\n  exports = module.exports = Mechanism;\n  \n}));\n","import mech from \"sasl-anonymous\";\n\n/**\n * [XEP-0175: Best Practices for Use of SASL ANONYMOUS](https://xmpp.org/extensions/xep-0175.html)\n * [RFC-4504: Anonymous Simple Authentication and Security Layer (SASL) Mechanism](https://tools.ietf.org/html/rfc4505)\n */\n\nexport default function saslAnonymous(sasl) {\n  sasl.use(mech);\n}\n","/* eslint-disable n/no-unsupported-features/node-builtins */\n\n// https://datatracker.ietf.org/doc/draft-schmaus-kitten-sasl-ht/\n// https://developer.mozilla.org/en-US/docs/Web/API/Web_Crypto_API\n\nexport function Mechanism() {}\n\nMechanism.prototype.Mechanism = Mechanism;\nMechanism.prototype.name = \"HT-SHA-256-NONE\";\nMechanism.prototype.clientFirst = true;\n\nMechanism.prototype.response = async function response({ username, password }) {\n  this.key = await crypto.subtle.importKey(\n    \"raw\",\n    new TextEncoder().encode(password),\n    // https://developer.mozilla.org/en-US/docs/Web/API/HmacImportParams\n    { name: \"HMAC\", hash: \"SHA-256\" },\n    false, // extractable\n    [\"sign\", \"verify\"],\n  );\n  const signature = await crypto.subtle.sign(\n    \"HMAC\",\n    this.key,\n    new TextEncoder().encode(\"Initiator\"),\n  );\n  return `${username}\\0${String.fromCodePoint(...new Uint8Array(signature))}`;\n};\n\nMechanism.prototype.final = async function final(data) {\n  const signature = Uint8Array.from(data, (c) => c.codePointAt(0));\n  // https://developer.mozilla.org/en-US/docs/Web/API/SubtleCrypto/verify\n  const result = await crypto.subtle.verify(\n    \"HMAC\",\n    this.key,\n    signature,\n    new TextEncoder().encode(\"Responder\"),\n  );\n  if (result !== true) {\n    throw new Error(\"Responder message from server was wrong\");\n  }\n};\n\nexport default function saslHashedToken(sasl) {\n  sasl.use(Mechanism);\n}\n","import { xml, jid, Client } from \"@xmpp/client-core\";\nimport getDomain from \"./lib/getDomain.js\";\nimport createOnAuthenticate from \"./lib/createOnAuthenticate.js\";\n\nimport _reconnect from \"@xmpp/reconnect\";\nimport _websocket from \"@xmpp/websocket\";\nimport _tcp from \"@xmpp/tcp\";\nimport _tls from \"@xmpp/tls\";\nimport _middleware from \"@xmpp/middleware\";\nimport _streamFeatures from \"@xmpp/stream-features\";\nimport _iqCaller from \"@xmpp/iq/caller.js\";\nimport _iqCallee from \"@xmpp/iq/callee.js\";\nimport _resolve from \"@xmpp/resolve\";\nimport _starttls from \"@xmpp/starttls\";\nimport _sasl2 from \"@xmpp/sasl2\";\nimport _sasl from \"@xmpp/sasl\";\nimport _resourceBinding from \"@xmpp/resource-binding\";\nimport _streamManagement from \"@xmpp/stream-management\";\nimport _bind2 from \"@xmpp/client-core/src/bind2/bind2.js\";\nimport _fast from \"@xmpp/client-core/src/fast/fast.js\";\n\nimport SASLFactory from \"saslmechanisms\";\nimport scramsha1 from \"@xmpp/sasl-scram-sha-1\";\nimport plain from \"@xmpp/sasl-plain\";\nimport anonymous from \"@xmpp/sasl-anonymous\";\nimport htsha256none from \"@xmpp/sasl-ht-sha-256-none\";\n\nfunction client(options = {}) {\n  let { resource, credentials, username, password, userAgent, ...params } =\n    options;\n\n  const { domain, service } = params;\n  if (!domain && service) {\n    params.domain = getDomain(service);\n  }\n\n  const entity = new Client(params);\n  if (username && params.domain) {\n    entity.jid = jid(username, params.domain);\n  }\n\n  const reconnect = _reconnect({ entity });\n  const websocket = _websocket({ entity });\n  const tcp = setupIfAvailable(_tcp, { entity });\n  const tls = setupIfAvailable(_tls, { entity });\n\n  const middleware = _middleware({ entity });\n  const streamFeatures = _streamFeatures({ middleware });\n  const iqCaller = _iqCaller({ middleware, entity });\n  const iqCallee = _iqCallee({ middleware, entity });\n  const resolve = _resolve({ entity });\n\n  // SASL mechanisms - order matters and define priority\n  const saslFactory = new SASLFactory();\n  const mechanisms = Object.entries({\n    ...(typeof scramsha1 === \"function\" && { scramsha1 }),\n    plain,\n    anonymous,\n  }).map(([k, v]) => ({ [k]: v(saslFactory) }));\n\n  // eslint-disable-next-line n/no-unsupported-features/node-builtins\n  userAgent ??= xml(\"user-agent\", { id: globalThis.crypto.randomUUID() });\n\n  // Stream features - order matters and define priority\n  const starttls = setupIfAvailable(_starttls, { streamFeatures });\n  const sasl2 = _sasl2(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent),\n  );\n\n  const fast = _fast({\n    sasl2,\n    entity,\n  });\n  sasl2.setup({ fast });\n\n  // SASL2 inline features\n  const bind2 = _bind2({ sasl2, entity }, resource);\n\n  // FAST mechanisms - order matters and define priority\n  htsha256none(fast.saslFactory);\n\n  // Stream features - order matters and define priority\n  const sasl = _sasl(\n    { streamFeatures, saslFactory },\n    createOnAuthenticate(credentials ?? { username, password }, userAgent),\n  );\n  const streamManagement = _streamManagement({\n    streamFeatures,\n    entity,\n    middleware,\n    bind2,\n    sasl2,\n  });\n  const resourceBinding = _resourceBinding(\n    { iqCaller, streamFeatures },\n    resource,\n  );\n\n  iqCallee?.get(\"urn:xmpp:ping\", \"ping\", () => {\n    return {};\n  });\n\n  return Object.assign(entity, {\n    entity,\n    reconnect,\n    tcp,\n    websocket,\n    tls,\n    middleware,\n    streamFeatures,\n    iqCaller,\n    iqCallee,\n    resolve,\n    starttls,\n    saslFactory,\n    sasl2,\n    sasl,\n    resourceBinding,\n    streamManagement,\n    mechanisms,\n    bind2,\n    fast,\n  });\n}\n\n// In browsers and react-native some packages are excluded\n// see package.json and https://metrobundler.dev/docs/configuration/#resolvermainfields\n// in which case the default import returns an empty object\nfunction setupIfAvailable(module, ...args) {\n  if (typeof module !== \"function\") {\n    return undefined;\n  }\n\n  return module(...args);\n}\n\nexport { xml, jid, client };\n","export default function getDomain(service) {\n  const domain = service.split(\"://\")[1] || service;\n  return domain.split(\":\")[0].split(\"/\")[0];\n}\n","/**\n * References\n * https://xmpp.org/rfcs/rfc6120.html#streams-negotiation Stream Negotiation\n * https://xmpp.org/extensions/xep-0170.html XEP-0170: Recommended Order of Stream Feature Negotiation\n * https://xmpp.org/registrar/stream-features.html XML Stream Features\n */\n\nexport default function streamFeatures({ middleware }) {\n  function use(name, xmlns, handler) {\n    return middleware.use((ctx, next) => {\n      const { stanza } = ctx;\n      if (!stanza.is(\"features\", \"http://etherx.jabber.org/streams\"))\n        return next();\n      const feature = stanza.getChild(name, xmlns);\n      if (!feature) return next();\n      return handler(ctx, next, feature);\n    });\n  }\n\n  return {\n    use,\n  };\n}\n"],"names":["XMPP","exports","domain","EventHandlers","EventEmitter","init","call","this","$getMaxListeners","that","undefined","_maxListeners","defaultMaxListeners","_addListener","target","type","listener","prepend","m","events","existing","e","TypeError","_events","newListener","emit","_eventsCount","unshift","push","warned","length","w","Error","name","emitter","count","console","warn","log","_onceWrap","fired","g","removeListener","apply","arguments","listenerCount","evlistener","arrayClone","arr","i","copy","Array","prototype","Object","create","usingDomains","active","Domain","getPrototypeOf","setMaxListeners","n","isNaN","getMaxListeners","er","handler","len","args","doError","error","err","context","domainEmitter","domainThrown","isFn","self","listeners","emitNone","arg1","emitOne","arg2","emitTwo","arg3","emitThree","emitMany","addListener","on","prependListener","once","prependOnceListener","list","position","originalListener","index","k","pop","spliceOne","removeAllListeners","key","keys","ret","unwrapListeners","eventNames","Reflect","ownKeys","freeze","__proto__","default","TimeoutError","constructor","message","super","timeout","promise","ms","promiseDelay","Promise","resolve","setTimeout","delay","race","finally","clearTimeout","then","map","WeakMap","onoff","get","addEventListener","bind","off","removeEventListener","event","set","rejectEvent","reject","timeoutId","cleanup","onEvent","onError","reason","value","Deferred","procedure","entity","stanza","done","async","element","send","catch","subscribe","entries","unsubscribe","detect","local","replaceAll","String","raw","search","escape","unescape","JID","resource","setDomain","setLocal","setResource","Symbol","toPrimitive","hint","Number","NaN","toString","s","_domain","_local","getLocal","_resource","bare","equals","other","escaping","toLowerCase","getDomain","getResource","parse","resourceStart","indexOf","slice","atStart","jid","defineProperty","j","getDefaultExportFromCjs","x","equal","a","b","detectEscape","escapeLocal","unescapeLocal","escapeXMLTable","escapeXMLReplace","match","unescapeXMLTable","unescapeXMLReplace","num","parseInt","fromCodePoint","replace","result","start","end","previous","substring","require","Element","attrs","parent","children","setAttrs","is","xmlns","getName","getNS","idx","prefix","findNS","attr","getXmlns","namespaces","hasOwnProperty","assign","getAttr","join","getChild","getChildren","child","getChildByAttr","val","recursive","getChildrenByAttr","flat","getChildrenByFilter","filter","getText","text","getChildText","getChildElements","root","up","c","cnode","append","nodes","node","t","remove","el","write","_addChildren","writer","escapeXMLText","v","escapeXML","tree","module","isArray","__source","__self","SaxLtx","remainder","parseRemainder","tagName","endTag","selfClosing","attrQuote","attrQuoteChar","attrName","state","recordStart","_handleTagOpening","data","pos","endRecording","recorded","lt","quot","endcomment","endCDATA","charCodeAt","unescapeXML","substr","cData","startsWith","prevFirst","prevSecond","XMLError","Parser","parser","LtxParser","cursor","onStartElement","onEndElement","onText","str","_escapeExports","require_escape","xml","createElement","unescapeXMLText","XMPPError","condition","application","fromElement","second","third","StreamError","parseURI","URI","port","hostname","protocol","URL","parseHost","host","Connection","socketListeners","parserListeners","options","status","socket","isSecure","secure","_streamError","disconnect","_onData","onParserError","_detachParser","onSocketClosed","dirty","_detachSocket","_status","clean","onStreamClosed","_attachSocket","close","connect","_onElement","isStreamError","_onStreamError","isStanza","_onSeeOtherHost","service","includes","parseService","lang","open","_attachParser","_jid","id","_ready","resumed","_closeStream","_closeSocket","promiseOnline","Socket","socketParameters","headerElement","to","header","stop","runHooks","fragment","footer","footerElement","restart","sendReceive","all","string","isNonza","version","NS","hooks","Map","hook_events","Set","hook","assertHookEventName","has","add","unhook","handlers","item","find","Client","transports","Transport","sendMany","_findTransport","from","ANONYMOUS","PLAIN","createOnAuthenticate","credentials","userAgent","authenticate","mechanisms","fast","token","fetch","mechanism","username","password","getMechanism","Reconnect","_timeout","onDisconnect","#onDisconnect","scheduleReconnect","reconnect","CODE","NS_FRAMING","ConnectionWebSocket","elements","test","url","uri","WebSocket","errno","code","wasClean","fn","_starttls","middleware","next","dispatch","compose","koaComposeExports","Context","IncomingContext","OutgoingContext","ctx","errorHandler","reply","StanzaError","IQCaller","use","_route","isReply","deferred","delete","request","Math","random","xid","timeoutPromise","_childRequest","buildReply","buildReplyError","buildError","iqHandler","isQuery","isValidQuery","buildReplyResult","route","ns","compare","method","res","p","link","rel","href","split","sort","compareAltConnections","fetchURIs","http","records","endpoints","_resolve","srv","record","fallbackConnect","uris","shift","params","_connect","filterSupportedURIs","encode","globalThis","btoa","decode","atob","SASLError","getAvailableMechanisms","saslFactory","offered","_mechs","mech","sasl","streamFeatures","onAuthenticate","_next","creds","server","realm","serviceType","serviceName","clientFirst","response","challenge","resp","features","additionalData","final","aid","feature","sasl2","promises","inline","getStreamFeatures","fast_available","auth","req","setup","_fast","iqCaller","makeBindElement","resourceBinding","datetime","d","Date","toISOString","setupStreamFeature","sm","failed","enabled","makeResumeElement","resume","promiseEnable","makeEnableElement","enable","outbound_q","outbound","enableSent","max","preferredMaximum","h","inbound","previd","streamManagement","bind2","timeoutTimeout","requestAckTimeout","requestAckDebounce","sendAck","ackQueue","q","stamp","queueToStanza","scheduleRequestAck","failQueue","oldOutbound","requestAckInterval","requestAck","_element","setupBind2","setupSasl2","tag","sessionFeatures","var","getSessionFeatures","main$5","factory$1","Factory","mechs","jlen","entry","factory","SASLFactory","reset","saveToken","fetchToken","deleteToken","save","expiry","isTokenValid","onInvalidToken","requestToken","available","main$3","mechanism$3","Mechanism","cred","authzid","chal","saslPlain","main$1","mechanism$1","trace","mainExports","saslAnonymous","setupIfAvailable","crypto","subtle","importKey","TextEncoder","hash","signature","sign","Uint8Array","codePointAt","verify","client","r","_reconnect","websocket","_websocket","tcp","_tcp","tls","_tls","incoming","outgoing","incomingListener","outgoingListener","_middleware","_streamFeatures","_iqCaller","iqCallee","_iqCallee","plain","anonymous","randomUUID","starttls","_sasl2","_bind2","htsha256none","_sasl","_streamManagement","_resourceBinding"],"mappings":"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","x_google_ignoreList":[0,13,14,15,16,31,56,57,59,60,62,63]}