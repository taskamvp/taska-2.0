{"version":3,"file":"index.cjs","sources":["../src/platform.ts","../src/types/addressbook.ts","../src/types/auth.ts","../src/types/calls.ts","../src/types/chat.ts","../src/types/config.ts","../src/types/data.ts","../src/types/dialogs.ts","../src/types/janus.ts","../src/types/media.ts","../src/types/meetings.ts","../src/types/proxy.ts","../src/types/pushnotifications.ts","../src/config.ts","../src/Utils.ts","../src/AddressBook.ts","../src/Auth.ts","../src/messaging/xmpp.ts","../src/messaging/Dialogs.ts","../src/messaging/Messages.ts","../src/messaging/ChatUtils.ts","../src/messaging/Helpers.ts","../src/messaging/StreamManagement.ts","../src/messaging/PrivacyList.ts","../src/messaging/MultiUserChat.ts","../src/messaging/Chat.ts","../src/videocalling_conference/janus.js","../src/videocalling_conference/JanusClient.ts","../src/videocalling_conference/ConferenceSession.ts","../src/videocalling_conference/ConferenceClient.ts","../src/Data.ts","../src/Meetings.ts","../src/Proxy.ts","../src/PushNotifications.ts","../src/Storage.ts","../src/Users.ts","../src/videocalling/WebRTCHelpers.ts","../src/videocalling/WebRTCPeerConnection.ts","../src/videocalling/WebRTCSession.ts","../src/videocalling/WebRTCSignalingProcessor.ts","../src/videocalling/WebRTCSignalingProvider.ts","../src/videocalling/WebRTCClient.ts","../src/Whiteboard.ts","../src/LinkPreview.ts","../src/ConnectyCube.ts","../src/index.ts"],"sourcesContent":["declare global {\n  interface Window {\n    adapter: any;\n  }\n}\n\nexport const base64Encode = (str: string): string =>\n  isBrowser\n    ? btoa(encodeURIComponent(str).replace(/%([0-9A-F]{2})/g, (_, p1) => String.fromCharCode(parseInt(p1, 16))))\n    : Buffer.from(str).toString('base64');\n\nexport const sdkVersion = 'define_sdk_version_replacer';\nexport const isBrowser: boolean = typeof window === 'object' && typeof document === 'object';\nexport const isNodeJS: boolean =\n  typeof process === 'object' && typeof process.versions === 'object' && !!process.versions.node;\nexport const isReactNative: boolean = false;\nexport const isExpo: boolean = false;\n\nlet fetchImpl;\nlet FormDataImpl;\n\nif (isNodeJS) {\n  import('node-fetch').then((nodeFetch) => {\n    fetchImpl = nodeFetch.default || nodeFetch;\n  });\n  import('form-data').then((FormDataNode) => {\n    FormDataImpl = FormDataNode.default || FormDataNode;\n  });\n} else {\n  fetchImpl = fetch;\n  FormDataImpl = FormData;\n}\n\nexport { fetchImpl, FormDataImpl };\n\nexport const navigator = isBrowser ? window.navigator : undefined;\nexport const mediaDevices = isBrowser && navigator ? navigator.mediaDevices : undefined;\nexport const MediaStream = isBrowser ? window.MediaStream : undefined;\nexport const MediaStreamTrack = isBrowser ? window.MediaStreamTrack : undefined;\nexport const RTCIceCandidate = isBrowser ? window.RTCIceCandidate : undefined;\nexport const RTCPeerConnection = isBrowser ? window.RTCPeerConnection : undefined;\nexport const RTCRtpReceiver = isBrowser ? window.RTCRtpReceiver : undefined;\nexport const RTCRtpSender = isBrowser ? window.RTCRtpSender : undefined;\nexport const RTCSessionDescription = isBrowser ? window.RTCSessionDescription : undefined;\n\nexport const isWebRTCAvailable: boolean = isBrowser ? Boolean(mediaDevices && window?.RTCPeerConnection) : false;\n\nexport const adapter = isBrowser ? window.adapter : undefined;\n","import { ForceParams } from './common';\nimport { ConnectyCubeUsers } from './users';\n\nexport enum AddressBookUserDataType {\n  COMPACT = 1,\n  FULL = 0,\n}\n\nexport namespace ConnectyCubeAddressBook {\n  export type Contact = { name: string; phone: string; destroy?: number | string };\n  // Request parameters type\n  export type UploadParams = { udid?: string } & ForceParams;\n  export type GetRegisteredUsersParams = boolean | { udid?: string; compact: AddressBookUserDataType | number }; // 1 - compact user data, 0 - full user data\n  // Response data types\n  export type UploadResponse = {\n    deleted: number;\n    rejected: Record<string | number, string[]>;\n    created: number;\n    updated: number;\n  };\n  export type GetRegisteredUsersResponse = {\n    items: Partial<ConnectyCubeUsers.User> & { address_book_name: string }[];\n  };\n}\n","import { DateOrTimestamp } from './common';\nimport { ConnectyCubeUsers } from './users';\n\nexport enum LoginProviderNames {\n  FACEBOOK = 'facebook',\n  TWITTER = 'twitter',\n  FIREBASE_PHONE = 'firebase_phone',\n  FIREBASE_EMAIL = 'firebase_email',\n}\n\nexport namespace ConnectyCubeAuth {\n  export type Session = {\n    id: number;\n    user_id: number;\n    application_id: string | number;\n    token: string;\n    ts: DateOrTimestamp;\n    created_at: DateOrTimestamp;\n    updated_at: DateOrTimestamp;\n    user?: ConnectyCubeUsers.User | null;\n  };\n  export type LoginProviderKeys = { token: string; secret?: string };\n  export type LoginFirebaseKeys = { project_id: string | number; access_token: string };\n  export type LoginByLogin = { login: string; password: string };\n  export type LoginByEmail = { email: string; password: string };\n  export type LoginByGuest = { guest: '1'; full_name: string };\n  // Login by social providers\n  export type LoginByFacebook = {\n    provider: LoginProviderNames.FACEBOOK;\n    keys: LoginProviderKeys;\n  };\n  export type LoginByTwitter = {\n    provider: LoginProviderNames.TWITTER;\n    keys: LoginProviderKeys;\n  };\n  export type LoginByFirebasePhone = {\n    provider: LoginProviderNames.FIREBASE_PHONE;\n    firebase_phone: LoginFirebaseKeys;\n  };\n  export type LoginByFirebaseEmail = {\n    provider: LoginProviderNames.FIREBASE_EMAIL;\n    firebase_email: LoginFirebaseKeys;\n  };\n  // Request parameters type\n  export type LoginParams =\n    | LoginByLogin\n    | LoginByEmail\n    | LoginByGuest\n    | LoginByFacebook\n    | LoginByTwitter\n    | LoginByFirebasePhone\n    | LoginByFirebaseEmail;\n  export type GeneratedSessionParams = {\n    application_id: string | number;\n    auth_key: string;\n    user?: LoginByLogin | LoginByEmail | LoginByGuest;\n    provider?: LoginProviderNames;\n    keys?: LoginProviderKeys;\n    firebase_phone?: LoginFirebaseKeys;\n    firebase_email?: LoginFirebaseKeys;\n  };\n  // Response data type\n  export type LoginRawResponse = { user: ConnectyCubeUsers.User; [key: string]: any };\n  export type GetSessionRawResponse = { session: Session; [key: string]: any };\n}\n","import WebRTCSession from '../videocalling/WebRTCSession';\nimport WebRTCSignalingProvider from '../videocalling/WebRTCSignalingProvider';\n\nexport const CallSignalingModuleIdentifier = 'WebRTCVideoChat';\n\nexport enum CallSignalingType {\n  CALL = 'call',\n  ACCEPT = 'accept',\n  REJECT = 'reject',\n  STOP = 'hangUp',\n  RESTART = 'iceRestart',\n  RESTART_ACCEPT = 'iceRestartAccept',\n  CANDIDATE = 'iceCandidates',\n}\nexport enum CallSessionConnectionState {\n  UNDEFINED = 0,\n  CONNECTING = 1,\n  CONNECTED = 2,\n  FAILED = 3,\n  DISCONNECTED = 4,\n  CLOSED = 5,\n  COMPLETED = 6,\n}\nexport enum CallSessionState {\n  NEW = 1,\n  ACTIVE = 2,\n  STOPPED = 3,\n  REJECTED = 4,\n  CLOSED = 5,\n}\nexport enum CallType {\n  VIDEO = 1,\n  AUDIO = 2,\n}\nexport enum CallEvent {\n  CALL = 'call',\n  ACCEPT = 'accept',\n  REJECT = 'reject',\n  STOP = 'stop',\n  INVALID = 'invalid',\n  NOT_ANSWER = 'not-answer',\n  REMOTE_STREAM = 'remote-stream',\n  CONNECTION_STATE = 'connection-state',\n  CLOSE = 'close',\n  STATS_REPORT = 'stats-report',\n  DEVICES = 'devices',\n}\nexport enum PeerConnectionState {\n  NEW = 1,\n  CONNECTING = 2,\n  CHECKING = 3,\n  CONNECTED = 4,\n  DISCONNECTED = 5,\n  FAILED = 6,\n  CLOSED = 7,\n  COMPLETED = 8,\n}\n\nexport namespace ConnectyCubeCalls {\n  export type UserInfo = {\n    maxBandwidth?: number;\n    bandwidth?: number;\n    [key: string]: any;\n  };\n  export type ExtensionParams = {\n    callType?: CallType;\n    callerID?: number;\n    iceCandidates?: RTCIceCandidateInit[];\n    opponentsIDs?: number[];\n    userInfo?: UserInfo;\n    sessionID?: string;\n    [key: string]: any;\n  };\n  export type Session = WebRTCSession;\n  export type SignalingProvider = WebRTCSignalingProvider;\n  export type SessionParams = {\n    ID: string | null;\n    initiatorID: number;\n    opponentsIDs: number[];\n    callType: CallType;\n    signalingProvider: SignalingProvider;\n    currentUserID: number;\n    maxBandwidth: number;\n  };\n  // Listeners\n  export type OnCallListener = (session: Session, userInfo: UserInfo) => void;\n  export type OnAcceptCallListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnRejectCallListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnStopCallListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnInvalidEventsListener = (session: Session, userID: number, userInfo: UserInfo) => void;\n  export type OnUserNotAnswerListener = (session: Session, userID: number) => void;\n  export type OnRemoteStreamListener = (session: Session, userID: number, stream: MediaStream) => void;\n  export type OnSessionConnectionStateChangedListener = (\n    session: Session,\n    userID: number,\n    connectionState: CallSessionConnectionState\n  ) => void;\n  export type OnSessionCloseListener = (session: Session) => void;\n  export type OnCallStatsReportListener = (session: Session, userID: number, stats: any, error: Error) => void;\n  export type OnDevicesChangeListener = ((this: MediaDevices, ev: Event) => any) | ((ev: Event) => any);\n  export type Listeners =\n    | OnCallListener\n    | OnAcceptCallListener\n    | OnRejectCallListener\n    | OnStopCallListener\n    | OnInvalidEventsListener\n    | OnUserNotAnswerListener\n    | OnRemoteStreamListener\n    | OnSessionConnectionStateChangedListener\n    | OnSessionCloseListener\n    | OnCallStatsReportListener\n    | OnDevicesChangeListener;\n  export type ListenerName =\n    | 'onCallListener'\n    | 'onAcceptCallListener'\n    | 'onRejectCallListener'\n    | 'onStopCallListener'\n    | 'onInvalidEventsListener'\n    | 'onUserNotAnswerListener'\n    | 'onRemoteStreamListener'\n    | 'onSessionConnectionStateChangedListener'\n    | 'onSessionCloseListener'\n    | 'onCallStatsReport'\n    | 'onDevicesChangeListener';\n}\n","import { Element, Node } from '@xmpp/xml';\nimport { ConnectyCubeDialogs } from './dialogs';\nimport { ConnectyCubeUsers } from './users';\nimport Connection from '@xmpp/connection';\n\nexport enum ChatType {\n  CHAT = 'chat',\n  GROUPCHAT = 'groupchat',\n}\nexport enum ChatEvent {\n  STATUS = 'status',\n  ERROR = 'error',\n  DISCONNECTED = 'disconnected',\n  RECONNECTED = 'reconnected',\n  MESSAGE = 'message',\n  SYSTEM_MESSAGE = 'system-message',\n  ERROR_MESSAGE = 'error-message',\n  TYPING_MESSAGE = 'typing-message',\n  UPDATE_MESSAGE = 'update-message',\n  DELETE_MESSAGE = 'delete-message',\n  REACTIONS_MESSAGE = 'reactions-message',\n  DELIVERED_MESSAGE = 'delivered-message',\n  READ_MESSAGE = 'read-message',\n  SENT_MESSAGE = 'sent-message',\n  USER_LAST_ACTIVITY = 'user-last-activity',\n  JOIN = 'join',\n  LEAVE = 'leave',\n  KICK = 'kick',\n}\nexport enum PrivacyListAction {\n  ALLOW = 'allow',\n  DENY = 'deny',\n}\nexport namespace ConnectyCubeChat {\n  export type XmlElement = Element;\n  export type XmlNode = Node;\n  export type StanzaCallback = (stanza: Element) => void;\n  export type StanzasCallbacks = { [stanzaId: string]: StanzaCallback };\n  export type ConnectionParams = { userId: number; password: string };\n  export type ConnectionStatus = keyof Connection.StatusEvents;\n  export type MessageParams = {\n    id?: string;\n    type?: ChatType | string;\n    body?: string | null;\n    extension?: any;\n    markable?: 1;\n  };\n  export type Message = {\n    id: string;\n    dialog_id: string | null;\n    recipient_id: string | number | null;\n    is_forwarded: boolean;\n    type: ChatType | string;\n    body: string | null;\n    extension: any;\n    delay: any;\n    markable?: 1;\n  };\n  export type SystemMessageParams = {\n    id?: string;\n    body?: string | null;\n    extension?: any;\n  };\n  export type SystemMessage = {\n    id: string;\n    body: string;\n    userId: number;\n    extension: any;\n  };\n  export type MessageStatusParams = {\n    messageId: string;\n    dialogId: string;\n    userId: number;\n  };\n  export type EditMessageParams = {\n    to: string | number;\n    dialogId: string;\n    body: string;\n    originMessageId: string;\n    extension?: any;\n    last?: boolean;\n  };\n  export type DeleteMessageParams = {\n    to: string;\n    dialogId: string;\n    messageId: string;\n  };\n  export type LastActivity = {\n    userId: number | null;\n    seconds: number;\n  };\n  export type SearchParams = {\n    search_text?: string;\n    start_date?: number | string | Date;\n    end_date?: number | string | Date;\n    chat_dialog_ids?: string | string[];\n  };\n  export type SearchResult = {\n    results: {\n      dialogs: ConnectyCubeDialogs.Dialog[];\n      messages: any[];\n      users: ConnectyCubeUsers.User[];\n    };\n    [key: string]: any;\n  };\n  export type UserJIDParams = {\n    userId?: number;\n    resource?: string;\n    jid?: string;\n    [key: string]: any;\n  };\n  // XMPP client events and listeners\n  export type XMPPClientEvent = string | symbol;\n  export type XMPPClientListener = (...args: any[]) => void;\n  export type XMPPClientListeners = Map<XMPPClientEvent, XMPPClientListener>;\n  // Chat listeners\n  export type OnChatStatusListener = (status: ConnectionStatus) => void;\n  export type OnChatConnectionErrorListener = (error: Error) => void;\n  export type OnChatDisconnectedListener = () => void;\n  export type OnChatReconnectedListener = () => void;\n  export type OnMessageListener = (userId: number, message: Message) => void;\n  export type OnMessageSystemListener = (message: SystemMessage) => void;\n  export type OnMessageErrorListener = (messageId: string, error: { code: number; info: string }) => void;\n  export type OnMessageTypingListener = (typing: boolean, userId: number, dialogId: string) => void;\n  export type OnMessageUpdateListener = (\n    messageId: string,\n    isLast: boolean,\n    updatedBody: string,\n    dialogId: string,\n    userId: number,\n    extraParams: object | null\n  ) => void;\n  export type OnMessageDeleteListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageReactionsListener = (\n    messageId: string,\n    userId: number,\n    dialogId: string,\n    add: string,\n    remove: string\n  ) => void;\n  export type OnMessageDeliveredListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageReadListener = (messageId: string, dialogId: string, userId: number) => void;\n  export type OnMessageSentListener = (lost: MessageParams | null, sent: MessageParams | null) => void;\n  export type OnLastUserActivityListener = (userId: LastActivity['userId'], seconds: LastActivity['seconds']) => void;\n  export type OnDialogJoinListener = (dialogId: string, userId: number) => void;\n  export type OnDialogLeaveListener = (dialogId: string, userId: number) => void;\n  export type OnDialogKickListener = (dialogId: string, initiatorId: number) => void;\n  export type Listeners =\n    | OnChatStatusListener\n    | OnChatConnectionErrorListener\n    | OnChatDisconnectedListener\n    | OnChatReconnectedListener\n    | OnMessageListener\n    | OnMessageSystemListener\n    | OnMessageErrorListener\n    | OnMessageTypingListener\n    | OnMessageUpdateListener\n    | OnMessageDeleteListener\n    | OnMessageReactionsListener\n    | OnMessageDeliveredListener\n    | OnMessageReadListener\n    | OnMessageSentListener\n    | OnLastUserActivityListener\n    | OnDialogJoinListener\n    | OnDialogLeaveListener\n    | OnDialogKickListener;\n  export type ListenerName =\n    | 'onChatStatusListener'\n    | 'onConnectionErrorListener'\n    | 'onDisconnectedListener'\n    | 'onReconnectListener'\n    | 'onMessageListener'\n    | 'onSystemMessageListener'\n    | 'onMessageErrorListener'\n    | 'onMessageTypingListener'\n    | 'onMessageUpdateListener'\n    | 'onMessageDeleteListener'\n    | 'onMessageReactionsListener'\n    | 'onDeliveredStatusListener'\n    | 'onReadStatusListener'\n    | 'onSentMessageCallback'\n    | 'onLastUserActivityListener'\n    | 'onJoinOccupant'\n    | 'onLeaveOccupant'\n    | 'onKickOccupant';\n  // PrivacyList\n  export type PrivacyListItem = {\n    user_id: string | number;\n    action: PrivacyListAction | string;\n    mutualBlock?: boolean;\n  };\n  export type PrivacyList = {\n    name: string;\n    items: PrivacyListItem[];\n  };\n  export type PrivacyListNames = {\n    default: string | null;\n    active: string | null;\n    names: string[];\n  };\n  export type PrivacyListItemParams = {\n    value: string;\n    action: string;\n    order: number;\n    isMutual: boolean;\n  };\n}\n","import { Auth } from '.';\nimport { Config } from '../config';\n\nexport enum ChatProtocol {\n  BOSH = 1,\n  WS = 2,\n}\nexport enum JanusDebugMode {\n  ALL = 'all',\n  TRACE = 'trace',\n  DEBUG = 'debug',\n  VDEBUG = 'vdebug',\n  LOG = 'log',\n  WARN = 'warn',\n  ERROR = 'error',\n}\n\nexport namespace ConnectyCubeConfig {\n  export type Object = Partial<Config>;\n  export type Credentials = {\n    appId: number | string;\n    authKey?: string;\n    token?: string;\n    systemApiKey?: string;\n    authSecret?: string;\n  };\n  export type Endpoints = { api: string; chat: string; muc?: string };\n  export type ChatProtocolURLs = { bosh?: string; websocket?: string; active: ChatProtocol | number };\n  export type ChatStreamManagement = { enable: boolean; acknowledgementTimeout?: number };\n  export type ChatReconnect = { enable: boolean; timeInterval: number };\n  export type Chat = {\n    streamManagement?: ChatStreamManagement;\n    reconnect?: ChatReconnect;\n  };\n  export type VideochatIceServer = {\n    urls: string | string[];\n    url?: string;\n    credential?: string;\n    username?: string;\n  };\n  export type Videochat = {\n    alwaysRelayCalls?: boolean;\n    answerTimeInterval?: number;\n    dialingTimeInterval?: number;\n    disconnectTimeInterval?: number;\n    statsReportTimeInterval?: number | null;\n    iceServers?: VideochatIceServer[];\n  };\n  export type JanusDebug = JanusDebugMode.ALL | JanusDebugMode[] | boolean;\n  export type Conference = {\n    server: string;\n    debug?: JanusDebug;\n  };\n  export type Whiteboard = {\n    server: string;\n  };\n  export type LinkPreview = {\n    server: string;\n  };\n  export type ApiRoutes = {\n    session: string;\n    login: string;\n    users: string;\n    chat: string;\n    blobs: string;\n    subscriptions: string;\n    events: string;\n    data: string;\n    addressbook: string;\n    meetings: string;\n    whiteboards: string;\n    unfurl: string;\n    calls: string;\n    type: string;\n  };\n  export type SessionHandlerResponse = () => void;\n  export type SessionRetryCallback = (session: Partial<Auth.Session>) => void;\n  export type SessionExpiredListener = (\n    handler: SessionHandlerResponse,\n    retry: SessionRetryCallback\n  ) => void | Promise<void>;\n  export type XMPPDataListener = (size: number) => number;\n  export type Listeners = {\n    sessionExpired?: SessionExpiredListener;\n    xmppDataWrite?: XMPPDataListener;\n    xmppDataRead?: XMPPDataListener;\n  };\n  export type Debug = { mode: number | boolean };\n  export type Options = {\n    creds?: Credentials;\n    endpoints?: Endpoints;\n    chatProtocol?: ChatProtocolURLs;\n    chat?: Chat;\n    videochat?: Videochat;\n    conference?: Conference;\n    whiteboard?: Whiteboard;\n    on?: Listeners;\n    timeout?: number;\n    debug?: Debug;\n  };\n}\n","import { DateOrTimestamp, SearchCondition } from './common';\n\nexport enum DataPermission {\n  CREATE = 'create',\n  READ = 'read',\n  UPDATE = 'update',\n  DELETE = 'delete',\n}\nexport enum DataPermissionAccess {\n  OPEN = 'open',\n  OWNER = 'owner',\n  NOT_ALLOWED = 'not_allowed',\n  OPEN_FOR_GROUPS = 'open_for_groups',\n  OPEN_FOR_USERS_IDS = 'open_for_users_ids',\n}\n\nexport namespace ConnectyCubeData {\n  export type PermissionOptions = {\n    access: DataPermissionAccess | string;\n    user_ids?: string[];\n    user_groups?: string[];\n  };\n  export type Permissions = Record<DataPermission | string, PermissionOptions>;\n  export type CreateRecord = Record<string, any> & {\n    permissions?: Permissions;\n  };\n  export type DataRecord = Record<string, any> & {\n    _id: string;\n    _parent_id: string | null;\n    created_at: DateOrTimestamp;\n    updated_at: DateOrTimestamp;\n    user_id: number;\n    permissions: Permissions;\n  };\n  // Request parameters type\n  export type CreateParams = CreateRecord | CreateRecord[];\n  export type ListParams =\n    | ({\n        sort_asc?: string;\n        sort_desc?: string;\n        skip?: number;\n        limit?: number;\n        count?: number;\n        output?: { include?: string[]; exclude?: string[] };\n        near?: string;\n      } & SearchCondition<any>)\n    | undefined;\n  export type ReadParams = { permissions: 1 };\n  export type UpdateOptions = {\n    [key: string]: any;\n    inc?: Record<string, number>;\n    pull?: Record<string, any>;\n    pull_with_filter?: Record<string, Record<string, any>>;\n    pull_all?: Record<string, any[]>;\n    pop?: Record<string, 1 | -1>;\n    push?: Record<string, any[]>;\n    add_to_set?: Record<string, any[]>;\n    update_by_index?: Record<string, Record<number, any>>;\n    search_criteria?: SearchCondition<any>;\n  };\n  // Response data types\n  export type ListResponse = { class_name: string; items: DataRecord[] };\n  export type ReadPermissionsResponse = { record_id: string; permissions: Permissions };\n  export type UpdateResponse = {\n    class_name: string;\n    skip?: number;\n    limit?: number;\n    total_found?: number;\n    not_found?: { ids: string[] };\n    items: DataRecord[];\n  };\n  export type DeleteResponse =\n    | {\n        SuccessfullyDeleted: { ids: string[] };\n        WrongPermissions: { ids: string[] };\n        NotFound: { ids: string[] };\n      }\n    | { total_deleted: number };\n}\n","import { ISODateString, SearchableProps, Timestamp } from './common';\nimport { ConnectyCubeUsers } from './users';\n\nexport enum DialogType {\n  PUBLIC = 1,\n  GROUP = 2,\n  PRIVATE = 3,\n  BROADCAST = 4,\n  MEETING = 5,\n}\nexport enum LastMessageMessageStatus {\n  SENT = 'sent',\n  DELIVERED = 'delivered',\n  READ = 'read',\n}\nexport enum DialogDateProp {\n  CREATED = 'created_at',\n  UPDATED = 'updated_at',\n  LAST_MESSAGE = 'last_message_date_sent',\n}\n\nexport namespace ConnectyCubeDialogs {\n  export type Dialog = {\n    _id: string;\n    name: string;\n    description: string | null;\n    photo: string | null;\n    type: DialogType | number;\n    user_id: number;\n    created_at: ISODateString;\n    updated_at: ISODateString;\n    xmpp_room_jid?: string | null;\n    admins_ids?: number[];\n    last_message: string | null;\n    last_message_date_sent?: Timestamp;\n    last_message_id: string | null;\n    last_message_user_id: number | null;\n    last_message_status: LastMessageMessageStatus | string | null;\n    occupants_ids: number[];\n    occupants_count?: number;\n    pinned_messages_ids?: string[];\n    unread_messages_count: number;\n    extensions?: { [key: string]: any };\n    permissions?: { allow_preview: boolean };\n  };\n  // Request parameters type\n  export type ListParams = SearchableProps<Dialog> & {\n    skip?: number;\n    limit?: number;\n    count?: number;\n    sort_asc?: DialogDateProp | string;\n    sort_desc?: DialogDateProp | string;\n  };\n  export type CreateParams = {\n    type: DialogType;\n    occupants_ids?: (string | number)[] | string;\n    admins_ids?: (string | number)[] | string;\n    name?: string;\n    photo?: string | null;\n    description?: string;\n    extensions?: { [key: string]: any };\n    permissions?: { allow_preview: boolean };\n  };\n  export type UpdateParams = {\n    push_all?: {\n      occupants_ids?: (string | number)[];\n      admins_ids?: (string | number)[];\n      pinned_messages_ids?: string[];\n    };\n    pull_all?: {\n      occupants_ids?: (string | number)[];\n      admins_ids?: (string | number)[];\n      pinned_messages_ids?: string[];\n    };\n    name?: string;\n    photo?: string | null;\n    description?: string;\n    extensions?: { [key: string]: any };\n    permissions?: { allow_preview: boolean };\n  };\n  export type GetPublicOccupantsParams = {\n    limit?: number;\n    skip?: number;\n  };\n  // Response data types\n  export type ListResponse = {\n    total_entries: number;\n    skip: number;\n    limit: number;\n    items: Dialog[];\n  };\n  export type DeleteResponse = {\n    SuccessfullyDeleted: { ids: string[] };\n    NotFound: { ids: string[] };\n    WrongPermissions: { ids: string[] };\n  };\n  export type GetNotificationsSettingsResponse = { notifications: { enabled: number | string } };\n  export type UpdateNotificationsSettingsResponse = { notifications: { enabled: number | string } };\n  export type GetPublicOccupantsResponse = { items: ConnectyCubeUsers.User[] };\n}\n","import ConferenceSession from '../videocalling_conference/ConferenceSession';\n\nexport enum DeviceInputType {\n  VIDEO = 'videoinput',\n  AUDIO = 'audioinput',\n}\nexport enum JanusEvent {\n  PARTICIPANT_JOINED = 'participant_joined',\n  PARTICIPANT_LEFT = 'participant_left',\n  LOCAL_STREAM = 'local_stream',\n  REMOTE_STREAM = 'remote_stream',\n  REMOTE_TRACKS_UPDATED = 'remote_tracks_updated',\n  DATA_CHANNEL_OPEN = 'data_channel_open',\n  DATA_CHANNEL_MESSAGE = 'data_channel_message',\n  ERROR = 'error',\n}\nexport enum JanusCallType {\n  VIDEO = 'video',\n  AUDIO = 'audio',\n}\nexport enum JanusMediaTrackReason {\n  CREATED = 'created',\n  ENDED = 'ended',\n  MUTE = 'mute',\n  UNMUTE = 'unmute',\n}\nexport enum ConferenceEvent {\n  JOIN = 'join',\n  LEFT = 'left',\n  SLOW_LINK = 'slow-link',\n  REMOTE_TRACKS_UPDATED = 'remote-tracks',\n  REMOTE_STREAM = 'remote-stream',\n  REMOTE_CONNECTION_STATE = 'remote-connection-state',\n  DATA_CHANNEL_OPENED = 'data-channel-opened',\n  DATA_CHANNEL_MESSAGE = 'data-channel-message',\n  SESSION_CONNECTION_STATE = 'session-connection-state',\n  ERROR = 'error',\n}\n\nexport namespace ConnectyCubeJanus {\n  export interface SuccessErrorCallbacks {\n    success?: (...args: any[]) => void;\n    error?: (error: any) => void;\n  }\n  export interface InitCallbacks extends SuccessErrorCallbacks {\n    destroyed?: () => void;\n    timeoutSessionCallback?: () => void;\n  }\n  export interface PluginCallbacks extends SuccessErrorCallbacks {\n    localStream?: MediaStream;\n    displayName?: string;\n    iceState?: (iceState: any) => void;\n    slowLink?: (uplink: any, nacks: any) => void;\n    consentDialog?: (on: any) => void;\n    mediaState?: (medium: any, on: any) => void;\n    webrtcState?: (on: any) => void;\n    oncleanup?: () => void;\n  }\n  export type Session = ConferenceSession;\n  export interface RequestCallbacks extends SuccessErrorCallbacks {\n    displayName?: string;\n  }\n  // Listeners\n  export type OnParticipantJoinedListener = (\n    session: Session,\n    userId: number,\n    userName: string,\n    isExist: boolean\n  ) => void;\n  export type OnParticipantLeftListener = (session: Session, ...args: any[]) => void;\n  export type OnSlowLinkListener = (session: Session, userId: number | null, uplink: any, nacks: any) => void;\n  export type OnRemoteStreamListener = (session: Session, userId: number, stream: MediaStream) => void;\n  export type OnRemoteTracksUpdatedListener = (\n    session: Session,\n    userId: number,\n    track: MediaStreamTrack,\n    eventType: any\n  ) => void;\n  export type OnRemoteConnectionStateChangedListener = (session: Session, userId: number, iceState: any) => void;\n  export type OnDataChannelOpenedListener = (session: Session, label: any) => void;\n  export type OnDataChannelMessageListener = (session: Session, label: any, data: any) => void;\n  export type OnSessionConnectionStateChangedListener = (session: Session, iceState: any) => void;\n  export type OnErrorListener = (session: Session, error: any) => void;\n  export type Listeners =\n    | OnParticipantJoinedListener\n    | OnParticipantLeftListener\n    | OnSlowLinkListener\n    | OnRemoteStreamListener\n    | OnRemoteTracksUpdatedListener\n    | OnRemoteConnectionStateChangedListener\n    | OnDataChannelOpenedListener\n    | OnDataChannelMessageListener\n    | OnSessionConnectionStateChangedListener\n    | OnErrorListener;\n  export type ListenerName =\n    | 'onParticipantJoinedListener'\n    | 'onParticipantLeftListener'\n    | 'onSlowLinkListener'\n    | 'onRemoteStreamListener'\n    | 'onRemoteTracksUpdatedListener'\n    | 'onRemoteConnectionStateChangedListener'\n    | 'onDataChannelOpenedListener'\n    | 'onDataChannelMessageListener'\n    | 'onSessionConnectionStateChangedListener'\n    | 'onErrorListener';\n}\n","export enum MediaType {\n  AUDIO = 'audio',\n  VIDEO = 'video',\n  NONE = 'none',\n}\n\nexport namespace ConnectyCubeMedia {\n  export interface ElementOptions {\n    muted?: boolean;\n    mirror?: boolean;\n  }\n  export interface ElementParams {\n    elementId?: string;\n    options?: ElementOptions;\n  }\n  export interface DisplayParams extends DisplayMediaStreamOptions, ElementParams {}\n  export interface UserParams extends MediaStreamConstraints, ElementParams {}\n  export type DeviceIdOrTrackConstraints = MediaTrackConstraints | string;\n  export type TrackConstraintsOrDeviceIds = {\n    audio?: DeviceIdOrTrackConstraints;\n    video?: DeviceIdOrTrackConstraints;\n  };\n}\n","import { DateOrTimestamp, SearchCondition } from './common';\n\nexport enum MeetingDateMetric {\n  MINUTES = 'minutes',\n  HOURS = 'hours',\n  DAYS = 'days',\n  WEEK = 'weeks',\n}\n\nexport namespace ConnectyCubeMeetings {\n  export type Attendee = { id?: number; email?: string };\n  export type Meeting = {\n    _id: string;\n    name?: string;\n    start_date?: DateOrTimestamp;\n    end_date?: DateOrTimestamp;\n    attendees?: Attendee[];\n    record?: boolean | null;\n    chat_dialog_id?: string | null;\n    created_at?: DateOrTimestamp;\n    updated_at?: DateOrTimestamp;\n    host_id?: number;\n    public?: boolean;\n    scheduled?: boolean;\n    notify?: boolean;\n    notify_before?: {\n      metric: MeetingDateMetric | string;\n      value: number; // 'minutes' range [0 - 55], 'hours' range [1 - 24], 'days' range [1 - 30], 'weeks' range [1 - 4]\n    };\n    timezone?: {\n      offset: number; // Minutes UTC offset\n      name: string; // Timezone Name\n    };\n  };\n  export type Recording = {\n    _id: string;\n    room_id: string;\n    participants_ids: number[];\n    updated_at: string;\n    created_at: string;\n    download_url: string;\n    participants_count: number;\n    duration: number;\n    size: number;\n  };\n  // Request parameters type\n  export type GetParams = {\n    _id?: string;\n    limit?: number;\n    offset?: number;\n    start_at?: SearchCondition<DateOrTimestamp>;\n    end_at?: SearchCondition<DateOrTimestamp>;\n    updated_at?: SearchCondition<DateOrTimestamp>;\n    created_at?: SearchCondition<DateOrTimestamp>;\n    scheduled?: SearchCondition<boolean>;\n  };\n  export type CreateParams = {\n    name?: string;\n    start_date?: DateOrTimestamp;\n    end_date?: DateOrTimestamp;\n    attendees?: Attendee[];\n    chat?: boolean;\n    record?: boolean;\n    public?: boolean;\n    scheduled?: boolean;\n    notify?: boolean;\n    notify_before?: {\n      metric: MeetingDateMetric | string;\n      value: number; // 'minutes' range [0 - 55], 'hours' range [1 - 24], 'days' range [1 - 30], 'weeks' range [1 - 4]\n    };\n    timezone?: {\n      offset: number; // Minutes UTC offset\n      name: string; // Timezone Name\n    };\n  };\n  export type UpdateParams = {\n    name: string;\n    start_date: DateOrTimestamp;\n    end_date: DateOrTimestamp;\n    attendees: Attendee[];\n    record?: boolean;\n    public?: boolean;\n    scheduled?: boolean;\n    notify?: boolean;\n    notify_before?: {\n      metric: MeetingDateMetric | string;\n      value: number; // 'minutes' range [0 - 55], 'hours' range [1 - 24], 'days' range [1 - 30], 'weeks' range [1 - 4]\n    };\n    timezone?: {\n      offset: number; // Minutes UTC offset\n      name: string; // Timezone Name\n    };\n  };\n}\n","import { ConnectyCubeConfig } from './config';\nimport { ConnectyCubeAuth } from './auth';\n\nexport enum ProxyMethod {\n  GET = 'GET',\n  POST = 'POST',\n  PUT = 'PUT',\n  PATCH = 'PATCH',\n  DELETE = 'DELETE',\n  HEAD = 'HEAD',\n}\nexport enum ProxyType {\n  JSON = 'json',\n  TEXT = 'text',\n}\n\nexport namespace ConnectyCubeProxy {\n  export type Params = {\n    url: string;\n    type?: ProxyMethod;\n    data?: any;\n    contentType?: boolean;\n    dataType?: ProxyType;\n    useArrayQuery?: boolean;\n    fileToCustomObject?: boolean;\n    authKey?: string;\n    abort_id?: string | number;\n  };\n  export type AbortControllersMap = {\n    [key: string | number]: {\n      controllers: AbortController[];\n      doneRequestsCount?: number;\n    };\n  };\n  export type SDKInstance = {\n    config: ConnectyCubeConfig.Object;\n    session: Partial<ConnectyCubeAuth.Session> | null;\n  };\n  export type ErrorObject = {\n    code?: number;\n    info?: { errors?: { base?: string[] } };\n  };\n}\n","import { DateOrTimestamp } from './common';\n\nexport enum NotificationChannel {\n  APNS = 'apns',\n  VOIP = 'apns_voip',\n  GCM = 'gcm',\n  WEB = 'web',\n}\nexport enum DevicePlatform {\n  IOS = 'ios',\n  ANDROID = 'android',\n  WEB = 'web',\n}\nexport enum PushEnvironment {\n  DEV = 'development',\n  PROD = 'production',\n}\n\nexport namespace ConnectyCubePushNotifications {\n  export type Subscription = {\n    subscription: {\n      id: number | string;\n      notification_channel: {\n        name: NotificationChannel | string;\n      };\n      device: {\n        udid: string;\n        platform: {\n          name: DevicePlatform | string;\n        };\n      };\n    };\n  };\n  export type Event = {\n    event: {\n      id: number;\n      event_type: string | null;\n      message: string | null;\n      date: DateOrTimestamp;\n      period: DateOrTimestamp;\n      name: string | null;\n      occured_count?: number;\n      created_at?: DateOrTimestamp;\n      updated_at?: DateOrTimestamp;\n      end_date?: DateOrTimestamp;\n      active?: boolean | null;\n      application_id: number | null;\n      user_id: number | null;\n      kind: string | null;\n      environment: PushEnvironment | null;\n      tag_query?: any;\n      notification_channel?: {\n        name?: NotificationChannel | null;\n      };\n    };\n  };\n  export type PushTokenBaseParams = {\n    environment: PushEnvironment | string;\n  };\n  export type PushTokenMobileParams = PushTokenBaseParams & {\n    client_identification_sequence: string;\n    bundle_identifier?: string;\n  };\n  export type PushTokenWebParams = PushTokenBaseParams & {\n    web_endpoint: string;\n    web_auth: string;\n    web_p256dh: string;\n  };\n  // Request parameters type\n  export type SubscriptionsCreateParams = {\n    notification_channel: NotificationChannel | string;\n    push_token: PushTokenMobileParams | PushTokenWebParams;\n    device: {\n      platform: DevicePlatform | string;\n      udid: string;\n    };\n  };\n  export type EventsCreateParams = {\n    notification_type: 'push' | string;\n    push_type: NotificationChannel | string;\n    environment: PushEnvironment | string;\n    event_type?: 'one_shot' | string;\n    message?: string | null;\n    user?: {\n      ids: string;\n      tags?: {\n        any?: string;\n        all?: string;\n        exclude?: string;\n      };\n    };\n    external_user?: { ids: string };\n  };\n}\n","import { sdkVersion } from './platform';\nimport { JanusDebugMode, Config as ConnectyCubeConfig } from './types';\n\nexport class Config {\n  private static instance: Config;\n\n  public version: string = sdkVersion;\n  public creds: ConnectyCubeConfig.Credentials = { appId: '', authKey: '' };\n  public endpoints: ConnectyCubeConfig.Endpoints = {\n    api: 'api.connectycube.com',\n    chat: 'chat.connectycube.com',\n    muc: 'muc.chat.connectycube.com',\n  };\n  public chatProtocol: ConnectyCubeConfig.ChatProtocolURLs = {\n    bosh: 'https://chat.connectycube.com:5281',\n    websocket: 'wss://chat.connectycube.com:5291',\n    active: 2,\n  };\n  public chat: ConnectyCubeConfig.Chat = {\n    streamManagement: { enable: false },\n    reconnect: { enable: true, timeInterval: 5 },\n  };\n  public videochat: ConnectyCubeConfig.Videochat = {\n    alwaysRelayCalls: false,\n    answerTimeInterval: 60,\n    dialingTimeInterval: 5,\n    disconnectTimeInterval: 30,\n    statsReportTimeInterval: null,\n    iceServers: [\n      { urls: 'stun:stun.l.google.com:19302' },\n      { urls: 'stun:turn.connectycube.com' },\n      {\n        urls: 'turn:turn.connectycube.com:5349?transport=udp',\n        username: 'connectycube',\n        credential: '4c29501ca9207b7fb9c4b4b6b04faeb1',\n      },\n      {\n        urls: 'turn:turn.connectycube.com:5349?transport=tcp',\n        username: 'connectycube',\n        credential: '4c29501ca9207b7fb9c4b4b6b04faeb1',\n      },\n    ],\n  };\n  public conference: ConnectyCubeConfig.Conference = {\n    server: 'wss://janus.connectycube.com:8989',\n    debug: JanusDebugMode.ALL,\n  };\n  public whiteboard: ConnectyCubeConfig.Whiteboard = { server: 'https://whiteboard.connectycube.com' };\n  public linkpreview: ConnectyCubeConfig.LinkPreview = { server: 'https://linkpreview.connectycube.com' };\n  readonly urls: ConnectyCubeConfig.ApiRoutes = {\n    session: 'session',\n    login: 'login',\n    users: 'users',\n    chat: 'chat',\n    blobs: 'blobs',\n    subscriptions: 'subscriptions',\n    events: 'events',\n    data: 'data',\n    addressbook: 'address_book',\n    meetings: 'meetings',\n    whiteboards: 'whiteboards',\n    unfurl: 'unfurl',\n    calls: 'calls',\n    type: '.json',\n  };\n  public on: ConnectyCubeConfig.Listeners = {\n    sessionExpired: undefined,\n    xmppDataWrite: undefined,\n    xmppDataRead: undefined,\n  };\n  public timeout: number | null = null;\n  public debug: ConnectyCubeConfig.Debug = { mode: 1 };\n\n  private constructor() {}\n\n  public static getInstance(): Config {\n    if (!Config.instance) {\n      Config.instance = new Config();\n    }\n    return Config.instance;\n  }\n\n  public set(options: ConnectyCubeConfig.Options): void {\n    if (options.endpoints && options.endpoints.chat) {\n      this.endpoints.muc = `muc.${options.endpoints.chat}`;\n      this.chatProtocol.bosh = `https://${options.endpoints.chat}:5281`;\n      this.chatProtocol.websocket = `wss://${options.endpoints.chat}:5291`;\n    }\n\n    Object.keys(options).forEach((key: string) => {\n      if (key !== 'set' && this.hasOwnProperty(key)) {\n        const optionValue = options[key as keyof ConnectyCubeConfig.Options];\n\n        if (typeof optionValue === 'object' && optionValue !== null) {\n          Object.keys(optionValue).forEach((nextKey) => {\n            if (this[key as keyof Config]?.hasOwnProperty(nextKey)) {\n              this[key as keyof Config][nextKey] = optionValue[nextKey];\n            }\n          });\n        } else {\n          (this[key as keyof Config] as Config[keyof Config]) = optionValue as Config[keyof Config];\n        }\n      }\n    });\n  }\n}\n\nexport default Config.getInstance();\n","import { isBrowser, isExpo, isNodeJS, isReactNative } from './platform';\nimport config from './config';\nimport { Config } from './types';\n\nexport default class Utils {\n  static loggers: Array<(args: any[]) => void> = [];\n\n  static env = {\n    isReactNative,\n    isBrowser,\n    isNodeJS,\n    isExpo,\n  };\n\n  static safeCallbackCall(cb: (...args: any[]) => void = () => {}): (...args: any[]) => void {\n    return (...args: any[]) => {\n      if (typeof cb === 'function') {\n        try {\n          cb(...args);\n        } catch (err) {\n          console.error('Error in listener:', err, `Check the code:\\n>>>\\n${cb.toString()}\\n<<<`);\n        }\n      }\n    };\n  }\n\n  static getUrl(base: Config.ApiRoutes[keyof Config.ApiRoutes], res?: string | number, ext?: string | number): string {\n    const resource = res ? `/${res}` : '';\n    const extension = ext ? `/${ext}` : '';\n    return `https://${config.endpoints.api}/${base}${resource}${extension}${config.urls.type}`;\n  }\n\n  static isArray(arg: any): arg is any[] {\n    return Array.isArray(arg);\n  }\n\n  static isObject(obj: any): boolean {\n    return Object.prototype.toString.call(obj) === '[object Object]';\n  }\n\n  static getBsonObjectId(): string {\n    // The object for type MongoDB.Bson.ObjectId\n    // http://docs.mongodb.org/manual/reference/object-id/\n    const ObjectId = {\n      machine: Math.floor(Math.random() * 16777216).toString(16),\n      pid: Math.floor(Math.random() * 32767).toString(16),\n      increment: 0,\n    };\n    const timestamp = Math.floor(Date.now() / 1000).toString(16);\n    const increment = (ObjectId.increment++).toString(16);\n\n    if (parseInt(increment, 16) > 0xffffff) {\n      ObjectId.increment = 0;\n    }\n\n    return (\n      timestamp.padStart(8, '0') +\n      ObjectId.machine.padStart(6, '0') +\n      ObjectId.pid.padStart(4, '0') +\n      increment.padStart(6, '0')\n    );\n  }\n\n  static DLog(...args: any[]): void {\n    if (Utils.loggers.length > 0) {\n      Utils.loggers.forEach((logger) => logger(args));\n      return;\n    }\n\n    const consoleLoggerFunction = () => {\n      return (args: any[]) => {\n        console.log(...args);\n      };\n    };\n\n    if (typeof config.debug === 'object') {\n      const modes = Array.isArray(config.debug.mode) ? config.debug.mode : [config.debug.mode];\n      modes.forEach((mode) => {\n        if (mode === 1) {\n          Utils.loggers.push(consoleLoggerFunction());\n        }\n      });\n    }\n\n    Utils.loggers.forEach((logger) => logger(args));\n  }\n\n  static callTrafficUsageCallback(callbackName: 'xmppDataRead' | 'xmppDataWrite', data: any): void {\n    if (typeof config.on[callbackName] === 'function') {\n      const getStringSize = (str: string): number => new Blob([str]).size;\n      const getDataSize = (data: any = {}): number => {\n        const { body: b, headers: h } = data;\n        let size = 0;\n        if (b) {\n          size += getStringSize(typeof b === 'string' ? b : JSON.stringify(b));\n        }\n        if (h) {\n          size += getStringSize(JSON.stringify(h));\n        }\n        return size;\n      };\n\n      config.on[callbackName](getDataSize(data));\n    }\n  }\n\n  static cloneObject<T>(obj: T = {} as T, escapeNull: boolean = false): T {\n    try {\n      const json = JSON.stringify(obj);\n      const jsonObject = escapeNull ? json.replace(/null/g, '\"\"') : json;\n\n      return JSON.parse(jsonObject);\n    } catch {\n      return obj;\n    }\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { AddressBook, ProxyMethod } from './types';\n\nexport default class AddressBookService {\n  public proxy: ProxyService;\n  readonly route = config.urls.addressbook;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async uploadAddressBook(\n    list: AddressBook.Contact[] = [],\n    params: AddressBook.UploadParams = {}\n  ): Promise<AddressBook.UploadResponse> {\n    if (!Utils.isArray(list)) {\n      throw new Error('First parameter must be an Array.');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { contacts: list, ...params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async get(udid?: string): Promise<AddressBook.Contact[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: udid ? { udid } : undefined,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getRegisteredUsers(\n    params: AddressBook.GetRegisteredUsersParams = false\n  ): Promise<AddressBook.GetRegisteredUsersResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'registered_users'),\n      data: typeof params === 'boolean' ? { compact: params ? 1 : 0 } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { Auth, Users, ProxyMethod, ProxyType, EmptyResponse } from './types';\n\nexport default class AuthService {\n  public proxy: ProxyService;\n\n  readonly routes = {\n    session: config.urls.session,\n    login: config.urls.login,\n  };\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public setSession = (session: Partial<Auth.Session>): void => {\n    this.proxy.setSession(session);\n  };\n\n  public getSession = async (): Promise<Auth.Session> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.GET,\n        url: Utils.getUrl(this.routes.session),\n      };\n      const response = await this.proxy.ajax<Auth.GetSessionRawResponse>(ajaxParams);\n      return response.session;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public createSession = async (params: Auth.LoginParams | {} = {}): Promise<Auth.Session> => {\n    if (config.creds.appId === '' || config.creds.authKey === '') {\n      throw new Error('Cannot create a new session without \"appId\" and \"authKey\"');\n    }\n\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.POST,\n        url: Utils.getUrl(this.routes.session),\n        data: this.generateCreateSessionParams(params),\n      };\n      const response = await this.proxy.ajax<Auth.GetSessionRawResponse>(ajaxParams);\n      this.proxy.setSession(response.session);\n      this.proxy.setCurrentUserId(response.session.user_id);\n      return response.session;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public destroySession = async (): Promise<EmptyResponse> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.DELETE,\n        url: Utils.getUrl(this.routes.session),\n        dataType: ProxyType.TEXT,\n      };\n      await this.proxy.ajax(ajaxParams);\n      this.proxy.setSession(null);\n      this.proxy.setCurrentUserId(null);\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public login = async (params: Auth.LoginParams): Promise<Users.User> => {\n    try {\n      const ajaxParams = {\n        type: ProxyMethod.POST,\n        url: Utils.getUrl(this.routes.login),\n        data: params,\n      };\n      const { user } = await this.proxy.ajax<Auth.LoginRawResponse>(ajaxParams);\n      this.proxy.setCurrentUserId(user.id);\n      return user;\n    } catch (error) {\n      throw error;\n    }\n  };\n\n  public logout = async (): Promise<EmptyResponse> => {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.routes.login),\n      dataType: ProxyType.TEXT,\n    };\n    this.proxy.setCurrentUserId(null);\n    return this.proxy.ajax(ajaxParams);\n  };\n\n  private generateCreateSessionParams(params: Auth.LoginParams | {} = {}): Auth.GeneratedSessionParams {\n    const message: Auth.GeneratedSessionParams = {\n      application_id: config.creds.appId,\n      auth_key: config.creds.authKey,\n    };\n\n    if ('guest' in params) {\n      message.user = params;\n    } else if ('login' in params && 'password' in params) {\n      message.user = { login: params.login, password: params.password };\n    } else if ('email' in params && 'password' in params) {\n      message.user = { email: params.email, password: params.password };\n    } else if ('provider' in params) {\n      message.provider = params.provider;\n      if ('keys' in params) {\n        message.keys = params.keys;\n      }\n      if ('firebase_phone' in params) {\n        message.firebase_phone = params.firebase_phone;\n      }\n      if ('firebase_email' in params) {\n        message.firebase_email = params.firebase_email;\n      }\n    }\n\n    return message;\n  }\n}\n","import { Client as _Client, jid as _jid, xml as _xml } from '@xmpp/client-core';\nimport { Element } from '@xmpp/xml';\nimport _connection from '@xmpp/connection';\nimport _reconnect from '@xmpp/reconnect';\nimport _websocket from '@xmpp/websocket';\nimport _middleware from '@xmpp/middleware';\nimport _streamFeatures from '@xmpp/stream-features';\nimport _iqCaller from '@xmpp/iq/caller.js';\nimport _iqCallee from '@xmpp/iq/callee.js';\nimport _resolve from '@xmpp/resolve';\nimport _sasl from '@xmpp/sasl';\nimport _resourceBinding from '@xmpp/resource-binding';\nimport _sessionEstablishment from '@xmpp/session-establishment';\nimport anonymous from '@xmpp/sasl-anonymous';\nimport plain from '@xmpp/sasl-plain';\nimport Utils from '../Utils';\n\nexport interface Options extends _connection.Options {\n  resource?: _resourceBinding.Resource | undefined;\n  credentials?: _sasl.Credentials | undefined;\n  username?: string | undefined;\n  password?: string | undefined;\n}\n\nexport interface XMPPClient extends _Client {\n  entity: _Client;\n  reconnect: _reconnect.Reconnect<_Client>;\n  websocket: any;\n  middleware: _middleware.Middleware<_Client>;\n  streamFeatures: _streamFeatures.StreamFeatures<_Client>;\n  iqCaller: _iqCaller.IQCaller<_Client>;\n  iqCallee: _iqCallee.IQCallee<_Client>;\n  starttls: _middleware.Middleware<_Client>;\n  resolve: any;\n  sasl: _sasl.SASL;\n  resourceBinding: any;\n  sessionEstablishment: any;\n  mechanisms: { [x: string]: any }[];\n  options: Options;\n  sendOnline: (element: Element, ...args: unknown[]) => Promise<void>;\n}\n\nexport function xmppClient(options: Options): XMPPClient {\n  const { resource, credentials, username, password, ...params } = options;\n  const { domain, service } = params;\n\n  if (!domain && service) {\n    params.domain = (service.split('://')[1] || service).split(':')[0].split('/')[0];\n  }\n\n  const entity = new _Client(params);\n  const reconnect = _reconnect({ entity });\n  const websocket = _websocket({ entity });\n  const middleware = _middleware({ entity });\n  const streamFeatures = _streamFeatures({ middleware });\n  const iqCaller = _iqCaller({ middleware, entity });\n  const iqCallee = _iqCallee({ middleware, entity });\n  const starttls = _middleware({ entity });\n  const resolve = _resolve({ entity });\n  const sasl = _sasl({ streamFeatures }, credentials || { username, password });\n  const resourceBinding = _resourceBinding({ iqCaller, streamFeatures }, resource);\n  const sessionEstablishment = _sessionEstablishment({ iqCaller, streamFeatures });\n  const mechanisms = Object.entries({ plain, anonymous }).map(([k, v]) => ({\n    [k]: v(sasl),\n  }));\n\n  const sendOnline = function (element: Element, ...args: unknown[]): Promise<void> {\n    if (entity.status === 'online') {\n      return entity.send.call(entity, element, ...args);\n    } else {\n      const message = \"You are not connected to chat. Please call 'connect' function first\";\n      Utils.DLog('[Chat][Error]', message);\n      return Promise.reject(new Error(message));\n    }\n  };\n\n  return Object.assign(entity, {\n    entity,\n    reconnect,\n    websocket,\n    middleware,\n    streamFeatures,\n    iqCaller,\n    iqCallee,\n    starttls,\n    resolve,\n    sasl,\n    resourceBinding,\n    sessionEstablishment,\n    mechanisms,\n    sendOnline,\n  });\n}\n\nexport const jid: typeof _jid = _jid;\nexport const xml: typeof _xml = _xml;\n","import ProxyService from '../Proxy';\nimport Utils from '../Utils';\nimport config from '../config';\nimport { Dialogs, EmptyResponse, ForceParams, ProxyMethod, ProxyType } from '../types';\n\nexport default class DialogsService {\n  public proxy: ProxyService;\n  readonly route = `${config.urls.chat}/Dialog`;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Dialogs.ListParams = {}): Promise<Dialogs.ListResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Dialogs.CreateParams): Promise<Dialogs.Dialog> {\n    const data = Utils.cloneObject(params);\n\n    if (Utils.isArray(data?.occupants_ids)) {\n      data.occupants_ids = data.occupants_ids.join(', ');\n    }\n\n    if (Utils.isArray(data?.admins_ids)) {\n      data.admins_ids = data.admins_ids.join(', ');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Dialogs.UpdateParams = {}): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(\n    idOrIds: string | string[],\n    params: ForceParams = {}\n  ): Promise<Dialogs.DeleteResponse | EmptyResponse> {\n    const idsToDelete = typeof idOrIds === 'string' ? idOrIds.split(',').map((id) => id.trim()) : idOrIds;\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, idsToDelete.toString()),\n      dataType: idsToDelete.length === 1 ? ProxyType.TEXT : ProxyType.JSON,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async addAdmins(id: string, admins_ids: number[]): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'admins'),\n      data: { push_all: { admins_ids } },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async removeAdmins(id: string, admins_ids: number[]): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'admins'),\n      data: { pull_all: { admins_ids } },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async subscribe(id: string): Promise<Dialogs.Dialog> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, id, 'subscribe'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public subscribeToPublic = this.subscribe;\n\n  public async unsubscribe(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id, 'subscribe'),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public unsubscribeFromPublic = this.unsubscribe;\n\n  public async updateNotificationsSettings(\n    id: string,\n    enabled: number | boolean\n  ): Promise<Dialogs.UpdateNotificationsSettingsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id, 'notifications'),\n      data: { enabled: enabled ? 1 : 0 },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getNotificationsSettings(id: string): Promise<Dialogs.GetNotificationsSettingsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, id, 'notifications'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getPublicOccupants(\n    id: string,\n    params: Dialogs.GetPublicOccupantsParams = {}\n  ): Promise<Dialogs.GetPublicOccupantsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, id, 'occupants'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async clearHistory(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, 'clearHistory', id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import ProxyService from '../Proxy';\nimport Utils from '../Utils';\nimport config from '../config';\nimport { EmptyResponse, ForceParams, Messages, ProxyMethod, ProxyType } from '../types';\nexport default class MessagesService {\n  public proxy: ProxyService;\n  readonly route = `${config.urls.chat}/Message`;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Messages.ListParams = {}): Promise<Messages.ListResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Messages.CreateParams = {}): Promise<Messages.Message> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route),\n      type: ProxyMethod.POST,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Messages.UpdateParams = {}): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string, params?: ForceParams): Promise<Messages.DeleteResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, id),\n      type: ProxyMethod.DELETE,\n      dataType: ProxyType.TEXT,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async createSystem(params: Messages.CreateSystemParams): Promise<Messages.CreateSystemResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, 'system'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async unreadCount(params: Messages.UnreadCountParams = {}): Promise<Messages.UnreadCountResponse> {\n    const data = Utils.cloneObject(params);\n\n    if (data && data.chat_dialog_ids && Utils.isArray(data.chat_dialog_ids)) {\n      data.chat_dialog_ids = data.chat_dialog_ids.join(', ');\n    }\n\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, 'unread'),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async listReactions(id: string = '_'): Promise<Messages.ListReactionsResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      dataType: ProxyType.JSON,\n      url: Utils.getUrl(this.route, id, 'reactions'),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async addReaction(id: string, reaction: string): Promise<EmptyResponse> {\n    return this.updateReaction(id, reaction);\n  }\n\n  public async removeReaction(id: string, reaction: string): Promise<EmptyResponse> {\n    return this.updateReaction(id, undefined, reaction);\n  }\n\n  public async updateReaction(id: string, add?: string, remove?: string): Promise<EmptyResponse> {\n    return this.putReaction(id, { add, remove });\n  }\n\n  private async putReaction(id: string, params: Messages.PutReactionParams): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id, 'reactions'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import config from '../config';\nimport { xml } from './xmpp';\nimport { Chat } from '../types';\n\nexport default class ChatUtils {\n  static buildUserJid(params: Chat.UserJIDParams = {}): string | void {\n    const { userId, resource, jid } = params;\n    const appId = config.creds.appId;\n    const url = config.endpoints.chat;\n\n    return userId ? `${userId}-${appId}@${url}${resource ? `/${resource}` : ''}` : jid;\n  }\n\n  static buildUserJidLocalPart(userId: string | number): string {\n    return `${userId}-${config.creds.appId}`;\n  }\n\n  static createMessageStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('message', attrs);\n  }\n\n  static createIqStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('iq', attrs);\n  }\n\n  static createPresenceStanza(attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml('presence', attrs);\n  }\n\n  static createNonza(name: string, attrs?: string | { [attrName: string]: any }): Chat.XmlElement {\n    return xml(name, attrs);\n  }\n\n  static getAttr(element: Chat.XmlElement, name: string): any {\n    return element?.getAttr(name) || element?.attrs[name] || null;\n  }\n\n  static getElement(element: Chat.XmlElement, name: string): Chat.XmlElement | undefined {\n    return element?.getChild(name);\n  }\n\n  static getName(element: Chat.XmlElement): string | null {\n    return element?.getName() || null;\n  }\n\n  static getText(element: Chat.XmlElement): string | null {\n    return element?.getText() || null;\n  }\n\n  static getChildElements(element: Chat.XmlElement): Chat.XmlElement[] {\n    return element?.getChildElements() || [];\n  }\n\n  static isErrorStanza(element: Chat.XmlElement): boolean {\n    return !!element?.getChild('error');\n  }\n\n  static getAllElements(element: Chat.XmlElement, name: string): Chat.XmlElement[] {\n    return element?.getChildren(name) || [];\n  }\n\n  static getElementText(element: Chat.XmlElement, name: string): string | null {\n    return element?.getChildText(name) || null;\n  }\n\n  static getElementTreePath(element: Chat.XmlElement, elementsPath: string[]): Chat.XmlElement | undefined {\n    return elementsPath.reduce<Chat.XmlElement | undefined>(\n      (prevElement: Chat.XmlElement | undefined, name: string) =>\n        prevElement ? ChatUtils.getElement(prevElement, name) : undefined,\n      element as Chat.XmlElement\n    );\n  }\n\n  static assignObjectToXml(element: Chat.XmlElement, obj: { [key: string]: any }, name: string): Chat.XmlElement {\n    element = element.c(name);\n\n    Object.keys(obj).forEach((key: string) => {\n      if (typeof obj[key] === 'object') {\n        ChatUtils.assignObjectToXml(element, obj[key], key);\n      } else {\n        element = element.c(key).t(obj[key]).up();\n      }\n    });\n\n    element = element.up();\n\n    return element;\n  }\n\n  static assignExtraParamsToXml(element: Chat.XmlElement, extension: { [key: string]: any }): Chat.XmlElement {\n    let extraParams = ChatUtils.getElement(element, 'extraParams');\n\n    Object.keys(extension).forEach((key) => {\n      if (key === 'attachments') {\n        (extension[key] as any[]).forEach((attachment: any) => {\n          extraParams!.c('attachment', attachment).up();\n        });\n      } else if (typeof extension[key] === 'object') {\n        ChatUtils.assignObjectToXml(extraParams!, extension[key], key);\n      } else {\n        extraParams!.c(key).t(extension[key]).up();\n      }\n    });\n\n    element.up();\n\n    return element;\n  }\n\n  static assignXmlToObject(element: Chat.XmlElement, obj: any): any {\n    const { children, name } = element;\n    const item: { [key: string]: any } = { [name]: {} };\n\n    children.forEach((node: Chat.XmlNode) => {\n      if (typeof node === 'string') {\n        item[name] = node;\n      } else if (node.children.length > 0) {\n        ChatUtils.assignXmlToObject(node, item[name]);\n      } else {\n        item[name][node.name] = ChatUtils.getText(node);\n      }\n    });\n\n    return Object.assign(obj, item);\n  }\n\n  static parseExtraParams(element: Chat.XmlElement): { extension: any; dialogId: string | null } | null {\n    if (!element) {\n      return null;\n    }\n\n    const extension: any = { attachments: [] };\n    let dialogId: string | null = null;\n\n    element.children.forEach((node: Chat.XmlNode) => {\n      if (typeof node === 'string') {\n        return;\n      }\n\n      if (node.name === 'attachment') {\n        const attachment: any = {};\n\n        Object.keys(node.attrs).forEach((key: string) => {\n          attachment[key] = key === 'size' ? parseInt(node.attrs.size) : node.attrs[key];\n        });\n\n        extension.attachments.push(attachment);\n      } else if (node.name === 'dialog_id') {\n        dialogId = ChatUtils.getElementText(element, 'dialog_id');\n        extension.dialog_id = dialogId;\n      }\n\n      if (node.children.length) {\n        ChatUtils.assignXmlToObject(node, extension);\n      }\n    });\n\n    if (extension.attachments.length === 0) {\n      delete extension.attachments;\n    }\n    if (extension.moduleIdentifier) {\n      delete extension.moduleIdentifier;\n    }\n\n    return { extension, dialogId };\n  }\n\n  static buildErrorFromXMPPErrorStanza(errorStanza: Chat.XmlElement): { code: number; info: string | null } {\n    const errorElement = ChatUtils.getElement(errorStanza, 'error');\n    const code = errorElement ? parseInt(ChatUtils.getAttr(errorElement, 'code')) : 0;\n    const info = errorElement ? ChatUtils.getElementText(errorElement, 'text') : null;\n    return { code: code, info: info };\n  }\n\n  static getUniqueId(suffix?: any): string {\n    const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n      const r = (Math.random() * 16) | 0;\n      const v = c == 'x' ? r : (r & 0x3) | 0x8;\n      return v.toString(16);\n    });\n\n    if (typeof suffix === 'string' || typeof suffix === 'number') {\n      return `${uuid}:${suffix}`;\n    } else {\n      return uuid;\n    }\n  }\n\n  static parseReactions(element: Chat.XmlElement): { add: string; remove: string } {\n    const reactions = ChatUtils.getChildElements(element).map((node: Chat.XmlElement) => ({\n      add: ChatUtils.getAttr(node, 'add') === 'true',\n      remove: ChatUtils.getAttr(node, 'remove') === 'true',\n      reaction: ChatUtils.getAttr(node, 'type'),\n    }));\n\n    return reactions.reduce((items, { add, remove, reaction }) => {\n      if (add) {\n        items['add'] = reaction;\n      } else if (remove) {\n        items['remove'] = reaction;\n      }\n      return items;\n    }, {} as { add: string; remove: string });\n  }\n}\n","import Utils from '../Utils';\nimport config from '../config';\nimport ChatUtils from './ChatUtils';\n\nexport default class ChatHelpers {\n  public xmppJID: string = '';\n\n  public get userCurrentJid(): string | '' {\n    return this.xmppJID;\n  }\n\n  public set userCurrentJid(jid: string | null) {\n    this.xmppJID = jid || '';\n  }\n\n  public getUniqueId = ChatUtils.getUniqueId;\n\n  public isNumeric(value: string): boolean {\n    return /^-?\\d+$/.test(value) || /^\\d+\\.\\d+$/.test(value);\n  }\n\n  public jidOrUserId(jidOrUserId: string | number): string {\n    if (typeof jidOrUserId === 'string') {\n      return this.isNumeric(jidOrUserId)\n        ? this.getUserJid(jidOrUserId)\n        : jidOrUserId.includes('@')\n          ? jidOrUserId\n          : this.getRoomJidFromDialogId(jidOrUserId);\n    }\n\n    return this.getUserJid(jidOrUserId);\n  }\n\n  public typeChat(jidOrUserId: string | number): 'chat' | 'groupchat' {\n    switch (typeof jidOrUserId) {\n      case 'string':\n        return this.isNumeric(jidOrUserId)\n          ? 'chat'\n          : jidOrUserId.includes('@')\n            ? jidOrUserId.includes('muc')\n              ? 'groupchat'\n              : 'chat'\n            : 'groupchat';\n      case 'number':\n        return 'chat';\n      default:\n        throw new Error('Unsupported chat type');\n    }\n  }\n\n  public getUserJid(userId: string | number): string {\n    return `${userId}-${config.creds.appId}@${config.endpoints.chat}`;\n  }\n\n  public getUserNickWithMucDomain(userId: string | number): string {\n    return `${config.endpoints.muc}/${userId}`;\n  }\n\n  public getUserIdFromJID(jid: string = this.userCurrentJid): number | null {\n    return jid?.includes('@') ? parseInt(jid.split('@')[0].split('-')[0]) : null;\n  }\n\n  public getDialogIdFromJID(jid: string): string | null {\n    return jid?.includes('@') ? jid.split('@')[0].split('_')[1] : null;\n  }\n\n  public getRoomJidFromDialogId(dialogId: string): string {\n    return `${config.creds.appId}_${dialogId}@${config.endpoints.muc}`;\n  }\n\n  public getRoomJid(jid: string): string {\n    return `${jid}/${this.getUserIdFromJID(this.userCurrentJid)}`;\n  }\n\n  public getIdFromResource(jid: string): number | null {\n    const parts = jid.split('/');\n    return parts.length > 1 ? parseInt(parts.slice(1).join('/')) : null;\n  }\n\n  public getRoomJidFromRoomFullJid(jid: string): string | null {\n    const parts = jid.split('/');\n    return parts.length > 1 ? parts[0] : null;\n  }\n\n  public getBsonObjectId = Utils.getBsonObjectId;\n\n  public getUserIdFromRoomJid(roomJid: string): number | null {\n    const parts = roomJid.split('/');\n    return parts.length > 1 ? parseInt(parts[parts.length - 1]) : null;\n  }\n\n  getDialogJid(identifier: string): string {\n    return identifier.indexOf('@') > 0 ? identifier : this.getRoomJidFromDialogId(identifier);\n  }\n}\n","import { Chat, ChatProtocol, ChatType } from '../types';\nimport config from '../config';\nimport ChatService from './Chat';\nimport ChatUtils from './ChatUtils';\nimport Utils from '../Utils';\n\nenum NonzaName {\n  ENABLE = 'enable',\n  ENABLED = 'enabled',\n  REQUEST = 'r',\n  ANSWER = 'a',\n}\n\nexport default class StreamManagement {\n  readonly xmlns = 'urn:xmpp:sm:3';\n\n  private enabled: boolean = false;\n  private clientHandledCounter: number = 0;\n  private serverHandledCounter: number = 0;\n  private messagesQueue: Set<Chat.MessageParams> = new Set();\n  private messagesQueueClearTimer?: NodeJS.Timeout;\n\n  constructor(private chat: ChatService) {}\n\n  public get supported(): boolean {\n    return config.chatProtocol.active === ChatProtocol.WS && config.chat.streamManagement?.enable;\n  }\n\n  public start(): void {\n    this.enabled = false;\n\n    if (this.supported) {\n      this.removeElementHandler();\n      this.addElementHandler();\n      this.sendNonza(NonzaName.ENABLE);\n    }\n  }\n\n  public stop(): void {\n    this.enabled = false;\n\n    if (this.supported) {\n      this.removeElementHandler();\n      this.markMessagesQueueAsLost();\n    }\n  }\n\n  public async sendAndCount(stanza: Chat.XmlElement, message: Chat.MessageParams): Promise<void> {\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const attachments = ChatUtils.getAllElements(stanza, 'attachment');\n    const isMessage = stanza.name === 'message';\n    const isChat = type === ChatType.CHAT || type === ChatType.GROUPCHAT;\n    const isContent = Boolean(body || attachments.length);\n\n    try {\n      await this.chat.xmppClient.sendOnline(stanza);\n\n      if (this.enabled && isMessage && isChat && isContent) {\n        this.messagesQueue.add(message);\n        this.sendNonza(NonzaName.REQUEST);\n      }\n    } catch {\n      this.markMessageAsLost(message);\n    }\n  }\n\n  private elementHandler = (stanza: Chat.XmlElement): void => {\n    const [name, xmlns] = [stanza.name, ChatUtils.getAttr(stanza, 'xmlns')];\n\n    if (xmlns === this.xmlns && name === NonzaName.ENABLED) {\n      this.clientHandledCounter = 0;\n      this.serverHandledCounter = 0;\n      this.enabled = true;\n      return;\n    }\n\n    if (xmlns !== this.xmlns) this.clientHandledCounter++;\n\n    if (name === NonzaName.REQUEST) {\n      this.sendNonza(NonzaName.ANSWER);\n      return;\n    }\n\n    if (name === NonzaName.ANSWER) {\n      const nextHandledCounter = parseInt(ChatUtils.getAttr(stanza, 'h'), 10);\n      const currHandledCounter = Number.isNaN(nextHandledCounter) ? this.serverHandledCounter : nextHandledCounter;\n      const diffHandledCounter = currHandledCounter - this.serverHandledCounter;\n\n      this.serverHandledCounter = currHandledCounter;\n      this.markMessagesQueueAsSent(diffHandledCounter);\n      this.markMessagesQueueAsLostByTimeout();\n    }\n  };\n\n  private markMessageAsSent(message: Chat.MessageParams): void {\n    Utils.safeCallbackCall(this.chat.onSentMessageCallback)(null, message);\n    this.messagesQueue.delete(message);\n  }\n\n  private markMessageAsLost(message: Chat.MessageParams, clear: boolean = true): void {\n    Utils.safeCallbackCall(this.chat.onSentMessageCallback)(message, null);\n    if (clear) this.messagesQueue.delete(message);\n  }\n\n  private markMessagesQueueAsSent(iterations: number = 0): void {\n    const iterator = this.messagesQueue.values();\n\n    for (let i = 0; i < iterations; i++) {\n      const { done, value } = iterator.next();\n      if (done) break;\n      this.markMessageAsSent(value);\n    }\n  }\n\n  private markMessagesQueueAsLost(): void {\n    clearTimeout(this.messagesQueueClearTimer);\n    this.messagesQueueClearTimer = undefined;\n\n    if (this.messagesQueue.size > 0) {\n      this.messagesQueue.forEach((message) => {\n        this.markMessageAsLost(message, false);\n      });\n      this.messagesQueue.clear();\n    }\n  }\n\n  private markMessagesQueueAsLostByTimeout(): void {\n    const ackTimeout = (config.chat.streamManagement?.acknowledgementTimeout ?? 30) * 1000;\n\n    clearTimeout(this.messagesQueueClearTimer);\n    this.messagesQueueClearTimer = setTimeout(() => {\n      this.markMessagesQueueAsLost();\n    }, ackTimeout);\n  }\n\n  private sendNonza(name: string): Promise<void> {\n    const attrs = { xmlns: this.xmlns, ...(name === NonzaName.ANSWER && { h: this.clientHandledCounter }) };\n    const nonza = ChatUtils.createNonza(name, attrs);\n\n    return this.chat.xmppClient.sendOnline(nonza);\n  }\n\n  private removeElementHandler(): void {\n    this.chat.xmppClient.removeListener('element', this.elementHandler);\n  }\n\n  private addElementHandler(): void {\n    this.chat.xmppClient.on('element', this.elementHandler);\n  }\n}\n","import ChatUtils from './ChatUtils';\nimport ChatHelpers from './Helpers';\nimport { XMPPClient } from './xmpp';\nimport { Chat, PrivacyListAction } from '../types';\n\nexport default class PrivacyList {\n  readonly xmlns = 'jabber:iq:privacy';\n  public helpers: ChatHelpers;\n  public xmppClient: XMPPClient;\n  public stanzasCallbacks: Chat.StanzasCallbacks;\n\n  constructor(options: { helpers: ChatHelpers; xmppClient: XMPPClient; stanzasCallbacks: Chat.StanzasCallbacks }) {\n    this.helpers = options.helpers;\n    this.xmppClient = options.xmppClient;\n    this.stanzasCallbacks = options.stanzasCallbacks;\n  }\n\n  public async create(list: Chat.PrivacyList): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const privacyList = list.items.reduce((acc, { user_id, action, mutualBlock }) => {\n        acc[user_id] = { action, mutualBlock };\n        return acc;\n      }, {} as Record<string, Partial<Chat.PrivacyListItem>>);\n\n      const privacyListKeys = Object.keys(privacyList);\n      const iqParams = {\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id: ChatUtils.getUniqueId('edit'),\n      };\n\n      let iq = ChatUtils.createIqStanza(iqParams);\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name: list.name });\n\n      for (let index = 0, j = 0, len = privacyListKeys.length; index < len; index++, j = j + 2) {\n        const userId = privacyListKeys[index];\n        const { action, mutualBlock } = privacyList[userId];\n        const isMutual = (mutualBlock && action === 'deny') ?? false;\n        const userJid = this.helpers.jidOrUserId(parseInt(userId, 10));\n        const userMuc = this.helpers.getUserNickWithMucDomain(userId);\n\n        this.assignPrivacyItem(iq, { order: j + 1, value: userJid, action, isMutual });\n        this.assignPrivacyItem(iq, { order: j + 2, value: userMuc, action, isMutual });\n      }\n\n      this.stanzasCallbacks[iqParams.id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async getList(name: string): Promise<Chat.PrivacyList> {\n    return new Promise((resolve, _reject) => {\n      const id = ChatUtils.getUniqueId('getlist');\n      const iq = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement): void => {\n        const query = ChatUtils.getElement(stanza, 'query');\n        const list = ChatUtils.getElement(query, 'list');\n        const privacyList: Chat.PrivacyList = {\n          name: ChatUtils.getAttr(list, 'name'),\n          items: ChatUtils.getChildElements(list)\n            .map((item, index) => {\n              if (index % 2 === 0) {\n                const { action, value } = item.attrs;\n                return {\n                  user_id: this.helpers.getUserIdFromJID(value),\n                  action: action,\n                } as Chat.PrivacyListItem;\n              }\n              return null;\n            })\n            .filter((item) => item !== null),\n        };\n\n        resolve(privacyList);\n\n        delete this.stanzasCallbacks[id];\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async update(list: Chat.PrivacyList): Promise<void> {\n    try {\n      const currentList = await this.getList(list.name);\n      const map = new Map(currentList.items.map((currentListItem) => [currentListItem.user_id, currentListItem]));\n\n      for (const item of list.items) {\n        if (item.action === PrivacyListAction.ALLOW) {\n          map.delete(item.user_id);\n        } else {\n          const updatedItem = Object.assign({}, map.get(item.user_id), item);\n          map.set(item.user_id, updatedItem);\n        }\n      }\n\n      const updatedListItems = Array.from(map.values());\n      const updatedList = { name: list.name, items: updatedListItems };\n\n      await this.create(updatedList);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getNames(): Promise<Chat.PrivacyListNames> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('getNames');\n      const iq = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        if (!ChatUtils.isErrorStanza(stanza)) {\n          const query = ChatUtils.getElement(stanza, 'query');\n          const defaultElement = ChatUtils.getElement(query, 'default');\n          const activeElement = ChatUtils.getElement(query, 'active');\n          const defaultName = ChatUtils.getAttr(defaultElement, 'name');\n          const activeName = ChatUtils.getAttr(activeElement, 'name');\n          const allNames = ChatUtils.getChildElements(query).map((list) => ChatUtils.getAttr(list, 'name'));\n\n          const namesList = {\n            default: defaultName,\n            active: activeName,\n            names: allNames,\n          };\n\n          resolve(namesList);\n        } else {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\n        }\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async delete(name: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('remove');\n      const iq = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('list', { name: name ? name : '' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  public async setAsDefault(name: string | null): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('default');\n      const iq = ChatUtils.createIqStanza({\n        type: 'set',\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iq.c('query', { xmlns: this.xmlns }).c('default', name ? { name: name } : {});\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        ChatUtils.isErrorStanza(stanza) ? reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza)) : resolve();\n      };\n\n      this.xmppClient.sendOnline(iq);\n    });\n  }\n\n  private assignPrivacyItem(iq: Chat.XmlElement, params: Chat.PrivacyListItemParams): void {\n    const { value, action, order, isMutual } = params;\n    const query = ChatUtils.getElement(iq, 'query');\n    const list = ChatUtils.getElement(query, 'list');\n    const item = list.c('item', { type: 'jid', value, action, order });\n\n    if (isMutual) {\n      item.up();\n\n      if (order % 2 === 0) {\n        iq.up().up();\n      }\n    } else {\n      item.c('message', {}).up().c('presence-in', {}).up().c('presence-out', {}).up().c('iq', {}).up().up();\n    }\n  }\n}\n","import { XMPPClient } from './xmpp';\nimport ChatHelpers from './Helpers';\nimport ChatUtils from './ChatUtils';\nimport { Chat } from '../types';\n\nexport default class MultiUserChat {\n  readonly xmlns = 'http://jabber.org/protocol/muc';\n  public helpers: ChatHelpers;\n  public xmppClient: XMPPClient;\n  public stanzasCallbacks: Chat.StanzasCallbacks;\n  public joinedRooms: { [jid: string]: boolean } = {};\n\n  constructor(options: { helpers: ChatHelpers; xmppClient: XMPPClient; stanzasCallbacks: Chat.StanzasCallbacks }) {\n    this.helpers = options.helpers;\n    this.xmppClient = options.xmppClient;\n    this.stanzasCallbacks = options.stanzasCallbacks;\n  }\n\n  public async join(dialogIdOrJid: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('join');\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\n      const presenceStanza = ChatUtils.createPresenceStanza({\n        id: id,\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.getRoomJid(dialogJid),\n      });\n\n      presenceStanza.c('x', { xmlns: this.xmlns }).c('history', { maxstanzas: 0 });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const x = ChatUtils.getElement(stanza, 'x');\n        const status = ChatUtils.getElement(x, 'status');\n        const code = ChatUtils.getAttr(status, 'code');\n\n        if (status && code == '110') {\n          this.joinedRooms[dialogJid] = true;\n          resolve();\n        } else {\n          const isJoin = ChatUtils.getAttr(x, 'xmlns') === this.xmlns && id.endsWith(':join');\n          const isError = ChatUtils.getAttr(stanza, 'type') === 'error';\n\n          if (isJoin && isError) {\n            const errorElement = ChatUtils.getElement(stanza, 'error');\n            const errorResponse = {\n              code: ChatUtils.getAttr(errorElement, 'code'),\n              message: ChatUtils.getElementText(errorElement, 'text') || 'Unknown issue',\n            };\n\n            reject(errorResponse);\n          }\n        }\n      };\n\n      this.xmppClient.sendOnline(presenceStanza);\n    });\n  }\n\n  public async leave(dialogIdOrJid: string): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const dialogJid = this.helpers.getDialogJid(dialogIdOrJid);\n      const presenceStanza = ChatUtils.createPresenceStanza({\n        type: 'unavailable',\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.getRoomJid(dialogJid),\n      });\n\n      delete this.joinedRooms[dialogJid];\n\n      this.stanzasCallbacks['muc:leave'] = (_stanza: Chat.XmlElement) => {\n        resolve();\n      };\n\n      this.xmppClient.sendOnline(presenceStanza);\n    });\n  }\n\n  public async listOnlineUsers(dialogIdOrJid: string): Promise<number[]> {\n    return new Promise((resolve, _reject) => {\n      const id = ChatUtils.getUniqueId('muc_disco_items');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'get',\n        to: this.helpers.getDialogJid(dialogIdOrJid),\n        from: this.helpers.userCurrentJid,\n        id,\n      });\n\n      iqStanza.c('query', { xmlns: 'http://jabber.org/protocol/disco#items' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const stanzaId = ChatUtils.getAttr(stanza, 'id');\n\n        if (this.stanzasCallbacks[stanzaId]) {\n          const query = ChatUtils.getAttr(stanza, 'query');\n          const users = ChatUtils.getChildElements(query)\n            .map((item: Chat.XmlElement): number | null => {\n              const roomJid = ChatUtils.getAttr(item, 'jid');\n              return this.helpers.getUserIdFromRoomJid(roomJid);\n            })\n            .filter((userId: number | null) => userId !== null);\n\n          resolve(users);\n        }\n      };\n\n      this.xmppClient.sendOnline(iqStanza);\n    });\n  }\n}\n","import config from '../config';\nimport { XMPPClient, xmppClient } from './xmpp';\nimport Utils from '../Utils';\nimport ProxyService from '../Proxy';\nimport DialogsService from './Dialogs';\nimport MessagesService from './Messages';\nimport ChatHelpers from './Helpers';\nimport ChatUtils from './ChatUtils';\nimport StreamManagement from './StreamManagement';\nimport WebRTCSignalingProcessor from '../videocalling/WebRTCSignalingProcessor';\nimport PrivacyList from './PrivacyList';\nimport MultiUserChat from './MultiUserChat';\nimport { Chat, ChatEvent, ProxyMethod } from '../types';\n\nexport default class ChatService {\n  public proxy: ProxyService;\n  public dialog: DialogsService;\n  public message: MessagesService;\n  public xmppClient: XMPPClient;\n  public helpers: ChatHelpers;\n  public privacylist: PrivacyList;\n  public muc: MultiUserChat;\n  public streamManagement: StreamManagement;\n  public webrtcSignalingProcessor!: WebRTCSignalingProcessor;\n\n  public isConnected: boolean = false;\n  private isConnecting: boolean = false;\n  private isLogout: boolean = false;\n  private isReconnect: boolean = false;\n\n  public stanzasCallbacks: Chat.StanzasCallbacks = {};\n  private xmppClientListeners: Chat.XMPPClientListeners = new Map<Chat.XMPPClientEvent, Chat.XMPPClientListener>();\n  private connectPromise: Promise<boolean> | null = null;\n  private earlyIncomingMessagesQueue: Chat.XmlElement[] = [];\n\n  public onChatStatusListener!: Chat.OnChatStatusListener;\n  public onConnectionErrorListener!: Chat.OnChatConnectionErrorListener;\n  public onDisconnectedListener!: Chat.OnChatDisconnectedListener;\n  public onReconnectListener!: Chat.OnChatReconnectedListener;\n  public onMessageListener!: Chat.OnMessageListener;\n  public onSystemMessageListener!: Chat.OnMessageSystemListener;\n  public onMessageErrorListener!: Chat.OnMessageErrorListener;\n  public onMessageTypingListener!: Chat.OnMessageTypingListener;\n  public onMessageUpdateListener!: Chat.OnMessageUpdateListener;\n  public onMessageDeleteListener!: Chat.OnMessageDeleteListener;\n  public onMessageReactionsListener!: Chat.OnMessageReactionsListener;\n  public onSentMessageCallback!: Chat.OnMessageSentListener;\n  public onDeliveredStatusListener!: Chat.OnMessageDeliveredListener;\n  public onReadStatusListener!: Chat.OnMessageReadListener;\n  public onLastUserActivityListener!: Chat.OnLastUserActivityListener;\n  public onJoinOccupant!: Chat.OnDialogJoinListener;\n  public onLeaveOccupant!: Chat.OnDialogLeaveListener;\n  public onKickOccupant!: Chat.OnDialogKickListener;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n    this.dialog = new DialogsService(proxy);\n    this.message = new MessagesService(proxy);\n    this.helpers = new ChatHelpers();\n\n    this.xmppClient = xmppClient({\n      service: config.chatProtocol.websocket,\n      credentials: (auth, _mechanism) =>\n        auth({\n          username: this.xmppClient.options.username || '',\n          password: this.xmppClient.options.password || '',\n        }),\n    });\n\n    if (config.chat.reconnect.enable) {\n      this.xmppClient.reconnect.delay = config.chat.reconnect.timeInterval * 1000;\n    }\n\n    const options = {\n      xmppClient: this.xmppClient,\n      helpers: this.helpers,\n      stanzasCallbacks: this.stanzasCallbacks,\n    };\n\n    this.muc = new MultiUserChat(options);\n    this.privacylist = new PrivacyList(options);\n    this.streamManagement = new StreamManagement(this);\n  }\n\n  get connectionStatus() {\n    return this.xmppClient.status;\n  }\n\n  public async connect(params: Chat.ConnectionParams): Promise<boolean> {\n    this.connectPromise = new Promise((resolve, reject) => {\n      Utils.DLog('[Chat]', 'Connect with parameter:', params);\n\n      if (this.isConnecting) {\n        Utils.DLog('[Chat]', 'Warning! Already in CONNECTING state');\n        resolve(false);\n        return;\n      }\n\n      if (this.isConnected) {\n        Utils.DLog('[Chat]', 'Warning! Chat is already connected!');\n        resolve(false);\n        return;\n      }\n\n      this.isConnecting = true;\n      this.isLogout = false;\n\n      this.removeAllXMPPClientListeners();\n\n      this.addXMPPClientListener('connect', () => {\n        Utils.DLog('[Chat]', this.isReconnect ? 'RECONNECTING' : 'CONNECTING');\n      });\n\n      this.addXMPPClientListener('online', () => {\n        Utils.DLog('[Chat]', 'ONLINE');\n        this.postConnectActions();\n        resolve(true);\n        this.connectPromise = null;\n      });\n\n      this.addXMPPClientListener('offline', () => {\n        Utils.DLog('[Chat]', 'OFFLINE');\n      });\n\n      this.addXMPPClientListener('disconnect', () => {\n        Utils.DLog('[Chat]', 'DISCONNECTED');\n\n        Utils.safeCallbackCall(this.onDisconnectedListener)();\n\n        if (config.chat.reconnect.enable) {\n          this.isConnected = false;\n          this.isConnecting = false;\n        } else {\n          this.disconnect();\n        }\n      });\n\n      this.addXMPPClientListener('status', (status: Chat.ConnectionStatus, value: any) => {\n        Utils.DLog('[Chat]', `status - ${status}`, typeof value === 'object' ? JSON.stringify(value) : '');\n        Utils.safeCallbackCall(this.onChatStatusListener)(status);\n      });\n\n      this.addXMPPClientListener('stanza', (stanza: Chat.XmlElement) => {\n        // it can be a case,\n        // when message came after xmpp auth but before resource binding,\n        // and it can cause some crashes, e.g.\n        // https://github.com/ConnectyCube/connectycube-js-sdk-releases/issues/28\n        if (stanza.is('message') && !this.isConnected) {\n          this.earlyIncomingMessagesQueue.push(stanza);\n          Utils.DLog('[Chat]', \"on 'stanza': enqueue incoming stanza (isConnected=false)\");\n          return;\n        }\n\n        // after 'input' and 'element' (only if stanza, not nonza)\n        if (stanza.is('presence')) {\n          this.onPresence(stanza);\n        } else if (stanza.is('iq')) {\n          this.onIQ(stanza);\n        } else if (stanza.is('message')) {\n          if (stanza.attrs.type === 'headline') {\n            this.onSystemMessage(stanza);\n          } else if (stanza.attrs.type === 'error') {\n            this.onMessageError(stanza);\n          } else {\n            this.onMessage(stanza);\n          }\n        }\n      });\n\n      this.addXMPPClientListener('error', (error) => {\n        Utils.DLog('[Chat]', 'ERROR:', error, {\n          isReconnect: this.isReconnect,\n          connectPromise: !!this.connectPromise,\n        });\n\n        if (this.connectPromise) {\n          if (!this.isReconnect) {\n            reject(error.name == 'SASLError' ? error.condition : error);\n            this.connectPromise = null;\n          }\n        } else {\n          Utils.safeCallbackCall(this.onConnectionErrorListener)(error);\n        }\n      });\n\n      this.addXMPPClientListener('output', (str) => {\n        Utils.callTrafficUsageCallback('xmppDataWrite', { body: str });\n        Utils.DLog('[Chat]', 'SENT:', str);\n      });\n\n      this.addXMPPClientListener('input', (str) => {\n        Utils.callTrafficUsageCallback('xmppDataRead', { body: str });\n        Utils.DLog('[Chat]', 'RECV:', str);\n      });\n\n      // save user connection data so they will be used when authenticate (above)\n      this.xmppClient.options.username = ChatUtils.buildUserJidLocalPart(params.userId);\n      this.xmppClient.options.password = params.password;\n      // start connect\n      this.xmppClient.start().catch((error) => {\n        console.error('[Chat] xmppClient.start error', error);\n        if (this.connectPromise) {\n          reject(error);\n          this.connectPromise = null;\n        } else {\n          Utils.safeCallbackCall(this.onConnectionErrorListener)(error);\n        }\n      });\n    });\n\n    return this.connectPromise;\n  }\n\n  public async ping(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('ping');\n      const iqStanza = ChatUtils.createIqStanza({ id, type: 'get', to: config.endpoints.chat });\n\n      iqStanza.c('ping', { xmlns: 'urn:xmpp:ping' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        const error = ChatUtils.getElement(stanza, 'error');\n        if (error) {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(error));\n        } else {\n          resolve();\n        }\n      };\n\n      this.xmppClient.sendOnline(iqStanza);\n    });\n  }\n\n  public async pingWithTimeout(timeout: number = 5000): Promise<unknown> {\n    return Promise.race([\n      this.ping(),\n      new Promise((_, reject) =>\n        setTimeout(() => {\n          const error = 'Chat ping() timed out';\n          Utils.safeCallbackCall(this.onConnectionErrorListener)(error);\n          reject(error);\n        }, timeout)\n      ),\n    ]);\n  }\n\n  public send(jidOrUserId: string | number, message: Chat.MessageParams = {}): string {\n    const messageId = message.id ?? Utils.getBsonObjectId();\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n      type: message.type ?? this.helpers.typeChat(jidOrUserId),\n      id: messageId,\n    });\n\n    if (!message.id) {\n      message.id = messageId;\n    }\n\n    if (message.body) {\n      messageStanza.c('body').t(message.body).up();\n    }\n\n    if (message.markable) {\n      messageStanza.c('markable', { xmlns: 'urn:xmpp:chat-markers:0' }).up();\n    }\n\n    if (message.extension) {\n      messageStanza.c('extraParams', { xmlns: 'jabber:client' });\n      ChatUtils.assignExtraParamsToXml(messageStanza, message.extension);\n    }\n\n    if (this.streamManagement.supported) {\n      this.streamManagement.sendAndCount(messageStanza, message);\n    } else {\n      this.xmppClient.sendOnline(messageStanza);\n    }\n\n    return messageId;\n  }\n\n  public sendSystemMessage(jidOrUserId: string | number, message: Chat.SystemMessageParams): string {\n    const messageId = message.id ?? Utils.getBsonObjectId();\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'headline',\n      id: messageId,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n    });\n\n    if (message.body) {\n      messageStanza.c('body').t(message.body).up();\n    }\n\n    if (message.extension) {\n      messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('moduleIdentifier').t('SystemNotifications').up();\n      ChatUtils.assignExtraParamsToXml(messageStanza, message.extension);\n    }\n\n    this.xmppClient.sendOnline(messageStanza);\n\n    return messageId;\n  }\n\n  public sendIsTypingStatus(jidOrUserId: string | number): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n      type: this.helpers.typeChat(jidOrUserId),\n    });\n\n    messageStanza.c('composing', { xmlns: 'http://jabber.org/protocol/chatstates' });\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public sendIsStopTypingStatus(jidOrUserId: string | number): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(jidOrUserId),\n      type: this.helpers.typeChat(jidOrUserId),\n    });\n\n    messageStanza.c('paused', { xmlns: 'http://jabber.org/protocol/chatstates' });\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public sendDeliveredStatus(params: Chat.MessageStatusParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'chat',\n      from: this.helpers.userCurrentJid,\n      id: Utils.getBsonObjectId(),\n      to: this.helpers.jidOrUserId(params.userId),\n    });\n\n    messageStanza.c('received', { xmlns: 'urn:xmpp:chat-markers:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public sendReadStatus(params: Chat.MessageStatusParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      type: 'chat',\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.userId),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('displayed', { xmlns: 'urn:xmpp:chat-markers:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public editMessage(params: Chat.EditMessageParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.to),\n      type: this.helpers.typeChat(params.to),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('body').t(params.body).up();\n    messageStanza\n      .c('replace', {\n        xmlns: 'urn:xmpp:message-correct:0',\n        id: params.originMessageId,\n        last: params.last ? 'true' : 'false',\n      })\n      .up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    if (params.extension) {\n      ChatUtils.assignExtraParamsToXml(messageStanza, params.extension);\n    }\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public deleteMessage(params: Chat.DeleteMessageParams): void {\n    const messageStanza = ChatUtils.createMessageStanza({\n      from: this.helpers.userCurrentJid,\n      to: this.helpers.jidOrUserId(params.to),\n      type: this.helpers.typeChat(params.to),\n      id: Utils.getBsonObjectId(),\n    });\n\n    messageStanza.c('remove', { xmlns: 'urn:xmpp:message-delete:0', id: params.messageId }).up();\n    messageStanza.c('extraParams', { xmlns: 'jabber:client' }).c('dialog_id').t(params.dialogId);\n\n    this.xmppClient.sendOnline(messageStanza);\n  }\n\n  public getLastUserActivity(jidOrUserId: string | number): Promise<Chat.LastActivity> {\n    return new Promise((resolve, reject) => {\n      const id = ChatUtils.getUniqueId('lastActivity');\n      const iqStanza = ChatUtils.createIqStanza({\n        type: 'get',\n        from: this.helpers.userCurrentJid,\n        to: this.helpers.jidOrUserId(jidOrUserId),\n        id: id,\n      });\n\n      iqStanza.c('query', { xmlns: 'jabber:iq:last' });\n\n      this.stanzasCallbacks[id] = (stanza: Chat.XmlElement) => {\n        if (ChatUtils.getElement(stanza, 'error')) {\n          reject(ChatUtils.buildErrorFromXMPPErrorStanza(stanza));\n        } else {\n          resolve(this.onLastActivityStanza(stanza));\n        }\n      };\n\n      this.xmppClient.sendOnline(iqStanza);\n    });\n  }\n\n  private onLastActivityStanza(stanza: Chat.XmlElement): Chat.LastActivity {\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const userId = this.helpers.getUserIdFromJID(from);\n    const query = ChatUtils.getElement(stanza, 'query');\n    const seconds = query ? parseInt(ChatUtils.getAttr(query, 'seconds')) : 0;\n\n    Utils.safeCallbackCall(this.onLastUserActivityListener)(userId, seconds);\n\n    return { userId, seconds };\n  }\n\n  public markActive(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('markActive'),\n      type: 'set',\n    });\n\n    iqStanza.c('mobile', {\n      xmlns: 'http://tigase.org/protocol/mobile#v2',\n      enable: 'false',\n    });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  public markInactive(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('markActive'),\n      type: 'set',\n    });\n\n    iqStanza.c('mobile', {\n      xmlns: 'http://tigase.org/protocol/mobile#v2',\n      enable: 'true',\n    });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  public async disconnect(): Promise<boolean> {\n    Utils.DLog('[Chat]', 'disconnect');\n\n    if (this.isLogout) {\n      Utils.DLog('[Chat]', 'Warning! Chat is already disconnected!');\n      return true;\n    }\n\n    this.isLogout = true;\n    this.isReconnect = false;\n    this.isConnected = false;\n    this.isConnecting = false;\n    this.muc.joinedRooms = {};\n    this.helpers.userCurrentJid = '';\n    this.streamManagement.stop();\n\n    try {\n      await this.xmppClient.stop();\n      return true;\n    } catch {\n      return false;\n    }\n  }\n\n  public terminate(): void {\n    Utils.DLog('[Chat]', 'terminated');\n\n    this.isConnected = false;\n    this.isConnecting = false;\n    this.streamManagement.stop();\n    this.xmppClient.socket.end();\n  }\n\n  public async search(params: Chat.SearchParams): Promise<Chat.SearchResult> {\n    const query = Object.assign({}, params);\n\n    if (query.start_date) {\n      query.start_date = new Date(query.start_date).toISOString();\n    }\n    if (query.end_date) {\n      query.end_date = new Date(query.end_date).toISOString();\n    }\n    if (Utils.isArray(query.chat_dialog_ids)) {\n      query.chat_dialog_ids = (query.chat_dialog_ids as string[]).join(',');\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(`${config.urls.chat}/search`),\n      data: query,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  private onMessage(rawStanza: Chat.XmlElement): void {\n    const forwardedStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']);\n    const stanza = forwardedStanza || rawStanza;\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const invite = ChatUtils.getElement(stanza, 'invite');\n    const resource = this.xmppClient.jid?.getResource() || '';\n    const isChat = type === 'chat';\n\n    // ignore private message from the same resource or invite messages from MUC\n    if ((isChat && from.includes(resource)) || invite) {\n      return;\n    }\n\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const markable = ChatUtils.getElement(stanza, 'markable');\n    const delivered = ChatUtils.getElement(stanza, 'received');\n    const read = ChatUtils.getElement(stanza, 'displayed');\n    const replaceSubElement = ChatUtils.getElement(stanza, 'replace');\n    const reactionsSubElement = ChatUtils.getElement(stanza, 'reactions');\n    const removeSubElement = ChatUtils.getElement(stanza, 'remove');\n    const composing = Boolean(ChatUtils.getElement(stanza, 'composing'));\n    const paused = ChatUtils.getElement(stanza, 'paused');\n    const delay = ChatUtils.getElement(stanza, 'delay');\n    const extraParams = ChatUtils.getElement(stanza, 'extraParams');\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const isForwarded = Boolean(forwardedStanza);\n    const isGroup = type === 'groupchat';\n    const recipient = isChat ? ChatUtils.getAttr(stanza, 'to') : null;\n    const recipientId = recipient ? this.helpers.getUserIdFromJID(recipient) : null;\n    const ext = extraParams ? ChatUtils.parseExtraParams(extraParams) : null;\n    const extension = ext ? ext.extension : null;\n    const dialogId = isGroup ? this.helpers.getDialogIdFromJID(from) : ext?.dialogId ?? null;\n    const userId = isGroup ? this.helpers.getIdFromResource(from) : this.helpers.getUserIdFromJID(from);\n    const currentUserJid = this.xmppClient.jid?.toString();\n    const currentUserId = currentUserJid ? this.helpers.getUserIdFromJID(currentUserJid) : 0;\n\n    // typing statuses\n    if (composing || paused) {\n      if (isChat || isGroup || !delay) {\n        Utils.safeCallbackCall(this.onMessageTypingListener)(composing, userId, dialogId);\n      }\n\n      return;\n    }\n\n    // edit message\n    if (replaceSubElement) {\n      Utils.safeCallbackCall(this.onMessageUpdateListener)(\n        ChatUtils.getAttr(replaceSubElement, 'id'),\n        ChatUtils.getAttr(replaceSubElement, 'last') === 'true',\n        body,\n        dialogId,\n        userId,\n        extension\n      );\n\n      return;\n    }\n\n    // reactions\n    if (reactionsSubElement) {\n      if (isForwarded && isGroup) {\n        return;\n      }\n\n      const messageId = ChatUtils.getAttr(reactionsSubElement, 'message_id');\n      const userId = parseInt(ChatUtils.getAttr(reactionsSubElement, 'user_id'));\n      const { add, remove } = ChatUtils.parseReactions(reactionsSubElement);\n\n      Utils.safeCallbackCall(this.onMessageReactionsListener)(messageId, userId, dialogId, add, remove);\n\n      return;\n    }\n\n    // delete message\n    if (removeSubElement) {\n      const messageId = ChatUtils.getAttr(removeSubElement, 'id');\n\n      Utils.safeCallbackCall(this.onMessageDeleteListener)(messageId, dialogId, userId);\n\n      return;\n    }\n\n    // delivered / read statuses\n    if (delivered || read) {\n      if (delivered && isChat) {\n        const id = ChatUtils.getAttr(delivered, 'id');\n        Utils.safeCallbackCall(this.onDeliveredStatusListener)(id, dialogId, userId);\n      }\n      if (read && isChat) {\n        const id = ChatUtils.getAttr(read, 'id');\n        Utils.safeCallbackCall(this.onReadStatusListener)(id, dialogId, userId);\n      }\n\n      return;\n    }\n\n    // auto-send 'received' status (ignore messages from yourself)\n    if (markable && dialogId && userId && userId !== currentUserId) {\n      this.sendDeliveredStatus({ messageId, dialogId, userId });\n    }\n\n    const message: Chat.Message = {\n      id: messageId,\n      dialog_id: dialogId,\n      recipient_id: recipientId,\n      is_forwarded: isForwarded,\n      type,\n      body,\n      extension,\n      delay,\n    };\n\n    if (markable) {\n      message.markable = 1;\n    }\n\n    if (isChat || isGroup) {\n      Utils.safeCallbackCall(this.onMessageListener)(userId, message);\n    }\n  }\n\n  private onPresence(stanza: Chat.XmlElement): void {\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const id = ChatUtils.getAttr(stanza, 'id');\n    const type = ChatUtils.getAttr(stanza, 'type');\n    const currentUserJid = this.xmppClient.jid?.toString();\n    const currentUserId = this.helpers.getUserIdFromJID(currentUserJid);\n    const x = ChatUtils.getElement(stanza, 'x');\n    const xmlns = x ? ChatUtils.getAttr(x, 'xmlns') : null;\n    const status = x ? ChatUtils.getElement(x, 'xmlns') : null;\n    // const statusCode = status ? ChatUtils.getElement(status, 'code') : null;\n    const statusCode = status ? ChatUtils.getElementText(status, 'code') : null;\n\n    // MUC presences\n    if (xmlns && xmlns.startsWith('http://jabber.org/protocol/muc')) {\n      // Error\n      if (type === 'error') {\n        // JOIN to dialog error\n        if (id.endsWith(':join')) {\n          Utils.safeCallbackCall(this.stanzasCallbacks[id])(stanza);\n        }\n        return;\n      }\n\n      const dialogId = this.helpers.getDialogIdFromJID(from);\n      const mucUserId = this.helpers.getUserIdFromRoomJid(from);\n\n      // self presence\n      if (status) {\n        // KICK from dialog event\n        if (statusCode === '301') {\n          const item = ChatUtils.getElement(stanza, 'item');\n          const actorElement = item ? ChatUtils.getElement(item, 'actor') : null;\n          const initiatorUserJid = actorElement ? ChatUtils.getAttr(actorElement, 'jid') : null;\n          const initiatorId = this.helpers.getUserIdFromJID(initiatorUserJid);\n          const roomJid = this.helpers.getRoomJidFromRoomFullJid(from);\n\n          Utils.safeCallbackCall(this.onKickOccupant)(dialogId, initiatorId);\n\n          if (roomJid) {\n            delete this.muc.joinedRooms[roomJid];\n          }\n\n          return;\n        } else {\n          if (type === 'unavailable') {\n            // LEAVE response\n            if (status && statusCode === '110') {\n              Utils.safeCallbackCall(this.stanzasCallbacks['muc:leave'])(null);\n            }\n            return;\n          }\n          // JOIN response\n          if (id.endsWith(':join') && status && statusCode === '110') {\n            this.stanzasCallbacks[id]?.(stanza);\n            return;\n          }\n        }\n        // Occupants JOIN/LEAVE events\n      } else if (mucUserId != currentUserId) {\n        const listenerName = type === 'unavailable' ? 'onLeaveOccupant' : 'onJoinOccupant';\n\n        Utils.safeCallbackCall(this[listenerName])(dialogId, mucUserId);\n\n        return;\n      }\n    }\n  }\n\n  private onIQ(stanza: Chat.XmlElement): void {\n    const stanzaId = ChatUtils.getAttr(stanza, 'id');\n\n    if (this.stanzasCallbacks[stanzaId]) {\n      Utils.safeCallbackCall(this.stanzasCallbacks[stanzaId])(stanza);\n      delete this.stanzasCallbacks[stanzaId];\n    } else {\n      const from = ChatUtils.getAttr(stanza, 'from');\n      const query = ChatUtils.getElement(stanza, 'query');\n      if (from && query) {\n        this.onLastActivityStanza(stanza);\n      }\n    }\n  }\n\n  private onSystemMessage(rawStanza: Chat.XmlElement): void {\n    const forwardedStanza = ChatUtils.getElementTreePath(rawStanza, ['sent', 'forwarded', 'message']);\n    const stanza = forwardedStanza || rawStanza;\n    const from = ChatUtils.getAttr(stanza, 'from');\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const extraParams = ChatUtils.getElement(stanza, 'extraParams');\n    const userId = this.helpers.getUserIdFromJID(from);\n    const delay = ChatUtils.getElement(stanza, 'delay');\n    const moduleIdentifier = extraParams ? ChatUtils.getElementText(extraParams, 'moduleIdentifier') : null;\n    const body = ChatUtils.getElementText(stanza, 'body');\n    const ext = extraParams ? ChatUtils.parseExtraParams(extraParams) : null;\n    const extension = ext ? ext.extension : null;\n\n    switch (moduleIdentifier) {\n      case 'SystemNotifications':\n        Utils.safeCallbackCall(this.onSystemMessageListener)({ id: messageId, userId, body, extension });\n        break;\n      case 'WebRTCVideoChat':\n        if (this.webrtcSignalingProcessor && !delay) {\n          Utils.safeCallbackCall(this.webrtcSignalingProcessor.onMessage)(userId, extraParams);\n        }\n        break;\n      default:\n        break;\n    }\n  }\n\n  private onMessageError(stanza: Chat.XmlElement): void {\n    // <error code=\"503\" type=\"cancel\">\n    //   <service-unavailable xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\"/>\n    //   <text xmlns=\"urn:ietf:params:xml:ns:xmpp-stanzas\" xml:lang=\"en\">Service not available.</text>\n    // </error>\n    const messageId = ChatUtils.getAttr(stanza, 'id');\n    const error = ChatUtils.buildErrorFromXMPPErrorStanza(stanza);\n\n    Utils.safeCallbackCall(this.onMessageErrorListener)(messageId, error);\n  }\n\n  private postConnectActions(): void {\n    Utils.DLog('[Chat]', this.isReconnect ? 'RECONNECTED' : 'CONNECTED');\n\n    const presence = ChatUtils.createPresenceStanza();\n\n    this.streamManagement.start();\n    this.helpers.userCurrentJid = this.xmppClient.jid?.toString() ?? null;\n    this.isConnected = true;\n    this.isConnecting = false;\n    this.enableCarbons();\n    this.xmppClient.sendOnline(presence); // initial presence\n\n    if (this.isReconnect) {\n      // reconnect\n      Utils.safeCallbackCall(this.onReconnectListener)();\n    } else {\n      this.isReconnect = true;\n    }\n\n    if (this.earlyIncomingMessagesQueue.length > 0) {\n      Utils.DLog('[Chat]', `Flush 'earlyIncomingMessagesQueue' (length=${this.earlyIncomingMessagesQueue.length})`);\n\n      const stanzasCallback = this.xmppClientListeners.get('stanza');\n\n      this.earlyIncomingMessagesQueue.forEach((stanza) => {\n        stanzasCallback?.(stanza);\n      });\n      this.earlyIncomingMessagesQueue = [];\n    }\n  }\n\n  private enableCarbons(): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      type: 'set',\n      from: this.helpers.userCurrentJid,\n      id: ChatUtils.getUniqueId('enableCarbons'),\n    });\n\n    iqStanza.c('enable', { xmlns: 'urn:xmpp:carbons:2' });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  private setSubscriptionToUserLastActivity(jidOrUserId: string | number, enable: boolean): void {\n    const iqStanza = ChatUtils.createIqStanza({\n      id: this.helpers.getUniqueId('statusStreaming'),\n      type: 'set',\n    });\n\n    iqStanza.c('subscribe', {\n      xmlns: 'https://connectycube.com/protocol/status_streaming',\n      user_jid: this.helpers.jidOrUserId(jidOrUserId),\n      enable,\n    });\n\n    this.xmppClient.sendOnline(iqStanza);\n  }\n\n  subscribeToUserLastActivityStatus(jidOrUserId: string | number) {\n    this.setSubscriptionToUserLastActivity(jidOrUserId, true);\n  }\n\n  unsubscribeFromUserLastActivityStatus(jidOrUserId: string | number) {\n    this.setSubscriptionToUserLastActivity(jidOrUserId, false);\n  }\n\n  private addXMPPClientListener(name: Chat.XMPPClientEvent, listener: Chat.XMPPClientListener): void {\n    this.xmppClient.on(name, listener);\n    this.xmppClientListeners.set(name, listener);\n  }\n\n  private removeXMPPClientListener(name: Chat.XMPPClientEvent): void {\n    const listener = this.xmppClientListeners.get(name);\n    if (listener) {\n      this.xmppClient.removeListener(name, listener);\n    }\n    this.xmppClientListeners.delete(name);\n  }\n\n  private removeAllXMPPClientListeners(): void {\n    this.xmppClientListeners.forEach((_, name) => this.removeXMPPClientListener(name));\n  }\n\n  private getListenerByName(name: ChatEvent): Chat.ListenerName | null {\n    switch (name) {\n      case ChatEvent.STATUS:\n        return 'onChatStatusListener';\n      case ChatEvent.ERROR:\n        return 'onConnectionErrorListener';\n      case ChatEvent.DISCONNECTED:\n        return 'onDisconnectedListener';\n      case ChatEvent.RECONNECTED:\n        return 'onReconnectListener';\n      case ChatEvent.MESSAGE:\n        return 'onMessageListener';\n      case ChatEvent.SYSTEM_MESSAGE:\n        return 'onSystemMessageListener';\n      case ChatEvent.ERROR_MESSAGE:\n        return 'onMessageErrorListener';\n      case ChatEvent.TYPING_MESSAGE:\n        return 'onMessageTypingListener';\n      case ChatEvent.UPDATE_MESSAGE:\n        return 'onMessageUpdateListener';\n      case ChatEvent.DELETE_MESSAGE:\n        return 'onMessageDeleteListener';\n      case ChatEvent.REACTIONS_MESSAGE:\n        return 'onMessageReactionsListener';\n      case ChatEvent.DELIVERED_MESSAGE:\n        return 'onDeliveredStatusListener';\n      case ChatEvent.READ_MESSAGE:\n        return 'onReadStatusListener';\n      case ChatEvent.SENT_MESSAGE:\n        return 'onSentMessageCallback';\n      case ChatEvent.USER_LAST_ACTIVITY:\n        return 'onLastUserActivityListener';\n      case ChatEvent.JOIN:\n        return 'onJoinOccupant';\n      case ChatEvent.LEAVE:\n        return 'onLeaveOccupant';\n      case ChatEvent.KICK:\n        return 'onKickOccupant';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: ChatEvent, listener: Chat.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Chat.Listeners) = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: ChatEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Chat.Listeners | undefined) = undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key: string) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key as Chat.ListenerName] === 'function') {\n        (this[key as Chat.ListenerName] as Chat.Listeners | undefined) = undefined;\n      }\n    });\n  }\n}\n","const {\n  adapter,\n  navigator,\n  MediaStream,\n  MediaStreamTrack,\n  RTCPeerConnection,\n  RTCRtpReceiver,\n  RTCRtpSender,\n  isReactNative\n} = require('../platform');\n\n('use strict');\n/*\n  The MIT License (MIT)\n\n  Copyright (c) 2016 Meetecho\n\n  Permission is hereby granted, free of charge, to any person obtaining\n  a copy of this software and associated documentation files (the \"Software\"),\n  to deal in the Software without restriction, including without limitation\n  the rights to use, copy, modify, merge, publish, distribute, sublicense,\n  and/or sell copies of the Software, and to permit persons to whom the\n  Software is furnished to do so, subject to the following conditions:\n\n  The above copyright notice and this permission notice shall be included\n  in all copies or substantial portions of the Software.\n\n  THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n  OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n  FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL\n  THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR\n  OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE,\n  ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR\n  OTHER DEALINGS IN THE SOFTWARE.\n */\n\n// List of sessions\nJanus.sessions = {};\n\nJanus.mobile = isReactNative;\n\nJanus.isExtensionEnabled = function () {\n  if (Janus.mobile) {\n    return false;\n  }\n  if (navigator.mediaDevices && navigator.mediaDevices.getDisplayMedia) {\n    // No need for the extension, getDisplayMedia is supported\n    return true;\n  }\n  if (window.navigator.userAgent.match('Chrome')) {\n    let chromever = parseInt(window.navigator.userAgent.match(/Chrome\\/(.*) /)[1], 10);\n    let maxver = 33;\n    if (window.navigator.userAgent.match('Linux')) maxver = 35; // \"known\" crash in chrome 34 and 35 on linux\n    if (chromever >= 26 && chromever <= maxver) {\n      // Older versions of Chrome don't support this extension-based approach, so lie\n      return true;\n    }\n    return Janus.extension.isInstalled();\n  } else {\n    // Firefox and others, no need for the extension (but this doesn't mean it will work)\n    return true;\n  }\n};\n\nconst defaultExtension = {\n  // Screensharing Chrome Extension ID\n  extensionId: 'hapfgfdkleiggjjpfpenajgdnfckjpaj',\n  isInstalled: function () {\n    if (Janus.mobile) {\n      return false;\n    } else {\n      return document.querySelector('#janus-extension-installed') !== null;\n    }\n  },\n  getScreen: function (callback) {\n    if (Janus.mobile) {\n      callback();\n    } else {\n      let pending = window.setTimeout(function () {\n        let error = new Error('NavigatorUserMediaError');\n        error.name =\n          'The required Chrome extension is not installed: click <a href=\"#\">here</a> to install it. (NOTE: this will need you to refresh the page)';\n        return callback(error);\n      }, 1000);\n      this.cache[pending] = callback;\n      window.postMessage({ type: 'janusGetScreen', id: pending }, '*');\n    }\n  },\n  init: function () {\n    let cache = {};\n    this.cache = cache;\n    // Wait for events from the Chrome Extension\n    if (!Janus.mobile) {\n      window.addEventListener('message', function (event) {\n        if (event.origin != window.location.origin) return;\n        if (event.data.type == 'janusGotScreen' && cache[event.data.id]) {\n          let callback = cache[event.data.id];\n          delete cache[event.data.id];\n          if (event.data.sourceId === '') {\n            // user canceled\n            let error = new Error('NavigatorUserMediaError');\n            error.name = 'You cancelled the request for permission, giving up...';\n            callback(error);\n          } else {\n            callback(null, event.data.sourceId);\n          }\n        } else if (event.data.type == 'janusGetScreenPending') {\n          window.clearTimeout(event.data.id);\n        }\n      });\n    }\n  },\n};\n\nJanus.useDefaultDependencies = function (deps) {\n  let f = (deps && deps.fetch) || fetch;\n  let p = (deps && deps.Promise) || Promise;\n  let socketCls = (deps && deps.WebSocket) || WebSocket;\n\n  return {\n    newWebSocket: function (server, proto) {\n      return new socketCls(server, proto);\n    },\n    extension: (deps && deps.extension) || defaultExtension,\n    isArray: function (arr) {\n      return Array.isArray(arr);\n    },\n    webRTCAdapter: (deps && deps.adapter) || adapter,\n    httpAPICall: function (url, options) {\n      let fetchOptions = {\n        method: options.verb,\n        headers: {\n          Accept: 'application/json, text/plain, */*',\n        },\n        cache: 'no-cache',\n      };\n      if (options.verb === 'POST') {\n        fetchOptions.headers['Content-Type'] = 'application/json';\n      }\n      if (typeof options.withCredentials !== 'undefined') {\n        fetchOptions.credentials =\n          options.withCredentials === true ? 'include' : options.withCredentials ? options.withCredentials : 'omit';\n      }\n      if (options.body) {\n        fetchOptions.body = JSON.stringify(options.body);\n      }\n\n      let fetching = f(url, fetchOptions).catch(function (error) {\n        return p.reject({\n          message: 'Probably a network error, is the server down?',\n          error: error,\n        });\n      });\n\n      /*\n       * fetch() does not natively support timeouts.\n       * Work around this by starting a timeout manually, and racing it agains the fetch() to see which thing resolves first.\n       */\n\n      if (options.timeout) {\n        let timeout = new p(function (resolve, reject) {\n          let timerId = setTimeout(function () {\n            clearTimeout(timerId);\n            return reject({\n              message: 'Request timed out',\n              timeout: options.timeout,\n            });\n          }, options.timeout);\n        });\n        fetching = p.race([fetching, timeout]);\n      }\n\n      fetching\n        .then(function (response) {\n          if (response.ok) {\n            if (typeof options.success === typeof Janus.noop) {\n              return response.json().then(\n                function (parsed) {\n                  try {\n                    options.success(parsed);\n                  } catch (error) {\n                    Janus.error('Unhandled httpAPICall success callback error', error);\n                  }\n                },\n                function (error) {\n                  return p.reject({\n                    message: 'Failed to parse response body',\n                    error: error,\n                    response: response,\n                  });\n                }\n              );\n            }\n          } else {\n            return p.reject({ message: 'API call failed', response: response });\n          }\n        })\n        .catch(function (error) {\n          if (typeof options.error === typeof Janus.noop) {\n            options.error(error.message || '<< internal error >>', error);\n          }\n        });\n\n      return fetching;\n    },\n  };\n};\n\nJanus.useOldDependencies = function (deps) {\n  let jq = (deps && deps.jQuery) || jQuery;\n  let socketCls = (deps && deps.WebSocket) || WebSocket;\n  return {\n    newWebSocket: function (server, proto) {\n      return new socketCls(server, proto);\n    },\n    isArray: function (arr) {\n      return jq.isArray(arr);\n    },\n    extension: (deps && deps.extension) || defaultExtension,\n    webRTCAdapter: (deps && deps.adapter) || adapter,\n    httpAPICall: function (url, options) {\n      let payload =\n        typeof options.body !== 'undefined'\n          ? {\n            contentType: 'application/json',\n            data: JSON.stringify(options.body),\n          }\n          : {};\n      let credentials =\n        typeof options.withCredentials !== 'undefined'\n          ? { xhrFields: { withCredentials: options.withCredentials } }\n          : {};\n\n      return jq.ajax(\n        jq.extend(payload, credentials, {\n          url: url,\n          type: options.verb,\n          cache: false,\n          dataType: 'json',\n          async: options.async,\n          timeout: options.timeout,\n          success: function (result) {\n            if (typeof options.success === typeof Janus.noop) {\n              options.success(result);\n            }\n          },\n          error: function (xhr, status, err) {\n            if (typeof options.error === typeof Janus.noop) {\n              options.error(status, err);\n            }\n          },\n        })\n      );\n    },\n  };\n};\n\n// Helper function to convert a deprecated media object to a tracks array\nJanus.mediaToTracks = function (media) {\n  let tracks = [];\n  if (!media) {\n    // Default is bidirectional audio and video, using default devices\n    tracks.push({ type: 'audio', capture: true, recv: true });\n    tracks.push({ type: 'video', capture: true, recv: true });\n  } else {\n    if (\n      !media.keepAudio &&\n      media.audio !== false &&\n      (typeof media.audio === 'undefined' ||\n        media.audio ||\n        media.audioSend ||\n        media.audioRecv ||\n        media.addAudio ||\n        media.replaceAudio ||\n        media.removeAudio)\n    ) {\n      // We may need an audio track\n      let track = { type: 'audio' };\n      if (media.removeAudio) {\n        track.remove = true;\n      } else {\n        if (media.addAudio) track.add = true;\n        else if (media.replaceAudio) track.replace = true;\n        // Check if we need to capture an audio device\n        if (media.audioSend !== false) track.capture = media.audio || true;\n        // Check if we need to receive audio\n        if (media.audioRecv !== false) track.recv = true;\n      }\n      // Add an audio track if needed\n      if (track.remove || track.capture || track.recv) tracks.push(track);\n    }\n    if (\n      !media.keepVideo &&\n      media.video !== false &&\n      (typeof media.video === 'undefined' ||\n        media.video ||\n        media.videoSend ||\n        media.videoRecv ||\n        media.addVideo ||\n        media.replaceVideo ||\n        media.removeVideo)\n    ) {\n      // We may need a video track\n      let track = { type: 'video' };\n      if (media.removeVideo) {\n        track.remove = true;\n      } else {\n        if (media.addVideo) track.add = true;\n        else if (media.replaceVideo) track.replace = true;\n        // Check if we need to capture a video device\n        if (media.videoSend !== false) {\n          track.capture = media.video || true;\n          if (['screen', 'window', 'desktop'].includes(track.capture)) {\n            // Change the type to 'screen'\n            track.type = 'screen';\n            track.capture = { video: {} };\n            // Check if there's constraints\n            if (media.screenshareFrameRate) track.capture.frameRate = media.screenshareFrameRate;\n            if (media.screenshareHeight) track.capture.height = media.screenshareHeight;\n            if (media.screenshareWidth) track.capture.width = media.screenshareWidth;\n          }\n        }\n        // Check if we need to receive video\n        if (media.videoRecv !== false) track.recv = true;\n      }\n      // Add a video track if needed\n      if (track.remove || track.capture || track.recv) tracks.push(track);\n    }\n    if (media.data) {\n      // We need a data channel\n      tracks.push({ type: 'data' });\n    }\n  }\n  // Done\n  return tracks;\n};\n\n// Helper function to convert a track object to a set of constraints\nJanus.trackConstraints = function (track) {\n  let constraints = {};\n  if (!track || !track.capture) return constraints;\n  if (track.type === 'audio') {\n    // Just put the capture part in the constraints\n    constraints.audio = track.capture;\n  } else if (track.type === 'video') {\n    // Check if one of the keywords was passed\n    if ((track.simulcast || track.svc) && track.capture === true) track.capture = 'hires';\n    if (track.capture === true || typeof track.capture === 'object') {\n      // Use the provided capture object as video constraint\n      constraints.video = track.capture;\n    } else {\n      let width = 0;\n      let height = 0;\n      if (track.capture === 'lowres') {\n        // Small resolution, 4:3\n        width = 320;\n        height = 240;\n      } else if (track.capture === 'lowres-16:9') {\n        // Small resolution, 16:9\n        width = 320;\n        height = 180;\n      } else if (track.capture === 'hires' || track.capture === 'hires-16:9' || track.capture === 'hdres') {\n        // High(HD) resolution is only 16:9\n        width = 1280;\n        height = 720;\n      } else if (track.capture === 'fhdres') {\n        // Full HD resolution is only 16:9\n        width = 1920;\n        height = 1080;\n      } else if (track.capture === '4kres') {\n        // 4K resolution is only 16:9\n        width = 3840;\n        height = 2160;\n      } else if (track.capture === 'stdres') {\n        // Normal resolution, 4:3\n        width = 640;\n        height = 480;\n      } else if (track.capture === 'stdres-16:9') {\n        // Normal resolution, 16:9\n        width = 640;\n        height = 360;\n      } else {\n        Janus.log('Default video setting is stdres 4:3');\n        width = 640;\n        height = 480;\n      }\n      constraints.video = {\n        width: { ideal: width },\n        height: { ideal: height },\n      };\n    }\n  } else if (track.type === 'screen') {\n    // Use the provided capture object as video constraint\n    constraints.video = track.capture;\n  }\n  return constraints;\n};\n\nJanus.noop = function () { };\n\nJanus.dataChanDefaultLabel = 'JanusDataChannel';\n\n// Note: in the future we may want to change this, e.g., as was\n// attempted in https://github.com/meetecho/janus-gateway/issues/1670\nJanus.endOfCandidates = null;\n\n// Stop all tracks from a given stream\nJanus.stopAllTracks = function (stream) {\n  try {\n    // Try a MediaStreamTrack.stop() for each track\n    let tracks = stream.getTracks();\n    for (let mst of tracks) {\n      Janus.log(mst);\n      if (mst && mst.dontStop !== true) {\n        mst.stop();\n      }\n    }\n  } catch (e) {\n    // Do nothing if this fails\n  }\n};\n\n// Initialization\nJanus.init = function (options) {\n  options = options || {};\n  options.callback = typeof options.callback == 'function' ? options.callback : Janus.noop;\n  if (Janus.initDone) {\n    // Already initialized\n    options.callback();\n  } else {\n    if (typeof console.log == 'undefined') {\n      console.log = function () { };\n    }\n    // Console logging (all debugging disabled by default)\n    Janus.trace = Janus.noop;\n    Janus.debug = Janus.noop;\n    Janus.vdebug = Janus.noop;\n    Janus.log = Janus.noop;\n    Janus.warn = Janus.noop;\n    Janus.error = Janus.noop;\n    if (options.debug === true || options.debug === 'all') {\n      // Enable all debugging levels\n      Janus.trace = console.trace.bind(console);\n      Janus.debug = console.debug.bind(console);\n      Janus.vdebug = console.debug.bind(console);\n      Janus.log = console.log.bind(console);\n      Janus.warn = console.warn.bind(console);\n      Janus.error = console.error.bind(console);\n    } else if (Array.isArray(options.debug)) {\n      for (let d of options.debug) {\n        switch (d) {\n          case 'trace':\n            Janus.trace = console.trace.bind(console);\n            break;\n          case 'debug':\n            Janus.debug = console.debug.bind(console);\n            break;\n          case 'vdebug':\n            Janus.vdebug = console.debug.bind(console);\n            break;\n          case 'log':\n            Janus.log = console.log.bind(console);\n            break;\n          case 'warn':\n            Janus.warn = console.warn.bind(console);\n            break;\n          case 'error':\n            Janus.error = console.error.bind(console);\n            break;\n          default:\n            console.error(\n              \"Unknown debugging option '\" + d + \"' (supported: 'trace', 'debug', 'vdebug', 'log', warn', 'error')\"\n            );\n            break;\n        }\n      }\n    }\n    Janus.log('Initializing library');\n\n    let usedDependencies = options.dependencies || Janus.useDefaultDependencies();\n    Janus.isArray = usedDependencies.isArray;\n    Janus.webRTCAdapter = usedDependencies.webRTCAdapter;\n    Janus.httpAPICall = usedDependencies.httpAPICall;\n    Janus.newWebSocket = usedDependencies.newWebSocket;\n    Janus.extension = usedDependencies.extension;\n    Janus.extension.init();\n\n    // Helper method to enumerate devices\n    Janus.listDevices = function (callback, config) {\n      callback = typeof callback == 'function' ? callback : Janus.noop;\n      if (!config) config = { audio: true, video: true };\n      if (Janus.isGetUserMediaAvailable()) {\n        navigator.mediaDevices\n          .getUserMedia(config)\n          .then(function (stream) {\n            navigator.mediaDevices.enumerateDevices().then(function (devices) {\n              Janus.debug(devices);\n              callback(devices);\n              // Get rid of the now useless stream\n              Janus.stopAllTracks(stream);\n            });\n          })\n          .catch(function (err) {\n            Janus.error(err);\n            callback([]);\n          });\n      } else {\n        Janus.warn('navigator.mediaDevices unavailable');\n        callback([]);\n      }\n    };\n    // Helper methods to attach/reattach a stream to a video element (previously part of adapter.js)\n    // Janus.attachMediaStream = function(element, stream) {\n    // \ttry {\n    // \t\telement.srcObject = stream;\n    // \t} catch (e) {\n    // \t\ttry {\n    // \t\t\telement.src = URL.createObjectURL(stream);\n    // \t\t} catch (e) {\n    // \t\t\tJanus.error(\"Error attaching stream to element\", e);\n    // \t\t}\n    // \t}\n    // };\n    // Janus.reattachMediaStream = function(to, from) {\n    // \ttry {\n    // \t\tto.srcObject = from.srcObject;\n    // \t} catch (e) {\n    // \t\ttry {\n    // \t\t\tto.src = from.src;\n    // \t\t} catch (e) {\n    // \t\t\tJanus.error(\"Error reattaching stream to element\", e);\n    // \t\t}\n    // \t}\n    // };\n    // Detect tab close: make sure we don't loose existing onbeforeunload handlers\n    // (note: for iOS we need to subscribe to a different event, 'pagehide', see\n    // https://gist.github.com/thehunmonkgroup/6bee8941a49b86be31a787fe8f4b8cfe)\n    // let iOS = ['iPad', 'iPhone', 'iPod'].indexOf(navigator.platform) >= 0;\n    // let eventName = iOS ? 'pagehide' : 'beforeunload';\n    // let oldOBF = window[\"on\" + eventName];\n    // window.addEventListener(eventName, function() {\n    // \tJanus.log(\"Closing window\");\n    // \tfor(let s in Janus.sessions) {\n    // \t\tif(Janus.sessions[s] && Janus.sessions[s].destroyOnUnload) {\n    // \t\t\tJanus.log(\"Destroying session \" + s);\n    // \t\t\tJanus.sessions[s].destroy({unload: true, notifyDestroyed: false});\n    // \t\t}\n    // \t}\n    // \tif(oldOBF && typeof oldOBF == \"function\") {\n    // \t\toldOBF();\n    // \t}\n    // });\n    // If this is a Safari Technology Preview, check if VP8 is supported\n    Janus.safariVp8 = false;\n    if (Janus.webRTCAdapter.browserDetails.browser === 'safari' && Janus.webRTCAdapter.browserDetails.version >= 605) {\n      // Let's see if RTCRtpSender.getCapabilities() is there\n      if (\n        RTCRtpSender &&\n        RTCRtpSender.getCapabilities &&\n        RTCRtpSender.getCapabilities('video') &&\n        RTCRtpSender.getCapabilities('video').codecs &&\n        RTCRtpSender.getCapabilities('video').codecs.length\n      ) {\n        for (let codec of RTCRtpSender.getCapabilities('video').codecs) {\n          if (codec && codec.mimeType && codec.mimeType.toLowerCase() === 'video/vp8') {\n            Janus.safariVp8 = true;\n            break;\n          }\n        }\n        if (Janus.safariVp8) {\n          Janus.log('This version of Safari supports VP8');\n        } else {\n          Janus.warn(\n            \"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n            \"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\"\n          );\n        }\n      } else {\n        // We do it in a very ugly way, as there's no alternative...\n        // We create a PeerConnection to see if VP8 is in an offer\n        let testpc = new RTCPeerConnection({});\n        testpc.createOffer({ offerToReceiveVideo: true }).then(function (offer) {\n          Janus.safariVp8 = offer.sdp.indexOf('VP8') !== -1;\n          if (Janus.safariVp8) {\n            Janus.log('This version of Safari supports VP8');\n          } else {\n            Janus.warn(\n              \"This version of Safari does NOT support VP8: if you're using a Technology Preview, \" +\n              \"try enabling the 'WebRTC VP8 codec' setting in the 'Experimental Features' Develop menu\"\n            );\n          }\n          testpc.close();\n          testpc = null;\n        });\n      }\n    }\n    Janus.initDone = true;\n    options.callback();\n  }\n};\n\n// Helper method to check whether WebRTC is supported by this browser\nJanus.isWebrtcSupported = function () {\n  return !!RTCPeerConnection;\n};\n// Helper method to check whether devices can be accessed by this browser (e.g., not possible via plain HTTP)\nJanus.isGetUserMediaAvailable = function () {\n  return navigator.mediaDevices && navigator.mediaDevices.getUserMedia;\n};\n\n// Helper method to create random identifiers (e.g., transaction)\nJanus.randomString = function (len) {\n  let charSet = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';\n  let randomString = '';\n  for (let i = 0; i < len; i++) {\n    let randomPoz = Math.floor(Math.random() * charSet.length);\n    randomString += charSet.charAt(randomPoz);\n  }\n  return randomString;\n};\n\nfunction Janus(gatewayCallbacks) {\n  gatewayCallbacks = gatewayCallbacks || {};\n  gatewayCallbacks.success = typeof gatewayCallbacks.success == 'function' ? gatewayCallbacks.success : Janus.noop;\n  gatewayCallbacks.error = typeof gatewayCallbacks.error == 'function' ? gatewayCallbacks.error : Janus.noop;\n  gatewayCallbacks.destroyed =\n    typeof gatewayCallbacks.destroyed == 'function' ? gatewayCallbacks.destroyed : Janus.noop;\n  if (!Janus.initDone) {\n    gatewayCallbacks.error('Library not initialized');\n    return {};\n  }\n  if (!Janus.isWebrtcSupported()) {\n    gatewayCallbacks.error('WebRTC not supported by this browser');\n    return {};\n  }\n  Janus.log('Library initialized: ' + Janus.initDone);\n  if (!gatewayCallbacks.server) {\n    gatewayCallbacks.error('Invalid server url');\n    return {};\n  }\n  let websockets = false;\n  let ws = null;\n  let wsHandlers = {};\n  let wsKeepaliveTimeoutId = null;\n  let servers = null;\n  let serversIndex = 0;\n  let server = gatewayCallbacks.server;\n  if (Janus.isArray(server)) {\n    Janus.log('Multiple servers provided (' + server.length + '), will use the first that works');\n    server = null;\n    servers = gatewayCallbacks.server;\n    Janus.debug(servers);\n  } else {\n    if (server.indexOf('ws') === 0) {\n      websockets = true;\n      Janus.log('Using WebSockets to contact Janus: ' + server);\n    } else {\n      websockets = false;\n      Janus.log('Using REST API to contact Janus: ' + server);\n    }\n  }\n  let iceServers = gatewayCallbacks.iceServers || [{ urls: 'stun:stun.l.google.com:19302' }];\n  let iceTransportPolicy = gatewayCallbacks.iceTransportPolicy;\n  let bundlePolicy = gatewayCallbacks.bundlePolicy;\n  // Whether we should enable the withCredentials flag for XHR requests\n  let withCredentials = false;\n  if (typeof gatewayCallbacks.withCredentials !== 'undefined' && gatewayCallbacks.withCredentials !== null)\n    withCredentials = gatewayCallbacks.withCredentials === true;\n  // Optional max events\n  let maxev = 10;\n  if (typeof gatewayCallbacks.max_poll_events !== 'undefined' && gatewayCallbacks.max_poll_events !== null)\n    maxev = gatewayCallbacks.max_poll_events;\n  if (maxev < 1) maxev = 1;\n  // Token to use (only if the token based authentication mechanism is enabled)\n  let token = null;\n  if (typeof gatewayCallbacks.token !== 'undefined' && gatewayCallbacks.token !== null) token = gatewayCallbacks.token;\n  // API secret to use (only if the shared API secret is enabled)\n  let apisecret = null;\n  if (typeof gatewayCallbacks.apisecret !== 'undefined' && gatewayCallbacks.apisecret !== null)\n    apisecret = gatewayCallbacks.apisecret;\n  // Whether we should destroy this session when onbeforeunload is called\n  this.destroyOnUnload = true;\n  if (typeof gatewayCallbacks.destroyOnUnload !== 'undefined' && gatewayCallbacks.destroyOnUnload !== null)\n    this.destroyOnUnload = gatewayCallbacks.destroyOnUnload === true;\n  // Some timeout-related values\n  let keepAlivePeriod = 25000;\n  if (typeof gatewayCallbacks.keepAlivePeriod !== 'undefined' && gatewayCallbacks.keepAlivePeriod !== null)\n    keepAlivePeriod = gatewayCallbacks.keepAlivePeriod;\n  if (isNaN(keepAlivePeriod)) keepAlivePeriod = 25000;\n  let longPollTimeout = 60000;\n  if (typeof gatewayCallbacks.longPollTimeout !== 'undefined' && gatewayCallbacks.longPollTimeout !== null)\n    longPollTimeout = gatewayCallbacks.longPollTimeout;\n  if (isNaN(longPollTimeout)) longPollTimeout = 60000;\n\n  // overrides for default maxBitrate values for simulcasting\n  function getMaxBitrates(simulcastMaxBitrates) {\n    let maxBitrates = {\n      high: 900000,\n      medium: 300000,\n      low: 100000,\n    };\n\n    if (typeof simulcastMaxBitrates !== 'undefined' && simulcastMaxBitrates !== null) {\n      if (simulcastMaxBitrates.high) maxBitrates.high = simulcastMaxBitrates.high;\n      if (simulcastMaxBitrates.medium) maxBitrates.medium = simulcastMaxBitrates.medium;\n      if (simulcastMaxBitrates.low) maxBitrates.low = simulcastMaxBitrates.low;\n    }\n\n    return maxBitrates;\n  }\n\n  let connected = false;\n  let sessionId = null;\n  let pluginHandles = {};\n  let that = this;\n  let retries = 0;\n  let transactions = {};\n  createSession(gatewayCallbacks);\n\n  // Public methods\n  this.getServer = function () {\n    return server;\n  };\n  this.isConnected = function () {\n    return connected;\n  };\n  this.reconnect = function (callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    callbacks['reconnect'] = true;\n    createSession(callbacks);\n  };\n  this.getSessionId = function () {\n    return sessionId;\n  };\n  this.getInfo = function (callbacks) {\n    getInfo(callbacks);\n  };\n  this.destroy = function (callbacks) {\n    destroySession(callbacks);\n  };\n  this.attach = function (callbacks) {\n    createHandle(callbacks);\n  };\n\n  function eventHandler() {\n    if (sessionId == null) return;\n    Janus.debug('Long poll...');\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      return;\n    }\n    let longpoll = server + '/' + sessionId + '?rid=' + new Date().getTime();\n    if (maxev) longpoll = longpoll + '&maxev=' + maxev;\n    if (token) longpoll = longpoll + '&token=' + encodeURIComponent(token);\n    if (apisecret) longpoll = longpoll + '&apisecret=' + encodeURIComponent(apisecret);\n    Janus.httpAPICall(longpoll, {\n      verb: 'GET',\n      withCredentials: withCredentials,\n      success: handleEvent,\n      timeout: longPollTimeout,\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown);\n        retries++;\n        if (retries > 3) {\n          // Did we just lose the server? :-(\n          connected = false;\n          gatewayCallbacks.error('Lost connection to the server (is it down?)');\n          return;\n        }\n        eventHandler();\n      },\n    });\n  }\n\n  // Private event handler: this will trigger plugin callbacks, if set\n  function handleEvent(json, skipTimeout) {\n    retries = 0;\n    if (!websockets && typeof sessionId !== 'undefined' && sessionId !== null && skipTimeout !== true) eventHandler();\n    if (!websockets && Janus.isArray(json)) {\n      // We got an array: it means we passed a maxev > 1, iterate on all objects\n      for (let i = 0; i < json.length; i++) {\n        handleEvent(json[i], true);\n      }\n      return;\n    }\n    if (json['janus'] === 'keepalive') {\n      // Nothing happened\n      Janus.vdebug('Got a keepalive on session ' + sessionId);\n      return;\n    } else if (json['janus'] === 'server_info') {\n      // Just info on the Janus instance\n      Janus.debug('Got info on the Janus instance');\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'ack') {\n      // Just an ack, we can probably ignore\n      Janus.debug('Got an ack on session ' + sessionId);\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'success') {\n      // Success!\n      Janus.debug('Got a success on session ' + sessionId);\n      Janus.debug(json);\n      const transaction = json['transaction'];\n      if (transaction) {\n        const reportSuccess = transactions[transaction];\n        if (reportSuccess) reportSuccess(json);\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'trickle') {\n      // We got a trickle candidate from Janus\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      let candidate = json['candidate'];\n      Janus.debug('Got a trickled candidate on session ' + sessionId);\n      Janus.debug(candidate);\n      let config = pluginHandle.webrtcStuff;\n      if (config.pc && config.remoteSdp) {\n        // Add candidate right now\n        Janus.debug('Adding remote candidate:', candidate);\n        if (!candidate || candidate.completed === true) {\n          // end-of-candidates\n          config.pc.addIceCandidate(Janus.endOfCandidates);\n        } else {\n          // New candidate\n          config.pc.addIceCandidate(candidate);\n        }\n      } else {\n        // We didn't do setRemoteDescription (trickle got here before the offer?)\n        Janus.debug(\"We didn't do setRemoteDescription (trickle got here before the offer?), caching candidate\");\n        if (!config.candidates) config.candidates = [];\n        config.candidates.push(candidate);\n        Janus.debug(config.candidates);\n      }\n    } else if (json['janus'] === 'webrtcup') {\n      // The PeerConnection with the server is up! Notify this\n      Janus.debug('Got a webrtcup event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.webrtcState(true);\n      return;\n    } else if (json['janus'] === 'hangup') {\n      // A plugin asked the core to hangup a PeerConnection on one of our handles\n      Janus.debug('Got a hangup event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.webrtcState(false, json['reason']);\n      pluginHandle.hangup();\n    } else if (json['janus'] === 'detached') {\n      // A plugin asked the core to detach one of our handles\n      Janus.debug('Got a detached event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        // Don't warn here because destroyHandle causes this situation.\n        return;\n      }\n      pluginHandle.ondetached();\n      pluginHandle.detach();\n    } else if (json['janus'] === 'media') {\n      // Media started/stopped flowing\n      Janus.debug('Got a media event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.mediaState(json['type'], json['receiving'], json['mid']);\n    } else if (json['janus'] === 'slowlink') {\n      Janus.debug('Got a slowlink event on session ' + sessionId);\n      Janus.debug(json);\n      // Trouble uplink or downlink\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.debug('This handle is not attached to this session');\n        return;\n      }\n      pluginHandle.slowLink(json['uplink'], json['lost'], json['mid']);\n    } else if (json['janus'] === 'error') {\n      // Oops, something wrong happened\n      Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n      Janus.debug(json);\n      let transaction = json['transaction'];\n      if (transaction) {\n        let reportSuccess = transactions[transaction];\n        if (reportSuccess) {\n          reportSuccess(json);\n        }\n        delete transactions[transaction];\n      }\n      return;\n    } else if (json['janus'] === 'event') {\n      Janus.debug('Got a plugin event on session ' + sessionId);\n      Janus.debug(json);\n      const sender = json['sender'];\n      if (!sender) {\n        Janus.warn('Missing sender...');\n        return;\n      }\n      let plugindata = json['plugindata'];\n      if (!plugindata) {\n        Janus.warn('Missing plugindata...');\n        return;\n      }\n      Janus.debug('  -- Event is coming from ' + sender + ' (' + plugindata['plugin'] + ')');\n      let data = plugindata['data'];\n      Janus.debug(data);\n      const pluginHandle = pluginHandles[sender];\n      if (!pluginHandle) {\n        Janus.warn('This handle is not attached to this session');\n        return;\n      }\n      let jsep = json['jsep'];\n      if (jsep) {\n        Janus.debug('Handling SDP as well...');\n        Janus.debug(jsep);\n      }\n      let callback = pluginHandle.onmessage;\n      if (callback) {\n        Janus.debug('Notifying application...');\n        // Send to callback specified when attaching plugin handle\n        callback(data, jsep);\n      } else {\n        // Send to generic callback (?)\n        Janus.debug('No provided notification callback');\n      }\n    } else if (json['janus'] === 'timeout') {\n      Janus.error('Timeout on session ' + sessionId);\n      Janus.debug(json);\n      if (websockets) {\n        ws.close(3504, 'Gateway timeout');\n      }\n      return;\n    } else {\n      Janus.warn(\"Unknown message/event  '\" + json['janus'] + \"' on session \" + sessionId);\n      Janus.debug(json);\n    }\n  }\n\n  // Private helper to send keep-alive messages on WebSockets\n  function keepAlive() {\n    if (!server || !websockets || !connected) return;\n    wsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n    let request = {\n      janus: 'keepalive',\n      session_id: sessionId,\n      transaction: Janus.randomString(12),\n    };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    ws.send(JSON.stringify(request));\n  }\n\n  // Private method to create a session\n  function createSession(callbacks) {\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'create', transaction: transaction };\n    if (callbacks['reconnect']) {\n      // We're reconnecting, claim the session\n      connected = false;\n      request['janus'] = 'claim';\n      request['session_id'] = sessionId;\n      // If we were using websockets, ignore the old connection\n      if (ws) {\n        ws.onopen = null;\n        ws.onerror = null;\n        ws.onclose = null;\n        if (wsKeepaliveTimeoutId) {\n          clearTimeout(wsKeepaliveTimeoutId);\n          wsKeepaliveTimeoutId = null;\n        }\n      }\n    }\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (!server && Janus.isArray(servers)) {\n      // We still need to find a working server from the list we were given\n      server = servers[serversIndex];\n      if (server.indexOf('ws') === 0) {\n        websockets = true;\n        Janus.log('Server #' + (serversIndex + 1) + ': trying WebSockets to contact Janus (' + server + ')');\n      } else {\n        websockets = false;\n        Janus.log('Server #' + (serversIndex + 1) + ': trying REST API to contact Janus (' + server + ')');\n      }\n    }\n    if (websockets) {\n      ws = Janus.newWebSocket(server, 'janus-protocol');\n      wsHandlers = {\n        error: function () {\n          Janus.error('Error connecting to the Janus WebSockets server... ' + server);\n          if (Janus.isArray(servers) && !callbacks['reconnect']) {\n            serversIndex++;\n            if (serversIndex === servers.length) {\n              // We tried all the servers the user gave us and they all failed\n              callbacks.error('Error connecting to any of the provided Janus servers: Is the server down?');\n              return;\n            }\n            // Let's try the next server\n            server = null;\n            setTimeout(function () {\n              createSession(callbacks);\n            }, 200);\n            return;\n          }\n          callbacks.error('Error connecting to the Janus WebSockets server: Is the server down?');\n        },\n\n        open: function () {\n          // We need to be notified about the success\n          transactions[transaction] = function (json) {\n            Janus.debug(json);\n            if (json['janus'] !== 'success') {\n              Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n              callbacks.error(json['error'].reason);\n              return;\n            }\n            wsKeepaliveTimeoutId = setTimeout(keepAlive, keepAlivePeriod);\n            connected = true;\n            sessionId = json['session_id'] ? json['session_id'] : json.data['id'];\n            if (callbacks['reconnect']) {\n              Janus.log('Claimed session: ' + sessionId);\n            } else {\n              Janus.log('Created session: ' + sessionId);\n            }\n            Janus.sessions[sessionId] = that;\n            callbacks.success();\n          };\n          ws.send(JSON.stringify(request));\n        },\n\n        message: function (event) {\n          handleEvent(JSON.parse(event.data));\n        },\n\n        close: function () {\n          if (!server || !connected) {\n            return;\n          }\n          connected = false;\n          // FIXME What if this is called when the page is closed?\n          gatewayCallbacks.error('Lost connection to the server (is it down?)');\n        },\n      };\n\n      for (let eventName in wsHandlers) {\n        ws.addEventListener(eventName, wsHandlers[eventName]);\n      }\n\n      return;\n    }\n    Janus.httpAPICall(server, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error(json['error'].reason);\n          return;\n        }\n        connected = true;\n        sessionId = json['session_id'] ? json['session_id'] : json.data['id'];\n        if (callbacks['reconnect']) {\n          Janus.log('Claimed session: ' + sessionId);\n        } else {\n          Janus.log('Created session: ' + sessionId);\n        }\n        Janus.sessions[sessionId] = that;\n        eventHandler();\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (Janus.isArray(servers) && !callbacks['reconnect']) {\n          serversIndex++;\n          if (serversIndex === servers.length) {\n            // We tried all the servers the user gave us and they all failed\n            callbacks.error('Error connecting to any of the provided Janus servers: Is the server down?');\n            return;\n          }\n          // Let's try the next server\n          server = null;\n          setTimeout(function () {\n            createSession(callbacks);\n          }, 200);\n          return;\n        }\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else if (errorThrown && errorThrown.error) callbacks.error(textStatus + ': ' + errorThrown.error.message);\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to get info on the server\n  function getInfo(callbacks) {\n    callbacks = callbacks || {};\n    // FIXME This method triggers a success even when we fail\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    Janus.log('Getting info on Janus instance');\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    // We just need to send an \"info\" request\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'info', transaction: transaction };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      transactions[transaction] = function (json) {\n        Janus.log('Server info:');\n        Janus.debug(json);\n        if (json['janus'] !== 'server_info') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success(json);\n      };\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Server info:');\n        Janus.debug(json);\n        if (json['janus'] !== 'server_info') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success(json);\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to destroy a session\n  function destroySession(callbacks) {\n    callbacks = callbacks || {};\n    // FIXME This method triggers a success even when we fail\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let unload = callbacks.unload === true;\n    let notifyDestroyed = true;\n    if (typeof callbacks.notifyDestroyed !== 'undefined' && callbacks.notifyDestroyed !== null)\n      notifyDestroyed = callbacks.notifyDestroyed === true;\n    let cleanupHandles = callbacks.cleanupHandles === true;\n    Janus.log('Destroying session ' + sessionId + ' (unload=' + unload + ')');\n    if (!sessionId) {\n      Janus.warn('No session to destroy');\n      callbacks.success();\n      if (notifyDestroyed) gatewayCallbacks.destroyed();\n      return;\n    }\n    if (cleanupHandles) {\n      for (let handleId in pluginHandles) destroyHandle(handleId, { noRequest: true });\n    }\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      sessionId = null;\n      callbacks.success();\n      return;\n    }\n    // No need to destroy all handles first, Janus will do that itself\n    let request = { janus: 'destroy', transaction: Janus.randomString(12) };\n    if (token) request['token'] = token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (unload) {\n      // We're unloading the page: use sendBeacon for HTTP instead,\n      // or just close the WebSocket connection if we're using that\n      if (websockets) {\n        ws.onclose = null;\n        ws.close();\n        ws = null;\n      } else {\n        navigator.sendBeacon(server + '/' + sessionId, JSON.stringify(request));\n      }\n      Janus.log('Destroyed session:');\n      sessionId = null;\n      connected = false;\n      callbacks.success();\n      if (notifyDestroyed) gatewayCallbacks.destroyed();\n      return;\n    }\n    if (websockets) {\n      request['session_id'] = sessionId;\n\n      let unbindWebSocket = function () {\n        for (let eventName in wsHandlers) {\n          ws.removeEventListener(eventName, wsHandlers[eventName]);\n        }\n        ws.removeEventListener('message', onUnbindMessage);\n        ws.removeEventListener('error', onUnbindError);\n        if (wsKeepaliveTimeoutId) {\n          clearTimeout(wsKeepaliveTimeoutId);\n        }\n        ws.close();\n      };\n\n      let onUnbindMessage = function (event) {\n        let data = JSON.parse(event.data);\n        if (data.session_id == request.session_id && data.transaction == request.transaction) {\n          unbindWebSocket();\n          callbacks.success();\n          if (notifyDestroyed) gatewayCallbacks.destroyed();\n        }\n      };\n      let onUnbindError = function () {\n        unbindWebSocket();\n        callbacks.error('Failed to destroy the server: Is the server down?');\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      };\n\n      ws.addEventListener('message', onUnbindMessage);\n      ws.addEventListener('error', onUnbindError);\n\n      if (ws.readyState === 1) {\n        ws.send(JSON.stringify(request));\n      } else {\n        onUnbindError();\n      }\n\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Destroyed session:');\n        Janus.debug(json);\n        sessionId = null;\n        connected = false;\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        callbacks.success();\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        // Reset everything anyway\n        sessionId = null;\n        connected = false;\n        callbacks.success();\n        if (notifyDestroyed) gatewayCallbacks.destroyed();\n      },\n    });\n  }\n\n  // Private method to create a plugin handle\n  function createHandle(callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    callbacks.dataChannelOptions = callbacks.dataChannelOptions || {\n      ordered: true,\n    };\n    callbacks.consentDialog = typeof callbacks.consentDialog == 'function' ? callbacks.consentDialog : Janus.noop;\n    callbacks.iceState = typeof callbacks.iceState == 'function' ? callbacks.iceState : Janus.noop;\n    callbacks.mediaState = typeof callbacks.mediaState == 'function' ? callbacks.mediaState : Janus.noop;\n    callbacks.webrtcState = typeof callbacks.webrtcState == 'function' ? callbacks.webrtcState : Janus.noop;\n    callbacks.slowLink = typeof callbacks.slowLink == 'function' ? callbacks.slowLink : Janus.noop;\n    callbacks.onmessage = typeof callbacks.onmessage == 'function' ? callbacks.onmessage : Janus.noop;\n    callbacks.onlocaltrack = typeof callbacks.onlocaltrack == 'function' ? callbacks.onlocaltrack : Janus.noop;\n    callbacks.onremotetrack = typeof callbacks.onremotetrack == 'function' ? callbacks.onremotetrack : Janus.noop;\n    callbacks.ondata = typeof callbacks.ondata == 'function' ? callbacks.ondata : Janus.noop;\n    callbacks.ondataopen = typeof callbacks.ondataopen == 'function' ? callbacks.ondataopen : Janus.noop;\n    callbacks.oncleanup = typeof callbacks.oncleanup == 'function' ? callbacks.oncleanup : Janus.noop;\n    callbacks.ondetached = typeof callbacks.ondetached == 'function' ? callbacks.ondetached : Janus.noop;\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let plugin = callbacks.plugin;\n    if (!plugin) {\n      Janus.error('Invalid plugin');\n      callbacks.error('Invalid plugin');\n      return;\n    }\n    let opaqueId = callbacks.opaqueId;\n    let loopIndex = callbacks.loopIndex;\n    let handleToken = callbacks.token ? callbacks.token : token;\n    let transaction = Janus.randomString(12);\n    let request = {\n      janus: 'attach',\n      plugin: plugin,\n      opaque_id: opaqueId,\n      loop_index: loopIndex,\n      transaction: transaction,\n    };\n    if (handleToken) request['token'] = handleToken;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      transactions[transaction] = function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason);\n          return;\n        }\n        let handleId = json.data['id'];\n        Janus.log('Created handle: ' + handleId);\n        let pluginHandle = {\n          session: that,\n          plugin: plugin,\n          id: handleId,\n          token: handleToken,\n          detached: false,\n          webrtcStuff: {\n            started: false,\n            myStream: null,\n            streamExternal: false,\n            mySdp: null,\n            mediaConstraints: null,\n            pc: null,\n            dataChannelOptions: callbacks.dataChannelOptions,\n            dataChannel: {},\n            dtmfSender: null,\n            trickle: true,\n            iceDone: false,\n            bitrate: {},\n          },\n          getId: function () {\n            return handleId;\n          },\n          getPlugin: function () {\n            return plugin;\n          },\n          getVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getRemoteVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getLocalVolume: function (mid, result) {\n            return getVolume(handleId, mid, false, result);\n          },\n          isAudioMuted: function (mid) {\n            return isMuted(handleId, mid, false);\n          },\n          muteAudio: function (mid) {\n            return mute(handleId, mid, false, true);\n          },\n          unmuteAudio: function (mid) {\n            return mute(handleId, mid, false, false);\n          },\n          isVideoMuted: function (mid) {\n            return isMuted(handleId, mid, true);\n          },\n          muteVideo: function (mid) {\n            return mute(handleId, mid, true, true);\n          },\n          unmuteVideo: function (mid) {\n            return mute(handleId, mid, true, false);\n          },\n          getBitrate: function (mid) {\n            return getBitrate(handleId, mid);\n          },\n          setMaxBitrate: function (mid, bitrate) {\n            return setBitrate(handleId, mid, bitrate);\n          },\n          send: function (callbacks) {\n            sendMessage(handleId, callbacks);\n          },\n          data: function (callbacks) {\n            sendData(handleId, callbacks);\n          },\n          dtmf: function (callbacks) {\n            sendDtmf(handleId, callbacks);\n          },\n          consentDialog: callbacks.consentDialog,\n          iceState: callbacks.iceState,\n          mediaState: callbacks.mediaState,\n          webrtcState: callbacks.webrtcState,\n          slowLink: callbacks.slowLink,\n          onmessage: callbacks.onmessage,\n          createOffer: function (callbacks) {\n            prepareWebrtc(handleId, true, callbacks);\n          },\n          createAnswer: function (callbacks) {\n            prepareWebrtc(handleId, false, callbacks);\n          },\n          handleRemoteJsep: function (callbacks) {\n            prepareWebrtcPeer(handleId, callbacks);\n          },\n          replaceTracks: function (callbacks) {\n            replaceTracks(handleId, callbacks);\n          },\n          getLocalTracks: function () {\n            return getLocalTracks(handleId);\n          },\n          getRemoteTracks: function () {\n            return getRemoteTracks(handleId);\n          },\n          onlocaltrack: callbacks.onlocaltrack,\n          onremotetrack: callbacks.onremotetrack,\n          ondata: callbacks.ondata,\n          ondataopen: callbacks.ondataopen,\n          oncleanup: callbacks.oncleanup,\n          ondetached: callbacks.ondetached,\n          hangup: function (sendRequest) {\n            cleanupWebrtc(handleId, sendRequest === true);\n          },\n          detach: function (callbacks) {\n            destroyHandle(handleId, callbacks);\n          },\n        };\n        pluginHandles[handleId] = pluginHandle;\n        callbacks.success(pluginHandle);\n      };\n      request['session_id'] = sessionId;\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          callbacks.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason);\n          return;\n        }\n        let handleId = json.data['id'];\n        Janus.log('Created handle: ' + handleId);\n        let pluginHandle = {\n          session: that,\n          plugin: plugin,\n          id: handleId,\n          token: handleToken,\n          detached: false,\n          webrtcStuff: {\n            started: false,\n            myStream: null,\n            streamExternal: false,\n            mySdp: null,\n            mediaConstraints: null,\n            pc: null,\n            dataChannelOptions: callbacks.dataChannelOptions,\n            dataChannel: {},\n            dtmfSender: null,\n            trickle: true,\n            iceDone: false,\n            bitrate: {},\n          },\n          getId: function () {\n            return handleId;\n          },\n          getPlugin: function () {\n            return plugin;\n          },\n          getVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getRemoteVolume: function (mid, result) {\n            return getVolume(handleId, mid, true, result);\n          },\n          getLocalVolume: function (mid, result) {\n            return getVolume(handleId, mid, false, result);\n          },\n          isAudioMuted: function (mid) {\n            return isMuted(handleId, mid, false);\n          },\n          muteAudio: function (mid) {\n            return mute(handleId, mid, false, true);\n          },\n          unmuteAudio: function (mid) {\n            return mute(handleId, mid, false, false);\n          },\n          isVideoMuted: function (mid) {\n            return isMuted(handleId, mid, true);\n          },\n          muteVideo: function (mid) {\n            return mute(handleId, mid, true, true);\n          },\n          unmuteVideo: function (mid) {\n            return mute(handleId, mid, true, false);\n          },\n          getBitrate: function (mid) {\n            return getBitrate(handleId, mid);\n          },\n          setMaxBitrate: function (mid, bitrate) {\n            return setBitrate(handleId, mid, bitrate);\n          },\n          send: function (callbacks) {\n            sendMessage(handleId, callbacks);\n          },\n          data: function (callbacks) {\n            sendData(handleId, callbacks);\n          },\n          dtmf: function (callbacks) {\n            sendDtmf(handleId, callbacks);\n          },\n          consentDialog: callbacks.consentDialog,\n          iceState: callbacks.iceState,\n          mediaState: callbacks.mediaState,\n          webrtcState: callbacks.webrtcState,\n          slowLink: callbacks.slowLink,\n          onmessage: callbacks.onmessage,\n          createOffer: function (callbacks) {\n            prepareWebrtc(handleId, true, callbacks);\n          },\n          createAnswer: function (callbacks) {\n            prepareWebrtc(handleId, false, callbacks);\n          },\n          handleRemoteJsep: function (callbacks) {\n            prepareWebrtcPeer(handleId, callbacks);\n          },\n          replaceTracks: function (callbacks) {\n            replaceTracks(handleId, callbacks);\n          },\n          getLocalTracks: function () {\n            return getLocalTracks(handleId);\n          },\n          getRemoteTracks: function () {\n            return getRemoteTracks(handleId);\n          },\n          onlocaltrack: callbacks.onlocaltrack,\n          onremotetrack: callbacks.onremotetrack,\n          ondata: callbacks.ondata,\n          ondataopen: callbacks.ondataopen,\n          oncleanup: callbacks.oncleanup,\n          ondetached: callbacks.ondetached,\n          hangup: function (sendRequest) {\n            cleanupWebrtc(handleId, sendRequest === true);\n          },\n          detach: function (callbacks) {\n            destroyHandle(handleId, callbacks);\n          },\n        };\n        pluginHandles[handleId] = pluginHandle;\n        callbacks.success(pluginHandle);\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        if (errorThrown === '') callbacks.error(textStatus + ': Is the server down?');\n        else callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to send a message\n  function sendMessage(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let message = callbacks.message;\n    let jsep = callbacks.jsep;\n    let transaction = Janus.randomString(12);\n    let request = { janus: 'message', body: message, transaction: transaction };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (jsep) {\n      request.jsep = {\n        type: jsep.type,\n        sdp: jsep.sdp,\n      };\n      if (jsep.e2ee) request.jsep.e2ee = true;\n      if (jsep.rid_order === 'hml' || jsep.rid_order === 'lmh') request.jsep.rid_order = jsep.rid_order;\n      if (jsep.force_relay) request.jsep.force_relay = true;\n    }\n    Janus.debug('Sending message to plugin (handle=' + handleId + '):');\n    Janus.debug(request);\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      transactions[transaction] = function (json) {\n        Janus.debug('Message sent!');\n        Janus.debug(json);\n        if (json['janus'] === 'success') {\n          // We got a success, must have been a synchronous transaction\n          let plugindata = json['plugindata'];\n          if (!plugindata) {\n            Janus.warn('Request succeeded, but missing plugindata...');\n            callbacks.success();\n            return;\n          }\n          Janus.log('Synchronous transaction successful (' + plugindata['plugin'] + ')');\n          let data = plugindata['data'];\n          Janus.debug(data);\n          callbacks.success(data);\n          return;\n        } else if (json['janus'] !== 'ack') {\n          // Not a success and not an ack, must be an error\n          if (json['error']) {\n            Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n            callbacks.error(json['error'].code + ' ' + json['error'].reason);\n          } else {\n            Janus.error('Unknown error'); // FIXME\n            callbacks.error('Unknown error');\n          }\n          return;\n        }\n        // If we got here, the plugin decided to handle the request asynchronously\n        callbacks.success();\n      };\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.debug('Message sent!');\n        Janus.debug(json);\n        if (json['janus'] === 'success') {\n          // We got a success, must have been a synchronous transaction\n          let plugindata = json['plugindata'];\n          if (!plugindata) {\n            Janus.warn('Request succeeded, but missing plugindata...');\n            callbacks.success();\n            return;\n          }\n          Janus.log('Synchronous transaction successful (' + plugindata['plugin'] + ')');\n          let data = plugindata['data'];\n          Janus.debug(data);\n          callbacks.success(data);\n          return;\n        } else if (json['janus'] !== 'ack') {\n          // Not a success and not an ack, must be an error\n          if (json['error']) {\n            Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n            callbacks.error(json['error'].code + ' ' + json['error'].reason);\n          } else {\n            Janus.error('Unknown error'); // FIXME\n            callbacks.error('Unknown error');\n          }\n          return;\n        }\n        // If we got here, the plugin decided to handle the request asynchronously\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        callbacks.error(textStatus + ': ' + errorThrown);\n      },\n    });\n  }\n\n  // Private method to send a trickle candidate\n  function sendTrickleCandidate(handleId, candidate) {\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      return;\n    }\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let request = {\n      janus: 'trickle',\n      candidate: candidate,\n      transaction: Janus.randomString(12),\n    };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    Janus.vdebug('Sending trickle candidate (handle=' + handleId + '):');\n    Janus.vdebug(request);\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      ws.send(JSON.stringify(request));\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.vdebug('Candidate sent!');\n        Janus.vdebug(json);\n        if (json['janus'] !== 'ack') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n          return;\n        }\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n      },\n    });\n  }\n\n  // Private method to create a data channel\n  function createDataChannel(handleId, dclabel, dcprotocol, incoming, pendingData) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return;\n    }\n    let onDataChannelMessage = function (event) {\n      Janus.log('Received message on data channel:', event);\n      let label = event.target.label;\n      pluginHandle.ondata(event.data, label);\n    };\n    let onDataChannelStateChange = function (event) {\n      Janus.log('Received state change on data channel:', event);\n      let label = event.target.label;\n      let protocol = event.target.protocol;\n      let dcState = config.dataChannel[label] ? config.dataChannel[label].readyState : 'null';\n      Janus.log('State change on <' + label + '> data channel: ' + dcState);\n      if (dcState === 'open') {\n        // Any pending messages to send?\n        if (config.dataChannel[label].pending && config.dataChannel[label].pending.length > 0) {\n          Janus.log('Sending pending messages on <' + label + '>:', config.dataChannel[label].pending.length);\n          for (let data of config.dataChannel[label].pending) {\n            Janus.log('Sending data on data channel <' + label + '>');\n            Janus.debug(data);\n            config.dataChannel[label].send(data);\n          }\n          config.dataChannel[label].pending = [];\n        }\n        // Notify the open data channel\n        pluginHandle.ondataopen(label, protocol);\n      }\n    };\n    let onDataChannelError = function (error) {\n      Janus.error('Got error on data channel:', error);\n      // TODO\n    };\n    if (!incoming) {\n      // FIXME Add options (ordered, maxRetransmits, etc.)\n      let dcoptions = config.dataChannelOptions;\n      if (dcprotocol) dcoptions.protocol = dcprotocol;\n      config.dataChannel[dclabel] = config.pc.createDataChannel(dclabel, dcoptions);\n    } else {\n      // The channel was created by Janus\n      config.dataChannel[dclabel] = incoming;\n    }\n    config.dataChannel[dclabel].onmessage = onDataChannelMessage;\n    config.dataChannel[dclabel].onopen = onDataChannelStateChange;\n    config.dataChannel[dclabel].onclose = onDataChannelStateChange;\n    config.dataChannel[dclabel].onerror = onDataChannelError;\n    config.dataChannel[dclabel].pending = [];\n    if (pendingData) config.dataChannel[dclabel].pending.push(pendingData);\n  }\n\n  // Private method to send a data channel message\n  function sendData(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    let data = callbacks.text || callbacks.data;\n    if (!data) {\n      Janus.warn('Invalid data');\n      callbacks.error('Invalid data');\n      return;\n    }\n    let label = callbacks.label ? callbacks.label : Janus.dataChanDefaultLabel;\n    if (!config.dataChannel[label]) {\n      // Create new data channel and wait for it to open\n      createDataChannel(handleId, label, callbacks.protocol, false, data, callbacks.protocol);\n      callbacks.success();\n      return;\n    }\n    if (config.dataChannel[label].readyState !== 'open') {\n      config.dataChannel[label].pending.push(data);\n      callbacks.success();\n      return;\n    }\n    Janus.log('Sending data on data channel <' + label + '>');\n    Janus.debug(data);\n    config.dataChannel[label].send(data);\n    callbacks.success();\n  }\n\n  // Private method to send a DTMF tone\n  function sendDtmf(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.dtmfSender) {\n      // Create the DTMF sender the proper way, if possible\n      if (config.pc) {\n        let senders = config.pc.getSenders();\n        let audioSender = senders.find(function (sender) {\n          return sender.track && sender.track.kind === 'audio';\n        });\n        if (!audioSender) {\n          Janus.warn('Invalid DTMF configuration (no audio track)');\n          callbacks.error('Invalid DTMF configuration (no audio track)');\n          return;\n        }\n        config.dtmfSender = audioSender.dtmf;\n        if (config.dtmfSender) {\n          Janus.log('Created DTMF Sender');\n          config.dtmfSender.ontonechange = function (tone) {\n            Janus.debug('Sent DTMF tone: ' + tone.tone);\n          };\n        }\n      }\n      if (!config.dtmfSender) {\n        Janus.warn('Invalid DTMF configuration');\n        callbacks.error('Invalid DTMF configuration');\n        return;\n      }\n    }\n    let dtmf = callbacks.dtmf;\n    if (!dtmf) {\n      Janus.warn('Invalid DTMF parameters');\n      callbacks.error('Invalid DTMF parameters');\n      return;\n    }\n    let tones = dtmf.tones;\n    if (!tones) {\n      Janus.warn('Invalid DTMF string');\n      callbacks.error('Invalid DTMF string');\n      return;\n    }\n    let duration = typeof dtmf.duration === 'number' ? dtmf.duration : 500; // We choose 500ms as the default duration for a tone\n    let gap = typeof dtmf.gap === 'number' ? dtmf.gap : 50; // We choose 50ms as the default gap between tones\n    Janus.debug('Sending DTMF string ' + tones + ' (duration ' + duration + 'ms, gap ' + gap + 'ms)');\n    config.dtmfSender.insertDTMF(tones, duration, gap);\n    callbacks.success();\n  }\n\n  // Private method to destroy a plugin handle\n  function destroyHandle(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let noRequest = callbacks.noRequest === true;\n    Janus.log('Destroying handle ' + handleId + ' (only-locally=' + noRequest + ')');\n    cleanupWebrtc(handleId);\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || pluginHandle.detached) {\n      // Plugin was already detached by Janus, calling detach again will return a handle not found error, so just exit here\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    pluginHandle.detached = true;\n    if (noRequest) {\n      // We're only removing the handle locally\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    if (!connected) {\n      Janus.warn('Is the server down? (connected=false)');\n      callbacks.error('Is the server down? (connected=false)');\n      return;\n    }\n    let request = { janus: 'detach', transaction: Janus.randomString(12) };\n    if (pluginHandle.token) request['token'] = pluginHandle.token;\n    if (apisecret) request['apisecret'] = apisecret;\n    if (websockets) {\n      request['session_id'] = sessionId;\n      request['handle_id'] = handleId;\n      ws.send(JSON.stringify(request));\n      delete pluginHandles[handleId];\n      callbacks.success();\n      return;\n    }\n    Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n      verb: 'POST',\n      withCredentials: withCredentials,\n      body: request,\n      success: function (json) {\n        Janus.log('Destroyed handle:');\n        Janus.debug(json);\n        if (json['janus'] !== 'success') {\n          Janus.error('Ooops: ' + json['error'].code + ' ' + json['error'].reason); // FIXME\n        }\n        delete pluginHandles[handleId];\n        callbacks.success();\n      },\n      error: function (textStatus, errorThrown) {\n        Janus.error(textStatus + ':', errorThrown); // FIXME\n        // We cleanup anyway\n        delete pluginHandles[handleId];\n        callbacks.success();\n      },\n    });\n  }\n\n  // WebRTC stuff\n  // Helper function to create a new PeerConnection, if we need one\n  function createPeerconnectionIfNeeded(handleId, callbacks) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (config.pc) {\n      // Nothing to do, we have a PeerConnection already\n      return;\n    }\n    let pc_config = {\n      iceServers: iceServers,\n      iceTransportPolicy: iceTransportPolicy,\n      bundlePolicy: bundlePolicy,\n    };\n    pc_config.sdpSemantics = 'unified-plan';\n    // Check if a sender or receiver transform has been provided\n    let insertableStreams = false;\n    if (callbacks.tracks) {\n      for (let track of callbacks.tracks) {\n        if (track.transforms && (track.transforms.sender || track.transforms.receiver)) {\n          insertableStreams = true;\n          break;\n        }\n      }\n    }\n    if (\n      RTCRtpSender &&\n      (RTCRtpSender.prototype.createEncodedStreams ||\n        (RTCRtpSender.prototype.createEncodedAudioStreams && RTCRtpSender.prototype.createEncodedVideoStreams)) &&\n      insertableStreams\n    ) {\n      config.insertableStreams = true;\n      pc_config.forceEncodedAudioInsertableStreams = true;\n      pc_config.forceEncodedVideoInsertableStreams = true;\n      pc_config.encodedInsertableStreams = true;\n    }\n    Janus.log('Creating PeerConnection');\n    config.pc = new RTCPeerConnection(pc_config);\n    Janus.debug(config.pc);\n    if (config.pc.getStats) {\n      // FIXME\n      config.volume = {};\n      config.bitrate.value = '0 kbits/sec';\n    }\n    Janus.log('Preparing local SDP and gathering candidates (trickle=' + config.trickle + ')');\n    config.pc.oniceconnectionstatechange = function () {\n      if (config.pc) pluginHandle.iceState(config.pc.iceConnectionState);\n    };\n    config.pc.onicecandidate = function (event) {\n      if (!event.candidate || (event.candidate.candidate && event.candidate.candidate.indexOf('endOfCandidates') > 0)) {\n        Janus.log('End of candidates.');\n        config.iceDone = true;\n        if (config.trickle === true) {\n          // Notify end of candidates\n          sendTrickleCandidate(handleId, { completed: true });\n        } else {\n          // No trickle, time to send the complete SDP (including all candidates)\n          sendSDP(handleId, callbacks);\n        }\n      } else {\n        // JSON.stringify doesn't work on some WebRTC objects anymore\n        // See https://code.google.com/p/chromium/issues/detail?id=467366\n        let candidate = {\n          candidate: event.candidate.candidate,\n          sdpMid: event.candidate.sdpMid,\n          sdpMLineIndex: event.candidate.sdpMLineIndex,\n        };\n        if (config.trickle === true) {\n          // Send candidate\n          sendTrickleCandidate(handleId, candidate);\n        }\n      }\n    };\n    config.pc.ontrack = function (event) {\n      Janus.log('Handling Remote Track', event);\n      if (!event.streams) return;\n      if (!event.track) return;\n      // Notify about the new track event\n      let mid = event.transceiver ? event.transceiver.mid || event.transceiver._mid : event.track.id;\n      try {\n        pluginHandle.onremotetrack(event.track, mid, true, {\n          reason: 'created',\n        });\n      } catch (e) {\n        Janus.error('Error calling onremotetrack', e);\n      }\n      if (event.track.onended) return;\n      let trackMutedTimeoutId = null;\n      Janus.log('Adding onended callback to track:', event.track);\n      event.track.onended = function (ev) {\n        Janus.log('Remote track removed:', ev);\n        clearTimeout(trackMutedTimeoutId);\n        // Notify the application\n        let transceivers = config.pc ? config.pc.getTransceivers() : null;\n        let transceiver = transceivers\n          ? transceivers.find((transceiver) => {\n            const receiver = transceiver.receiver || transceiver._receiver;\n            const track = receiver.track || receiver._track;\n            return track === ev.target;\n          })\n          : null;\n        let mid = transceiver ? transceiver.mid || transceiver._mid : ev.target.id;\n        try {\n          pluginHandle.onremotetrack(ev.target, mid, false, {\n            reason: 'ended',\n          });\n        } catch (e) {\n          Janus.error('Error calling onremotetrack on removal', e);\n        }\n      };\n      event.track.onmute = function (ev) {\n        Janus.log('Remote track muted:', ev);\n        if (!trackMutedTimeoutId) {\n          const target = ev.target;\n          trackMutedTimeoutId = setTimeout(function () {\n            Janus.log('Removing remote track');\n            // Notify the application the track is gone\n            let transceivers = config.pc ? config.pc.getTransceivers() : null;\n            let transceiver = transceivers\n              ? transceivers.find((transceiver) => {\n                const receiver = transceiver.receiver || transceiver._receiver;\n                const track = receiver.track || receiver._track;\n                return track === target;\n              })\n              : null;\n            let mid = transceiver ? transceiver.mid || transceiver._mid : target.id;\n            try {\n              pluginHandle.onremotetrack(target, mid, false, {\n                reason: 'mute',\n              });\n            } catch (e) {\n              Janus.error('Error calling onremotetrack on mute', e);\n            }\n            trackMutedTimeoutId = null;\n            // Chrome seems to raise mute events only at multiples of 834ms;\n            // we set the timeout to three times this value (rounded to 840ms);\n          }, 3 * 840);\n        }\n      };\n      event.track.onunmute = function (ev) {\n        Janus.log('Remote track flowing again:', ev);\n        if (trackMutedTimeoutId != null) {\n          clearTimeout(trackMutedTimeoutId);\n          trackMutedTimeoutId = null;\n        } else {\n          try {\n            // Notify the application the track is back\n            let transceivers = config.pc ? config.pc.getTransceivers() : null;\n            let transceiver = transceivers\n              ? transceivers.find((transceiver) => {\n                const receiver = transceiver.receiver || transceiver._receiver;\n                const track = receiver.track || receiver._track;\n                return track === ev.target;\n              })\n              : null;\n            let mid = transceiver ? transceiver.mid || transceiver._mid : ev.target.id;\n            pluginHandle.onremotetrack(ev.target, mid, true, {\n              reason: 'unmute',\n            });\n          } catch (e) {\n            Janus.error('Error calling onremotetrack on unmute', e);\n          }\n        }\n      };\n    };\n  }\n\n  // Helper function used when creating either an offer or answer: it\n  // prepares what needs to be prepared, including creating a new\n  // PeerConnection (if needed) and updating the tracks configuration,\n  // before invoking the function to actually generate the offer/answer\n  async function prepareWebrtc(handleId, offer, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : webrtcError;\n    let jsep = callbacks.jsep;\n    if (offer && jsep) {\n      Janus.error('Provided a JSEP to a createOffer');\n      callbacks.error('Provided a JSEP to a createOffer');\n      return;\n    } else if (!offer && (!jsep || !jsep.type || !jsep.sdp)) {\n      Janus.error('A valid JSEP is required for createAnswer');\n      callbacks.error('A valid JSEP is required for createAnswer');\n      return;\n    }\n    // If the deprecated media was provided instead of tracks, translate it\n    if (callbacks.media && !callbacks.tracks) {\n      callbacks.tracks = Janus.mediaToTracks(callbacks.media);\n      if (callbacks.simulcast === true || callbacks.simulcast2 === true || callbacks.svc) {\n        // Find the video track and add simulcast/SVC info there\n        for (let track of callbacks.tracks) {\n          if (track.type === 'video') {\n            if (callbacks.simulcast === true || callbacks.simulcast2 === true) track.simulcast = true;\n            else if (callbacks.svc) track.svc = callbacks.svc;\n            break;\n          }\n        }\n      }\n      Janus.warn('Deprecated media object passed, use tracks instead. Automatically translated to:', callbacks.tracks);\n    }\n    // Check that callbacks.array is a valid array\n    if (callbacks.tracks && !Array.isArray(callbacks.tracks)) {\n      Janus.error('Tracks must be an array');\n      callbacks.error('Tracks must be an array');\n      return;\n    }\n    // Get the plugin handle\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    config.trickle = isTrickleEnabled(callbacks.trickle);\n    try {\n      // Create a PeerConnection, if needed\n      createPeerconnectionIfNeeded(handleId, callbacks);\n      if (offer) {\n        // Capture devices and setup tracks, if needed\n        await captureDevices(handleId, callbacks);\n      }\n      // Create offer or answer now (depending on the context)\n      if (!jsep) {\n        let offer = await createOffer(handleId, callbacks);\n        callbacks.success(offer);\n      } else {\n        await config.pc.setRemoteDescription(jsep);\n        Janus.log('Remote description accepted!');\n        config.remoteSdp = jsep.sdp;\n        // Any trickle candidate we cached?\n        if (config.candidates && config.candidates.length > 0) {\n          for (let i = 0; i < config.candidates.length; i++) {\n            let candidate = config.candidates[i];\n            Janus.debug('Adding remote candidate:', candidate);\n            if (!candidate || candidate.completed === true) {\n              // end-of-candidates\n              config.pc.addIceCandidate(Janus.endOfCandidates);\n            } else {\n              // New candidate\n              config.pc.addIceCandidate(candidate);\n            }\n          }\n          config.candidates = [];\n        }\n        // Capture devices and setup tracks, if needed\n        await captureDevices(handleId, callbacks);\n        // Create the answer now\n        let answer = await createAnswer(handleId, callbacks);\n        callbacks.success(answer);\n      }\n    } catch (err) {\n      Janus.error(err);\n      callbacks.error(err);\n    }\n  }\n\n  function prepareWebrtcPeer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : webrtcError;\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let jsep = callbacks.jsep;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      callbacks.error('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (jsep) {\n      if (!config.pc) {\n        Janus.warn('Wait, no PeerConnection?? if this is an answer, use createAnswer and not handleRemoteJsep');\n        callbacks.error('No PeerConnection: if this is an answer, use createAnswer and not handleRemoteJsep');\n        return;\n      }\n      callbacks.customizeSdp(jsep);\n      config.pc.setRemoteDescription(jsep).then(function () {\n        Janus.log('Remote description accepted!');\n        config.remoteSdp = jsep.sdp;\n        // Any trickle candidate we cached?\n        if (config.candidates && config.candidates.length > 0) {\n          for (let i = 0; i < config.candidates.length; i++) {\n            let candidate = config.candidates[i];\n            Janus.debug('Adding remote candidate:', candidate);\n            if (!candidate || candidate.completed === true) {\n              // end-of-candidates\n              config.pc.addIceCandidate(Janus.endOfCandidates);\n            } else {\n              // New candidate\n              config.pc.addIceCandidate(candidate);\n            }\n          }\n          config.candidates = [];\n        }\n        // Done\n        callbacks.success();\n      }, callbacks.error);\n    } else {\n      callbacks.error('Invalid JSEP');\n    }\n  }\n\n  async function createOffer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Creating offer (iceDone=' + config.iceDone + ')');\n    // https://code.google.com/p/webrtc/issues/detail?id=3508\n    let mediaConstraints = {};\n    let iceRestart = callbacks.iceRestart === true;\n    // If we need an ICE restart, set the related constraint\n    if (iceRestart) mediaConstraints.iceRestart = true;\n    Janus.debug(mediaConstraints);\n    let offer = await config.pc.createOffer(mediaConstraints);\n    Janus.debug(offer);\n    // JSON.stringify doesn't work on some WebRTC objects anymore\n    // See https://code.google.com/p/chromium/issues/detail?id=467366\n    let jsep = {\n      type: 'offer',\n      sdp: offer.sdp,\n    };\n    callbacks.customizeSdp(jsep);\n    offer.sdp = jsep.sdp;\n    Janus.log('Setting local description');\n    config.mySdp = {\n      type: 'offer',\n      sdp: offer.sdp,\n    };\n    await config.pc.setLocalDescription(offer);\n    config.mediaConstraints = mediaConstraints;\n    if (!config.iceDone && !config.trickle) {\n      // FIXME Don't do anything until we have all candidates\n      Janus.log('Waiting for all candidates...');\n      return null;\n    }\n    // If transforms are present, notify Janus that the media is end-to-end encrypted\n    if (config.insertableStreams) offer.e2ee = true;\n    return offer;\n  }\n\n  async function createAnswer(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.customizeSdp = typeof callbacks.customizeSdp == 'function' ? callbacks.customizeSdp : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Creating answer (iceDone=' + config.iceDone + ')');\n    let answer = await config.pc.createAnswer();\n    Janus.debug(answer);\n    // JSON.stringify doesn't work on some WebRTC objects anymore\n    // See https://code.google.com/p/chromium/issues/detail?id=467366\n    let jsep = {\n      type: 'answer',\n      sdp: answer.sdp,\n    };\n    callbacks.customizeSdp(jsep);\n    answer.sdp = jsep.sdp;\n    Janus.log('Setting local description');\n    config.mySdp = {\n      type: 'answer',\n      sdp: answer.sdp,\n    };\n    await config.pc.setLocalDescription(answer);\n    if (!config.iceDone && !config.trickle) {\n      // FIXME Don't do anything until we have all candidates\n      Janus.log('Waiting for all candidates...');\n      return null;\n    }\n    // If transforms are present, notify Janus that the media is end-to-end encrypted\n    if (config.insertableStreams) answer.e2ee = true;\n    return answer;\n  }\n\n  function sendSDP(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle, not sending anything');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    Janus.log('Sending offer/answer SDP...');\n    if (!config.mySdp) {\n      Janus.warn('Local SDP instance is invalid, not sending anything...');\n      return;\n    }\n    config.mySdp = {\n      type: config.pc.localDescription.type,\n      sdp: config.pc.localDescription.sdp,\n    };\n    if (config.trickle === false) config.mySdp['trickle'] = false;\n    Janus.debug(callbacks);\n    config.sdpSent = true;\n    callbacks.success(config.mySdp);\n  }\n\n  async function replaceTracks(handleId, callbacks) {\n    callbacks = callbacks || {};\n    callbacks.success = typeof callbacks.success == 'function' ? callbacks.success : Janus.noop;\n    callbacks.error = typeof callbacks.error == 'function' ? callbacks.error : Janus.noop;\n    // Check that callbacks.array is a valid array\n    if (callbacks.tracks && !Array.isArray(callbacks.tracks)) {\n      Janus.error('Tracks must be an array');\n      callbacks.error('Tracks must be an array');\n      return;\n    }\n    // Add the replace:true if it's missing\n    for (let track of callbacks.tracks) {\n      if (track.add || (!track.replace && !track.remove)) track.replace = true;\n    }\n    try {\n      await captureDevices(handleId, callbacks);\n      callbacks.success();\n    } catch (err) {\n      Janus.error(err);\n      callbacks.error(err);\n    }\n  }\n\n  async function captureDevices(handleId, callbacks) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle, not sending anything');\n      throw 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      throw 'Invalid PeerConnection';\n    }\n    let tracks = callbacks.tracks;\n    if (!tracks || !Array.isArray(tracks) || tracks.length === 0) {\n      // Nothing to do\n      return;\n    }\n    let openedConsentDialog = false;\n    // Check if we can/should group getUserMedia calls\n    let groups = {};\n    for (let track of tracks) {\n      delete track.gumGroup;\n      if (!track.type || !['audio', 'video'].includes(track.type)) continue;\n      if (!track.capture || track.capture instanceof MediaStreamTrack) continue;\n      let group = track.group ? track.group : 'default';\n      if (!groups[group]) groups[group] = {};\n      if (groups[group][track.type]) continue;\n      track.gumGroup = group;\n      groups[group][track.type] = track;\n    }\n    let keys = Object.keys(groups);\n    for (let key of keys) {\n      let group = groups[key];\n      if (!group.audio || !group.video) {\n        if (group.audio) delete group.audio.gumGroup;\n        if (group.video) delete group.video.gumGroup;\n        delete groups[key];\n      }\n    }\n    let answer = callbacks.jsep ? true : false;\n    for (let track of tracks) {\n      if (!track.type) {\n        Janus.warn('Missing track type:', track);\n        continue;\n      }\n      if (track.type === 'data') {\n        // Easy enough: create a datachannel if we don't have one already\n        if (config.pc.ondatachannel) {\n          Janus.warn('Data channel exists already, not creating another one');\n          continue;\n        }\n        Janus.log('Creating default data channel');\n        createDataChannel(handleId, Janus.dataChanDefaultLabel, null, false);\n        config.pc.ondatachannel = function (event) {\n          Janus.log('Data channel created by Janus:', event);\n          createDataChannel(handleId, event.channel.label, event.channel.protocol, event.channel);\n        };\n        continue;\n      }\n      if (\n        typeof track.add === 'undefined' &&\n        track.add === null &&\n        typeof track.remove === 'undefined' &&\n        track.remove === null &&\n        typeof track.replace === 'undefined' &&\n        track.replace === null\n      ) {\n        // Let's default to 'add'\n        track.add = true;\n      }\n      if ((track.add && track.remove) || (track.add && track.remove && track.replace)) {\n        Janus.warn('Conflicting actions for track, ignoring:', track);\n        continue;\n      }\n      if (track.add && track.replace) {\n        Janus.warn('Both add and replace provided, falling back to replace:', track);\n        delete track.add;\n      } else if (track.remove && track.replace) {\n        Janus.warn('Both remove and replace provided, falling back to remove:', track);\n        delete track.replace;\n      }\n      let kind = track.type;\n      if (track.type === 'screen') kind = 'video'; // FIXME\n      let transceiver = null,\n        sender = null;\n      if (track.mid) {\n        // Search by mid\n        transceiver = config.pc.getTransceivers().find((t) => t.mid === track.mid && t.receiver.track.kind === kind);\n      } else {\n        // Find the first track of this type\n        transceiver = config.pc.getTransceivers().find((t) => t.receiver.track.kind === kind);\n      }\n      if (track.replace || track.remove) {\n        if (!transceiver) {\n          Janus.warn(\"Couldn't find a transceiver for track:\", track);\n          continue;\n        }\n        if (!transceiver.sender) {\n          Janus.warn('No sender in the transceiver for track:', track);\n          continue;\n        }\n        sender = transceiver.sender;\n      }\n      if (answer && !transceiver) {\n        transceiver = config.pc.getTransceivers().find((t) => t.receiver.track.kind === kind);\n        if (!transceiver) {\n          Janus.warn(\"Couldn't find a transceiver for track:\", track);\n          continue;\n        }\n      }\n      // Capture the new track, if we need to\n      let nt = null,\n        trackId = null;\n      if (track.remove) {\n        Janus.log('Removing track from PeerConnection', track);\n        trackId = sender.track ? sender.track.id : null;\n        await sender.replaceTrack(null);\n      } else if (track.capture) {\n        if (track.gumGroup && groups[track.gumGroup] && groups[track.gumGroup].stream) {\n          // We did a getUserMedia before already\n          let stream = groups[track.gumGroup].stream;\n          nt = track.type === 'audio' ? stream.getAudioTracks()[0] : stream.getVideoTracks()[0];\n          delete groups[track.gumGroup].stream;\n          delete groups[track.gumGroup];\n          delete track.gumGroup;\n        } else if (track.capture instanceof MediaStreamTrack) {\n          // An external track was provided, use that\n          nt = track.capture;\n        } else {\n          if (!openedConsentDialog) {\n            openedConsentDialog = true;\n            pluginHandle.consentDialog(true);\n          }\n          let constraints = Janus.trackConstraints(track),\n            stream = null;\n          if (track.type === 'audio' || track.type === 'video') {\n            // Use getUserMedia: check if we need to group audio and video together\n            if (track.gumGroup) {\n              let otherType = track.type === 'audio' ? 'video' : 'audio';\n              if (groups[track.gumGroup] && groups[track.gumGroup][otherType]) {\n                let otherTrack = groups[track.gumGroup][otherType];\n                let otherConstraints = Janus.trackConstraints(otherTrack);\n                constraints[otherType] = otherConstraints[otherType];\n              }\n            }\n            stream = await navigator.mediaDevices.getUserMedia(constraints);\n            if (track.gumGroup && constraints.audio && constraints.video) {\n              // We just performed a grouped getUserMedia, keep track of the\n              // stream so that we can immediately assign the track later\n              groups[track.gumGroup].stream = stream;\n              delete track.gumGroup;\n            }\n          } else {\n            // Use getDisplayMedia\n            stream = await navigator.mediaDevices.getDisplayMedia(constraints);\n          }\n          nt = track.type === 'audio' ? stream.getAudioTracks()[0] : stream.getVideoTracks()[0];\n        }\n        if (track.replace) {\n          // Replace the track\n          await sender.replaceTrack(nt);\n          // Update the transceiver direction\n          let newDirection = 'sendrecv';\n          if (track.recv === false || transceiver.direction === 'inactive' || transceiver.direction === 'sendonly')\n            newDirection = 'sendonly';\n          if (transceiver.setDirection) transceiver.setDirection(newDirection);\n          else transceiver.direction = newDirection;\n        } else {\n          // FIXME Add as a new track\n          if (!config.myStream) config.myStream = new MediaStream();\n          if (kind === 'audio' || (!track.simulcast && !track.svc)) {\n            sender = config.pc.addTrack(nt, config.myStream);\n            transceiver = config.pc.getTransceivers().find((t) => t.sender === sender);\n          } else if (track.simulcast) {\n            if (Janus.webRTCAdapter.browserDetails.browser !== 'firefox') {\n              // Standard RID\n              Janus.log('Enabling rid-based simulcasting:', nt);\n              let maxBitrates = getMaxBitrates(track.simulcastMaxBitrates);\n              transceiver = config.pc.addTransceiver(nt, {\n                direction: 'sendrecv',\n                streams: [config.myStream],\n                sendEncodings: track.sendEncodings || [\n                  { rid: 'h', active: true, maxBitrate: maxBitrates.high },\n                  {\n                    rid: 'm',\n                    active: true,\n                    maxBitrate: maxBitrates.medium,\n                    scaleResolutionDownBy: 2,\n                  },\n                  {\n                    rid: 'l',\n                    active: true,\n                    maxBitrate: maxBitrates.low,\n                    scaleResolutionDownBy: 4,\n                  },\n                ],\n              });\n            } else {\n              // Firefox-based RID, based on https://gist.github.com/voluntas/088bc3cc62094730647b\n              Janus.log('Enabling Simulcasting for Firefox (RID)');\n              transceiver = config.pc.addTransceiver(nt, {\n                direction: 'sendrecv',\n                streams: [config.myStream],\n              });\n              sender = transceiver ? transceiver.sender : null;\n              if (sender) {\n                let parameters = sender.getParameters();\n                if (!parameters) parameters = {};\n                let maxBitrates = getMaxBitrates(track.simulcastMaxBitrates);\n                parameters.encodings = track.sendEncodings || [\n                  { rid: 'h', active: true, maxBitrate: maxBitrates.high },\n                  {\n                    rid: 'm',\n                    active: true,\n                    maxBitrate: maxBitrates.medium,\n                    scaleResolutionDownBy: 2,\n                  },\n                  {\n                    rid: 'l',\n                    active: true,\n                    maxBitrate: maxBitrates.low,\n                    scaleResolutionDownBy: 4,\n                  },\n                ];\n                sender.setParameters(parameters);\n              }\n            }\n          } else {\n            Janus.log('Enabling SVC (' + track.svc + '):', nt);\n            transceiver = config.pc.addTransceiver(nt, {\n              direction: 'sendrecv',\n              streams: [config.myStream],\n              sendEncodings: [{ scalabilityMode: track.svc }],\n            });\n          }\n          if (!sender) sender = transceiver ? transceiver.sender : null;\n          // Check if we need to override some settings\n          if (track.codec) {\n            if (Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n              Janus.warn('setCodecPreferences not supported in Firefox, ignoring codec for track:', track);\n            } else if (typeof track.codec !== 'string') {\n              Janus.warn('Invalid codec value, ignoring for track:', track);\n            } else {\n              let mimeType = kind + '/' + track.codec.toLowerCase();\n              let codecs = RTCRtpReceiver.getCapabilities(kind).codecs.filter(function (codec) {\n                return codec.mimeType.toLowerCase() === mimeType;\n              });\n              if (!codecs || codecs.length === 0) {\n                Janus.warn('Codec not supported in this browser for this track, ignoring:', track);\n              } else if (transceiver) {\n                try {\n                  transceiver.setCodecPreferences(codecs);\n                } catch (err) {\n                  Janus.warn('Failed enforcing codec for this ' + kind + ' track:', err);\n                }\n              }\n            }\n          }\n          if (track.bitrate) {\n            // Override maximum bitrate\n            if (track.simulcast || track.svc) {\n              Janus.warn('Ignoring bitrate for simulcast/SVC track, use sendEncodings for that');\n            } else if (isNaN(track.bitrate) || track.bitrate < 0) {\n              Janus.warn('Ignoring invalid bitrate for track:', track);\n            } else if (sender) {\n              let params = sender.getParameters();\n              if (!params || !params.encodings || params.encodings.length === 0) {\n                Janus.warn('No encodings in the sender parameters, ignoring bitrate for track:', track);\n              } else {\n                params.encodings[0].maxBitrate = track.bitrate;\n                await sender.setParameters(params);\n              }\n            }\n          }\n          if (kind === 'video' && track.framerate) {\n            // Override maximum framerate\n            if (track.simulcast || track.svc) {\n              Janus.warn('Ignoring framerate for simulcast/SVC track, use sendEncodings for that');\n            } else if (isNaN(track.framerate) || track.framerate < 0) {\n              Janus.warn('Ignoring invalid framerate for track:', track);\n            } else if (sender) {\n              let params = sender.getParameters();\n              if (!params || !params.encodings || params.encodings.length === 0) {\n                Janus.warn('No encodings in the sender parameters, ignoring framerate for track:', track);\n              } else {\n                params.encodings[0].maxFramerate = track.framerate;\n                await sender.setParameters(params);\n              }\n            }\n          }\n          // Check if insertable streams are involved\n          if (track.transforms) {\n            if (sender && track.transforms.sender) {\n              // There's a sender transform, set it on the transceiver sender\n              let senderStreams = null;\n              if (RTCRtpSender.prototype.createEncodedStreams) {\n                senderStreams = sender.createEncodedStreams();\n              } else if (\n                RTCRtpSender.prototype.createAudioEncodedStreams ||\n                RTCRtpSender.prototype.createEncodedVideoStreams\n              ) {\n                if (kind === 'audio') {\n                  senderStreams = sender.createEncodedAudioStreams();\n                } else if (kind === 'video') {\n                  senderStreams = sender.createEncodedVideoStreams();\n                }\n              }\n              if (senderStreams) {\n                Janus.log('Insertable Streams sender transform:', senderStreams);\n                if (senderStreams.readableStream && senderStreams.writableStream) {\n                  senderStreams.readableStream\n                    .pipeThrough(track.transforms.sender)\n                    .pipeTo(senderStreams.writableStream);\n                } else if (senderStreams.readable && senderStreams.writable) {\n                  senderStreams.readable.pipeThrough(track.transforms.sender).pipeTo(senderStreams.writable);\n                }\n              }\n            }\n            if (transceiver && transceiver.receiver && track.transforms.receiver) {\n              // There's a receiver transform, set it on the transceiver receiver\n              let receiverStreams = null;\n              if (RTCRtpReceiver.prototype.createEncodedStreams) {\n                receiverStreams = transceiver.receiver.createEncodedStreams();\n              } else if (\n                RTCRtpReceiver.prototype.createAudioEncodedStreams ||\n                RTCRtpReceiver.prototype.createEncodedVideoStreams\n              ) {\n                if (kind === 'audio') {\n                  receiverStreams = transceiver.receiver.createEncodedAudioStreams();\n                } else if (kind === 'video') {\n                  receiverStreams = transceiver.receiver.createEncodedVideoStreams();\n                }\n              }\n              if (receiverStreams) {\n                Janus.log('Insertable Streams receiver transform:', receiverStreams);\n                if (receiverStreams.readableStream && receiverStreams.writableStream) {\n                  receiverStreams.readableStream\n                    .pipeThrough(track.transforms.receiver)\n                    .pipeTo(receiverStreams.writableStream);\n                } else if (receiverStreams.readable && receiverStreams.writable) {\n                  receiverStreams.readable.pipeThrough(track.transforms.receiver).pipeTo(receiverStreams.writable);\n                }\n              }\n            }\n          }\n        }\n        if (nt && track.dontStop === true) nt.dontStop = true;\n      } else if (track.recv && !transceiver) {\n        // Maybe a new recvonly track\n        transceiver = config.pc.addTransceiver(kind);\n        if (transceiver) {\n          // Check if we need to override some settings\n          if (track.codec) {\n            if (Janus.webRTCAdapter.browserDetails.browser === 'firefox') {\n              Janus.warn('setCodecPreferences not supported in Firefox, ignoring codec for track:', track);\n            } else if (typeof track.codec !== 'string') {\n              Janus.warn('Invalid codec value, ignoring for track:', track);\n            } else {\n              let mimeType = kind + '/' + track.codec.toLowerCase();\n              let codecs = RTCRtpReceiver.getCapabilities(kind).codecs.filter(function (codec) {\n                return codec.mimeType.toLowerCase() === mimeType;\n              });\n              if (!codecs || codecs.length === 0) {\n                Janus.warn('Codec not supported in this browser for this track, ignoring:', track);\n              } else {\n                try {\n                  transceiver.setCodecPreferences(codecs);\n                } catch (err) {\n                  Janus.warn('Failed enforcing codec for this ' + kind + ' track:', err);\n                }\n              }\n            }\n          }\n          // Check if insertable streams are involved\n          if (transceiver.receiver && track.transforms && track.transforms.receiver) {\n            // There's a receiver transform, set it on the transceiver receiver\n            let receiverStreams = null;\n            if (RTCRtpReceiver.prototype.createEncodedStreams) {\n              receiverStreams = transceiver.receiver.createEncodedStreams();\n            } else if (\n              RTCRtpReceiver.prototype.createAudioEncodedStreams ||\n              RTCRtpReceiver.prototype.createEncodedVideoStreams\n            ) {\n              if (kind === 'audio') {\n                receiverStreams = transceiver.receiver.createEncodedAudioStreams();\n              } else if (kind === 'video') {\n                receiverStreams = transceiver.receiver.createEncodedVideoStreams();\n              }\n            }\n            if (receiverStreams) {\n              Janus.log('Insertable Streams receiver transform:', receiverStreams);\n              if (receiverStreams.readableStream && receiverStreams.writableStream) {\n                receiverStreams.readableStream\n                  .pipeThrough(track.transforms.receiver)\n                  .pipeTo(receiverStreams.writableStream);\n              } else if (receiverStreams.readable && receiverStreams.writable) {\n                receiverStreams.readable.pipeThrough(track.transforms.receiver).pipeTo(receiverStreams.writable);\n              }\n            }\n          }\n        }\n      }\n      // Get rid of the old track\n      // FIXME We should probably do this *before* capturing the new\n      // track, since this prevents, for instance, just changing the\n      // resolution of the same webcam we're capturing already (the\n      // existing resolution would be returned, or an overconstrained\n      // error). On the other end, closing the track before we capture\n      // the new device means we'd end up with a period of time where\n      // no video is sent (changing device takes some time), and\n      // media would be stopped entirely in case capturing the new\n      // device results in an error. To keep things simpler, we're\n      // doing it after: we can make this configurable in the future.\n      if (trackId && config.myStream) {\n        let rt = null;\n        if (kind === 'audio' && config.myStream.getAudioTracks() && config.myStream.getAudioTracks().length) {\n          for (let t of config.myStream.getAudioTracks()) {\n            if (t.id === trackId) {\n              rt = t;\n              Janus.log('Removing audio track:', rt);\n            }\n          }\n        } else if (kind === 'video' && config.myStream.getVideoTracks() && config.myStream.getVideoTracks().length) {\n          for (let t of config.myStream.getVideoTracks()) {\n            if (t.id === trackId) {\n              rt = t;\n              Janus.log('Removing video track:', rt);\n            }\n          }\n        }\n        if (rt) {\n          // Remove the track and notify the application\n          try {\n            config.myStream.removeTrack(rt);\n            pluginHandle.onlocaltrack(rt, false);\n          } catch (e) {\n            Janus.error('Error calling onlocaltrack on removal for renegotiation', e);\n          }\n          // Close the old track (unless we've been asked not to)\n          if (rt.dontStop !== true) {\n            try {\n              rt.stop();\n            } catch (e) { }\n          }\n        }\n      }\n      if (nt) {\n        // FIXME Add the new track locally\n        config.myStream.addTrack(nt);\n        // Notify the application about the new local track, if any\n        nt.onended = function (ev) {\n          Janus.log('Local track removed:', ev);\n          try {\n            pluginHandle.onlocaltrack(ev.target, false);\n          } catch (e) {\n            Janus.error('Error calling onlocaltrack following end', e);\n          }\n        };\n        try {\n          pluginHandle.onlocaltrack(nt, true);\n        } catch (e) {\n          Janus.error('Error calling onlocaltrack for track add', e);\n        }\n      }\n      // Update the direction of the transceiver\n      if (transceiver) {\n        let curdir = transceiver.direction,\n          newdir = null;\n        let send = nt && transceiver.sender.track,\n          recv = track.recv !== false && transceiver.receiver.track;\n        if (send && recv) newdir = 'sendrecv';\n        else if (send && !recv) newdir = 'sendonly';\n        else if (!send && recv) newdir = 'recvonly';\n        else if (!send && !recv) newdir = 'inactive';\n        if (newdir && newdir !== curdir) {\n          Janus.warn('Changing direction of transceiver to ' + newdir + ' (was ' + curdir + ')', track);\n          if (transceiver.setDirection) transceiver.setDirection(newdir);\n          else transceiver.direction = newdir;\n        }\n      }\n    }\n    if (openedConsentDialog) pluginHandle.consentDialog(false);\n  }\n\n  function getLocalTracks(handleId) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return null;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return null;\n    }\n    let tracks = [];\n    let transceivers = config.pc.getTransceivers();\n    for (let tr of transceivers) {\n      let track = null;\n      if (tr.sender && tr.sender.track) {\n        track = { mid: tr.mid };\n        track.type = tr.sender.track.kind;\n        track.id = tr.sender.track.id;\n        track.label = tr.sender.track.label;\n      }\n      if (track) tracks.push(track);\n    }\n    return tracks;\n  }\n\n  function getRemoteTracks(handleId) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return null;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return null;\n    }\n    let tracks = [];\n    let transceivers = config.pc.getTransceivers();\n    for (let tr of transceivers) {\n      let track = null;\n      if (tr.receiver && tr.receiver.track) {\n        track = { mid: tr.mid };\n        track.type = tr.receiver.track.kind;\n        track.id = tr.receiver.track.id;\n        track.label = tr.receiver.track.label;\n      }\n      if (track) tracks.push(track);\n    }\n    return tracks;\n  }\n\n  function getVolume(handleId, mid, remote, result) {\n    result = typeof result == 'function' ? result : Janus.noop;\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      result(0);\n      return;\n    }\n    let stream = remote ? 'remote' : 'local';\n    let config = pluginHandle.webrtcStuff;\n    if (!config.volume[stream]) config.volume[stream] = { value: 0 };\n    // Start getting the volume, if audioLevel in getStats is supported (apparently\n    // they're only available in Chrome/Safari right now: https://webrtc-stats.callstats.io/)\n    if (\n      config.pc &&\n      config.pc.getStats &&\n      (Janus.webRTCAdapter.browserDetails.browser === 'chrome' ||\n        Janus.webRTCAdapter.browserDetails.browser === 'safari')\n    ) {\n      // Are we interested in a mid in particular?\n      let query = config.pc;\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          result(0);\n          return;\n        }\n        if (remote && !transceiver.receiver) {\n          Janus.warn('Remote transceiver track unavailable');\n          result(0);\n          return;\n        } else if (!remote && !transceiver.sender) {\n          Janus.warn('Local transceiver track unavailable');\n          result(0);\n          return;\n        }\n        query = remote ? transceiver.receiver : transceiver.sender;\n      }\n      query.getStats().then(function (stats) {\n        stats.forEach(function (res) {\n          if (!res || res.kind !== 'audio') return;\n          if ((remote && !res.remoteSource) || (!remote && res.type !== 'media-source')) return;\n          result(res.audioLevel ? res.audioLevel : 0);\n        });\n      });\n      return config.volume[stream].value;\n    } else {\n      // audioInputLevel and audioOutputLevel seem only available in Chrome? audioLevel\n      // seems to be available on Chrome and Firefox, but they don't seem to work\n      Janus.warn('Getting the ' + stream + ' volume unsupported by browser');\n      result(0);\n      return;\n    }\n  }\n\n  function isMuted(handleId, mid, video) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return true;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return true;\n    }\n    if (!config.myStream) {\n      Janus.warn('Invalid local MediaStream');\n      return true;\n    }\n    if (video) {\n      // Check video track\n      if (!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n        Janus.warn('No video track');\n        return true;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return true;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No video sender with mid ' + mid);\n          return true;\n        }\n        return !transceiver.sender.track.enabled;\n      } else {\n        return !config.myStream.getVideoTracks()[0].enabled;\n      }\n    } else {\n      // Check audio track\n      if (!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n        Janus.warn('No audio track');\n        return true;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          return true;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No audio sender with mid ' + mid);\n          return true;\n        }\n        return !transceiver.sender.track.enabled;\n      } else {\n        return !config.myStream.getAudioTracks()[0].enabled;\n      }\n    }\n  }\n\n  function mute(handleId, mid, video, mute) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return false;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return false;\n    }\n    if (!config.myStream) {\n      Janus.warn('Invalid local MediaStream');\n      return false;\n    }\n    if (video) {\n      // Mute/unmute video track\n      if (!config.myStream.getVideoTracks() || config.myStream.getVideoTracks().length === 0) {\n        Janus.warn('No video track');\n        return false;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return false;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No video sender with mid ' + mid);\n          return false;\n        }\n        transceiver.sender.track.enabled = mute ? false : true;\n      } else {\n        for (const videostream of config.myStream.getVideoTracks()) {\n          videostream.enabled = !mute;\n        }\n      }\n    } else {\n      // Mute/unmute audio track\n      if (!config.myStream.getAudioTracks() || config.myStream.getAudioTracks().length === 0) {\n        Janus.warn('No audio track');\n        return false;\n      }\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'audio');\n        if (!transceiver) {\n          Janus.warn('No audio transceiver with mid ' + mid);\n          return false;\n        }\n        if (!transceiver.sender || !transceiver.sender.track) {\n          Janus.warn('No audio sender with mid ' + mid);\n          return false;\n        }\n        transceiver.sender.track.enabled = mute ? false : true;\n      } else {\n        for (const audiostream of config.myStream.getAudioTracks()) {\n          audiostream.enabled = !mute;\n        }\n      }\n    }\n    return true;\n  }\n\n  function getBitrate(handleId, mid) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return 'Invalid handle';\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) return 'Invalid PeerConnection';\n    // Start getting the bitrate, if getStats is supported\n    if (config.pc.getStats) {\n      let query = config.pc;\n      let target = mid ? mid : 'default';\n      if (mid) {\n        let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid && t.receiver.track.kind === 'video');\n        if (!transceiver) {\n          Janus.warn('No video transceiver with mid ' + mid);\n          return 'No video transceiver with mid ' + mid;\n        }\n        if (!transceiver.receiver) {\n          Janus.warn('No video receiver with mid ' + mid);\n          return 'No video receiver with mid ' + mid;\n        }\n        query = transceiver.receiver;\n      }\n      if (!config.bitrate[target]) {\n        config.bitrate[target] = {\n          timer: null,\n          bsnow: null,\n          bsbefore: null,\n          tsnow: null,\n          tsbefore: null,\n          value: '0 kbits/sec',\n        };\n      }\n      if (!config.bitrate[target].timer) {\n        Janus.log('Starting bitrate timer' + (mid ? ' for mid ' + mid : '') + ' (via getStats)');\n        config.bitrate[target].timer = setInterval(function () {\n          query.getStats().then(function (stats) {\n            stats.forEach(function (res) {\n              if (!res) return;\n              let inStats = false;\n              // Check if these are statistics on incoming media\n              if (\n                (res.mediaType === 'video' || res.id.toLowerCase().indexOf('video') > -1) &&\n                res.type === 'inbound-rtp' &&\n                res.id.indexOf('rtcp') < 0\n              ) {\n                // New stats\n                inStats = true;\n              } else if (\n                res.type == 'ssrc' &&\n                res.bytesReceived &&\n                (res.googCodecName === 'VP8' || res.googCodecName === '')\n              ) {\n                // Older Chromer versions\n                inStats = true;\n              }\n              // Parse stats now\n              if (inStats) {\n                config.bitrate[target].bsnow = res.bytesReceived;\n                config.bitrate[target].tsnow = res.timestamp;\n                if (config.bitrate[target].bsbefore === null || config.bitrate[target].tsbefore === null) {\n                  // Skip this round\n                  config.bitrate[target].bsbefore = config.bitrate[target].bsnow;\n                  config.bitrate[target].tsbefore = config.bitrate[target].tsnow;\n                } else {\n                  // Calculate bitrate\n                  let timePassed = config.bitrate[target].tsnow - config.bitrate[target].tsbefore;\n                  if (Janus.webRTCAdapter.browserDetails.browser === 'safari') timePassed = timePassed / 1000; // Apparently the timestamp is in microseconds, in Safari\n                  let bitRate = Math.round(\n                    ((config.bitrate[target].bsnow - config.bitrate[target].bsbefore) * 8) / timePassed\n                  );\n                  if (Janus.webRTCAdapter.browserDetails.browser === 'safari') bitRate = parseInt(bitRate / 1000);\n                  config.bitrate[target].value = bitRate + ' kbits/sec';\n                  //~ Janus.log(\"Estimated bitrate is \" + config.bitrate.value);\n                  config.bitrate[target].bsbefore = config.bitrate[target].bsnow;\n                  config.bitrate[target].tsbefore = config.bitrate[target].tsnow;\n                }\n              }\n            });\n          });\n        }, 1000);\n        return '0 kbits/sec'; // We don't have a bitrate value yet\n      }\n      return config.bitrate[target].value;\n    } else {\n      Janus.warn('Getting the video bitrate unsupported by browser');\n      return 'Feature unsupported by browser';\n    }\n  }\n\n  function setBitrate(handleId, mid, bitrate) {\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle || !pluginHandle.webrtcStuff) {\n      Janus.warn('Invalid handle');\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (!config.pc) {\n      Janus.warn('Invalid PeerConnection');\n      return;\n    }\n    let transceiver = config.pc.getTransceivers().find((t) => t.mid === mid);\n    if (!transceiver) {\n      Janus.warn('No transceiver with mid', mid);\n      return;\n    }\n    if (!transceiver.sender) {\n      Janus.warn('No sender for transceiver with mid', mid);\n      return;\n    }\n    let params = transceiver.sender.getParameters();\n    if (!params || !params.encodings || params.encodings.length === 0) {\n      Janus.warn('No parameters encodings');\n    } else if (params.encodings.length > 1) {\n      Janus.warn('Ignoring bitrate for simulcast track, use sendEncodings for that');\n    } else if (isNaN(bitrate) || bitrate < 0) {\n      Janus.warn('Invalid bitrate (must be a positive integer)');\n    } else {\n      params.encodings[0].maxBitrate = bitrate;\n      transceiver.sender.setParameters(params);\n    }\n  }\n\n  function webrtcError(error) {\n    Janus.error('WebRTC error:', error);\n  }\n\n  function cleanupWebrtc(handleId, hangupRequest) {\n    Janus.log('Cleaning WebRTC stuff');\n    let pluginHandle = pluginHandles[handleId];\n    if (!pluginHandle) {\n      // Nothing to clean\n      return;\n    }\n    let config = pluginHandle.webrtcStuff;\n    if (config) {\n      if (hangupRequest === true) {\n        // Send a hangup request (we don't really care about the response)\n        let request = { janus: 'hangup', transaction: Janus.randomString(12) };\n        if (pluginHandle.token) request['token'] = pluginHandle.token;\n        if (apisecret) request['apisecret'] = apisecret;\n        Janus.debug('Sending hangup request (handle=' + handleId + '):');\n        Janus.debug(request);\n        if (websockets) {\n          request['session_id'] = sessionId;\n          request['handle_id'] = handleId;\n          ws.send(JSON.stringify(request));\n        } else {\n          Janus.httpAPICall(server + '/' + sessionId + '/' + handleId, {\n            verb: 'POST',\n            withCredentials: withCredentials,\n            body: request,\n          });\n        }\n      }\n      // Cleanup stack\n      if (config.volume) {\n        if (config.volume['local'] && config.volume['local'].timer) clearInterval(config.volume['local'].timer);\n        if (config.volume['remote'] && config.volume['remote'].timer) clearInterval(config.volume['remote'].timer);\n      }\n      for (let i in config.bitrate) {\n        if (config.bitrate[i].timer) clearInterval(config.bitrate[i].timer);\n      }\n      config.bitrate = {};\n      if (!config.streamExternal && config.myStream) {\n        Janus.log('Stopping local stream tracks');\n        Janus.stopAllTracks(config.myStream);\n      }\n      config.streamExternal = false;\n      config.myStream = null;\n      // Close PeerConnection\n      try {\n        config.pc.close();\n      } catch (e) {\n        // Do nothing\n      }\n      config.pc = null;\n      config.candidates = null;\n      config.mySdp = null;\n      config.remoteSdp = null;\n      config.iceDone = false;\n      config.dataChannel = {};\n      config.dtmfSender = null;\n      config.insertableStreams = false;\n    }\n    pluginHandle.oncleanup();\n  }\n\n  function isTrickleEnabled(trickle) {\n    Janus.debug('isTrickleEnabled:', trickle);\n    return trickle === false ? false : true;\n  }\n}\n\nmodule.exports = Janus;\n","import EventEmitter from 'eventemitter3';\nimport { adapter, MediaStream } from '../platform';\nimport config from '../config';\nimport JanusEngine from './janus.js';\nimport Utils from '../Utils';\nimport { Config, Janus, JanusDebugMode, JanusEvent, JanusMediaTrackReason } from '../types';\n\nexport default class JanusClient {\n  public token: Config.Credentials['token'];\n  public server: Config.Conference['server'];\n  public debug: Config.JanusDebug;\n  public engine!: JanusEngine;\n  public videoRoomPlugin: any = null;\n  public isOnlyAudio: boolean = false;\n  public currentRoomId: string | null = null;\n  public currentUserId: number | string | null = null;\n  public remoteFeeds: { [userId: number | string]: any } = {};\n  public remoteJseps: { [userId: number | string]: any } = {};\n  public remoteFeedsAttachingInProgress: { [userId: number | string]: any } = {};\n  public bitrateTimers: { [userId: number | string]: NodeJS.Timeout | null } = {};\n  public emitter: EventEmitter = new EventEmitter();\n\n  constructor(token: Config.Credentials['token']) {\n    if (!Utils.env.isReactNative && !adapter) {\n      throw 'Error: in order to use this library please connect adapter.js. More info https://github.com/webrtc/adapter';\n    }\n\n    this.token = token;\n    this.server = config.conference.server;\n    this.debug = config.conference.debug ?? JanusDebugMode.ALL;\n\n    if (!this.server) {\n      throw \"'server' parameter is mandatory\";\n    } else if (this.server.includes('http')) {\n      this.server += '/janus';\n    }\n  }\n\n  public createSession({\n    success = () => {},\n    error = () => {},\n    destroyed = () => {},\n    timeoutSessionCallback = () => {},\n  }: Janus.InitCallbacks): void {\n    JanusEngine.init({\n      debug: this.debug,\n      callback: () => {\n        if (!JanusEngine.isWebrtcSupported()) {\n          Utils.safeCallbackCall(error)(`Your browser does not support WebRTC, so you can't use this functionality.`);\n          return;\n        }\n\n        this.engine = new JanusEngine({\n          server: this.server,\n          iceServers: config.videochat.iceServers,\n          token: this.token,\n          success: () => Utils.safeCallbackCall(success)(),\n          error: (err) => Utils.safeCallbackCall(error)(err),\n          destroyed: () => Utils.safeCallbackCall(destroyed)(),\n          timeoutSessionCallback: () => Utils.safeCallbackCall(timeoutSessionCallback)(),\n        });\n      },\n    });\n  }\n\n  public getSessionId(): string | null {\n    return this.engine?.getSessionId() ?? null;\n  }\n\n  public destroySession({ success = () => {}, error = () => {} }: Janus.SuccessErrorCallbacks): void {\n    this.engine.destroy({\n      success: () => Utils.safeCallbackCall(success)(),\n      error: (err) => Utils.safeCallbackCall(error)(err),\n    });\n  }\n\n  public attachVideoConferencingPlugin(\n    isRemote: boolean,\n    userId: number,\n    skipMedia: boolean,\n    callbacks: Janus.PluginCallbacks\n  ): void {\n    let remoteFeed: any = null;\n\n    const localStream = callbacks.localStream;\n    delete callbacks.localStream;\n\n    const displayName = callbacks.displayName;\n    delete callbacks.displayName;\n\n    this.engine.attach({\n      plugin: 'janus.plugin.videoroom',\n      success: (pluginHandle) => {\n        if (isRemote) {\n          remoteFeed = pluginHandle;\n          remoteFeed.userId = userId;\n          this.remoteFeedsAttachingInProgress[userId] = remoteFeed;\n\n          const listen = {\n            request: 'join',\n            room: this.currentRoomId,\n            ptype: 'listener',\n            feed: userId,\n            display: displayName,\n          };\n\n          remoteFeed?.send({ message: listen });\n        } else {\n          this.videoRoomPlugin = pluginHandle;\n        }\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n      consentDialog: (on) => {\n        Utils.safeCallbackCall(callbacks.consentDialog)(on);\n      },\n      mediaState: (medium, on) => {\n        Utils.safeCallbackCall(callbacks.mediaState)(medium, on);\n      },\n      webrtcState: (on) => {\n        Utils.safeCallbackCall(callbacks.webrtcState)(on);\n      },\n      slowLink: (uplink, nacks) => {\n        Utils.safeCallbackCall(callbacks.slowLink)(uplink, nacks);\n      },\n      iceState: (iceConnectionState) => {\n        Utils.safeCallbackCall(callbacks.iceState)(iceConnectionState);\n      },\n      onmessage: (msg, jsep) => {\n        const event = msg['videoroom'];\n\n        if (isRemote) {\n          if (event) {\n            // Remote feed attached\n            if (event === 'attached') {\n              const feedId = msg['id'];\n              this.remoteFeeds[feedId] = this.remoteFeedsAttachingInProgress[feedId];\n              this.remoteFeedsAttachingInProgress[feedId] = null;\n            } else if (msg['error']) {\n              Utils.safeCallbackCall(callbacks.error)(msg['error']);\n            }\n          }\n\n          if (jsep) {\n            const feedId = msg['id'];\n\n            // ICE restart case\n            if (!feedId) {\n            }\n\n            this.remoteJseps[feedId] = jsep;\n\n            this.createAnswer(\n              {\n                remoteFeed: this.remoteFeeds[feedId],\n                jsep,\n              },\n              localStream as MediaStream,\n              {\n                success: () => {},\n                error: (error) => {\n                  Utils.safeCallbackCall(callbacks.error)(error);\n                },\n              }\n            );\n          }\n\n          // local feed\n        } else {\n          if (event) {\n            // We JOINED\n            if (event === 'joined') {\n              const media = skipMedia ? { audio: false, video: false } : { audio: true, video: true };\n              const existedStream = skipMedia ? undefined : localStream;\n              const offerParams = { media, stream: existedStream };\n              this.createOffer(offerParams, {\n                success: () => {\n                  if (msg['publishers']) {\n                    const publishers = msg['publishers'];\n                    for (const f in publishers) {\n                      const userId = publishers[f]['id'];\n                      const userDisplayName = publishers[f]['display'];\n                      this.emitter.emit(JanusEvent.PARTICIPANT_JOINED, userId, userDisplayName, true);\n                    }\n                  }\n                },\n                error: (error) => {\n                  Utils.safeCallbackCall(callbacks.error)(error);\n                },\n              });\n\n              // We JOINED and now receiving who is online\n            } else if (event === 'event') {\n              // Any new feed to attach to?\n              if (msg['publishers']) {\n                const publishers = msg['publishers'];\n\n                for (const f in publishers) {\n                  const userId = publishers[f]['id'];\n                  const userDisplayName = publishers[f]['display'];\n\n                  this.emitter.emit(JanusEvent.PARTICIPANT_JOINED, userId, userDisplayName, false);\n                }\n\n                // Someone is LEAVING\n              } else if (msg['leaving']) {\n                // One of the publishers has gone away?\n                const feedId = msg['leaving'];\n                const success = this.detachRemoteFeed(feedId);\n                if (success) {\n                  this.emitter.emit(JanusEvent.PARTICIPANT_LEFT, feedId, null);\n                }\n              } else if (msg['unpublished']) {\n                // One of the publishers has gone away?\n                const feedId = msg['unpublished'];\n                if (feedId != 'ok') {\n                  const success = this.detachRemoteFeed(feedId);\n                  if (success) {\n                    this.emitter.emit(JanusEvent.PARTICIPANT_LEFT, feedId, null);\n                  }\n                }\n              } else if (msg['error']) {\n                Utils.DLog('[janus error message]', msg['error']);\n                // #define VIDEOROOM_ERROR_ID_EXISTS\t\t\t436\n                // #define VIDEOROOM_ERROR_UNAUTHORIZED\t\t433\n                //\n                this.emitter.emit(JanusEvent.ERROR, msg);\n                Utils.safeCallbackCall(callbacks.error)(msg['error']);\n              }\n            }\n          }\n\n          if (jsep) {\n            this.videoRoomPlugin.handleRemoteJsep({ jsep: jsep });\n\n            // TODO:\n            // handle wrong or unsupported codecs here...\n            // const video = msg['video_codec']\n            // if(mystream && mystream.getVideoTracks() && mystream.getVideoTracks().length > 0 && !video) {\n            // \t\t'Our video stream has been rejected, viewers won't see us'\n            // }\n          }\n        }\n      },\n      onlocaltrack: (track, on) => {\n        Utils.DLog('[onlocaltrack]', track, on);\n        this.onLocalTrack(track, on);\n      },\n      onremotetrack: (track, mid, on, metadata) => {\n        Utils.DLog('[onremotetrack]', track, mid, on, metadata);\n        this.onRemoteTrack(remoteFeed, track, mid, on, metadata);\n      },\n      ondataopen: (channelLabel) => {\n        Utils.DLog('[ondataopen]', channelLabel);\n        this.emitter.emit(JanusEvent.DATA_CHANNEL_OPEN, channelLabel);\n      },\n      ondata: (data, channelLabel) => {\n        Utils.DLog('[ondata]', channelLabel, data);\n        this.emitter.emit(JanusEvent.DATA_CHANNEL_MESSAGE, channelLabel, data);\n      },\n      oncleanup: () => {\n        Utils.safeCallbackCall(callbacks.oncleanup)();\n      },\n      detached: () => {},\n    });\n  }\n\n  public onLocalTrack(track: MediaStreamTrack, on: any): void {\n    // this.emitter.emit(JanusEvent.LOCAL_STREAM, track);\n  }\n\n  public onRemoteTrack(remoteFeed: any, track: MediaStreamTrack, mid: any, on: any, metadata: any): void {\n    const eventType = metadata && metadata.reason;\n\n    if (eventType === JanusMediaTrackReason.CREATED) {\n      const isStreamNoExistedBefore = !remoteFeed.stream || !remoteFeed.tracks;\n      if (isStreamNoExistedBefore) {\n        remoteFeed.tracks = { [mid]: track };\n        remoteFeed.stream = new MediaStream([track]);\n      } else {\n        remoteFeed.tracks[mid] = track;\n        remoteFeed.stream.addTrack(track);\n      }\n      if (isStreamNoExistedBefore) {\n        this.emitter.emit(JanusEvent.REMOTE_STREAM, remoteFeed.userId, remoteFeed.stream);\n      }\n    } else if (eventType === JanusMediaTrackReason.ENDED) {\n      delete remoteFeed.tracks[mid];\n\n      const trackToRemove = remoteFeed.stream.getTracks().find((streamTrack) => streamTrack.kind === track.kind);\n      remoteFeed.stream.removeTrack(trackToRemove);\n    }\n\n    this.emitter.emit(JanusEvent.REMOTE_TRACKS_UPDATED, remoteFeed.userId, track, eventType);\n  }\n\n  public getPluginId(): string | null {\n    return this.videoRoomPlugin?.getId() ?? null;\n  }\n\n  public detachVideoConferencingPlugin(callbacks: Janus.SuccessErrorCallbacks): void {\n    const clean = () => {\n      this.videoRoomPlugin = null;\n\n      // detach all remote feeds\n      Object.keys(this.remoteFeeds).forEach((userId) => {\n        this.detachRemoteFeed(Number(userId));\n      });\n\n      this.remoteFeeds = {};\n      this.remoteJseps = {};\n      /*\n       * Deprecated\n      this.currentMediaDeviceId = null\n       */\n    };\n\n    this.videoRoomPlugin.detach({\n      success: () => {\n        clean();\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        clean();\n\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public join(roomId: string, userId: number, isOnlyAudio: boolean, callbacks: Janus.RequestCallbacks): void {\n    const displayName = callbacks.displayName;\n    delete callbacks.displayName;\n\n    this.isOnlyAudio = isOnlyAudio;\n\n    Utils.DLog('isOnlyAudio: ' + this.isOnlyAudio);\n\n    const joinEvent = {\n      request: 'join',\n      room: roomId,\n      ptype: 'publisher',\n      id: userId,\n      display: displayName,\n    };\n\n    this.videoRoomPlugin.send({\n      message: joinEvent,\n      success: (resp) => {\n        this.currentRoomId = roomId;\n        this.currentUserId = userId;\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public leave(callbacks: Janus.RequestCallbacks): void {\n    Utils.DLog('leave');\n\n    if (!this.engine.isConnected()) {\n      Utils.safeCallbackCall(callbacks.success)();\n      return;\n    }\n\n    const leaveEvent = {\n      request: 'leave',\n      room: this.currentRoomId,\n      id: this.currentUserId,\n    };\n\n    if (this.videoRoomPlugin) {\n      this.videoRoomPlugin.send({ message: leaveEvent });\n    }\n    this.currentRoomId = null;\n    this.currentUserId = null;\n\n    Utils.safeCallbackCall(callbacks.success)();\n  }\n\n  public listOnlineParticipants(roomId: string, callbacks: Janus.SuccessErrorCallbacks): void {\n    const listRequest = { request: 'listparticipants', room: roomId };\n\n    this.videoRoomPlugin.send({\n      message: listRequest,\n      success: (data) => {\n        const participants = data ? data.participants : [];\n        Utils.safeCallbackCall(callbacks.success)(participants);\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public toggleAudioMute(): boolean {\n    const muted = this.videoRoomPlugin.isAudioMuted();\n    if (muted) {\n      this.videoRoomPlugin.unmuteAudio();\n    } else {\n      this.videoRoomPlugin.muteAudio();\n    }\n    return this.videoRoomPlugin.isAudioMuted();\n  }\n\n  public isAudioMuted(): boolean {\n    return this.videoRoomPlugin.isAudioMuted();\n  }\n\n  public toggleRemoteAudioMute(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const audioTracks = remoteFeed.stream.getAudioTracks();\n    if (audioTracks && audioTracks.length > 0) {\n      for (let i = 0; i < audioTracks.length; ++i) {\n        audioTracks[i].enabled = !audioTracks[i].enabled;\n      }\n      return !audioTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public isRemoteAudioMuted(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const audioTracks = remoteFeed.stream.getAudioTracks();\n    if (audioTracks && audioTracks.length > 0) {\n      return !audioTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public toggleVideoMute(): boolean {\n    const muted = this.videoRoomPlugin.isVideoMuted();\n    if (muted) {\n      this.videoRoomPlugin.unmuteVideo();\n    } else {\n      this.videoRoomPlugin.muteVideo();\n    }\n    return this.videoRoomPlugin.isVideoMuted();\n  }\n\n  public isVideoMuted(): boolean {\n    return this.videoRoomPlugin.isVideoMuted();\n  }\n\n  public toggleRemoteVideoMute(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const videoTracks = remoteFeed.stream.getVideoTracks();\n    if (videoTracks && videoTracks.length > 0) {\n      for (let i = 0; i < videoTracks.length; ++i) {\n        videoTracks[i].enabled = !videoTracks[i].enabled;\n      }\n      return !videoTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public isRemoteVideoMuted(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (!remoteFeed) {\n      return false;\n    }\n\n    const videoTracks = remoteFeed.stream.getVideoTracks();\n    if (videoTracks && videoTracks.length > 0) {\n      return !videoTracks[0].enabled;\n    }\n\n    return false;\n  }\n\n  public sendKeyframeRequest(roomId: string, callbacks: Janus.SuccessErrorCallbacks): void {\n    const configureRequest = {\n      request: 'configure',\n      room: roomId,\n      keyframe: true,\n    };\n\n    this.videoRoomPlugin.send({\n      message: configureRequest,\n      success: (response) => {\n        Utils.safeCallbackCall(callbacks.success)(response);\n      },\n      error: (error) => {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public getTracksFromStream(stream: MediaStream): { type: string; capture: MediaStreamTrack; recv: boolean }[] {\n    const tracks: { type: string; capture: MediaStreamTrack; recv: boolean }[] = [];\n\n    const audioTracks = stream.getAudioTracks();\n    if (audioTracks.length) {\n      const audioTrack = audioTracks[0];\n      tracks.push({ type: 'audio', capture: audioTrack, recv: false });\n    }\n\n    const videoTracks = stream.getVideoTracks();\n    if (videoTracks.length) {\n      const videoTrack = videoTracks[0];\n      tracks.push({ type: 'video', capture: videoTrack, recv: false });\n    }\n\n    return tracks;\n  }\n\n  public createOffer(\n    mediaParams: { stream?: MediaStream; media: { audio: boolean; video: boolean }; replace?: boolean },\n    callbacks: Janus.SuccessErrorCallbacks\n  ): void {\n    Utils.DLog('[JanusWrapper][createOffer]', mediaParams);\n\n    const { stream: existedStream, media, replace } = mediaParams;\n\n    const createOfferParams: any = { tracks: [{ type: 'data' }] };\n\n    if (existedStream) {\n      const tracksFromStream = this.getTracksFromStream(existedStream);\n      createOfferParams.tracks = createOfferParams.tracks.concat(tracksFromStream);\n    } else if (media) {\n      const tracksFromParams: { type: string; capture: boolean; recv: boolean; replace: boolean }[] = [];\n      if (media.audio) {\n        tracksFromParams.push({\n          type: 'audio',\n          capture: media.audio,\n          recv: false,\n          replace: !!replace,\n        });\n      }\n      if (media.video) {\n        tracksFromParams.push({\n          type: 'video',\n          capture: media.video,\n          recv: false,\n          replace: !!replace,\n        });\n      }\n      createOfferParams.tracks = createOfferParams.tracks.concat(tracksFromParams);\n    } else {\n      createOfferParams.tracks = createOfferParams.tracks.concat([\n        { type: 'audio', capture: true, recv: false, replace: !!replace },\n        { type: 'video', capture: true, recv: false, replace: !!replace },\n      ]);\n    }\n\n    Utils.DLog('[JanusWrapper][createOffer][params]', createOfferParams);\n\n    createOfferParams.customizeSdp = (jsep) => {};\n\n    createOfferParams.success = (jsep) => {\n      const publish = {\n        request: 'configure',\n        audio: !!media.audio,\n        video: !!media.video,\n      };\n      Utils.DLog('[JanusWrapper][createOffer][success]', publish);\n\n      this.videoRoomPlugin.send({ message: publish, jsep: jsep });\n\n      Utils.safeCallbackCall(callbacks.success)();\n    };\n\n    createOfferParams.error = (error) => {\n      Utils.DLog('[JanusWrapper][createOffer][error]', error);\n      if (media.audio) {\n        this.createOffer({ media: { video: false, audio: false } }, callbacks);\n      } else {\n        Utils.safeCallbackCall(callbacks.error)(error);\n      }\n    };\n\n    this.videoRoomPlugin.createOffer(createOfferParams);\n  }\n\n  public getTracksMidsFromStream(stream: MediaStream): { type: string; mid: string; recv: boolean }[] {\n    const tracks: { type: string; mid: string; recv: boolean }[] = [];\n\n    const audioTracks = stream.getAudioTracks();\n    if (audioTracks.length) {\n      const audioTrack = audioTracks[0];\n      tracks.push({ type: 'audio', mid: audioTrack.id, recv: true });\n    }\n\n    const videoTracks = stream.getVideoTracks();\n    if (videoTracks.length) {\n      const videoTrack = videoTracks[0];\n      tracks.push({ type: 'video', mid: videoTrack.id, recv: true });\n    }\n\n    return tracks;\n  }\n\n  public createAnswer(\n    { remoteFeed, jsep }: any,\n    existedStream: MediaStream,\n    callbacks: Janus.SuccessErrorCallbacks\n  ): void {\n    Utils.DLog('[JanusWrapper][createAnswer]', jsep, existedStream);\n    let tracks: any = [{ type: 'data' }];\n\n    if (existedStream) {\n      const tracksFromStream = this.getTracksMidsFromStream(existedStream);\n      tracks = tracks.concat(tracksFromStream);\n    }\n\n    Utils.DLog('[JanusWrapper][createAnswer][tracks]', tracks);\n\n    remoteFeed.createAnswer({\n      jsep: jsep,\n      tracks: tracks,\n      success: (jsep) => {\n        const body = { request: 'start', room: this.currentRoomId };\n        Utils.DLog('[JanusWrapper][createAnswer][success]', body);\n\n        remoteFeed.send({ message: body, jsep: jsep });\n\n        Utils.safeCallbackCall(callbacks.success)();\n      },\n      error: (error) => {\n        Utils.DLog('[JanusWrapper][createAnswer][error]', error);\n        Utils.safeCallbackCall(callbacks.error)(error);\n      },\n    });\n  }\n\n  public detachRemoteFeed(userId: number): boolean {\n    const remoteFeed = this.remoteFeeds[userId];\n    if (remoteFeed) {\n      remoteFeed.detach();\n      this.remoteFeeds[userId] = null;\n      this.remoteJseps[userId] = null;\n      return true;\n    }\n    return false;\n  }\n\n  public getUserBitrate(userId: number): any {\n    const remoteFeed = this.remoteFeeds[userId];\n    return remoteFeed.getBitrate();\n  }\n\n  public getVolume(resultCallback: (value: any) => void): void {\n    return this.videoRoomPlugin.getLocalVolume(null, resultCallback);\n  }\n\n  public getUserVolume(userId: number, resultCallback: (value: any) => void): void {\n    const remoteFeed = this.remoteFeeds[userId];\n    return remoteFeed.getRemoteVolume(null, resultCallback);\n  }\n\n  public showBitrate(userId: number, element: any): void {\n    const remoteFeed = this.remoteFeeds[userId];\n\n    if (\n      !Utils.env.isReactNative &&\n      (adapter.browserDetails.browser === 'chrome' || adapter.browserDetails.browser === 'firefox')\n    ) {\n      this.bitrateTimers[userId] = setInterval(() => {\n        const bitrate = remoteFeed.getBitrate();\n        element.text(bitrate);\n      }, 1000);\n    }\n  }\n\n  public hideBitrate(userId: number, element: any): void {\n    if (this.bitrateTimers[userId]) {\n      clearInterval(this.bitrateTimers[userId]);\n    }\n    this.bitrateTimers[userId] = null;\n    element.text = null;\n  }\n\n  public on(eventType: JanusEvent, listener: (...args: any[]) => void): EventEmitter {\n    return this.emitter.addListener(eventType, listener);\n  }\n\n  public removeAllListeners(eventType?: JanusEvent): EventEmitter {\n    return this.emitter.removeAllListeners(eventType);\n  }\n}\n","import { mediaDevices } from '../platform';\nimport Utils from '../Utils';\nimport JanusClient from './JanusClient';\nimport { Auth, Janus, JanusCallType, JanusEvent, Media } from '../types';\n\nexport default class ConferenceSession {\n  private client: JanusClient;\n  public id: string = `${Math.random()}`;\n  public currentUserDisplayName?: string;\n  public localStream?: MediaStream;\n  public mediaParams: MediaStreamConstraints = {};\n  public onParticipantJoinedListener!: Janus.OnParticipantJoinedListener;\n  public onParticipantLeftListener!: Janus.OnParticipantLeftListener;\n  public onSlowLinkListener!: Janus.OnSlowLinkListener;\n  public onRemoteStreamListener!: Janus.OnRemoteStreamListener;\n  public onRemoteTracksUpdatedListener!: Janus.OnRemoteTracksUpdatedListener;\n  public onRemoteConnectionStateChangedListener!: Janus.OnRemoteConnectionStateChangedListener;\n  public onDataChannelOpenedListener!: Janus.OnDataChannelOpenedListener;\n  public onDataChannelMessageListener!: Janus.OnDataChannelMessageListener;\n  public onSessionConnectionStateChangedListener!: Janus.OnSessionConnectionStateChangedListener;\n  public onErrorListener!: Janus.OnErrorListener;\n\n  constructor(token: Auth.Session['token']) {\n    this.client = new JanusClient(token);\n    this.client.on(JanusEvent.PARTICIPANT_JOINED, this.onParticipantJoined);\n    this.client.on(JanusEvent.PARTICIPANT_LEFT, this.onParticipantLeft);\n    this.client.on(JanusEvent.REMOTE_STREAM, this.onRemoteStream);\n    this.client.on(JanusEvent.REMOTE_TRACKS_UPDATED, this.onRemoteTracksUpdated);\n    this.client.on(JanusEvent.DATA_CHANNEL_OPEN, this.onDataChannelOpen);\n    this.client.on(JanusEvent.DATA_CHANNEL_MESSAGE, this.onDataChannelMessage);\n    this.client.on(JanusEvent.ERROR, this.onError);\n  }\n\n  get currentRoomId(): string | null {\n    return this.client.currentRoomId;\n  }\n\n  set currentRoomId(roomId: string | null) {\n    this.client.currentRoomId = roomId;\n  }\n\n  get currentPublisherPC() {\n    return this.client.videoRoomPlugin.webrtcStuff.pc;\n  }\n\n  private async createSession(): Promise<void> {\n    let isResolved = false;\n\n    return new Promise((resolve, reject) => {\n      this.client.createSession({\n        success: () => {\n          isResolved = true;\n          resolve(void 0);\n        },\n        error: (error) => {\n          if (isResolved) {\n            this.onError(error);\n          } else {\n            reject(error);\n          }\n        },\n      });\n    });\n  }\n\n  // joinAsPublisher+Listener\n  public async join(roomId: string, user_id: number, userDisplayName: string): Promise<void> {\n    this.currentUserDisplayName = userDisplayName;\n    this.currentRoomId = roomId;\n    await this.createSession();\n    await this.createHandler(user_id, false, false);\n    await this.joinInternal(this.currentRoomId, user_id);\n  }\n\n  public async joinAsListener(roomId: string, user_id: number, userDisplayName: string): Promise<void> {\n    this.currentUserDisplayName = userDisplayName;\n    this.currentRoomId = roomId;\n    await this.createSession();\n    await this.createHandler(user_id, false, true);\n    await this.joinInternal(this.currentRoomId, user_id);\n  }\n\n  public async sendKeyframeRequest(roomId: string): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.client.sendKeyframeRequest(roomId, {\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  private async createHandler(user_id: number, isRemote: boolean, skipMedia: boolean = false): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.attachVideoConferencingPlugin(isRemote, user_id, skipMedia, {\n        success: resolve,\n        error: reject,\n        iceState: isRemote\n          ? (iceState) => this.onRemoteIceStateChanged(user_id, iceState)\n          : (iceState) => this.onLocalIceStateChanged(iceState),\n        slowLink: isRemote\n          ? (uplink, nacks) => this.onSlowLink(user_id, uplink, nacks)\n          : (uplink, nacks) => this.onSlowLink(null, uplink, nacks),\n        localStream: this.localStream,\n        displayName: this.currentUserDisplayName,\n      });\n    });\n  }\n\n  private async joinInternal(roomId: string, user_id: number): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.join(roomId, user_id, false, {\n        success: resolve,\n        error: reject,\n        displayName: this.currentUserDisplayName,\n      });\n    });\n  }\n\n  private onParticipantJoined = (user_id: number, userDisplayName: string, isExistingParticipant: boolean): void => {\n    Utils.DLog('[onParticipantJoined]', user_id, userDisplayName, isExistingParticipant);\n    this.createHandler(user_id, true, false);\n    Utils.safeCallbackCall(this.onParticipantJoinedListener)(this, user_id, userDisplayName, isExistingParticipant);\n  };\n\n  private onParticipantLeft = (user_id: number, userDisplayName: string): void => {\n    Utils.DLog('[onParticipantLeft]', user_id, userDisplayName);\n    Utils.safeCallbackCall(this.onParticipantLeftListener)(this, user_id, userDisplayName);\n  };\n\n  private onError = (error: any): void => {\n    Utils.DLog('[onError]', JSON.stringify(error));\n    Utils.safeCallbackCall(this.onErrorListener)(this, error);\n  };\n\n  private onDataChannelOpen = (label: any): void => {\n    Utils.DLog('[onDataChannelOpen]', label);\n    Utils.safeCallbackCall(this.onDataChannelOpenedListener)(this, label);\n  };\n\n  private onDataChannelMessage = (user_id: number, data: any): void => {\n    Utils.DLog('[onDataChannelMessage]', user_id, data);\n    Utils.safeCallbackCall(this.onDataChannelMessageListener)(this, user_id, data);\n  };\n\n  private onLocalIceStateChanged = (iceState: any): void => {\n    Utils.DLog('[onLocalIceStateChanged]', iceState);\n    Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener)(this, iceState);\n  };\n\n  private onRemoteIceStateChanged = (user_id: number, iceState: any): void => {\n    Utils.DLog('[onRemoteIceStateChanged]', user_id, iceState);\n    Utils.safeCallbackCall(this.onRemoteConnectionStateChangedListener)(this, user_id, iceState);\n  };\n\n  private onRemoteStream = (user_id: number, stream: MediaStream): void => {\n    Utils.DLog('[onRemoteStream]', user_id, stream);\n    Utils.safeCallbackCall(this.onRemoteStreamListener)(this, user_id, stream);\n  };\n\n  private onRemoteTracksUpdated = (user_id: number, track: MediaStreamTrack, eventType: any): void => {\n    Utils.DLog('[onRemoteTracksUpdated]', user_id, track, eventType);\n    Utils.safeCallbackCall(this.onRemoteTracksUpdatedListener)(this, user_id, track, eventType);\n  };\n\n  private onSlowLink = (user_id: number | null, uplink: any, nacks: any): void => {\n    Utils.DLog('[onSlowLink]', user_id, uplink, nacks);\n    Utils.safeCallbackCall(this.onSlowLinkListener)(this, user_id, uplink, nacks);\n  };\n\n  public async listOfOnlineParticipants(): Promise<any> {\n    return new Promise((resolve, reject) => {\n      if (this.currentRoomId) {\n        this.client.listOnlineParticipants(this.currentRoomId, {\n          success: resolve,\n          error: reject,\n        });\n      } else {\n        reject('Room ID is not set');\n      }\n    });\n  }\n\n  public async leave(): Promise<void> {\n    this.currentRoomId = null;\n    this.currentUserDisplayName = undefined;\n    await this.leaveGroup();\n    await this.detachVideoConferencingPlugin();\n    await this.destroy();\n\n    if (this.localStream) {\n      this.localStream.getTracks().forEach((track) => track.stop());\n      this.localStream = undefined;\n      this.mediaParams = {};\n    }\n  }\n\n  public async leaveGroup(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.leave({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async destroy(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.destroySession({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async detachVideoConferencingPlugin(): Promise<void> {\n    return new Promise((resolve, reject) => {\n      this.client.detachVideoConferencingPlugin({\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n\n  public async getDisplayMedia(params: Media.DisplayParams): Promise<MediaStream> {\n    if (!mediaDevices.getDisplayMedia) {\n      throw new Error(\"Your environment does not support 'getDisplayMedia' API\");\n    }\n\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      return this.upsertStream(stream, elementId, options);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getUserMedia(params: Media.UserParams): Promise<MediaStream> {\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getUserMedia(mediaParams);\n      return this.upsertStream(stream, elementId, options);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private upsertStream(\n    stream: MediaStream,\n    elementId: string | null = null,\n    options: Media.ElementOptions = {}\n  ): MediaStream {\n    const shouldUpdateCurrentStream = !!this.localStream;\n\n    if (shouldUpdateCurrentStream) {\n      this.replaceTracks(stream);\n    } else {\n      this.localStream = stream;\n    }\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    if (elementId) {\n      if (shouldUpdateCurrentStream) {\n        this.detachMediaStream(elementId, options);\n      }\n      this.attachMediaStream(elementId, this.localStream, options);\n    }\n\n    return this.localStream;\n  }\n\n  private replaceTracks(stream: MediaStream): MediaStream {\n    this.localStream?.getTracks().forEach((localTrack) => {\n      if (localTrack.kind === JanusCallType.AUDIO && stream.getAudioTracks().length === 0) {\n        return;\n      } else {\n        localTrack.stop();\n        this.localStream?.removeTrack(localTrack);\n      }\n    });\n\n    stream.getTracks().forEach((newTrack) => {\n      const pcSenders = this.currentPublisherPC.getSenders();\n      const sender = pcSenders.find(({ track }) => newTrack.kind === track.kind);\n\n      if (newTrack.kind === JanusCallType.AUDIO) {\n        newTrack.enabled = this.localStream?.getAudioTracks().every(({ enabled }) => enabled) ?? true;\n      } else {\n        newTrack.enabled = this.localStream?.getVideoTracks().every(({ enabled }) => enabled) ?? true;\n      }\n\n      if (sender) {\n        sender.replaceTrack(newTrack);\n        this.localStream?.addTrack(newTrack);\n      } else {\n        console.warn(`No sender found for track kind: ${newTrack.kind}`);\n      }\n    });\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    return this.localStream;\n  }\n\n  public async switchMediaTracks(options: Media.TrackConstraintsOrDeviceIds): Promise<MediaStream> {\n    [JanusCallType.AUDIO, JanusCallType.VIDEO].forEach((type) => {\n      const device = type === JanusCallType.AUDIO ? options.audio : type === JanusCallType.VIDEO ? options.video : {};\n      const deviceId = typeof device === 'string' ? device : device?.deviceId ?? null;\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] === 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    try {\n      const mediaParams = {\n        audio: this.mediaParams?.audio ?? false,\n        video: this.mediaParams?.video ?? false,\n      };\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      return this.replaceTracks(stream);\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public muteVideo(): void {\n    if (!this.isVideoMuted()) {\n      this.client.toggleVideoMute();\n    }\n  }\n\n  public unmuteVideo(): void {\n    if (this.isVideoMuted()) {\n      this.client.toggleVideoMute();\n    }\n  }\n\n  public muteAudio(): void {\n    if (!this.isAudioMuted()) {\n      this.client.toggleAudioMute();\n    }\n  }\n\n  public unmuteAudio(): void {\n    if (this.isAudioMuted()) {\n      this.client.toggleAudioMute();\n    }\n  }\n\n  public isVideoMuted(): boolean {\n    return this.client.isVideoMuted();\n  }\n\n  public isAudioMuted(): boolean {\n    return this.client.isAudioMuted();\n  }\n\n  public async getUserVolume(): Promise<any> {\n    return new Promise((resolve, _reject) => {\n      return this.client.getVolume(resolve);\n    });\n  }\n\n  public getRemoteUserBitrate(userId: number): any {\n    return this.client.getUserBitrate(userId);\n  }\n\n  public async getRemoteUserVolume(userId: number): Promise<any> {\n    return new Promise((resolve, reject) => {\n      return this.client.getUserVolume(userId, resolve);\n    });\n  }\n\n  public attachMediaStream(elementId: string, stream: MediaStream, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.srcObject = stream;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n      mediaElement.onloadedmetadata = (_event: Event) => {\n        mediaElement.play();\n      };\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public detachMediaStream(elementId: string, opt?: Media.ElementOptions) {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.pause();\n      mediaElement.srcObject = null;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public async sendData(data: any, label: any): Promise<any> {\n    return new Promise((resolve, reject) => {\n      this.client.videoRoomPlugin.data({\n        data,\n        label,\n        success: resolve,\n        error: reject,\n      });\n    });\n  }\n}\n","import { mediaDevices } from '../platform';\nimport ConferenceSession from './ConferenceSession';\nimport ProxyService from '../Proxy';\nimport { Janus, JanusCallType, ConferenceEvent, DeviceInputType } from '../types';\n\nexport default class ConferenceClient {\n  public proxy: ProxyService;\n  public DeviceInputType: typeof DeviceInputType = DeviceInputType;\n  public JanusCallType: typeof JanusCallType = JanusCallType;\n  public sessionsStore: { [id: ConferenceSession['id']]: ConferenceSession } = {};\n  public onParticipantJoinedListener!: Janus.OnParticipantJoinedListener;\n  public onParticipantLeftListener!: Janus.OnParticipantLeftListener;\n  public onSlowLinkListener!: Janus.OnSlowLinkListener;\n  public onRemoteStreamListener!: Janus.OnRemoteStreamListener;\n  public onRemoteTracksUpdatedListener!: Janus.OnRemoteTracksUpdatedListener;\n  public onRemoteConnectionStateChangedListener!: Janus.OnRemoteConnectionStateChangedListener;\n  public onDataChannelOpenedListener!: Janus.OnDataChannelOpenedListener;\n  public onDataChannelMessageListener!: Janus.OnDataChannelMessageListener;\n  public onSessionConnectionStateChangedListener!: Janus.OnSessionConnectionStateChangedListener;\n  public onErrorListener!: Janus.OnErrorListener;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  createNewSession() {\n    const session = new ConferenceSession(this.getCurrentSessionToken());\n\n    this.sessionsStore[session.id] = session;\n    session.onParticipantJoinedListener = this.onParticipantJoinedListener;\n    session.onParticipantLeftListener = this.onParticipantLeftListener;\n    session.onSlowLinkListener = this.onSlowLinkListener;\n    session.onRemoteStreamListener = this.onRemoteStreamListener;\n    session.onRemoteTracksUpdatedListener = this.onRemoteTracksUpdatedListener;\n    session.onRemoteConnectionStateChangedListener = this.onRemoteConnectionStateChangedListener;\n    session.onDataChannelOpenedListener = this.onDataChannelOpenedListener;\n    session.onDataChannelMessageListener = this.onDataChannelMessageListener;\n    session.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener;\n    session.onErrorListener = this.onErrorListener;\n\n    return session;\n  }\n\n  public async getMediaDevices(kind?: DeviceInputType): Promise<MediaDeviceInfo[]> {\n    if (mediaDevices?.enumerateDevices) {\n      const devices = await mediaDevices.enumerateDevices();\n      return kind ? devices.filter((device) => device.kind === kind) : devices;\n    } else {\n      throw new Error(\"No 'enumerateDevices' API supported\");\n    }\n  }\n\n  public clearSession(session_id: ConferenceSession['id']): void {\n    delete this.sessionsStore[session_id];\n  }\n\n  public getCurrentSessionToken(): string {\n    const currentSession = this.proxy.getSession();\n\n    if (currentSession?.token) {\n      return currentSession.token;\n    } else {\n      throw new Error('Session does not exist');\n    }\n  }\n\n  private getListenerByName(name: ConferenceEvent): Janus.ListenerName | null {\n    switch (name) {\n      case ConferenceEvent.JOIN:\n        return 'onParticipantJoinedListener';\n      case ConferenceEvent.LEFT:\n        return 'onParticipantLeftListener';\n      case ConferenceEvent.SLOW_LINK:\n        return 'onSlowLinkListener';\n      case ConferenceEvent.REMOTE_STREAM:\n        return 'onRemoteStreamListener';\n      case ConferenceEvent.REMOTE_TRACKS_UPDATED:\n        return 'onRemoteTracksUpdatedListener';\n      case ConferenceEvent.REMOTE_CONNECTION_STATE:\n        return 'onRemoteConnectionStateChangedListener';\n      case ConferenceEvent.DATA_CHANNEL_OPENED:\n        return 'onDataChannelOpenedListener';\n      case ConferenceEvent.DATA_CHANNEL_MESSAGE:\n        return 'onDataChannelMessageListener';\n      case ConferenceEvent.SESSION_CONNECTION_STATE:\n        return 'onSessionConnectionStateChangedListener';\n      case ConferenceEvent.ERROR:\n        return 'onErrorListener';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: ConferenceEvent, listener: Janus.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Janus.Listeners) = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: ConferenceEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Janus.Listeners | undefined) = undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key as Janus.ListenerName] === 'function') {\n        (this[key as Janus.ListenerName] as Janus.Listeners | undefined) = undefined;\n      }\n    });\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { Data, EmptyResponse, ProxyMethod, ProxyType, SearchCondition } from './types';\n\nexport default class DataService {\n  public proxy: ProxyService;\n  readonly route = config.urls.data;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(className: string, params: Data.CreateParams = {}): Promise<Data.DataRecord> {\n    const isMany = Utils.isArray(params);\n    const multi = isMany ? 'multi' : undefined;\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, className, multi),\n      data: isMany ? { record: this.createRecord(params) } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async list(className: string, params: Data.ListParams = {}): Promise<Data.ListResponse> {\n    const ext = typeof params === 'string' ? params : Utils.isArray(params) ? params.toString() : undefined;\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, className, ext),\n      data: ext ? undefined : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async readPermissions(className: string, id: string): Promise<Data.ReadPermissionsResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, className, id),\n      data: { permissions: 1 },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(\n    className: string,\n    params: Data.UpdateOptions | Data.UpdateOptions[] = {}\n  ): Promise<Data.UpdateResponse | Data.DataRecord> {\n    const isMany = Utils.isArray(params);\n    const isSearch = !isMany && params.search_criteria;\n    const ext = isMany ? 'multi' : isSearch ? 'by_criteria' : params.id || params._id;\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, className, ext),\n      data: isMany ? { record: this.createRecord(params) } : params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(\n    className: string,\n    params: string | string[] | SearchCondition<any>\n  ): Promise<Data.DeleteResponse | EmptyResponse> {\n    const isCriteria = Utils.isObject(params);\n    const isOne = typeof params === 'string' || (Utils.isArray(params) && params.length === 1);\n    const ext = isCriteria ? 'by_criteria' : params.toString();\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, className, ext),\n      data: isCriteria ? params : undefined,\n      dataType: isOne ? ProxyType.TEXT : undefined,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  private createRecord(params: Data.CreateRecord[] = []): object {\n    return params.reduce((items, item, index) => {\n      const key = index + 1;\n      const id = item.id || item._id;\n      const record = id ? { ...item, id } : item;\n\n      return { ...items, [key]: record };\n    }, {});\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { EmptyResponse, Meetings, ProxyMethod, ProxyType } from './types';\n\nexport default class MeetingsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.meetings;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async get(params: Meetings.GetParams = {}): Promise<Meetings.Meeting | Meetings.Meeting[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Meetings.CreateParams = {}): Promise<Meetings.Meeting> {\n    const MINUTE = 60;\n    const startTimestamp = Math.ceil(Date.now() / 1000);\n    const endTimestamp = startTimestamp + 60 * MINUTE;\n    const defaultName = new Date(startTimestamp).toLocaleString('en', {\n      year: 'numeric',\n      month: 'long',\n      day: 'numeric',\n      hour: 'numeric',\n      minute: 'numeric',\n    });\n    const defaultParams = {\n      name: defaultName,\n      start_date: startTimestamp,\n      end_date: endTimestamp,\n      attendees: [],\n      record: false,\n      chat: false,\n    };\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { ...defaultParams, ...params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string | number, params: Meetings.UpdateParams): Promise<Meetings.Meeting> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string | number): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getRecordings(id: string | number): Promise<Meetings.Recording[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'recordings', id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import { fetchImpl, FormDataImpl } from './platform';\nimport config from './config';\nimport Utils from './Utils';\nimport { Auth, Proxy, ProxyMethod, ProxyType } from './types';\n\nexport default class ProxyService {\n  public sdkInstance: Proxy.SDKInstance = {\n    config,\n    session: null,\n  };\n  public requestsNumber: number = 0;\n  public fetchImpl = fetchImpl;\n  private currentUserId: number | undefined;\n  private abortControllersMap: Proxy.AbortControllersMap = {};\n  public requestMethod: typeof ProxyMethod = ProxyMethod;\n  public responseType: typeof ProxyType = ProxyType;\n\n  public setSession(session: Partial<Auth.Session>): void {\n    this.sdkInstance.session = session;\n\n    if (session && session.user_id) {\n      this.setCurrentUserId(session.user_id);\n    }\n  }\n\n  public getSession(): Partial<Auth.Session> | null {\n    return this.sdkInstance.session;\n  }\n\n  public setCurrentUserId(userId?: number | null): void {\n    this.currentUserId = userId || undefined;\n  }\n\n  public getCurrentUserId(): number | undefined {\n    return this.currentUserId;\n  }\n\n  public logRequest(params: Proxy.Params, requestId: number): void {\n    Utils.DLog(`[Request][${requestId}]`, `${params.type || 'GET'} ${params.url}`, params);\n  }\n\n  public logResponse(response: any, requestId: number): void {\n    Utils.DLog(`[Response][${requestId}]`, response);\n  }\n\n  public buildRequestAndURL(params: Proxy.Params): [any, string] {\n    const isGetOrHeadType = !params.type || params.type === 'GET' || params.type === 'HEAD';\n    const isPostOrPutType = params.type ? params.type === 'POST' || params.type === 'PUT' : false;\n    const token = this.sdkInstance && this.sdkInstance.session && this.sdkInstance.session.token;\n    const isInternalRequest = params.url.indexOf('s3.amazonaws.com') === -1;\n    const isMultipartFormData = params.contentType === false;\n    const authKey = params.authKey;\n\n    let requestBody;\n    let requestURL = params.url;\n    const requestObject: any = {};\n\n    requestObject.method = params.type || 'GET';\n\n    if (params.data) {\n      requestBody = this.buildRequestBody(params, isMultipartFormData, isPostOrPutType);\n\n      if (isGetOrHeadType) {\n        requestURL += `?${requestBody}`;\n      } else {\n        requestObject.body = requestBody;\n      }\n    }\n\n    if (!isMultipartFormData) {\n      requestObject.headers = {\n        'Content-Type': isPostOrPutType\n          ? 'application/json;charset=utf-8'\n          : 'application/x-www-form-urlencoded; charset=UTF-8',\n      };\n    }\n\n    if (isInternalRequest) {\n      if (!requestObject.headers) {\n        requestObject.headers = {};\n      }\n\n      requestObject.headers['CB-SDK'] = `JS ${config.version} - Client`;\n\n      if (token) {\n        requestObject.headers['CB-Token'] = token;\n      } else if (authKey) {\n        requestObject.headers['CB-AuthKey'] = authKey;\n      }\n    }\n\n    if (config.timeout) {\n      requestObject.timeout = config.timeout;\n    }\n\n    return [requestObject, requestURL];\n  }\n\n  public buildRequestBody(\n    params: Proxy.Params,\n    isMultipartFormData: boolean,\n    isPostOrPutType: boolean\n  ): typeof FormDataImpl | string | any {\n    const data = params.data;\n    const useArrayQuery = params.useArrayQuery;\n\n    let dataObject: any;\n\n    if (isMultipartFormData) {\n      dataObject = new FormDataImpl();\n\n      Object.keys(data).forEach(function (item) {\n        if (params.fileToCustomObject && item === 'file') {\n          dataObject.append(item, data[item].data, data[item].name);\n        } else {\n          dataObject.append(item, params.data[item]);\n        }\n      });\n    } else if (isPostOrPutType) {\n      dataObject = JSON.stringify(data);\n    } else {\n      dataObject = this.serializeQueryParams(data, '', useArrayQuery, 0);\n    }\n\n    return dataObject;\n  }\n\n  public serializeQueryParams(obj: any, prefix: string, useArrayQuery: any, level = 0): string {\n    const parts: string[] = [];\n\n    for (let propName in obj) {\n      let propQueryName = this.encodeURIComponent(propName);\n      if (Utils.isArray(obj)) {\n        propQueryName = '';\n      }\n\n      const key = prefix ? prefix + `[${propQueryName}]` : propQueryName;\n      let value = obj[propName];\n\n      const isArrayVal = Utils.isArray(value);\n\n      if ((isArrayVal && (useArrayQuery || level === 0)) || Utils.isObject(value)) {\n        parts.push(this.serializeQueryParams(value, key, useArrayQuery, ++level));\n      } else {\n        value = isArrayVal ? value.sort().join(',') : value;\n        parts.push(`${key}=${this.encodeURIComponent(value)}`);\n      }\n    }\n\n    return parts.sort().join('&');\n  }\n\n  public encodeURIComponent(uriComponent: string | number | boolean): string {\n    return encodeURIComponent(uriComponent).replace(/[#$&+,/:;=?@\\[\\]]/g, (c) => `%${c.charCodeAt(0).toString(16)}`);\n  }\n\n  public abortRequest(abortId: string | number): void {\n    if (this.abortControllersMap[abortId]) {\n      const controllers = this.abortControllersMap[abortId].controllers || [];\n\n      controllers.forEach((controller) => {\n        controller.abort();\n      });\n    }\n  }\n\n  public processSuccessfulOrFailedRequest(abort_id?: string | number): void {\n    if (!abort_id || !this.abortControllersMap[abort_id]) {\n      return;\n    }\n\n    const controllers = this.abortControllersMap[abort_id].controllers || [];\n\n    if (!this.abortControllersMap[abort_id].doneRequestsCount) {\n      this.abortControllersMap[abort_id].doneRequestsCount = 1;\n    } else {\n      this.abortControllersMap[abort_id].doneRequestsCount += 1;\n    }\n\n    const doneRequestsCount = this.abortControllersMap[abort_id].doneRequestsCount;\n\n    if (doneRequestsCount === controllers.length) {\n      delete this.abortControllersMap[abort_id];\n    }\n  }\n\n  public async ajax<T>(params: Proxy.Params): Promise<T> {\n    const requestId = ++this.requestsNumber;\n\n    return new Promise((resolve, reject) => {\n      this.logRequest(params, requestId);\n\n      const [requestObject, requestURL] = this.buildRequestAndURL(params);\n      const abort_id = params.abort_id;\n\n      if (abort_id) {\n        let index = 0;\n\n        if (this.abortControllersMap[abort_id]) {\n          const controllers = this.abortControllersMap[abort_id].controllers || [];\n          this.abortControllersMap[abort_id].controllers.push(new AbortController());\n          index = controllers.length - 1;\n        } else {\n          this.abortControllersMap[abort_id] = {\n            controllers: [new AbortController()],\n          };\n        }\n        const signal = this.abortControllersMap[abort_id].controllers[index].signal;\n        Object.assign(requestObject, { signal });\n      }\n\n      let response: any;\n\n      // The Promise returned from fetch() won’t reject on HTTP error\n      // status even if the response is an HTTP 404 or 500.\n      // Instead, it will resolve normally (with ok status set to false),\n      // and it will only reject on network failure or if anything prevented the request from completing.\n      fetchImpl(requestURL, requestObject)\n        .then((resp: any) => {\n          response = resp;\n          const dataType = params.dataType || ProxyType.JSON;\n          return dataType === ProxyType.TEXT ? response.text() : response.json();\n        })\n        .then((body: any) => {\n          this.processSuccessfulOrFailedRequest(abort_id);\n          if (!response.ok) {\n            this.processAjaxError(response, body, null, reject, resolve, params, requestId);\n          } else {\n            this.processAjaxResponse(body, resolve, requestId);\n          }\n        })\n        .catch((error: any) => {\n          this.processSuccessfulOrFailedRequest(abort_id);\n          this.processAjaxError(response, ' ', error, reject, resolve, params, requestId);\n        });\n    });\n  }\n\n  public processAjaxResponse(body: any, resolve: (value: any) => void, requestId: number): void {\n    const responseBody = body && body !== ' ' ? body : 'empty body';\n    this.logResponse(responseBody, requestId);\n\n    resolve(body);\n  }\n\n  public processAjaxError(\n    response: Response | null,\n    body: any,\n    error: any,\n    reject: (reason?: any) => void,\n    resolve: (value: any) => void,\n    params: Proxy.Params,\n    requestId: number\n  ): void {\n    if (!response && error && !error.code) {\n      reject(error);\n      return;\n    }\n\n    const responseBody = body || error || body.errors;\n    const statusCode = response?.status;\n    const errorObject: Proxy.ErrorObject = {\n      code: (response && statusCode) || (error && error.code),\n      info: (body && typeof body === 'string' && body !== ' ' ? JSON.parse(body) : body) || (error && error.errno),\n    };\n\n    this.logResponse(responseBody, requestId);\n\n    if (response?.url.indexOf(config.urls.session) === -1) {\n      if (this.isExpiredSessionError(errorObject) && typeof config.on.sessionExpired === 'function') {\n        this.handleExpiredSessionResponse(errorObject, null, reject, resolve, params);\n      } else {\n        reject(errorObject);\n      }\n    } else {\n      reject(errorObject);\n    }\n  }\n\n  public handleExpiredSessionResponse(\n    error: any,\n    response: any,\n    reject: (reason?: any) => void,\n    resolve: (value: any) => void,\n    params: Proxy.Params\n  ): void {\n    const handleResponse = () => {\n      if (error) {\n        reject(error);\n      } else {\n        resolve(response);\n      }\n    };\n\n    const retryCallback = (session: Partial<Auth.Session>) => {\n      if (session) {\n        this.setSession(session);\n        this.ajax(params).then(resolve).catch(reject);\n      }\n    };\n\n    if (typeof config.on.sessionExpired === 'function') {\n      config.on.sessionExpired(handleResponse, retryCallback);\n    }\n  }\n\n  private isExpiredSessionError(error: Proxy.ErrorObject): boolean {\n    try {\n      return error && error.code === 401 && error.info?.errors?.base?.[0] === 'Required session does not exist';\n    } catch {\n      return false;\n    }\n  }\n}\n","import { base64Encode } from './platform';\nimport config from './config';\nimport ProxyService from './Proxy';\nimport Utils from './Utils';\nimport { EmptyResponse, ProxyMethod, ProxyType, PushNotifications } from './types';\n\nexport default class PushNotificationsService {\n  public proxy: ProxyService;\n  public subscriptions: SubscriptionsService;\n  public events: EventsService;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n    this.subscriptions = new SubscriptionsService(proxy);\n    this.events = new EventsService(proxy);\n  }\n\n  public base64Encode = base64Encode;\n}\n\nclass SubscriptionsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.subscriptions;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(params: PushNotifications.SubscriptionsCreateParams): Promise<PushNotifications.Subscription> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async list(): Promise<PushNotifications.Subscription[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string | number): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      dataType: ProxyType.TEXT,\n      url: Utils.getUrl(this.route, id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n\nclass EventsService {\n  public proxy: ProxyService;\n  readonly route = config.urls.events;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async create(event: PushNotifications.EventsCreateParams): Promise<PushNotifications.Event[]> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { event },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import ProxyService from './Proxy';\nimport Utils from './Utils';\nimport config from './config';\nimport { EmptyResponse, Proxy, ProxyMethod, ProxyType, Storage } from './types';\nexport default class StorageService {\n  public proxy: ProxyService;\n  readonly route = config.urls.blobs;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async list(params: Storage.ListParams = {}): Promise<Storage.ListResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params?: Storage.CreateParams): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { blob: params },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: number | string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async createAndUpload(params: Storage.CreateAndUploadParams): Promise<Storage.Blob> {\n    const { name, file, size, abort_id, type: content_type, public: isPublic = true } = params;\n    const createParams = { name, content_type, public: isPublic };\n\n    let blob: Storage.Blob;\n\n    return this.create(createParams)\n      .then(({ blob: blobObject }) => {\n        blob = blobObject;\n        const uri = this.parseUri(blob.blob_object_access?.params);\n        const uploadUrl = `${uri.protocol}://${uri.authority}${uri.path}`;\n        const uploadParams: Proxy.Params = { url: uploadUrl, data: {} };\n\n        if (abort_id) {\n          uploadParams.abort_id = abort_id;\n        }\n\n        Object.keys(uri.queryKey).forEach((key) => {\n          uploadParams.data[key] = decodeURIComponent(uri.queryKey[key]);\n        });\n\n        uploadParams.data.file = file;\n\n        return this.upload(uploadParams).then(() => blob);\n      })\n      .then((blob) => this.markUploaded({ id: blob.id, size }).then(() => blob))\n      .then((blob) => ({ ...blob, size }));\n  }\n\n  public async upload(params: Proxy.Params): Promise<any> {\n    const ajaxParams = {\n      ...params,\n      type: ProxyMethod.POST,\n      dataType: ProxyType.TEXT,\n      contentType: false,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async markUploaded(params: Storage.MarkUploadedParams): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, params.id, 'complete'),\n      data: {\n        size: params.size,\n      },\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getInfo(id: number | string): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, id),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getFile(uid: string): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, uid),\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getFileObject(uid: string, params: Storage.GetFileObjectParams): Promise<Storage.BlobResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, uid, 'object'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(params: Storage.UpdateParams): Promise<Storage.BlobResponse> {\n    const data = { blob: {} as any };\n\n    if (typeof params.name !== 'undefined') {\n      data.blob.name = params.name;\n    }\n\n    const ajaxParams = {\n      url: Utils.getUrl(this.route, params.id),\n      data: data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public privateUrl(fileUID: string = ''): string {\n    return `https://${config.endpoints.api}/blobs/${fileUID}?token=${this.proxy.getSession()?.token}`;\n  }\n\n  public publicUrl(fileUID: string = ''): string {\n    return `https://${config.endpoints.api}/blobs/${fileUID}`;\n  }\n\n  // parseUri 1.2.2\n  // (c) Steven Levithan <stevenlevithan.com>\n  // MIT License\n  // http://blog.stevenlevithan.com/archives/parseuri\n  private parseUri(str: string = ''): any {\n    const options = {\n      strictMode: false,\n      key: [\n        'source',\n        'protocol',\n        'authority',\n        'userInfo',\n        'user',\n        'password',\n        'host',\n        'port',\n        'relative',\n        'path',\n        'directory',\n        'file',\n        'query',\n        'anchor',\n      ],\n      q: {\n        name: 'queryKey',\n        parser: /(?:^|&)([^&=]*)=?([^&]*)/g,\n      },\n      parser: {\n        strict:\n          /^(?:([^:\\/?#]+):)?(?:\\/\\/((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?))?((((?:[^?#\\/]*\\/)*)([^?#]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n        loose:\n          /^(?:(?![^:@]+:[^:@\\/]*@)([^:\\/?#.]+):)?(?:\\/\\/)?((?:(([^:@]*)(?::([^:@]*))?)?@)?([^:\\/?#]*)(?::(\\d*))?)(((\\/(?:[^?#](?![^?#\\/]*\\.[^?#\\/.]+(?:[?#]|$)))*\\/?)?([^?#\\/]*))(?:\\?([^#]*))?(?:#(.*))?)/,\n      },\n    };\n    const m = options.parser[options.strictMode ? 'strict' : 'loose'].exec(str) ?? {};\n\n    const uri = {};\n    let i = 14;\n\n    while (i--) {\n      uri[options.key[i]] = m[i] || '';\n    }\n\n    uri[options.q.name] = {};\n    uri[options.key[12]].replace(options.q.parser, ($0, $1, $2) => {\n      if ($1) {\n        uri[options.q.name][$1] = $2;\n      }\n    });\n\n    return uri;\n  }\n}\n","import config from './config';\nimport ProxyService from './Proxy';\nimport { EmptyResponse, ProxyMethod, ProxyType, Users } from './types';\nimport Utils from './Utils';\n\nexport default class UsersService {\n  public proxy: ProxyService;\n  readonly route = config.urls.users;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async getV2(params: Users.GetV2Params): Promise<Users.GetV2Response> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'v2'),\n      useArrayQuery: true,\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async signup(user: Users.SignUpParams, auth_key?: string): Promise<Users.UserResponse> {\n    const ajaxParams = {\n      authKey: auth_key ?? config.creds.authKey,\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: { user },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(user: Users.UpdateParams = {}): Promise<Users.UserResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, this.proxy.getCurrentUserId()),\n      data: { user },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, this.proxy.getCurrentUserId()),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async resetPassword(email: string = ''): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route, 'password', 'reset'),\n      data: { email },\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async listOnline(params: Users.ListOnlineParams = {}): Promise<Users.UsersResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'online'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async getOnlineCount(): Promise<Users.OnlineCountResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, 'online'),\n      data: { count: true },\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  /**\n   * @deprecated Use `getV2(params)` instead.\n   */\n  public async get(params: any): Promise<Users.OldGetResponse | Users.UserResponse> {\n    let data = Utils.cloneObject(params);\n    let url: string | number = '';\n\n    const filters: string[] = [];\n    const dateFields = ['created_at', 'updated_at', 'last_request_at'];\n    const numberFields = ['id', 'external_user_id'];\n    const extensions: any = {\n      login: 'by_login',\n      full_name: 'by_full_name',\n      facebook_id: 'by_facebook_id',\n      twitter_id: 'by_twitter_id',\n      phone: 'phone',\n      email: 'by_email',\n      tags: 'by_tags',\n      external: 'external',\n    };\n\n    function generateFilter(filter: any): string {\n      const obj = Utils.cloneObject(filter);\n      let type = dateFields.includes(obj.field) ? 'date' : typeof obj.value;\n\n      if (Utils.isArray(obj.value)) {\n        if (type === 'object') {\n          type = typeof obj.value[0];\n        }\n        obj.value = obj.value.toString();\n      }\n\n      return [type, obj.field, obj.param, obj.value].join(' ');\n    }\n\n    if (data.order) {\n      const type = data.order.field in dateFields ? 'date' : data.order.field in numberFields ? 'number' : 'string';\n      data.order = [data.order.sort, type, data.order.field].join(' ');\n    }\n\n    if (data && data.filter) {\n      if (Utils.isArray(data.filter)) {\n        data.filter.forEach((filter: any) => {\n          filters.push(generateFilter(filter));\n        });\n      } else {\n        filters.push(generateFilter(data.filter));\n      }\n      data.filter = filters;\n    }\n\n    if (typeof data === 'number') {\n      url = data;\n      data = undefined;\n    } else {\n      for (const key in extensions) {\n        if (data[key]) {\n          url = extensions[key];\n\n          if (key === extensions.external) {\n            url += `/${data[extensions.external]}`;\n            data = undefined;\n          }\n\n          break;\n        }\n      }\n    }\n\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route, url),\n      data,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import config from '../config';\nimport { navigator } from '../platform';\n\nexport default class WebRTCHelpers {\n  static getUserJid(id: string | number): string {\n    return `${id}-${config.creds.appId}@${config.endpoints.chat}`;\n  }\n\n  static getUserIdFromJID(jid: string): number | null {\n    return jid?.includes('@') ? parseInt(jid.split('@')[0].split('-')[0]) : null;\n  }\n\n  static trace(text: string): void {\n    if (config.debug) {\n      console.log('[VideoChat]:', text);\n    }\n  }\n\n  static traceWarning(text: string): void {\n    if (config.debug) {\n      console.warn('[VideoChat]:', text);\n    }\n  }\n\n  static traceError(text: string): void {\n    if (config.debug) {\n      console.error('[VideoChat]:', text);\n    }\n  }\n\n  static get getVersionFirefox(): number {\n    const ua = navigator?.userAgent ?? null;\n    let version = 0;\n    if (ua) {\n      const ffInfo = ua.match(/(?:firefox)[ \\/](\\d+)/i) || [];\n      version = ffInfo[1] ? +ffInfo[1] : 0;\n    }\n    return typeof version === 'string' ? parseInt(version) : version;\n  }\n\n  static get getVersionSafari(): number {\n    const ua = navigator?.userAgent ?? null;\n    let version = 0;\n    if (ua) {\n      const sInfo = ua.match(/(?:safari)[ \\/](\\d+)/i) || [];\n      if (sInfo.length) {\n        const sVer = ua.match(/(?:version)[ \\/](\\d+)/i) || [];\n        if (sVer) {\n          version = sVer[1] ? +sVer[1] : 0;\n        }\n      }\n    }\n\n    return typeof version === 'string' ? parseInt(version) : version;\n  }\n}\n","import { RTCPeerConnection, RTCSessionDescription, MediaStream } from '../platform';\nimport config from '../config';\nimport WebRTCSession from './WebRTCSession';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport { Calls, CallSessionConnectionState, CallType, Config, MediaType, PeerConnectionState } from '../types';\n\nexport default class WebRTCPeerConnection {\n  public original!: RTCPeerConnection;\n  public session!: WebRTCSession;\n  public userID!: number;\n  public type!: RTCSdpType;\n  public remoteSDP: string | null = null;\n  public state: PeerConnectionState = PeerConnectionState.NEW;\n  public iceCandidates: RTCIceCandidateInit[] = [];\n  public remoteStream: MediaStream = new MediaStream();\n  public answerTimeInterval: number = 0;\n  public onStatusClosedChecker: NodeJS.Timeout | null = null;\n  public dialingTimer: NodeJS.Timeout | null = null;\n  public statsReportTimer: NodeJS.Timeout | null = null;\n  public waitingReconnectTimeoutCallback: NodeJS.Timeout | null = null;\n  public released: boolean = false;\n\n  constructor(session: WebRTCSession, userID: number, type: RTCSdpType) {\n    this.create();\n    this.setup(session, userID, type);\n  }\n\n  private create() {\n    const rtcConfiguration: RTCConfiguration = {\n      iceTransportPolicy: (config.videochat.alwaysRelayCalls ? 'relay' : 'all') as RTCIceTransportPolicy,\n      iceServers: config.videochat.iceServers.map(\n        (item: Config.VideochatIceServer): RTCIceServer => ({\n          urls: item.urls ?? item.url,\n          username: item.username,\n          credential: item.credential,\n        })\n      ) as RTCIceServer[],\n    };\n\n    this.original = RTCPeerConnection ? new RTCPeerConnection(rtcConfiguration) : ({} as RTCPeerConnection);\n\n    WebRTCHelpers.trace(`new RTCPeerConnection(${JSON.stringify(rtcConfiguration, null, 2)})`);\n  }\n\n  private setup(session: WebRTCSession, userID: number, type: RTCSdpType): void {\n    this.type = type;\n    this.userID = userID;\n    this.session = session;\n    this.session.startCallTime = Date.now();\n\n    this.original.addEventListener('track', this.onMediaTrackHandler);\n    this.original.addEventListener('icecandidate', this.onIceCandidateHandler);\n    this.original.addEventListener('signalingstatechange', this.onSignalingStateHandler);\n    this.original.addEventListener('iceconnectionstatechange', this.onIceConnectionStateHandler);\n\n    WebRTCHelpers.trace(`RTCPeerConnection init. ${this.toString()}`);\n  }\n\n  private onMediaTrackHandler = (event: RTCTrackEvent): void => {\n    this.remoteStream.addTrack(event.track);\n\n    if (\n      (this.session.callType == CallType.VIDEO && this.remoteStream.getVideoTracks().length) ||\n      (this.session.callType == CallType.AUDIO && this.remoteStream.getAudioTracks().length)\n    ) {\n      this.session.onRemoteStream(this.userID, this.remoteStream);\n    }\n\n    this.getWrappedStats();\n  };\n\n  private onIceCandidateHandler = (event: RTCPeerConnectionIceEvent): void => {\n    if (event.candidate) {\n      const { sdpMLineIndex, sdpMid, candidate } = event.candidate;\n      const iceCandidate: RTCIceCandidateInit = { sdpMLineIndex, sdpMid, candidate };\n\n      if (this.signalingState === 'stable' && this.original.canTrickleIceCandidates) {\n        this.session.processIceCandidates(this.userID, [iceCandidate]);\n      } else {\n        this.iceCandidates.push(iceCandidate);\n      }\n    }\n  };\n\n  private onSignalingStateHandler = async (): Promise<void> => {\n    WebRTCHelpers.trace(`onSignalingStateHandler: ${this.signalingState}`);\n\n    if (this.signalingState === 'stable' && this.iceCandidates.length > 0) {\n      this.session.processIceCandidates(this.userID, this.iceCandidates);\n      this.iceCandidates.length = 0;\n    }\n  };\n\n  /** handler of remote media stream */\n  private onIceConnectionStateHandler = (): void => {\n    WebRTCHelpers.trace(`onIceConnectionStateHandler: ${this.iceConnectionState}`);\n\n    if (this.onStatusClosedChecker && WebRTCHelpers.getVersionSafari >= 11) {\n      clearTimeout(this.onStatusClosedChecker);\n    }\n\n    switch (this.iceConnectionState) {\n      case 'checking':\n        this.state = PeerConnectionState.CHECKING;\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.CONNECTING);\n        break;\n      case 'connected':\n        this.state = PeerConnectionState.CONNECTED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.CONNECTED);\n        break;\n      case 'completed':\n        this.state = PeerConnectionState.COMPLETED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.COMPLETED);\n        break;\n      case 'failed':\n        this.state = PeerConnectionState.FAILED;\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.FAILED);\n        break;\n      case 'disconnected':\n        this.state = PeerConnectionState.DISCONNECTED;\n        this.startWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.DISCONNECTED);\n        if (WebRTCHelpers.getVersionSafari >= 11) {\n          this.onStatusClosedChecker = setTimeout(() => {\n            this.onIceConnectionStateHandler(); // repeat to get status \"closed\"\n          }, 500);\n        }\n        break;\n      case 'closed': // TODO: this state doesn't fires on Safari 11\n        this.state = PeerConnectionState.CLOSED;\n        this.clearWaitingReconnectTimer();\n        this.session.onSessionConnectionStateChanged(this.userID, CallSessionConnectionState.CLOSED);\n        break;\n      default:\n        break;\n    }\n  };\n\n  private clearWaitingReconnectTimer(): void {\n    if (this.waitingReconnectTimeoutCallback) {\n      WebRTCHelpers.trace('clearWaitingReconnectTimer');\n      clearTimeout(this.waitingReconnectTimeoutCallback);\n      this.waitingReconnectTimeoutCallback = null;\n    }\n  }\n\n  private startWaitingReconnectTimer(): void {\n    const timeout = config.videochat.disconnectTimeInterval * 1000;\n    WebRTCHelpers.trace(`startWaitingReconnectTimer, timeout: ${timeout}`);\n\n    this.waitingReconnectTimeoutCallback = setTimeout(() => {\n      WebRTCHelpers.trace('waitingReconnectTimeoutCallback');\n      if (this.waitingReconnectTimeoutCallback) {\n        clearTimeout(this.waitingReconnectTimeoutCallback);\n      }\n      this.release();\n      this.session.closeSessionIfAllConnectionsClosed();\n    }, timeout);\n  }\n\n  private clearStatsReportTimer(): void {\n    if (this.statsReportTimer) {\n      clearInterval(this.statsReportTimer);\n      this.statsReportTimer = null;\n    }\n  }\n\n  public async addCandidates(iceCandidates: RTCIceCandidateInit[]): Promise<void> {\n    for (const iceCandidate of iceCandidates) {\n      if (iceCandidate?.candidate) {\n        try {\n          await this.addIceCandidate(iceCandidate);\n          WebRTCHelpers.trace(`'addIceCandidate' success: ${this.signalingState}`);\n        } catch (error) {\n          WebRTCHelpers.traceError(`'addIceCandidate' error: ${error}`);\n        }\n      }\n    }\n  }\n\n  public release(): void {\n    this.clearDialingTimer();\n    this.clearStatsReportTimer();\n    this.close();\n    if (WebRTCHelpers.getVersionSafari >= 11) {\n      this.onIceConnectionStateHandler(); // TODO: 'closed' state doesn't fires on Safari 11 (do it manually)\n    }\n    this.original.removeEventListener('track', this.onMediaTrackHandler);\n    this.original.removeEventListener('icecandidate', this.onIceCandidateHandler);\n    this.original.removeEventListener('signalingstatechange', this.onSignalingStateHandler);\n    this.original.removeEventListener('iceconnectionstatechange', this.onIceConnectionStateHandler);\n    this.released = true;\n    WebRTCHelpers.trace(`RTCPeerConnection closed. ${this.toString()}`);\n  }\n\n  public clearDialingTimer(): void {\n    if (this.dialingTimer) {\n      WebRTCHelpers.trace('clearDialingTimer');\n      clearInterval(this.dialingTimer);\n      this.dialingTimer = null;\n      this.answerTimeInterval = 0;\n    }\n  }\n\n  public async getAndSetLocalSessionDescription(\n    maxBandwidth: number,\n    iceRestart: boolean = false\n  ): Promise<RTCSessionDescriptionInit> {\n    this.state = PeerConnectionState.CONNECTING;\n\n    try {\n      const offerOptions = iceRestart ? { iceRestart } : undefined;\n      const sessionDescription =\n        this.type === 'offer' ? await this.createOffer(offerOptions) : await this.createAnswer();\n\n      await this.setLocalDescription(sessionDescription);\n      this.setRTCRtpSenderMaxBandwidth(maxBandwidth);\n\n      return sessionDescription;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public setRTCRtpSenderMaxBandwidth(maxBandwidth: number): void {\n    const senders = this.getSenders() || [];\n    const maxBitrate = maxBandwidth ? Math.round(maxBandwidth * 1000) : 0;\n\n    senders.forEach((sender: RTCRtpSender) => {\n      if (sender.track?.kind === MediaType.VIDEO) {\n        const params = sender.getParameters();\n\n        params.encodings ??= [{}];\n        params.encodings.forEach((encoding) => {\n          if (maxBitrate > 0) {\n            encoding.maxBitrate = maxBitrate;\n          } else {\n            delete encoding.maxBitrate;\n          }\n        });\n\n        sender\n          .setParameters(params)\n          .then(() => {\n            WebRTCHelpers.trace(\n              `Set 'maxBandwidth' for ${this.userID}: ${maxBandwidth > 0 ? `${maxBandwidth} kbps` : 'unlimited'}`\n            );\n          })\n          .catch((error) => {\n            WebRTCHelpers.traceWarning(`Set 'maxBandwidth' for ${this.userID}: ${error}`);\n          });\n      }\n    });\n  }\n\n  public startDialingTimer(extension: Calls.ExtensionParams, withOnNotAnswerCallback: boolean): void {\n    const dialingTimeInterval = config.videochat.dialingTimeInterval * 1000;\n\n    WebRTCHelpers.trace(`startDialingTimer, dialingTimeInterval: ${JSON.stringify(dialingTimeInterval)}`);\n\n    const dialingCallback = (extension, withOnNotAnswerCallback, skipIncrement) => {\n      if (!skipIncrement) {\n        this.answerTimeInterval += config.videochat.dialingTimeInterval * 1000;\n      }\n\n      WebRTCHelpers.trace(`dialingCallback, extension: ${JSON.stringify(extension)}`);\n\n      if (this.answerTimeInterval >= config.videochat.answerTimeInterval * 1000) {\n        this.clearDialingTimer();\n\n        if (withOnNotAnswerCallback) {\n          this.session.processOnNotAnswer(this);\n        }\n      } else {\n        this.session.processCall(this, extension);\n      }\n    };\n\n    this.dialingTimer = setInterval(dialingCallback, dialingTimeInterval, extension, withOnNotAnswerCallback, false);\n\n    dialingCallback(extension, withOnNotAnswerCallback, true); // call for the 1st time\n  }\n\n  public async setRemoteSessionDescription(type: RTCSdpType, sdp: string): Promise<void> {\n    const desc = new RTCSessionDescription!({ sdp, type });\n    return this.setRemoteDescription(desc);\n  }\n\n  private getWrappedStats(): void {\n    if (config.videochat.statsReportTimeInterval) {\n      let lastResult: RTCStatsReport;\n\n      WebRTCHelpers.trace('Stats tracker has been started');\n\n      this.statsReportTimer = setInterval(() => {\n        this.getStatsCustom(\n          lastResult,\n          (results, lastResults) => {\n            lastResult = lastResults;\n            this.session.onCallStatsReport(this.userID, results);\n          },\n          (err) => {\n            WebRTCHelpers.traceError(`Get stats error. ${err.name}: ${err.message}`);\n            this.session.onCallStatsReport(this.userID, null, err);\n          }\n        );\n      }, config.videochat.statsReportTimeInterval * 1000);\n    }\n  }\n\n  set sdpRemote(sdp: string) {\n    if (sdp) {\n      this.remoteSDP = sdp;\n    }\n  }\n\n  get sdpRemote(): string | null {\n    return this.remoteSDP;\n  }\n\n  toString(): string {\n    return `sessionID: ${this.session.ID}, userID: ${this.userID}, type: ${this.type}, state: ${this.state}`;\n  }\n\n  private getStatsCustom(\n    lastResults: RTCStatsReport,\n    onSuccess: (results: any, lastResults: any) => void,\n    onFail: (err: Error) => void\n  ) {\n    const obj = { audio: {} as any, video: {} as any, candidate: {} as any };\n    const statistic = { local: Object.assign({}, obj), remote: Object.assign({}, obj) };\n\n    if (WebRTCHelpers.getVersionFirefox) {\n      const localStream = this.session.localStream;\n      const localVideoSettings = localStream?.getVideoTracks()[0].getSettings();\n\n      if (localVideoSettings) {\n        statistic.local.video.frameHeight = localVideoSettings.height;\n        statistic.local.video.frameWidth = localVideoSettings.width;\n      }\n    }\n\n    this.getStats().then((results: RTCStatsReport) => {\n      results.forEach((result) => {\n        let item;\n\n        if (result.bytesReceived && result.type === 'inbound-rtp') {\n          item = statistic.remote[result.mediaType];\n          item.bitrate = this.getBitratePerSecond(result, lastResults, false);\n          item.bytesReceived = result.bytesReceived;\n          item.packetsReceived = result.packetsReceived;\n          item.timestamp = result.timestamp;\n          if (result.mediaType === MediaType.VIDEO && result.framerateMean) {\n            item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\n          }\n        } else if (result.bytesSent && result.type === 'outbound-rtp') {\n          item = statistic.local[result.mediaType];\n          item.bitrate = this.getBitratePerSecond(result, lastResults, true);\n          item.bytesSent = result.bytesSent;\n          item.packetsSent = result.packetsSent;\n          item.timestamp = result.timestamp;\n          if (result.mediaType === MediaType.VIDEO && result.framerateMean) {\n            item.framesPerSecond = Math.round(result.framerateMean * 10) / 10;\n          }\n        } else if (result.type === 'local-candidate') {\n          item = statistic.local.candidate;\n          if (result.candidateType === 'host' && result.mozLocalTransport === 'udp' && result.transport === 'udp') {\n            item.protocol = result.transport;\n            item.ip = result.ipAddress;\n            item.port = result.portNumber;\n          } else if (!WebRTCHelpers.getVersionFirefox) {\n            item.protocol = result.protocol;\n            item.ip = result.ip;\n            item.port = result.port;\n          }\n        } else if (result.type === 'remote-candidate') {\n          item = statistic.remote.candidate;\n          item.protocol = result.protocol || result.transport;\n          item.ip = result.ip || result.ipAddress;\n          item.port = result.port || result.portNumber;\n        } else if (result.type === 'track' && result.kind === MediaType.VIDEO && !WebRTCHelpers.getVersionFirefox) {\n          if (result.remoteSource) {\n            item = statistic.remote.video;\n            item.frameHeight = result.frameHeight;\n            item.frameWidth = result.frameWidth;\n            item.framesPerSecond = this.getFramesPerSecond(result, lastResults, false);\n          } else {\n            item = statistic.local.video;\n            item.frameHeight = result.frameHeight;\n            item.frameWidth = result.frameWidth;\n            item.framesPerSecond = this.getFramesPerSecond(result, lastResults, true);\n          }\n        }\n      });\n      onSuccess(statistic, results);\n    }, onFail);\n  }\n\n  private getBitratePerSecond(result: any, lastResults: any, isLocal: boolean): number {\n    const lastResult = lastResults.get(result.id);\n    const seconds = lastResult ? (result.timestamp - lastResult.timestamp) / 1000 : 5;\n    const kilo = 1024;\n    const bit = 8;\n    const bitrate = !lastResult\n      ? 0\n      : isLocal\n      ? (bit * (result.bytesSent - lastResult.bytesSent)) / (kilo * seconds)\n      : (bit * (result.bytesReceived - lastResult.bytesReceived)) / (kilo * seconds);\n\n    return Math.round(bitrate);\n  }\n\n  private getFramesPerSecond(result: any, lastResults: any, isLocal: boolean): number {\n    const lastResult = lastResults && lastResults.get(result.id);\n    const seconds = lastResult ? (result.timestamp - lastResult.timestamp) / 1000 : 5;\n    const framesPerSecond = !lastResult\n      ? 0\n      : isLocal\n      ? (result.framesSent - lastResult.framesSent) / seconds\n      : (result.framesReceived - lastResult.framesReceived) / seconds;\n\n    return Math.round(framesPerSecond * 10) / 10;\n  }\n\n  // original RTCPeerConnection methods\n  close(): void {\n    this.original.close?.();\n  }\n  addTrack(track: MediaStreamTrack, stream: MediaStream): RTCRtpSender {\n    return this.original.addTrack?.(track, stream) ?? null;\n  }\n  getSenders(): RTCRtpSender[] {\n    return this.original.getSenders?.() ?? null;\n  }\n  async createOffer(options?: RTCOfferOptions): Promise<RTCSessionDescriptionInit> {\n    return (await this.original.createOffer?.(options)) ?? null;\n  }\n  async createAnswer(options?: RTCOfferOptions): Promise<RTCSessionDescriptionInit> {\n    return (await this.original.createAnswer?.(options)) ?? null;\n  }\n  async getStats(selector?: MediaStreamTrack | null): Promise<RTCStatsReport> {\n    return (await this.original.getStats?.(selector)) ?? null;\n  }\n  async addIceCandidate(candidate?: RTCIceCandidateInit): Promise<void> {\n    await this.original.addIceCandidate?.(candidate);\n  }\n  async setRemoteDescription(description: RTCSessionDescriptionInit): Promise<void> {\n    await this.original.setRemoteDescription?.(description);\n  }\n  async setLocalDescription(description?: RTCSessionDescriptionInit): Promise<void> {\n    await this.original.setLocalDescription?.(description);\n  }\n  get localDescription(): RTCSessionDescription {\n    return this.original.localDescription ?? null;\n  }\n  get signalingState(): RTCSignalingState {\n    return this.original.signalingState ?? 'closed';\n  }\n  get iceConnectionState(): RTCIceConnectionState {\n    return this.original.iceConnectionState ?? 'closed';\n  }\n}\n","import { mediaDevices } from '../platform';\nimport config from '../config';\nimport WebRTCPeerConnection from './WebRTCPeerConnection';\nimport WebRTCSignalingProvider from './WebRTCSignalingProvider';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport Utils from '../Utils';\nimport {\n  Calls,\n  CallSessionConnectionState,\n  CallSessionState,\n  CallSignalingType,\n  CallType,\n  Media,\n  MediaType,\n  PeerConnectionState,\n} from '../types';\n\nexport default class WebRTCSession {\n  public ID: string | null = null;\n  public state: CallSessionState = CallSessionState.NEW;\n  public callType!: CallType;\n  public initiatorID!: number;\n  public currentUserID!: number;\n  public opponentsIDs: number[] = [];\n  public maxBandwidth: number = 0;\n  public peerConnections: { [userID: number]: WebRTCPeerConnection } = {};\n  public localStream?: MediaStream;\n  public mediaParams: MediaStreamConstraints = {};\n  public signalingProvider!: WebRTCSignalingProvider;\n  public answerTimer: NodeJS.Timeout | null = null;\n  public waitingOfferOrAnswerTimer: NodeJS.Timeout | null = null;\n  public startCallTime: number = 0;\n  public acceptCallTime: number = 0;\n  public onUserNotAnswerListener!: Calls.OnUserNotAnswerListener;\n  public onRemoteStreamListener!: Calls.OnRemoteStreamListener;\n  public onSessionCloseListener!: Calls.OnSessionCloseListener;\n  public onCallStatsReportListener!: Calls.OnCallStatsReportListener;\n  public onSessionConnectionStateChangedListener!: Calls.OnSessionConnectionStateChangedListener;\n\n  constructor(params: Calls.SessionParams) {\n    Object.assign(this, params, { ID: params.ID ?? generateUUID() });\n  }\n\n  public async getDisplayMedia(params: Media.DisplayParams): Promise<MediaStream> {\n    if (!mediaDevices.getDisplayMedia) {\n      throw new Error(\"Your environment does not support 'getDisplayMedia' API\");\n    }\n\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getDisplayMedia(mediaParams);\n      const localStream = this.upsertStream(stream, elementId, options);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public async getUserMedia(params: Media.UserParams): Promise<MediaStream> {\n    const elementId = params && params.elementId;\n    const options = params && params.options;\n    const mediaParams = { ...params };\n\n    this.mediaParams = mediaParams;\n\n    delete mediaParams.elementId;\n    delete mediaParams.options;\n\n    try {\n      const stream = await mediaDevices.getUserMedia(mediaParams);\n      const localStream = this.upsertStream(stream, elementId, options);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  private upsertStream(stream: MediaStream, elementId?: string, options?: Media.ElementOptions): MediaStream {\n    const shouldUpdateCurrentStream = !!this.localStream;\n\n    if (shouldUpdateCurrentStream) {\n      this.replaceTracks(stream);\n    } else {\n      this.localStream = stream;\n    }\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    if (elementId) {\n      if (shouldUpdateCurrentStream) {\n        this.detachMediaStream(elementId, options);\n      }\n      this.attachMediaStream(elementId, this.localStream, options);\n    }\n\n    return this.localStream;\n  }\n\n  private replaceTracks(stream: MediaStream): MediaStream {\n    this.localStream?.getTracks().forEach((localTrack) => {\n      if (localTrack.kind === MediaType.AUDIO && stream.getAudioTracks().length === 0) {\n        return;\n      } else {\n        localTrack.stop();\n        this.localStream?.removeTrack(localTrack);\n      }\n    });\n\n    stream.getTracks().forEach((newTrack) => {\n      if (newTrack.kind === MediaType.AUDIO) {\n        newTrack.enabled = this.localStream?.getAudioTracks().every(({ enabled }) => enabled) ?? true;\n      } else {\n        newTrack.enabled = this.localStream?.getVideoTracks().every(({ enabled }) => enabled) ?? true;\n      }\n\n      if (newTrack) {\n        Object.values(this.peerConnections).forEach((pc) => {\n          pc.getSenders()\n            .find(({ track }) => newTrack.kind === track?.kind)\n            ?.replaceTrack(newTrack);\n        });\n        this.localStream?.addTrack(newTrack);\n      }\n    });\n\n    if (!this.localStream) {\n      throw new Error('Local stream is not defined');\n    }\n\n    return this.localStream;\n  }\n\n  public async setMaxBandwidth(maxBandwidth: number): Promise<void[]> {\n    const peers = this.peerConnections;\n    const peersKeys = Object.keys(peers);\n\n    if (peersKeys.length < 1) {\n      WebRTCHelpers.trace(\"No 'RTCPeerConnection' to set 'maxBandwidth'\");\n      return;\n    }\n\n    return Promise.all(peersKeys.map((userID) => peers[Number(userID)].setRTCRtpSenderMaxBandwidth(maxBandwidth)));\n  }\n\n  public connectionStateForUser(userID: number): PeerConnectionState | null {\n    const peerConnection = this.peerConnections[userID];\n    return peerConnection ? peerConnection.state : null;\n  }\n\n  public attachMediaStream(elementId: string, stream: MediaStream, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.srcObject = stream;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n      mediaElement.onloadedmetadata = (_event: Event) => {\n        mediaElement.play();\n      };\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public detachMediaStream(elementId: string, opt?: Media.ElementOptions): void {\n    const mediaElement = document.getElementById(elementId) as HTMLMediaElement;\n\n    if ('srcObject' in mediaElement) {\n      mediaElement.pause();\n      mediaElement.srcObject = null;\n      mediaElement.style.transform = opt?.mirror ? 'scaleX(-1)' : 'none';\n      if (typeof opt?.muted === 'boolean') {\n        mediaElement.muted = opt?.muted;\n      }\n    } else {\n      throw new Error(`Unable to attach media stream, element #${elementId} is undefined`);\n    }\n  }\n\n  public async switchMediaTracks(options: Media.TrackConstraintsOrDeviceIds = {}): Promise<MediaStream> {\n    Utils.DLog('switchMediaTracks:', options);\n\n    [MediaType.AUDIO, MediaType.VIDEO].forEach((type) => {\n      const device = type === MediaType.AUDIO ? options.audio : type === MediaType.VIDEO ? options.video : {};\n      const deviceId = typeof device === 'string' ? device : device?.deviceId;\n\n      if (deviceId) {\n        if (typeof this.mediaParams[type] !== 'object') {\n          this.mediaParams[type].deviceId = deviceId;\n        } else {\n          this.mediaParams[type] = { deviceId };\n        }\n      }\n    });\n\n    try {\n      const constrains = { audio: this.mediaParams.audio || false, video: this.mediaParams.video || false };\n      const stream = await mediaDevices.getUserMedia(constrains);\n      const localStream = this.replaceTracks(stream);\n      return localStream;\n    } catch (error) {\n      throw error;\n    }\n  }\n\n  public call(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Call, extension: ${JSON.stringify(ext)}`);\n\n    this.state = CallSessionState.ACTIVE;\n    this.maxBandwidth = Number(ext.userInfo?.maxBandwidth ?? 0);\n    this.opponentsIDs.forEach((userID) => {\n      this.callInternal(userID, ext, true);\n    });\n  }\n\n  private async callInternal(\n    userID: number,\n    extension: Calls.ExtensionParams,\n    withOnNotAnswerCallback: boolean\n  ): Promise<void> {\n    const pc = new WebRTCPeerConnection(this, userID, 'offer');\n\n    this.localStream?.getTracks().forEach((track) => {\n      pc.addTrack(track, this.localStream);\n    });\n\n    this.peerConnections[userID] = pc;\n\n    try {\n      await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      WebRTCHelpers.trace('getAndSetLocalSessionDescription success');\n      pc.startDialingTimer(extension, withOnNotAnswerCallback); // call requests to user\n    } catch (error) {\n      WebRTCHelpers.traceError(`getAndSetLocalSessionDescription error: ${error}`);\n    }\n  }\n\n  public accept(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Accept, extension: ${JSON.stringify(ext)}`);\n\n    if (this.state === CallSessionState.ACTIVE) {\n      WebRTCHelpers.traceError(\"Can't accept, the session is already active, return\");\n      return;\n    }\n\n    if (this.state === CallSessionState.CLOSED) {\n      WebRTCHelpers.traceError(\"Can't accept, the session is already closed, return\");\n      this.stop({});\n      return;\n    }\n\n    this.state = CallSessionState.ACTIVE;\n    this.acceptCallTime = Date.now();\n    this.clearAnswerTimer();\n    this.acceptInternal(this.initiatorID, ext);\n\n    // group call\n    const opponentsIDs = this.opponentsIDs.filter((userID) => userID !== this.currentUserID);\n\n    if (opponentsIDs.length > 0) {\n      this.startWaitingOfferOrAnswerTimer();\n      opponentsIDs.forEach((opponentID) => {\n        if (this.currentUserID > opponentID) {\n          this.callInternal(opponentID, ext, true);\n        }\n      });\n    }\n  }\n\n  private async acceptInternal(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc || !pc.sdpRemote) {\n      WebRTCHelpers.traceError(\"Can't accept the call, there is no information about peer connection by some reason\");\n      return;\n    }\n\n    this.localStream?.getTracks().forEach((track) => {\n      pc.addTrack(track, this.localStream);\n    });\n\n    try {\n      await pc.setRemoteSessionDescription('offer', pc.sdpRemote);\n      WebRTCHelpers.trace('setRemoteSessionDescription - success');\n      await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      WebRTCHelpers.trace('getAndSetLocalSessionDescription - success');\n\n      const ext = Object.assign({}, extension, {\n        sessionID: this.ID,\n        callType: this.callType,\n        callerID: this.initiatorID,\n        opponentsIDs: this.opponentsIDs,\n        sdp: pc.localDescription.sdp,\n      });\n\n      this.signalingProvider.sendMessage(userID, ext, CallSignalingType.ACCEPT);\n    } catch (error) {\n      WebRTCHelpers.traceError(`[acceptInternal] Error: ${error}`);\n    }\n  }\n\n  public reject(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Reject, extension: ${JSON.stringify(ext.userInfo)}`);\n\n    this.state = CallSessionState.REJECTED;\n    this.clearAnswerTimer();\n    Object.assign(ext, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    });\n\n    Object.keys(this.peerConnections).forEach((userID) => {\n      this.signalingProvider.sendMessage(Number(userID), ext, CallSignalingType.REJECT);\n    });\n\n    this.close();\n  }\n\n  public stop(extension: Calls.UserInfo = {}): void {\n    const ext = prepareExtension(extension);\n\n    WebRTCHelpers.trace(`Stop, extension: ${JSON.stringify(ext.userInfo)}`);\n\n    this.state = CallSessionState.STOPPED;\n\n    if (this.answerTimer) {\n      this.clearAnswerTimer();\n    }\n\n    Object.assign(ext, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    });\n\n    Object.keys(this.peerConnections).forEach((userID) => {\n      this.signalingProvider.sendMessage(Number(userID), ext, CallSignalingType.STOP);\n    });\n\n    this.close();\n  }\n\n  public canInitiateIceRestart(userID: number): boolean {\n    return this.peerConnections[userID]?.type === 'offer';\n  }\n\n  public async iceRestart(userID: number): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceError(\"Can't restart ice, there is no information about peer connection by some reason\");\n      return;\n    }\n\n    try {\n      const { sdp } = await pc.getAndSetLocalSessionDescription(this.maxBandwidth, true);\n      const ext = { sessionID: this.ID ?? '', sdp };\n      this.signalingProvider.sendMessage(userID, ext, CallSignalingType.RESTART);\n      WebRTCHelpers.trace('[iceRestart] OK');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[iceRestart] Error: ${error}`);\n    }\n  }\n\n  public processOnCall(callerID: number, extension: Calls.ExtensionParams): void {\n    const opponentsIDs = [this.initiatorID, ...this.opponentsIDs.filter((userID) => userID !== this.currentUserID)];\n\n    opponentsIDs.forEach((opponentID) => {\n      const pc = this.peerConnections[opponentID];\n\n      if (pc) {\n        if (opponentID === callerID) {\n          pc.sdpRemote = extension.sdp;\n          /** The group call logic starts here */\n          if (callerID !== this.initiatorID && this.state === CallSessionState.ACTIVE) {\n            this.acceptInternal(callerID, extension);\n          }\n        }\n      } else {\n        /** create peer connections for each opponent */\n        const rtcSdpType = opponentID !== callerID && this.currentUserID > opponentID ? 'offer' : 'answer';\n        const pc = new WebRTCPeerConnection(this, opponentID, rtcSdpType);\n\n        this.peerConnections[opponentID] = pc;\n\n        if (opponentID === callerID) {\n          pc.sdpRemote = extension.sdp;\n          this.startAnswerTimer();\n        }\n      }\n    });\n  }\n\n  public async processOnAccept(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\"Ignore 'OnAccept', there is no information about peer connection by some reason\");\n    }\n\n    try {\n      pc.clearDialingTimer();\n      await pc.setRemoteSessionDescription('answer', extension.sdp);\n      WebRTCHelpers.trace(\"'setRemoteSessionDescription' success\");\n    } catch (error) {\n      WebRTCHelpers.traceError(`'setRemoteSessionDescription' error: ${error}`);\n    }\n  }\n\n  public processOnReject(userID: number): void {\n    const pc = this.peerConnections[userID];\n\n    this.clearWaitingOfferOrAnswerTimer();\n\n    if (pc) {\n      pc.release();\n    } else {\n      WebRTCHelpers.traceWarning(\"Ignore 'OnReject', there is no information about peer connection by some reason\");\n    }\n\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public processOnStop(userID: number): void {\n    this.clearAnswerTimer();\n\n    /** drop the call if the initiator did it */\n    if (userID === this.initiatorID) {\n      const pcKeys = Object.keys(this.peerConnections);\n      if (pcKeys.length > 0) {\n        pcKeys.forEach((key: string) => {\n          this.peerConnections[Number(key)].release();\n        });\n      } else {\n        WebRTCHelpers.traceWarning(\"Ignore 'OnStop', there is no information about peer connections by some reason\");\n      }\n    } else {\n      const pc = this.peerConnections[userID];\n      if (pc) {\n        pc.release();\n      } else {\n        WebRTCHelpers.traceWarning('Ignore \"OnStop\", there is no information about peer connection by some reason');\n      }\n    }\n\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public async processOnIceCandidates(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\n        'Ignore \"OnIceCandidates\", there is no information about peer connection by some reason'\n      );\n    }\n\n    if (extension.iceCandidates) {\n      await pc.addCandidates(extension.iceCandidates);\n    }\n  }\n\n  public async processOnIceRestart(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning('Ignore \"OnIceRestart\", there is no information about peer connection by some reason');\n    }\n\n    try {\n      await pc.setRemoteSessionDescription('offer', extension.sdp);\n      const { sdp } = await pc.getAndSetLocalSessionDescription(this.maxBandwidth);\n      const ext = { sessionID: this.ID ?? '', sdp };\n      this.signalingProvider.sendMessage(userID, ext, CallSignalingType.RESTART_ACCEPT);\n      WebRTCHelpers.trace('[processOnIceRestart] Success');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[processOnIceRestart] Error: ${error}`);\n    }\n  }\n\n  public async processOnIceRestartAccept(userID: number, extension: Calls.ExtensionParams): Promise<void> {\n    const pc = this.peerConnections[userID];\n\n    if (!pc) {\n      WebRTCHelpers.traceWarning(\n        'Ignore \"OnIceRestartAccept\", there is no information about peer connection by some reason'\n      );\n    }\n\n    try {\n      await pc.setRemoteSessionDescription('answer', extension.sdp);\n      WebRTCHelpers.trace('[processOnIceRestartAccept] Success');\n    } catch (error) {\n      WebRTCHelpers.traceError(`[processOnIceRestartAccept] Error: ${error}`);\n    }\n  }\n\n  public processCall(peerConnection: WebRTCPeerConnection, extension: Calls.ExtensionParams = {}): void {\n    const ext = Object.assign({ userInfo: {} }, extension, {\n      sessionID: this.ID,\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n      sdp: peerConnection.localDescription.sdp,\n    });\n\n    this.signalingProvider.sendMessage(peerConnection.userID, ext, CallSignalingType.CALL);\n  }\n\n  public processIceCandidates(userID: number, iceCandidates: RTCIceCandidateInit[]): void {\n    const extension = {\n      sessionID: this.ID ?? '',\n      callType: this.callType,\n      callerID: this.initiatorID,\n      opponentsIDs: this.opponentsIDs,\n    };\n\n    this.signalingProvider.sendCandidate(userID, iceCandidates, extension);\n  }\n\n  public processOnNotAnswer(peerConnection: WebRTCPeerConnection): void {\n    WebRTCHelpers.trace(`Answer timeout callback for session ${this.ID} for user ${peerConnection.userID}`);\n\n    this.clearWaitingOfferOrAnswerTimer();\n    peerConnection.release();\n    Utils.safeCallbackCall(this.onUserNotAnswerListener)(this, peerConnection.userID);\n    this.closeSessionIfAllConnectionsClosed();\n  }\n\n  public onRemoteStream(userID: number, stream: MediaStream): void {\n    Utils.safeCallbackCall(this.onRemoteStreamListener)(this, userID, stream);\n  }\n\n  public onCallStatsReport(userID: number, stats: any, error?: Error): void {\n    Utils.safeCallbackCall(this.onCallStatsReportListener)(this, userID, stats, error);\n  }\n\n  public onSessionConnectionStateChanged(userID: number, connectionState: CallSessionConnectionState): void {\n    Utils.safeCallbackCall(this.onSessionConnectionStateChangedListener)(this, userID, connectionState);\n  }\n\n  private close(): void {\n    Object.values(this.peerConnections).forEach((pc) => {\n      try {\n        pc.release();\n      } catch (e) {\n        Utils.DLog(`Peer close error: ${e}`);\n      }\n    });\n\n    this.closeLocalMediaStream();\n    this.state = CallSessionState.CLOSED;\n    Utils.safeCallbackCall(this.onSessionCloseListener)(this);\n  }\n\n  public closeSessionIfAllConnectionsClosed(): void {\n    let isAllClosed = true;\n\n    Object.values(this.peerConnections).forEach((pc) => {\n      let isClosed = false;\n      try {\n        /*\n         * TODO:\n         * Uses RTCPeerConnection.signalingState instead RTCPeerConnection.iceConnectionState,\n         * because state 'closed' comes after few time from Safari, but signaling state comes instantly\n         */\n        isClosed = pc.iceConnectionState === 'closed' || pc.signalingState === 'closed' || pc.released;\n      } catch (err) {\n        WebRTCHelpers.traceError(err);\n        // need to set peerState to 'closed' on error. FF will crashed without this part.\n        isClosed = true;\n      }\n\n      isAllClosed = isClosed;\n    });\n\n    WebRTCHelpers.trace(`All peer connections closed: ${isAllClosed}`);\n\n    if (isAllClosed) {\n      this.closeLocalMediaStream();\n      Utils.safeCallbackCall(this.onSessionCloseListener)(this);\n      this.state = CallSessionState.CLOSED;\n    }\n  }\n\n  private closeLocalMediaStream(): void {\n    if (this.localStream) {\n      this.localStream.getTracks().forEach((track) => track.stop());\n      this.localStream = undefined;\n      this.mediaParams = {};\n    }\n  }\n\n  public mute(type: MediaType): void {\n    this.muteStream(false, type);\n  }\n\n  public unmute(type: MediaType): void {\n    this.muteStream(true, type);\n  }\n\n  private muteStream(enabled: boolean, type: MediaType = MediaType.NONE): void {\n    const tracks =\n      type === MediaType.AUDIO\n        ? this.localStream?.getAudioTracks()\n        : type === MediaType.VIDEO\n        ? this.localStream?.getVideoTracks()\n        : [];\n\n    tracks?.forEach((track) => {\n      track.enabled = enabled;\n    });\n  }\n\n  private clearAnswerTimer(): void {\n    if (this.answerTimer) {\n      WebRTCHelpers.trace('clearAnswerTimer');\n      clearTimeout(this.answerTimer);\n      this.answerTimer = null;\n    }\n  }\n\n  private startAnswerTimer(): void {\n    WebRTCHelpers.trace('startAnswerTimer');\n\n    this.answerTimer = setTimeout(() => {\n      WebRTCHelpers.trace('answerTimeoutCallback');\n      this.close();\n      this.answerTimer = null;\n    }, config.videochat.answerTimeInterval * 1000);\n  }\n\n  private clearWaitingOfferOrAnswerTimer(): void {\n    if (this.waitingOfferOrAnswerTimer) {\n      WebRTCHelpers.trace('clearWaitingOfferOrAnswerTimer');\n      clearTimeout(this.waitingOfferOrAnswerTimer);\n      this.waitingOfferOrAnswerTimer = null;\n    }\n  }\n\n  private startWaitingOfferOrAnswerTimer(): void {\n    const timeWait = (this.acceptCallTime - this.startCallTime) / 1000;\n    const timeDiff = Math.min(timeWait, config.videochat.answerTimeInterval / 2);\n    const timeout = Math.max(config.videochat.answerTimeInterval - timeDiff, 1);\n\n    WebRTCHelpers.trace(`startWaitingOfferOrAnswerTimer, timeout: ${timeout}`);\n\n    this.waitingOfferOrAnswerTimer = setTimeout(() => {\n      WebRTCHelpers.trace('waitingOfferOrAnswerTimeoutCallback');\n\n      Object.values(this.peerConnections).forEach((pc) => {\n        if (pc.state === PeerConnectionState.CONNECTING || pc.state === PeerConnectionState.NEW) {\n          this.processOnNotAnswer(pc);\n        }\n      });\n\n      this.waitingOfferOrAnswerTimer = null;\n    }, timeout * 1000);\n  }\n\n  public toString(): string {\n    return `ID: ${this.ID}, initiatorID: ${this.initiatorID}, opponentsIDs: ${this.opponentsIDs}, state: ${this.state}, callType: ${this.callType}`;\n  }\n}\n\nfunction generateUUID(): string {\n  let d = Date.now();\n  const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = (d + Math.random() * 16) % 16 | 0;\n    d = Math.floor(d / 16);\n    return (c == 'x' ? r : (r & 0x3) | 0x8).toString(16);\n  });\n  return uuid;\n}\n\nfunction prepareExtension(extension: Calls.UserInfo = {}): Calls.ExtensionParams {\n  const ext = { userInfo: extension };\n\n  try {\n    if (Utils.isObject(extension)) {\n      ext.userInfo = Utils.cloneObject(extension, true);\n    } else {\n      WebRTCHelpers.traceWarning('Ignore \"prepareExtension\", must be an object');\n    }\n  } catch (err) {\n    WebRTCHelpers.traceWarning(err.message);\n  }\n\n  return ext;\n}\n","import WebRTCClient from './WebRTCClient';\nimport ChatHelpers from '../messaging/ChatUtils';\nimport ChatUtils from '../messaging/ChatUtils';\nimport { Calls, CallSignalingType, CallType, Chat } from '../types';\n\nexport default class WebRTCSignalingProcessor {\n  public delegate: WebRTCClient;\n\n  constructor(delegate: WebRTCClient) {\n    this.delegate = delegate;\n  }\n\n  public onMessage = (userID: number, extraParams: Chat.XmlElement): void => {\n    const extension = this.getExtension(extraParams);\n    const sessionId = extension?.sessionID ?? '';\n    const signalType = extension?.signalType;\n    /** cleanup */\n    delete extension?.moduleIdentifier;\n    delete extension?.sessionID;\n    delete extension?.signalType;\n\n    switch (signalType) {\n      case CallSignalingType.CALL:\n        this.delegate.onCallHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.ACCEPT:\n        this.delegate.onAcceptHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.REJECT:\n        this.delegate.onRejectHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.STOP:\n        this.delegate.onStopHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.CANDIDATE:\n        this.delegate.onIceCandidatesHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.RESTART:\n        this.delegate.onIceRestartHandler(userID, sessionId, extension);\n        break;\n      case CallSignalingType.RESTART_ACCEPT:\n        this.delegate.onIceRestartAcceptHandler(userID, sessionId, extension);\n        break;\n    }\n  };\n\n  private getExtension(extraParams?: Chat.XmlElement): Calls.ExtensionParams {\n    if (!extraParams) {\n      return {};\n    }\n\n    const extension: Calls.ExtensionParams = { iceCandidates: [], opponentsIDs: [] };\n    const elements = ChatUtils.getChildElements(extraParams);\n\n    elements.forEach((element: Chat.XmlElement) => {\n      const items = ChatUtils.getChildElements(element);\n      const key = ChatUtils.getName(element) ?? '';\n\n      switch (key) {\n        case 'callerID':\n          extension[key] = parseInt(ChatUtils.getText(element) || '0');\n          break;\n\n        case 'callType':\n          const type = ChatUtils.getText(element);\n          extension[key] = type === '1' ? CallType.VIDEO : type === '2' ? CallType.AUDIO : undefined;\n          break;\n\n        case 'iceCandidates':\n          items.forEach((item) => {\n            const candidate = {};\n            ChatUtils.getChildElements(item).forEach((child) => {\n              const childName = ChatUtils.getName(child) || '';\n              const childText = ChatUtils.getText(child);\n              candidate[childName] = childName === 'sdpMLineIndex' ? parseInt(childText || '0') : childText;\n            });\n            extension.iceCandidates?.push(candidate);\n          });\n          break;\n\n        case 'opponentsIDs':\n          items.forEach((item) => {\n            extension.opponentsIDs?.push(parseInt(ChatUtils.getText(item) || '0'));\n          });\n          break;\n\n        default:\n          if (items.length > 1) {\n            if ((ChatUtils.getText(element) || '').length > 4096) {\n              extension[key] = items.reduce((acc, item) => acc + ChatUtils.getText(item), '');\n            } else {\n              ChatHelpers.assignXmlToObject(element, extension);\n            }\n          } else {\n            if (key === 'userInfo') {\n              ChatHelpers.assignXmlToObject(element, extension);\n            } else {\n              extension[key] = ChatUtils.getText(element);\n            }\n          }\n          break;\n      }\n    });\n\n    if (extension.iceCandidates?.length === 0) {\n      delete extension.iceCandidates;\n    }\n\n    if (extension.opponentsIDs?.length === 0) {\n      delete extension.opponentsIDs;\n    }\n\n    return extension;\n  }\n}\n","import Utils from '../Utils';\nimport { XMPPClient } from '../messaging/xmpp';\nimport ChatUtils from '../messaging/ChatUtils';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport { Calls, CallSignalingModuleIdentifier, CallSignalingType } from '../types';\n\nexport default class WebRTCSignalingProvider {\n  public signalingConnection: XMPPClient;\n\n  constructor(signalingConnection: XMPPClient) {\n    this.signalingConnection = signalingConnection;\n  }\n\n  public sendCandidate(userID: number, iceCandidates: RTCIceCandidateInit[], ext: Calls.ExtensionParams = {}): void {\n    const extension = Object.assign({}, ext, { iceCandidates });\n\n    this.sendMessage(userID, extension, CallSignalingType.CANDIDATE);\n  }\n\n  public sendMessage(userID: number, ext: Calls.ExtensionParams, signalingType: CallSignalingType): void {\n    const extension = Object.assign({}, ext);\n    /** basic parameters */\n    extension.moduleIdentifier = CallSignalingModuleIdentifier;\n    extension.signalType = signalingType;\n    /** extension.sessionID */\n    /** extension.callType */\n    extension.platform = Utils.env.isBrowser ? 'web' : Utils.env.isReactNative || Utils.env.isExpo ? 'mobile' : 'node';\n    /** extension.callerID */\n    /** extension.opponentsIDs */\n    /** extension.sdp */\n\n    if (extension.userInfo) {\n      if (!Object.keys(extension.userInfo).length) {\n        delete extension.userInfo;\n      } else if (extension.userInfo.maxBandwidth === 0) {\n        delete extension.userInfo.maxBandwidth;\n      }\n    }\n\n    let messageStanza = ChatUtils.createMessageStanza({\n      to: WebRTCHelpers.getUserJid(userID),\n      type: 'headline',\n      id: Utils.getBsonObjectId(),\n    }).c('extraParams', { xmlns: 'jabber:client' });\n\n    Object.keys(extension).forEach((name) => {\n      const item = extension[name];\n\n      if (name === 'iceCandidates') {\n        messageStanza = messageStanza.c('iceCandidates');\n        item.forEach((candidate: RTCIceCandidateInit) => {\n          messageStanza = messageStanza.c('iceCandidate');\n          Object.keys(candidate).forEach((key: string) => {\n            messageStanza = messageStanza.c(key).t(candidate[key]).up();\n          });\n          messageStanza = messageStanza.up();\n        });\n        messageStanza = messageStanza.up();\n      } else if (name === 'opponentsIDs') {\n        messageStanza = messageStanza.c('opponentsIDs');\n        item.forEach((opponentId: string) => {\n          messageStanza = messageStanza.c('opponentID').t(opponentId).up();\n        });\n        messageStanza = messageStanza.up();\n      } else if (typeof item === 'object') {\n        ChatUtils.assignObjectToXml(messageStanza, item, name);\n      } else {\n        messageStanza = messageStanza.c(name).t(item).up();\n      }\n    });\n\n    messageStanza = messageStanza.up();\n\n    this.signalingConnection.sendOnline(messageStanza);\n  }\n}\n","import { mediaDevices } from '../platform';\nimport config from '../config';\nimport ProxyService from '../Proxy';\nimport Utils from '../Utils';\nimport WebRTCSession from './WebRTCSession';\nimport WebRTCSignalingProcessor from './WebRTCSignalingProcessor';\nimport WebRTCSignalingProvider from './WebRTCSignalingProvider';\nimport WebRTCHelpers from './WebRTCHelpers';\nimport { XMPPClient } from '../messaging/xmpp';\nimport {\n  CallEvent,\n  Calls,\n  CallSessionConnectionState,\n  CallSessionState,\n  CallType,\n  EmptyResponse,\n  PeerConnectionState,\n  ProxyMethod,\n} from '../types';\n\nexport default class WebRTCClient {\n  public connection: XMPPClient;\n  public proxy: ProxyService;\n  public signalingProcessor: WebRTCSignalingProcessor;\n  public signalingProvider: WebRTCSignalingProvider;\n  public SessionConnectionState: typeof CallSessionConnectionState = CallSessionConnectionState;\n  public PeerConnectionState: typeof PeerConnectionState = PeerConnectionState;\n  public CallType: typeof CallType = CallType;\n  public sessions: { [key: string]: WebRTCSession } = {};\n  public onCallListener!: Calls.OnCallListener;\n  public onAcceptCallListener!: Calls.OnAcceptCallListener;\n  public onRejectCallListener!: Calls.OnRejectCallListener;\n  public onStopCallListener!: Calls.OnStopCallListener;\n  public onInvalidEventsListener!: Calls.OnInvalidEventsListener;\n  public onUserNotAnswerListener!: Calls.OnUserNotAnswerListener;\n  public onRemoteStreamListener!: Calls.OnRemoteStreamListener;\n  public onSessionConnectionStateChangedListener!: Calls.OnSessionConnectionStateChangedListener;\n  public onSessionCloseListener!: Calls.OnSessionCloseListener;\n  public onCallStatsReport!: Calls.OnCallStatsReportListener;\n  public onDevicesChangeListener: Calls.OnDevicesChangeListener = () => {};\n\n  constructor(connection: XMPPClient, proxy: ProxyService) {\n    this.connection = connection;\n    this.proxy = proxy;\n\n    this.signalingProcessor = new WebRTCSignalingProcessor(this);\n    this.signalingProvider = new WebRTCSignalingProvider(connection);\n\n    if (mediaDevices) {\n      mediaDevices.ondevicechange = Utils.safeCallbackCall(this.onDevicesChangeListener);\n    }\n  }\n\n  private get currentUserID(): number {\n    const userJID = this.connection.jid?.toString() ?? '';\n    const userID = WebRTCHelpers.getUserIdFromJID(userJID) ?? 0;\n    return userID;\n  }\n\n  public async getMediaDevices(kind?: MediaDeviceKind): Promise<MediaDeviceInfo[]> {\n    if (mediaDevices?.enumerateDevices) {\n      const devices = await mediaDevices.enumerateDevices();\n      return kind ? devices.filter((device) => device.kind === kind) : devices;\n    } else {\n      throw new Error(\"No 'enumerateDevices' API supported\");\n    }\n  }\n\n  public createNewSession(\n    opponentsIDs: number[],\n    callType: number,\n    options?: { maxBandwidth?: number; bandwidth?: number }\n  ): WebRTCSession {\n    const maxBandwidth = (options?.maxBandwidth || options?.bandwidth) ?? 0;\n\n    if (!opponentsIDs) {\n      throw new Error(\"Can't create a session without opponentsIDs\");\n    }\n\n    return this.createAndStoreSession(null, this.currentUserID, opponentsIDs, callType, maxBandwidth);\n  }\n\n  private createAndStoreSession(\n    sessionID: string | null,\n    initiatorID: number,\n    opponentsIDs: number[],\n    callType: CallType,\n    maxBandwidth: number = 0\n  ): WebRTCSession {\n    const webRTCSession = new WebRTCSession({\n      ID: sessionID,\n      initiatorID,\n      opponentsIDs,\n      callType,\n      signalingProvider: this.signalingProvider,\n      currentUserID: this.currentUserID,\n      maxBandwidth,\n    });\n\n    webRTCSession.onUserNotAnswerListener = this.onUserNotAnswerListener;\n    webRTCSession.onRemoteStreamListener = this.onRemoteStreamListener;\n    webRTCSession.onSessionConnectionStateChangedListener = this.onSessionConnectionStateChangedListener;\n    webRTCSession.onSessionCloseListener = this.onSessionCloseListener;\n    webRTCSession.onCallStatsReportListener = this.onCallStatsReport;\n\n    if (webRTCSession?.ID) {\n      this.sessions[webRTCSession.ID] = webRTCSession;\n    }\n\n    return webRTCSession;\n  }\n\n  public clearSession(sessionId: string): void {\n    delete this.sessions[sessionId];\n  }\n\n  /// Reject call by http request\n  public callRejectRequest(params: {\n    sessionID: string;\n    recipientId: number;\n    platform: 'web' | 'android' | 'ios';\n    userInfo?: Calls.UserInfo;\n  }): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(config.urls.calls, 'reject'),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  /// DELEGATE (signaling)\n\n  public onCallHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const userInfo = extension.userInfo || {};\n    const maxBandwidth = Number(userInfo.maxBandwidth ?? 0);\n\n    let session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(`onCall. userID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`);\n\n    if (!session) {\n      session = this.createAndStoreSession(\n        sessionID,\n        extension.callerID || 0,\n        extension.opponentsIDs || [],\n        extension.callType || CallType.VIDEO,\n        maxBandwidth\n      );\n\n      Utils.safeCallbackCall(this.onCallListener)(session, userInfo);\n    }\n\n    session.processOnCall(userID, extension);\n  }\n\n  public onAcceptHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const session = this.sessions[sessionID];\n    const userInfo = extension.userInfo || {};\n\n    WebRTCHelpers.trace(\n      `onAccept. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session && (session.state === CallSessionState.ACTIVE || session.state === CallSessionState.NEW)) {\n      Utils.safeCallbackCall(this.onAcceptCallListener)(session, userID, userInfo);\n      session.processOnAccept(userID, extension);\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onAccept', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onRejectHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams): void {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onReject. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      const userInfo = extension.userInfo || {};\n\n      Utils.safeCallbackCall(this.onRejectCallListener)(session, userID, userInfo);\n      session.processOnReject(userID);\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onReject', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onStopHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    WebRTCHelpers.trace(`onStop. UserID: ${userID}, sessionID: ${sessionID}, extension: ${JSON.stringify(extension)}`);\n\n    const session = this.sessions[sessionID];\n    const userInfo = extension.userInfo || {};\n\n    if (session && (session.state === CallSessionState.ACTIVE || session.state === CallSessionState.NEW)) {\n      session.processOnStop(userID);\n      Utils.safeCallbackCall(this.onStopCallListener)(session, userID, userInfo);\n    } else {\n      Utils.safeCallbackCall(this.onInvalidEventsListener)(session, userID, userInfo);\n      WebRTCHelpers.traceWarning(`Ignore 'onStop', there is no information about session ${sessionID} by some reason`);\n    }\n  }\n\n  public onIceCandidatesHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceCandidates. UserID: ${userID}. SessionID: ${sessionID}. ICE candidates count: ${\n        extension.iceCandidates?.length ?? 0\n      }`\n    );\n\n    if (session) {\n      if (session.state === CallSessionState.ACTIVE) {\n        session.processOnIceCandidates(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'OnIceCandidates', the session ( ${sessionID} ) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'OnIceCandidates', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onIceRestartHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceRestart. UserID: ${userID}. SessionID: ${sessionID}. Extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      if (session.state === CallSessionState.ACTIVE) {\n        session.processOnIceRestart(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'OnIceRestart', the session (${sessionID}) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'OnIceRestart', there is no information about session ${sessionID}`);\n    }\n  }\n\n  public onIceRestartAcceptHandler(userID: number, sessionID: string, extension: Calls.ExtensionParams) {\n    const session = this.sessions[sessionID];\n\n    WebRTCHelpers.trace(\n      `onIceRestartAccept. UserID: ${userID}. SessionID: ${sessionID}. Extension: ${JSON.stringify(extension)}`\n    );\n\n    if (session) {\n      if (session.state === CallSessionState.ACTIVE) {\n        session.processOnIceRestartAccept(userID, extension);\n      } else {\n        WebRTCHelpers.traceWarning(`Ignore 'onIceRestartAccept', the session (${sessionID}) has invalid state`);\n      }\n    } else {\n      WebRTCHelpers.traceWarning(`Ignore 'onIceRestartAccept', there is no information about session ${sessionID}`);\n    }\n  }\n\n  private getListenerByName(name: CallEvent): Calls.ListenerName | null {\n    switch (name) {\n      case CallEvent.CALL:\n        return 'onCallListener';\n      case CallEvent.ACCEPT:\n        return 'onAcceptCallListener';\n      case CallEvent.REJECT:\n        return 'onRejectCallListener';\n      case CallEvent.STOP:\n        return 'onStopCallListener';\n      case CallEvent.INVALID:\n        return 'onInvalidEventsListener';\n      case CallEvent.NOT_ANSWER:\n        return 'onUserNotAnswerListener';\n      case CallEvent.REMOTE_STREAM:\n        return 'onRemoteStreamListener';\n      case CallEvent.CONNECTION_STATE:\n        return 'onSessionConnectionStateChangedListener';\n      case CallEvent.CLOSE:\n        return 'onSessionCloseListener';\n      case CallEvent.STATS_REPORT:\n        return 'onCallStatsReport';\n      case CallEvent.DEVICES:\n        return 'onDevicesChangeListener';\n      default:\n        return null;\n    }\n  }\n\n  public addListener(name: CallEvent, listener: Calls.Listeners): () => void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Calls.Listeners) = listener;\n    }\n    return this.removeListener.bind(this, name);\n  }\n\n  public removeListener(name: CallEvent): void {\n    const listenerName = this.getListenerByName(name);\n    if (listenerName) {\n      (this[listenerName] as Calls.Listeners | undefined) = name === CallEvent.DEVICES ? () => {} : undefined;\n    }\n  }\n\n  public removeAllListeners(): void {\n    Object.keys(this).forEach((key) => {\n      if (key.startsWith('on') && key.endsWith('Listener') && typeof this[key as Calls.ListenerName] === 'function') {\n        (this[key as Calls.ListenerName] as Calls.Listeners | undefined) =\n          key === 'onDevicesChangeListener' ? () => {} : undefined;\n      }\n    });\n  }\n}\n","import ProxyService from './Proxy';\nimport config from './config';\nimport Utils from './Utils';\nimport { EmptyResponse, ProxyMethod, ProxyType, Whiteboard } from './types';\n\nexport default class WhiteboardService {\n  public proxy: ProxyService;\n  readonly route = config.urls.whiteboards;\n  readonly server = config.whiteboard.server;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public getURL({ id, title, username }: Whiteboard.GetUrlParams): string {\n    return `${this.server}?whiteboardid=${id}&username=${username}&title=${title}`;\n  }\n\n  public async get(paramsOrId: Whiteboard.GetParams): Promise<Whiteboard.Item[]> {\n    const ajaxParams = {\n      type: ProxyMethod.GET,\n      url: Utils.getUrl(this.route),\n      data: typeof paramsOrId === 'string' ? { chat_dialog_id: paramsOrId } : paramsOrId,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async create(params: Whiteboard.CreateParams): Promise<Whiteboard.Item> {\n    const ajaxParams = {\n      type: ProxyMethod.POST,\n      url: Utils.getUrl(this.route),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async update(id: string, params: Whiteboard.UpdateParams): Promise<Whiteboard.Item> {\n    const ajaxParams = {\n      type: ProxyMethod.PUT,\n      url: Utils.getUrl(this.route, id),\n      data: params,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n\n  public async delete(id: string): Promise<EmptyResponse> {\n    const ajaxParams = {\n      type: ProxyMethod.DELETE,\n      url: Utils.getUrl(this.route, id),\n      dataType: ProxyType.TEXT,\n    };\n\n    return this.proxy.ajax(ajaxParams);\n  }\n}\n","import ProxyService from './Proxy';\nimport config from './config';\nimport { ProxyMethod, LinkPreview, LinkPreviewCache } from './types';\n\nexport default class LinkPreviewService {\n  public proxy: ProxyService;\n  public cache: LinkPreviewCache = new Map();\n\n  readonly route = config.urls.unfurl;\n  readonly server = config.linkpreview.server;\n\n  constructor(proxy: ProxyService) {\n    this.proxy = proxy;\n  }\n\n  public async get(url: string): Promise<LinkPreview> {\n    if (!this.cache.has(url)) {\n      let linkPreview: LinkPreview;\n\n      try {\n        const ajaxParams = {\n          type: ProxyMethod.POST,\n          url: `${this.server}/${this.route}`,\n          data: { url },\n        };\n\n        linkPreview = (await this.proxy.ajax(ajaxParams)) as LinkPreview;\n      } catch (error) {\n        const title = this.getHostFromUrl(url);\n\n        linkPreview = { url, title, description: '', images: [] };\n      } finally {\n        this.cache.set(url, linkPreview);\n      }\n    }\n\n    return this.cache.get(url);\n  }\n\n  private getHostFromUrl(url: string): string {\n    if (typeof URL === 'function') {\n      return new URL(url).hostname;\n    }\n\n    const match = url.match(/^(?:https?:\\/\\/)?([^\\/]+)/);\n    return match ? match[1] : url;\n  }\n}\n","import { isWebRTCAvailable } from './platform';\nimport config from './config';\nimport AddressBookService from './AddressBook';\nimport AuthService from './Auth';\nimport ChatClient from './messaging/Chat';\nimport ConferenceClient from './videocalling_conference/ConferenceClient';\nimport DataService from './Data';\nimport MeetingsService from './Meetings';\nimport ProxyService from './Proxy';\nimport PushNotificationsService from './PushNotifications';\nimport StorageService from './Storage';\nimport UsersService from './Users';\nimport Utils from './Utils';\nimport WebRTCClient from './videocalling/WebRTCClient';\nimport WhiteboardService from './Whiteboard';\nimport LinkPreviewService from './LinkPreview';\nimport { Config } from './types';\n\nexport default class ConnectyCube {\n  public ConnectyCube?: typeof ConnectyCube;\n\n  public utils!: Utils;\n  public service!: ProxyService;\n  public auth!: AuthService;\n  public users!: UsersService;\n  public storage!: StorageService;\n  public pushnotifications!: PushNotificationsService;\n  public data!: DataService;\n  public addressbook!: AddressBookService;\n  public chat!: ChatClient;\n  public meeting!: MeetingsService;\n  public whiteboard!: WhiteboardService;\n  public linkpreview!: LinkPreviewService;\n  public videochat!: WebRTCClient;\n  public videochatconference!: ConferenceClient;\n  public setSession!: AuthService['setSession'];\n  public getSession!: AuthService['getSession'];\n  public createSession!: AuthService['createSession'];\n  public destroySession!: AuthService['destroySession'];\n  /**\n   * @deprecated ConnectyCube.login(user) is deprecated. Use `ConnectyCube.createSession(user)` or `ConnectyCube.auth.login(user)` instead.\n   */\n  public login!: AuthService['login'];\n  /**\n   * @deprecated ConnectyCube.logout() is deprecated. Use `ConnectyCube.destroySession()` or `ConnectyCube.auth.logout()` instead.\n   */\n  public logout!: AuthService['logout'];\n\n  public init(credentials: Config.Credentials, configMap: Config.Options = {}): void {\n    if (configMap && typeof configMap === 'object') {\n      config.set(configMap);\n    }\n\n    this.utils = Utils;\n    this.service = new ProxyService();\n    this.auth = new AuthService(this.service);\n    this.users = new UsersService(this.service);\n    this.storage = new StorageService(this.service);\n    this.pushnotifications = new PushNotificationsService(this.service);\n    this.data = new DataService(this.service);\n    this.addressbook = new AddressBookService(this.service);\n    this.chat = new ChatClient(this.service);\n    this.meeting = new MeetingsService(this.service);\n    this.whiteboard = new WhiteboardService(this.service);\n    this.linkpreview = new LinkPreviewService(this.service);\n\n    if (isWebRTCAvailable) {\n      this.videochat = new WebRTCClient(this.chat.xmppClient, this.service);\n      this.videochatconference = new ConferenceClient(this.service);\n      this.chat.webrtcSignalingProcessor = this.videochat.signalingProcessor;\n    }\n\n    if (credentials.token) {\n      config.creds.appId = credentials.appId;\n      this.service.setSession({ token: credentials.token });\n    } else {\n      config.creds.appId = credentials.appId;\n      config.creds.authKey = credentials.authKey;\n    }\n\n    this.setSession = this.auth.setSession;\n    this.getSession = this.auth.getSession;\n    this.createSession = this.auth.createSession;\n    this.destroySession = this.auth.destroySession;\n    this.login = this.auth.login;\n    this.logout = this.auth.logout;\n  }\n}\n","import ConnectyCube from './ConnectyCube';\n\nconst connectycube = new ConnectyCube();\nconnectycube.ConnectyCube = ConnectyCube;\n\nexport default connectycube;\n"],"names":["base64Encode","str","isBrowser","btoa","encodeURIComponent","replace","_","p1","String","fromCharCode","parseInt","Buffer","from","toString","sdkVersion","window","document","isNodeJS","process","versions","node","isReactNative","isExpo","fetchImpl","FormDataImpl","import","then","nodeFetch","default","FormDataNode","fetch","FormData","navigator","undefined","mediaDevices","MediaStream","MediaStreamTrack","RTCIceCandidate","RTCPeerConnection","RTCRtpReceiver","RTCRtpSender","RTCSessionDescription","isWebRTCAvailable","Boolean","adapter","AddressBookUserDataType","LoginProviderNames","CallSignalingType","CallSessionConnectionState","CallSessionState","CallType","CallEvent","PeerConnectionState","ChatType","ChatEvent","PrivacyListAction","ChatProtocol","JanusDebugMode","DataPermission","DataPermissionAccess","DialogType","LastMessageMessageStatus","DialogDateProp","DeviceInputType","JanusEvent","JanusCallType","JanusMediaTrackReason","ConferenceEvent","MediaType","MeetingDateMetric","ProxyMethod","ProxyType","NotificationChannel","DevicePlatform","PushEnvironment","Config","constructor","this","version","creds","appId","authKey","endpoints","api","chat","muc","chatProtocol","bosh","websocket","active","streamManagement","enable","reconnect","timeInterval","videochat","alwaysRelayCalls","answerTimeInterval","dialingTimeInterval","disconnectTimeInterval","statsReportTimeInterval","iceServers","urls","username","credential","conference","server","debug","ALL","whiteboard","linkpreview","session","login","users","blobs","subscriptions","events","data","addressbook","meetings","whiteboards","unfurl","calls","type","on","sessionExpired","xmppDataWrite","xmppDataRead","timeout","mode","getInstance","instance","set","options","Object","keys","forEach","key","hasOwnProperty","optionValue","nextKey","config","Utils","safeCallbackCall","cb","args","err","console","error","getUrl","base","res","ext","resource","extension","isArray","arg","Array","isObject","obj","prototype","call","getBsonObjectId","ObjectId","machine","Math","floor","random","pid","increment","timestamp","Date","now","padStart","DLog","loggers","length","logger","push","log","callTrafficUsageCallback","callbackName","getStringSize","Blob","size","getDataSize","body","b","headers","h","JSON","stringify","cloneObject","escapeNull","json","jsonObject","parse","env","AddressBookService","proxy","route","uploadAddressBook","list","params","Error","ajaxParams","POST","url","contacts","ajax","get","udid","GET","getRegisteredUsers","compact","AuthService","routes","setSession","getSession","async","createSession","generateCreateSessionParams","response","setCurrentUserId","user_id","destroySession","DELETE","dataType","TEXT","user","id","logout","message","application_id","auth_key","password","email","provider","firebase_phone","firebase_email","xml","_xml","DialogsService","subscribeToPublic","subscribe","unsubscribeFromPublic","unsubscribe","create","occupants_ids","join","admins_ids","update","PUT","idOrIds","idsToDelete","split","map","trim","addAdmins","push_all","removeAdmins","pull_all","updateNotificationsSettings","enabled","getNotificationsSettings","getPublicOccupants","clearHistory","MessagesService","createSystem","unreadCount","chat_dialog_ids","listReactions","addReaction","reaction","updateReaction","removeReaction","add","remove","putReaction","ChatUtils","buildUserJid","userId","jid","buildUserJidLocalPart","createMessageStanza","attrs","createIqStanza","createPresenceStanza","createNonza","name","getAttr","element","getElement","getChild","getName","getText","getChildElements","isErrorStanza","getAllElements","getChildren","getElementText","getChildText","getElementTreePath","elementsPath","reduce","prevElement","assignObjectToXml","c","t","up","assignExtraParamsToXml","extraParams","attachment","assignXmlToObject","children","item","assign","parseExtraParams","attachments","dialogId","dialog_id","moduleIdentifier","buildErrorFromXMPPErrorStanza","errorStanza","errorElement","code","info","getUniqueId","suffix","uuid","r","parseReactions","items","ChatHelpers","xmppJID","userCurrentJid","isNumeric","value","test","jidOrUserId","getUserJid","includes","getRoomJidFromDialogId","typeChat","getUserNickWithMucDomain","getUserIdFromJID","getDialogIdFromJID","getRoomJid","getIdFromResource","parts","slice","getRoomJidFromRoomFullJid","getUserIdFromRoomJid","roomJid","getDialogJid","identifier","indexOf","NonzaName","StreamManagement","xmlns","clientHandledCounter","serverHandledCounter","messagesQueue","Set","elementHandler","stanza","ENABLED","REQUEST","ANSWER","nextHandledCounter","currHandledCounter","Number","isNaN","diffHandledCounter","markMessagesQueueAsSent","markMessagesQueueAsLostByTimeout","sendNonza","supported","WS","start","removeElementHandler","addElementHandler","ENABLE","stop","markMessagesQueueAsLost","sendAndCount","isMessage","isChat","CHAT","GROUPCHAT","isContent","xmppClient","sendOnline","markMessageAsLost","markMessageAsSent","onSentMessageCallback","delete","clear","iterations","iterator","values","i","done","next","clearTimeout","messagesQueueClearTimer","ackTimeout","acknowledgementTimeout","setTimeout","nonza","removeListener","PrivacyList","helpers","stanzasCallbacks","Promise","resolve","reject","privacyList","acc","action","mutualBlock","privacyListKeys","iqParams","iq","index","j","len","isMutual","userJid","userMuc","assignPrivacyItem","order","getList","_reject","query","filter","currentList","Map","currentListItem","ALLOW","updatedItem","updatedListItems","updatedList","getNames","defaultElement","activeElement","defaultName","activeName","allNames","names","setAsDefault","MultiUserChat","joinedRooms","dialogIdOrJid","dialogJid","presenceStanza","to","maxstanzas","x","status","isJoin","endsWith","isError","errorResponse","leave","_stanza","listOnlineUsers","iqStanza","stanzaId","ChatService","isConnected","isConnecting","isLogout","isReconnect","xmppClientListeners","connectPromise","earlyIncomingMessagesQueue","dialog","credentials","domain","service","entity","_Client","_reconnect","_websocket","middleware","_middleware","streamFeatures","_streamFeatures","iqCaller","_iqCaller","iqCallee","_iqCallee","starttls","_resolve","sasl","_sasl","resourceBinding","_resourceBinding","sessionEstablishment","_sessionEstablishment","mechanisms","entries","plain","anonymous","k","v","send","auth","_mechanism","delay","privacylist","connectionStatus","connect","removeAllXMPPClientListeners","addXMPPClientListener","postConnectActions","onDisconnectedListener","disconnect","onChatStatusListener","is","onPresence","onIQ","onSystemMessage","onMessageError","onMessage","condition","onConnectionErrorListener","catch","ping","pingWithTimeout","race","messageId","messageStanza","markable","sendSystemMessage","sendIsTypingStatus","sendIsStopTypingStatus","sendDeliveredStatus","sendReadStatus","editMessage","originMessageId","last","deleteMessage","getLastUserActivity","onLastActivityStanza","seconds","onLastUserActivityListener","markActive","markInactive","terminate","socket","end","search","start_date","toISOString","end_date","rawStanza","forwardedStanza","invite","getResource","delivered","read","replaceSubElement","reactionsSubElement","removeSubElement","composing","paused","isForwarded","isGroup","recipient","recipientId","currentUserJid","currentUserId","onMessageTypingListener","onMessageUpdateListener","onMessageReactionsListener","onMessageDeleteListener","onDeliveredStatusListener","onReadStatusListener","recipient_id","is_forwarded","onMessageListener","statusCode","startsWith","mucUserId","actorElement","initiatorUserJid","initiatorId","onKickOccupant","listenerName","onSystemMessageListener","webrtcSignalingProcessor","onMessageErrorListener","presence","enableCarbons","onReconnectListener","stanzasCallback","setSubscriptionToUserLastActivity","user_jid","subscribeToUserLastActivityStatus","unsubscribeFromUserLastActivityStatus","listener","removeXMPPClientListener","getListenerByName","STATUS","ERROR","DISCONNECTED","RECONNECTED","MESSAGE","SYSTEM_MESSAGE","ERROR_MESSAGE","TYPING_MESSAGE","UPDATE_MESSAGE","DELETE_MESSAGE","REACTIONS_MESSAGE","DELIVERED_MESSAGE","READ_MESSAGE","SENT_MESSAGE","USER_LAST_ACTIVITY","JOIN","LEAVE","KICK","addListener","bind","removeAllListeners","require$$0","Janus","sessions","mobile","isExtensionEnabled","getDisplayMedia","userAgent","match","chromever","maxver","isInstalled","defaultExtension","extensionId","querySelector","getScreen","callback","pending","cache","postMessage","init","addEventListener","event","origin","location","sourceId","gatewayCallbacks","success","noop","destroyed","initDone","isWebrtcSupported","websockets","ws","wsHandlers","wsKeepaliveTimeoutId","servers","serversIndex","iceTransportPolicy","bundlePolicy","withCredentials","maxev","max_poll_events","token","apisecret","destroyOnUnload","keepAlivePeriod","longPollTimeout","getMaxBitrates","simulcastMaxBitrates","maxBitrates","high","medium","low","connected","sessionId","pluginHandles","that","retries","transactions","eventHandler","warn","longpoll","getTime","httpAPICall","verb","handleEvent","textStatus","errorThrown","skipTimeout","transaction","reportSuccess","sender","pluginHandle","candidate","webrtcStuff","pc","remoteSdp","completed","addIceCandidate","endOfCandidates","candidates","webrtcState","hangup","ondetached","detach","mediaState","slowLink","reason","plugindata","jsep","onmessage","close","vdebug","keepAlive","request","janus","session_id","randomString","callbacks","onopen","onerror","onclose","newWebSocket","open","eventName","sendMessage","handleId","sdp","e2ee","rid_order","force_relay","sendTrickleCandidate","createDataChannel","dclabel","dcprotocol","incoming","pendingData","onDataChannelStateChange","label","target","protocol","dcState","dataChannel","readyState","ondataopen","dcoptions","dataChannelOptions","ondata","sendData","text","dataChanDefaultLabel","sendDtmf","dtmfSender","audioSender","getSenders","find","track","kind","dtmf","ontonechange","tone","tones","duration","gap","insertDTMF","destroyHandle","noRequest","cleanupWebrtc","detached","createPeerconnectionIfNeeded","pc_config","insertableStreams","tracks","transforms","receiver","createEncodedStreams","createEncodedAudioStreams","createEncodedVideoStreams","forceEncodedAudioInsertableStreams","forceEncodedVideoInsertableStreams","encodedInsertableStreams","getStats","volume","bitrate","trickle","oniceconnectionstatechange","iceState","iceConnectionState","onicecandidate","iceDone","mySdp","localDescription","sdpSent","sendSDP","sdpMid","sdpMLineIndex","ontrack","streams","mid","transceiver","_mid","onremotetrack","e","onended","trackMutedTimeoutId","ev","transceivers","getTransceivers","_receiver","_track","onmute","onunmute","prepareWebrtc","offer","webrtcError","media","mediaToTracks","simulcast","simulcast2","svc","captureDevices","setRemoteDescription","answer","customizeSdp","createAnswer","setLocalDescription","mediaConstraints","iceRestart","createOffer","prepareWebrtcPeer","replaceTracks","openedConsentDialog","groups","gumGroup","capture","group","audio","video","ondatachannel","channel","nt","trackId","replaceTrack","stream","getAudioTracks","getVideoTracks","consentDialog","constraints","trackConstraints","otherType","otherTrack","otherConstraints","getUserMedia","newDirection","recv","direction","setDirection","myStream","addTrack","webRTCAdapter","browserDetails","browser","addTransceiver","sendEncodings","rid","maxBitrate","scaleResolutionDownBy","parameters","getParameters","encodings","setParameters","scalabilityMode","codec","mimeType","toLowerCase","codecs","getCapabilities","setCodecPreferences","framerate","maxFramerate","senderStreams","createAudioEncodedStreams","readableStream","writableStream","pipeThrough","pipeTo","readable","writable","receiverStreams","dontStop","rt","removeTrack","onlocaltrack","curdir","newdir","getLocalTracks","tr","getRemoteTracks","getVolume","remote","result","stats","remoteSource","audioLevel","isMuted","mute","videostream","audiostream","getBitrate","timer","bsnow","bsbefore","tsnow","tsbefore","setInterval","inStats","mediaType","bytesReceived","googCodecName","timePassed","bitRate","round","setBitrate","hangupRequest","clearInterval","streamExternal","stopAllTracks","oncleanup","getServer","getSessionId","getInfo","destroy","unload","notifyDestroyed","cleanupHandles","sendBeacon","unbindWebSocket","removeEventListener","onUnbindMessage","onUnbindError","attach","ordered","plugin","opaqueId","loopIndex","handleToken","opaque_id","loop_index","started","getId","getPlugin","getRemoteVolume","getLocalVolume","isAudioMuted","muteAudio","unmuteAudio","isVideoMuted","muteVideo","unmuteVideo","setMaxBitrate","handleRemoteJsep","sendRequest","createHandle","useDefaultDependencies","deps","f","p","socketCls","WebSocket","proto","arr","fetchOptions","method","Accept","fetching","timerId","ok","parsed","useOldDependencies","jq","jQuery","payload","contentType","xhrFields","extend","xhr","keepAudio","audioSend","audioRecv","addAudio","replaceAudio","removeAudio","keepVideo","videoSend","videoRecv","addVideo","replaceVideo","removeVideo","screenshareFrameRate","frameRate","screenshareHeight","height","screenshareWidth","width","ideal","getTracks","mst","trace","d","usedDependencies","dependencies","listDevices","isGetUserMediaAvailable","enumerateDevices","devices","safariVp8","testpc","offerToReceiveVideo","charSet","randomPoz","charAt","JanusClient","videoRoomPlugin","isOnlyAudio","currentRoomId","remoteFeeds","remoteJseps","remoteFeedsAttachingInProgress","bitrateTimers","emitter","EventEmitter","timeoutSessionCallback","JanusEngine","engine","attachVideoConferencingPlugin","isRemote","skipMedia","remoteFeed","localStream","displayName","listen","room","ptype","feed","display","uplink","nacks","msg","feedId","offerParams","publishers","userDisplayName","emit","PARTICIPANT_JOINED","detachRemoteFeed","PARTICIPANT_LEFT","onLocalTrack","metadata","onRemoteTrack","channelLabel","DATA_CHANNEL_OPEN","DATA_CHANNEL_MESSAGE","eventType","CREATED","isStreamNoExistedBefore","REMOTE_STREAM","ENDED","trackToRemove","streamTrack","REMOTE_TRACKS_UPDATED","getPluginId","detachVideoConferencingPlugin","clean","roomId","joinEvent","resp","leaveEvent","listOnlineParticipants","listRequest","participants","toggleAudioMute","toggleRemoteAudioMute","audioTracks","isRemoteAudioMuted","toggleVideoMute","toggleRemoteVideoMute","videoTracks","isRemoteVideoMuted","sendKeyframeRequest","configureRequest","keyframe","getTracksFromStream","audioTrack","videoTrack","mediaParams","existedStream","createOfferParams","tracksFromStream","concat","tracksFromParams","publish","getTracksMidsFromStream","getUserBitrate","resultCallback","getUserVolume","showBitrate","hideBitrate","ConferenceSession","onParticipantJoined","isExistingParticipant","createHandler","onParticipantJoinedListener","onParticipantLeft","onParticipantLeftListener","onError","onErrorListener","onDataChannelOpen","onDataChannelOpenedListener","onDataChannelMessage","onDataChannelMessageListener","onLocalIceStateChanged","onSessionConnectionStateChangedListener","onRemoteIceStateChanged","onRemoteConnectionStateChangedListener","onRemoteStream","onRemoteStreamListener","onRemoteTracksUpdated","onRemoteTracksUpdatedListener","onSlowLink","onSlowLinkListener","client","currentPublisherPC","isResolved","currentUserDisplayName","joinInternal","joinAsListener","listOfOnlineParticipants","leaveGroup","elementId","upsertStream","shouldUpdateCurrentStream","detachMediaStream","attachMediaStream","localTrack","AUDIO","newTrack","every","switchMediaTracks","VIDEO","device","deviceId","getRemoteUserBitrate","getRemoteUserVolume","opt","mediaElement","getElementById","srcObject","style","transform","mirror","muted","onloadedmetadata","_event","play","pause","ConferenceClient","sessionsStore","createNewSession","getCurrentSessionToken","getMediaDevices","clearSession","currentSession","LEFT","SLOW_LINK","REMOTE_CONNECTION_STATE","DATA_CHANNEL_OPENED","SESSION_CONNECTION_STATE","DataService","className","isMany","multi","record","createRecord","readPermissions","permissions","isSearch","search_criteria","_id","isCriteria","isOne","MeetingsService","startTimestamp","ceil","endTimestamp","defaultParams","toLocaleString","year","month","day","hour","minute","attendees","getRecordings","ProxyService","sdkInstance","requestsNumber","abortControllersMap","requestMethod","responseType","getCurrentUserId","logRequest","requestId","logResponse","buildRequestAndURL","isGetOrHeadType","isPostOrPutType","isInternalRequest","isMultipartFormData","requestBody","requestURL","requestObject","buildRequestBody","useArrayQuery","dataObject","fileToCustomObject","append","serializeQueryParams","prefix","level","propName","propQueryName","isArrayVal","sort","uriComponent","charCodeAt","abortRequest","abortId","controllers","controller","abort","processSuccessfulOrFailedRequest","abort_id","doneRequestsCount","AbortController","signal","processAjaxResponse","processAjaxError","responseBody","errors","errorObject","errno","isExpiredSessionError","handleExpiredSessionResponse","handleResponse","retryCallback","PushNotificationsService","SubscriptionsService","EventsService","StorageService","blob","createAndUpload","file","content_type","public","isPublic","createParams","blobObject","uri","parseUri","blob_object_access","uploadParams","authority","path","queryKey","decodeURIComponent","upload","markUploaded","getFile","uid","getFileObject","privateUrl","fileUID","publicUrl","q","parser","strict","loose","m","exec","$0","$1","$2","UsersService","getV2","signup","resetPassword","listOnline","getOnlineCount","count","filters","dateFields","numberFields","extensions","full_name","facebook_id","twitter_id","phone","tags","external","generateFilter","field","param","WebRTCHelpers","traceWarning","traceError","getVersionFirefox","ua","ffInfo","getVersionSafari","sVer","WebRTCPeerConnection","userID","remoteSDP","state","NEW","iceCandidates","remoteStream","onStatusClosedChecker","dialingTimer","statsReportTimer","waitingReconnectTimeoutCallback","released","onMediaTrackHandler","callType","getWrappedStats","onIceCandidateHandler","iceCandidate","signalingState","original","canTrickleIceCandidates","processIceCandidates","onSignalingStateHandler","onIceConnectionStateHandler","CHECKING","onSessionConnectionStateChanged","CONNECTING","CONNECTED","clearWaitingReconnectTimer","COMPLETED","FAILED","startWaitingReconnectTimer","CLOSED","setup","rtcConfiguration","startCallTime","release","closeSessionIfAllConnectionsClosed","clearStatsReportTimer","addCandidates","clearDialingTimer","getAndSetLocalSessionDescription","maxBandwidth","offerOptions","sessionDescription","setRTCRtpSenderMaxBandwidth","senders","encoding","startDialingTimer","withOnNotAnswerCallback","dialingCallback","skipIncrement","processOnNotAnswer","processCall","setRemoteSessionDescription","desc","lastResult","getStatsCustom","results","lastResults","onCallStatsReport","sdpRemote","ID","onSuccess","onFail","statistic","local","localVideoSettings","getSettings","frameHeight","frameWidth","getBitratePerSecond","packetsReceived","framerateMean","framesPerSecond","bytesSent","packetsSent","candidateType","mozLocalTransport","transport","ip","ipAddress","port","portNumber","getFramesPerSecond","isLocal","framesSent","framesReceived","selector","description","WebRTCSession","opponentsIDs","peerConnections","answerTimer","waitingOfferOrAnswerTimer","acceptCallTime","generateUUID","setMaxBandwidth","peers","peersKeys","all","connectionStateForUser","peerConnection","constrains","prepareExtension","ACTIVE","userInfo","callInternal","accept","clearAnswerTimer","acceptInternal","initiatorID","currentUserID","startWaitingOfferOrAnswerTimer","opponentID","sessionID","callerID","signalingProvider","ACCEPT","REJECTED","REJECT","STOPPED","STOP","canInitiateIceRestart","RESTART","processOnCall","rtcSdpType","startAnswerTimer","processOnAccept","processOnReject","clearWaitingOfferOrAnswerTimer","processOnStop","pcKeys","processOnIceCandidates","processOnIceRestart","RESTART_ACCEPT","processOnIceRestartAccept","CALL","sendCandidate","onUserNotAnswerListener","onCallStatsReportListener","connectionState","closeLocalMediaStream","onSessionCloseListener","isAllClosed","isClosed","muteStream","unmute","NONE","timeWait","timeDiff","min","max","WebRTCSignalingProcessor","delegate","getExtension","signalType","onCallHandler","onAcceptHandler","onRejectHandler","onStopHandler","CANDIDATE","onIceCandidatesHandler","onIceRestartHandler","onIceRestartAcceptHandler","child","childName","childText","WebRTCSignalingProvider","signalingConnection","signalingType","platform","opponentId","WebRTCClient","connection","SessionConnectionState","onDevicesChangeListener","signalingProcessor","ondevicechange","userJID","bandwidth","createAndStoreSession","webRTCSession","callRejectRequest","onCallListener","onAcceptCallListener","onRejectCallListener","onInvalidEventsListener","onStopCallListener","INVALID","NOT_ANSWER","CONNECTION_STATE","CLOSE","STATS_REPORT","DEVICES","WhiteboardService","getURL","title","paramsOrId","chat_dialog_id","LinkPreviewService","has","linkPreview","getHostFromUrl","images","URL","hostname","ConnectyCube","configMap","utils","storage","pushnotifications","ChatClient","meeting","videochatconference","connectycube"],"mappings":"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"}